import Ju from"node:http";import{apiReference as Yu}from"@scalar/express-api-reference";import $u from"cors";import Sn from"express";import op from"zod";var H=class extends Error{};var N=class extends Error{};var a=class extends Error{};var f=class extends Error{};var Z=class extends Error{};import{ZodError as rp}from"zod";var ut=class extends rp{};var lt=class{handle(e,r,t,i){return e instanceof ut?t.status(400).json({message:"Validation error",error:op.treeifyError(e)}):e instanceof H?t.status(400).json({message:e.message}):e instanceof f?t.status(404).json({message:e.message}):e instanceof Z?t.status(401).json({message:e.message}):e instanceof N?t.status(409).json({message:e.message}):e instanceof a?t.status(500).json({message:e.message}):t.status(500).json({message:"Internal server error"})}};function vn(){return{errorHandler:new lt}}import{OpenAPIRegistry as Xd,OpenApiGeneratorV3 as Jd}from"@asteasolutions/zod-to-openapi";import{$Enums as En}from"@prisma/client";import c from"zod";import{extendZodWithOpenApi as ip}from"@asteasolutions/zod-to-openapi";import je from"zod";var np=1,sp=6;ip(je);var vo=je.object({page:je.coerce.number().min(1).default(np),limit:je.coerce.number().min(1).default(sp),title:je.string().optional(),description:je.string().optional(),orderBy:je.enum(["asc","desc"]).default("desc")}),ft=class{constructor(e){this.certificationRepository=e}async handle(e,r){try{let{title:t,description:i,limit:n,orderBy:s,page:m}=vo.parse(e.query),p=m*n-n,u=e.user.id,[T,P]=await Promise.all([this.certificationRepository.findByUserId({userId:u,pagination:{offset:p,limit:n},filter:{title:t,description:i,orderBy:s}}),this.certificationRepository.count({filter:{title:t,description:i,userId:u}})]),B=Math.max(Math.ceil(P/n),1);return r.status(200).json({page:m,totalPages:B,offset:p,limit:n,totalCertifications:P,certifications:T})}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as ap}from"@asteasolutions/zod-to-openapi";import xe from"zod";var mp=1,pp=7;ap(xe);var Eo=xe.object({page:xe.coerce.number().min(1).default(mp),limit:xe.coerce.number().min(1).default(pp),title:xe.string().optional(),content:xe.string().optional(),orderBy:xe.enum(["asc","desc"]).default("desc")}),yt=class{constructor(e){this.newsRepository=e}async handle(e,r){try{let{page:t,limit:i,content:n,orderBy:s,title:m}=Eo.parse(e.query),p=i*t-i,u=e.user.id,[T,P]=await Promise.all([this.newsRepository.findByAuthorId({authorId:u,pagination:{offset:p,limit:i},filter:{orderBy:s,title:m,content:n}}),this.newsRepository.count({filter:{authorId:u,content:n,title:m}})]),B=Math.ceil(P/i);r.status(200).json({page:t,totalPages:B,offset:p,limit:i,news:T})}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as cp}from"@asteasolutions/zod-to-openapi";import{PendencyStatus as dp}from"@prisma/client";import de from"zod";var up=1,lp=6;cp(de);var jo=de.object({page:de.coerce.number().min(1).default(up),limit:de.coerce.number().min(1).default(lp),title:de.string().optional(),description:de.string().optional(),status:de.enum(dp).default("PENDING"),orderBy:de.enum(["asc","desc"]).default("desc")}),gt=class{constructor(e){this.pendencyRepository=e}async handle(e,r){try{let{limit:t,page:i,...n}=jo.parse(e.query),s=i*t-t,m=e.user.id,[p,u]=await Promise.all([this.pendencyRepository.findByUserId({userId:m,pagination:{offset:s,limit:t},filter:n}),this.pendencyRepository.count({filter:{...n,userId:m}})]),T=Math.max(Math.ceil(u/t),1);return r.status(200).json({page:i,totalPages:T,offset:s,limit:t,pendencies:p})}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as fp}from"@asteasolutions/zod-to-openapi";import ht from"zod";fp(ht);var xo=ht.object({password:ht.string(),email:ht.email()}),Rt=class{constructor(e,r,t){this.userRepository=e;this.bcrypt=r;this.jwtService=t}async handle(e,r){try{let{email:t,password:i}=xo.parse(e.body),n=await this.userRepository.findByEmail(t);if(!n)return r.status(401).json({message:"Usu\xE1rio n\xE3o existe."});if(!await this.bcrypt.compare({password:i,hashedPassword:n.passwordHash}))throw new Z("Senha inv\xE1lida.");let{id:m,role:p}=n,u=this.jwtService.sign({id:m,role:p,email:t});return r.status(200).json({token:u})}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as yp}from"@asteasolutions/zod-to-openapi";import We from"zod";var It=8;yp(We);var To=We.object({name:We.string("Nome \xE9 obrigat\xF3rio.").min(1,"Nome \xE9 obrigat\xF3rio."),emailAddress:We.email("E-mail inv\xE1lido.").min(1,"E-mail \xE9 obrigat\xF3rio."),password:We.string("A senha \xE9 obrigat\xF3ria.").min(It,`A senha deve ter pelo menos ${It} caracteres.`),confirmPassword:We.string("A senha \xE9 obrigat\xF3ria.").min(It,`A senha deve ter pelo menos ${It} caracteres.`)}).refine(o=>o.password===o.confirmPassword,{message:"As senhas n\xE3o coincidem.",path:["confirmPassword"]}),bt=class{constructor(e,r){this.userRepository=e;this.bcrypt=r}async handle(e,r){try{let{emailAddress:t,name:i,password:n}=To.parse(e.body);if(await this.userRepository.findByEmail(t))throw new N("Usu\xE1rio j\xE1 existe.");let m=await this.bcrypt.hash(n);return await this.userRepository.create({name:i,emailAddress:t,passwordHash:m}),r.status(201).json()}catch(t){if(t instanceof Error)throw new a(t.message)}}};var jn={method:"post",path:"/auth/sign-up",tags:["Authentication"],summary:"Create a new user",request:{body:{content:{"application/json":{schema:To}}}},responses:{201:{description:"User created successfully",summary:"User Registration Successful",content:{"application/json":{schema:c.object({message:c.string()})}}},400:{description:"Invalid input data provided",summary:"Validation Error",content:{"application/json":{schema:c.object({errors:c.record(c.string(),c.string())})}}},409:{description:"User already exists with this email",summary:"User Already Exists",content:{"application/json":{schema:c.object({message:c.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:c.object({message:c.string()})}}}}},xn={method:"post",path:"/auth/sign-in",tags:["Authentication"],summary:"Sign in",request:{body:{content:{"application/json":{schema:xo}}}},responses:{200:{description:"Authentication successful, JWT token returned",summary:"Login Successful",content:{"application/json":{schema:c.object({token:c.string()})}}},400:{description:"Invalid credentials or input data",summary:"Validation Error",content:{"application/json":{schema:c.object({errors:c.record(c.string(),c.string())})}}},401:{description:"Invalid email or password",summary:"Authentication Failed",content:{"application/json":{schema:c.object({message:c.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:c.object({message:c.string()})}}}}},Tn={method:"get",path:"/auth/user",tags:["Authentication"],summary:"Search for authenticated user",security:[{bearerAuth:[]}],responses:{200:{description:"Authenticated user information retrieved successfully",summary:"User Information Retrieved",content:{"application/json":{schema:c.object({name:c.string(),id:c.string(),avatarUrl:c.string().nullable(),createdAt:c.date(),updatedAt:c.date(),emailAddress:c.string(),orcid:c.string().nullable(),phone:c.string().nullable(),lattesUrl:c.string().nullable(),role:c.enum(En.UserRole)}).nullable()}}},400:{description:"Invalid request parameters",summary:"Validation Error",content:{"application/json":{schema:c.object({errors:c.record(c.string(),c.string())})}}},404:{description:"User not found or not authenticated",summary:"User Not Found",content:{"application/json":{schema:c.object({message:c.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:c.object({message:c.string()})}}}}},Pn={method:"get",path:"/auth/user/news",tags:["Authentication"],summary:"List authenticated user news",security:[{bearerAuth:[]}],request:{query:Eo},responses:{200:{description:"Paginated list of authenticated user news retrieved successfully",summary:"User News Retrieved",content:{"application/json":{schema:c.object({page:c.number(),totalPages:c.number(),offset:c.number(),limit:c.number(),news:c.object({content:c.string(),id:c.string(),title:c.string(),createdAt:c.date(),updatedAt:c.date(),imageUrl:c.string().nullable()})})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:c.object({errors:c.record(c.string(),c.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:c.object({message:c.string()})}}}}},An={method:"get",path:"/auth/admin",tags:["Authentication"],summary:"Verify admin access",security:[{bearerAuth:[]}],responses:{200:{description:"Admin access verified successfully",summary:"Admin Access Granted",content:{"application/json":{schema:c.object({success:c.boolean()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:c.object({message:c.string()})}}}}},Un={method:"get",path:"/auth/certifications",tags:["Authentication"],summary:"List all authenticated user's certifications",security:[{bearerAuth:[]}],request:{query:vo},responses:{200:{description:"Paginated list of authenticated user certifications retrieved successfully",summary:"User Certifications Retrieved",content:{"application/json":{schema:c.object({page:c.number(),totalPages:c.number(),offset:c.number(),limit:c.number(),certifications:c.object({description:c.string(),id:c.string(),title:c.string(),certificationUrl:c.string(),createdAt:c.date(),updatedAt:c.date(),userId:c.string()})})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:c.object({errors:c.record(c.string(),c.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:c.object({message:c.string()})}}}}},Dn={method:"get",path:"/auth/pendencies",tags:["Authentication"],summary:"List all authenticated user's pendencies",security:[{bearerAuth:[]}],request:{query:jo},responses:{200:{description:"Paginated list of authenticated user pendencies retrieved successfully",summary:"User Pendencies Retrieved",content:{"application/json":{schema:c.object({page:c.number(),totalPages:c.number(),offset:c.number(),limit:c.number(),pendencies:c.object({id:c.string(),title:c.string(),description:c.string(),status:c.enum(En.PendencyStatus),createdAt:c.date(),updatedAt:c.date(),userId:c.string()})})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:c.object({errors:c.record(c.string(),c.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:c.object({message:c.string()})}}}}};import{$Enums as Mp}from"@prisma/client";import R from"zod";import{extendZodWithOpenApi as gp}from"@asteasolutions/zod-to-openapi";import Po from"zod";gp(Po);var Ao=Po.object({id:Po.string()}),wt=class{constructor(e,r){this.certificationRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t}=Ao.parse({id:e.params.certification_id}),i=await this.certificationRepository.findById(t);if(!i)throw new f("A certifica\xE7\xE3o n\xE3o existe.");return await Promise.all([this.certificationRepository.deleteById(i.id),this.firebaseStorageService.deleteFile({fileUrl:i.certificationUrl})]),r.sendStatus(204)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as hp}from"@asteasolutions/zod-to-openapi";import Uo from"zod";hp(Uo);var Do=Uo.object({certificationId:Uo.uuid()}),Ct=class{constructor(e){this.certificationRepository=e}async handle(e,r){try{let{certificationId:t}=Do.parse({certificationId:e.params.certification_id}),i=await this.certificationRepository.findById(t);if(!i)throw new f("Certificado n\xE3o encontrado.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Rp}from"@asteasolutions/zod-to-openapi";import ue from"zod";var Ip=1,bp=6;Rp(ue);var Fo=ue.object({page:ue.coerce.number().min(1).default(Ip),limit:ue.coerce.number().min(1).default(bp),title:ue.string().optional(),description:ue.string().optional(),userId:ue.uuid().optional(),orderBy:ue.enum(["asc","desc"]).default("desc")}),Mt=class{constructor(e){this.certificationRepository=e}async handle(e,r){try{let{limit:t,page:i,...n}=Fo.parse(e.query),s=i*t-t,[m,p]=await Promise.all([this.certificationRepository.find({pagination:{offset:s,limit:t},filter:n}),this.certificationRepository.count({filter:n})]),u=Math.max(Math.ceil(p/t),1);return r.status(200).json({page:i,totalPages:u,offset:s,limit:t,certifications:m})}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as wp}from"@asteasolutions/zod-to-openapi";import Ze from"zod";var U={NEWS:"images/news",USER:"images/user",IN_MEMORIAM:"images/in-memoriam",PARTNER:"images/partners",CERTIFICATION:"documents/certifications",PENDENCY:"documents/pendencies",REGIMENT:"documents/regiments",MEETING_MINUTE:"documents/meeting-minutes"};wp(Ze);var vt=Ze.object({userId:Ze.uuid(),title:Ze.string().min(1,"T\xEDtulo \xE9 obrigat\xF3rio."),description:Ze.string().min(1,"Descri\xE7\xE3o \xE9 obrigat\xF3ria."),certification:Ze.any().refine(o=>o&&typeof o=="object"&&o.size>0,"Arquivo do certificado \xE9 obrigat\xF3rio")}),St=class{constructor(e,r,t){this.userRepository=e;this.certificationRepository=r;this.firebaseStorageService=t}async handle(e,r){try{let{userId:t,title:i,description:n,certification:s}=vt.parse({...e.body,userId:e.params.user_id,certification:e.file});if(!await this.userRepository.findById(t))throw new H("O usu\xE1rio n\xE3o existe.");let p=await this.firebaseStorageService.uploadFile({file:s,id:t,folder:U.CERTIFICATION});return await this.certificationRepository.register({userId:t,title:i,description:n,certificationUrl:p}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Cp}from"@asteasolutions/zod-to-openapi";import Ve from"zod";Cp(Ve);var jt=Ve.object({id:Ve.uuid(),title:Ve.string().min(1,"T\xEDtulo \xE9 obrigat\xF3rio."),description:Ve.string().min(1,"Descri\xE7\xE3o \xE9 obrigat\xF3ria."),certification:Ve.any().refine(o=>o==null||typeof o=="object"&&typeof o.size=="number"&&(o.size===0||o.size>0),"Arquivo do certificado \xE9 inv\xE1lido").optional()}),Et=class{constructor(e,r){this.certificationRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{certification:t,id:i,...n}=jt.parse({...e.body,id:e.params.certification_id,certification:e.file}),s=await this.certificationRepository.findById(i);if(!s)throw new H("A certifica\xE7\xE3o n\xE3o existe");let m=s.certificationUrl;return t&&t.size>0&&(m=await this.firebaseStorageService.updateFile({file:t,id:s.userId,folder:U.CERTIFICATION,fileUrl:s.certificationUrl})),await this.certificationRepository.update({...n,id:i,certificationUrl:m}),r.sendStatus(204)}catch(t){if(t instanceof Error)throw new a(t.message)}}};var Fn={method:"post",path:"/certifications/{user_id}",tags:["Certifications"],summary:"Register certification for user",security:[{bearerAuth:[]}],request:{params:vt.pick({userId:!0}).transform(()=>({user_id:""})),body:{content:{"multipart/form-data":{schema:vt.omit({userId:!0})}}}},responses:{201:{description:"Certification registered successfully for the user",summary:"Certification Registered",content:{"application/json":{schema:R.object({message:R.string()})}}},400:{description:"Invalid input data or file format",summary:"Validation Error",content:{"application/json":{schema:R.object({errors:R.record(R.string(),R.string())})}}},404:{description:"User not found with the provided ID",summary:"User Not Found",content:{"application/json":{schema:R.object({message:R.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:R.object({message:R.string()})}}}}},qn={method:"get",path:"/certifications",tags:["Certifications"],summary:"List certifications",security:[{bearerAuth:[]}],request:{query:Fo},responses:{200:{description:"Paginated list of certifications with user information retrieved successfully",summary:"Certifications Retrieved",content:{"application/json":{schema:R.object({page:R.number(),totalPages:R.number(),offset:R.number(),limit:R.number(),certifications:R.array(R.object({description:R.string(),userId:R.string(),title:R.string(),id:R.string(),createdAt:R.date(),updatedAt:R.date(),certificationUrl:R.url(),user:R.object({id:R.uuid(),name:R.string(),createdAt:R.date(),updatedAt:R.date(),avatarUrl:R.string().nullable(),emailAddress:R.email(),orcid:R.string().nullable(),phone:R.string().nullable(),lattesUrl:R.url().nullable(),role:R.enum(Mp.UserRole)})}))})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:R.object({errors:R.record(R.string(),R.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:R.object({message:R.string()})}}}}},Bn={method:"get",path:"/certifications/{certification_id}",tags:["Certifications"],summary:"Find certification by ID",security:[{bearerAuth:[]}],request:{params:Do},responses:{200:{description:"Certification details retrieved successfully",summary:"Certification Retrieved",content:{"application/json":{schema:R.object({description:R.string(),userId:R.string(),title:R.string(),id:R.string(),createdAt:R.date(),updatedAt:R.date(),certificationUrl:R.url()}).nullable()}}},400:{description:"Invalid certification ID format",summary:"Validation Error",content:{"application/json":{schema:R.object({errors:R.record(R.string(),R.string())})}}},404:{description:"Certification not found with the provided ID",summary:"Certification Not Found",content:{"application/json":{schema:R.object({message:R.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:R.object({message:R.string()})}}}}},On={method:"put",path:"/certifications/{certification_id}",tags:["Certifications"],summary:"Update certification",security:[{bearerAuth:[]}],request:{params:jt.pick({id:!0}).transform(()=>({certification_id:""})),body:{content:{"multipart/form-data":{schema:jt.omit({id:!0})}}}},responses:{204:{description:"Certification updated successfully",summary:"Certification Updated"},400:{description:"Invalid input data or file format",summary:"Validation Error",content:{"application/json":{schema:R.object({errors:R.record(R.string(),R.string())})}}},404:{description:"Certification not found with the provided ID",summary:"Certification Not Found",content:{"application/json":{schema:R.object({message:R.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:R.object({message:R.string()})}}}}},Nn={method:"delete",path:"/certifications/{certification_id}",tags:["Certifications"],summary:"Delete certification",security:[{bearerAuth:[]}],request:{params:Ao},responses:{204:{description:"Certification deleted successfully",summary:"Certification Deleted"},400:{description:"Invalid certification ID format",summary:"Validation Error",content:{"application/json":{schema:R.object({errors:R.record(R.string(),R.string())})}}},404:{description:"Certification not found with the provided ID",summary:"Certification Not Found",content:{"application/json":{schema:R.object({message:R.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:R.object({message:R.string()})}}}}};import{$Enums as Lo}from"@prisma/client";import l from"zod";import{extendZodWithOpenApi as Sp}from"@asteasolutions/zod-to-openapi";import $ from"zod";Sp($);var qo=$.object({code:$.string(),title:$.string(),description:$.string().optional(),notes:$.string().optional(),leaderId:$.uuid(),deputyLeaderId:$.uuid(),secretaryId:$.uuid(),memberIds:$.array($.uuid())}),xt=class{constructor(e){this.etpRepository=e}async handle(e,r){try{let{code:t,title:i,description:n,notes:s,leaderId:m,deputyLeaderId:p,secretaryId:u,memberIds:T}=qo.parse(e.body);if(await this.etpRepository.findByCode(t))throw new N("J\xE1 existe um ETP cadastrado com este c\xF3digo.");return await this.etpRepository.create({code:t,title:i,description:n,notes:s,leaderId:m,deputyLeaderId:p,secretaryId:u,memberIds:T}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as vp}from"@asteasolutions/zod-to-openapi";import Bo from"zod";vp(Bo);var Oo=Bo.object({id:Bo.uuid()}),Tt=class{constructor(e){this.etpRepository=e}async handle(e,r){try{let{id:t}=Oo.parse({id:e.params.id});if(!await this.etpRepository.findById(t))throw new f("O ETP n\xE3o existe.");return await this.etpRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Ep}from"@asteasolutions/zod-to-openapi";import No from"zod";Ep(No);var At=No.object({id:No.uuid()}),Pt=class{constructor(e){this.etpRepository=e}async handle(e,r){try{let{id:t}=At.parse({id:e.params.id}),i=await this.etpRepository.findById(t);if(!i)throw new f("O ETP n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as jp}from"@asteasolutions/zod-to-openapi";import V from"zod";jp(V);var ko=V.object({id:V.uuid(),code:V.string().optional(),title:V.string().optional(),description:V.string().optional(),notes:V.string().optional(),leaderId:V.uuid().optional(),deputyLeaderId:V.uuid().optional(),secretaryId:V.uuid().optional(),memberIds:V.array(V.uuid()).optional()}),Ut=class{constructor(e){this.etpRepository=e}async handle(e,r){try{let{id:t,code:i,title:n,description:s,notes:m,leaderId:p,deputyLeaderId:u,secretaryId:T,memberIds:P}=ko.parse({id:e.params.id,...e.body});if(!await this.etpRepository.findById(t))throw new f("O ETP n\xE3o existe.");if(i){let L=await this.etpRepository.findByCode(i);if(L&&L.id!==t)throw new N("J\xE1 existe um ETP com este c\xF3digo.")}return await this.etpRepository.update({id:t,code:i,title:n,description:s,notes:m,leaderId:p,deputyLeaderId:u,secretaryId:T,memberIds:P}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new a(t.message)}}};var xp=1,Tp=9,Dt=l.object({id:l.uuid(),registrationNumber:l.string(),mainEtps:l.string().nullable(),formations:l.string().nullable(),degrees:l.array(l.enum(Lo.Degree)),occupations:l.string(),seniority:l.enum(Lo.Seniority),institutions:l.string(),biography:l.string().nullable(),createdAt:l.date(),updatedAt:l.date(),user:l.object({id:l.uuid(),name:l.string(),emailAddress:l.string(),avatarUrl:l.string().nullable(),orcid:l.string().nullable(),phone:l.string().nullable(),lattesUrl:l.string().nullable(),role:l.enum(Lo.UserRole)})}),kn=l.object({id:l.uuid(),code:l.string(),title:l.string(),description:l.string().nullable(),notes:l.string().nullable(),createdAt:l.date(),updatedAt:l.date(),leader:l.object({id:l.uuid(),researcher:Dt}).nullable(),deputyLeader:l.object({id:l.uuid(),researcher:Dt}).nullable(),secretary:l.object({id:l.uuid(),researcher:Dt}).nullable(),members:l.array(Dt)}),Ln={method:"post",path:"/etp",tags:["ETPs"],summary:"Create a new ETP with single leader, deputy leader, secretary and multiple members",security:[{bearerAuth:[]}],request:{body:{content:{"application/json":{schema:qo}}}},responses:{201:{description:"ETP created successfully",summary:"ETP Created"},400:{description:"Invalid input data or missing required fields",summary:"Validation Error",content:{"application/json":{schema:l.object({errors:l.record(l.string(),l.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:l.object({message:l.string()})}}},409:{description:"ETP with this code already exists",summary:"Conflict",content:{"application/json":{schema:l.object({message:l.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:l.object({message:l.string()})}}}}},Hn={method:"get",path:"/etp",tags:["ETPs"],summary:"List all ETPs with pagination and filters",request:{query:l.object({page:l.coerce.number().min(1).default(xp).optional(),limit:l.coerce.number().min(1).default(Tp).optional(),code:l.string().optional(),title:l.string().optional(),description:l.string().optional(),notes:l.string().optional(),orderBy:l.enum(["asc","desc"]).optional()})},responses:{200:{description:"List of ETPs retrieved successfully with pagination",summary:"ETPs Retrieved",content:{"application/json":{schema:l.object({page:l.number(),totalPages:l.number(),offset:l.number(),limit:l.number(),etps:l.array(kn)})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:l.object({message:l.string()})}}}}},_n={method:"get",path:"/etp/{id}",tags:["ETPs"],summary:"Find ETP by ID",request:{params:At},responses:{200:{description:"ETP details retrieved successfully",summary:"ETP Retrieved",content:{"application/json":{schema:kn}}},400:{description:"Invalid ETP ID format",summary:"Validation Error",content:{"application/json":{schema:l.object({errors:l.record(l.string(),l.string())})}}},404:{description:"ETP not found with the provided ID",summary:"ETP Not Found",content:{"application/json":{schema:l.object({message:l.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:l.object({message:l.string()})}}}}},zn={method:"put",path:"/etp/{id}",tags:["ETPs"],summary:"Update ETP and manage user relationships (single leader, deputy leader, secretary, multiple members)",security:[{bearerAuth:[]}],request:{params:At,body:{content:{"application/json":{schema:ko.omit({id:!0})}}}},responses:{200:{description:"ETP updated successfully",summary:"ETP Updated"},400:{description:"Invalid input data or ETP ID format",summary:"Validation Error",content:{"application/json":{schema:l.object({errors:l.record(l.string(),l.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:l.object({message:l.string()})}}},404:{description:"ETP not found with the provided ID",summary:"ETP Not Found",content:{"application/json":{schema:l.object({message:l.string()})}}},409:{description:"ETP with this code already exists",summary:"Conflict",content:{"application/json":{schema:l.object({message:l.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:l.object({message:l.string()})}}}}},Wn={method:"delete",path:"/etp/{id}",tags:["ETPs"],summary:"Delete ETP",security:[{bearerAuth:[]}],request:{params:Oo},responses:{200:{description:"ETP deleted successfully",summary:"ETP Deleted"},400:{description:"Invalid ETP ID format",summary:"Validation Error",content:{"application/json":{schema:l.object({errors:l.record(l.string(),l.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:l.object({message:l.string()})}}},404:{description:"ETP not found with the provided ID",summary:"ETP Not Found",content:{"application/json":{schema:l.object({message:l.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:l.object({message:l.string()})}}}}};import{InMemoriamRole as Vp}from"@prisma/client";import b from"zod";import{extendZodWithOpenApi as Pp}from"@asteasolutions/zod-to-openapi";import{InMemoriamRole as Ap}from"@prisma/client";import le from"zod";var Vn=2,Zn=1024,Up=Zn*Zn,Dp=Vn*Up;Pp(le);var Ho=le.object({name:le.string().min(1,"Nome \xE9 obrigat\xF3rio"),birthDate:le.coerce.date(),deathDate:le.coerce.date(),biography:le.string().optional(),photo:le.any().refine(o=>o==null?!0:typeof o!="object"||typeof o.size!="number"?!1:o.size<=Dp,`A imagem deve ter no m\xE1ximo ${Vn}MB.`).optional(),role:le.enum(Ap)}).refine(o=>o.deathDate>o.birthDate,{message:"Data de falecimento deve ser posterior \xE0 data de nascimento",path:["deathDate"]}),Ft=class{constructor(e,r){this.inMemoriamRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{name:t,birthDate:i,deathDate:n,biography:s,role:m,photo:p}=Ho.parse({...e.body,photo:e.file}),u=await this.inMemoriamRepository.create({name:t,birthDate:i,deathDate:n,biography:s??void 0,role:m}),T;return p&&(T=await this.firebaseStorageService.uploadFile({file:p,id:u.id,folder:U.IN_MEMORIAM}),await this.inMemoriamRepository.update({id:u.id,photoUrl:T})),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Fp}from"@asteasolutions/zod-to-openapi";import _o from"zod";Fp(_o);var zo=_o.object({id:_o.uuid()}),qt=class{constructor(e,r){this.inMemoriamRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t}=zo.parse({id:e.params.id}),i=await this.inMemoriamRepository.findById(t);if(!i)throw new f("O in memoriam n\xE3o existe.");return i.photoUrl&&this.firebaseStorageService.deleteFile({fileUrl:i.photoUrl}),await this.inMemoriamRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as qp}from"@asteasolutions/zod-to-openapi";import Wo from"zod";qp(Wo);var Ot=Wo.object({id:Wo.uuid()}),Bt=class{constructor(e){this.inMemoriamRepository=e}async handle(e,r){try{let{id:t}=Ot.parse({id:e.params.id}),i=await this.inMemoriamRepository.findById(t);if(!i)throw new f("O in memoriam n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Bp}from"@asteasolutions/zod-to-openapi";import{InMemoriamRole as Op}from"@prisma/client";import Zo from"zod";Bp(Zo);var Vo=Zo.object({role:Zo.enum(Op)}),Nt=class{constructor(e){this.inMemoriamRepository=e}async handle(e,r){try{let{role:t}=Vo.parse({role:e.params.role}),i=await this.inMemoriamRepository.findByRole(t);return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Np}from"@asteasolutions/zod-to-openapi";import{InMemoriamRole as kp}from"@prisma/client";import fe from"zod";var Lp=1,Hp=9;Np(fe);var Ko=fe.object({page:fe.coerce.number().min(1).default(Lp),limit:fe.coerce.number().min(1).default(Hp),name:fe.string().optional(),biography:fe.string().optional(),role:fe.enum(kp).optional(),orderBy:fe.enum(["asc","desc"]).default("desc")}),kt=class{constructor(e){this.inMemoriamRepository=e}async handle(e,r){try{let{page:t,limit:i,...n}=Ko.parse(e.query),s=i*t-i,[m,p]=await Promise.all([this.inMemoriamRepository.find({pagination:{offset:s,limit:i},filter:n}),this.inMemoriamRepository.count({filter:n})]),u=Math.max(Math.ceil(p/i),1);r.status(200).json({page:t,totalPages:u,offset:s,limit:i,inMemoriam:m})}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as _p}from"@asteasolutions/zod-to-openapi";import{InMemoriamRole as zp}from"@prisma/client";import oe from"zod";var Gn=2,Kn=1024,Wp=Kn*Kn,Zp=Gn*Wp;_p(oe);var Go=oe.object({id:oe.uuid(),name:oe.string().min(1,"Nome \xE9 obrigat\xF3rio").optional(),birthDate:oe.coerce.date().optional(),deathDate:oe.coerce.date().optional(),biography:oe.string().optional(),photo:oe.any().refine(o=>o==null?!0:typeof o!="object"||typeof o.size!="number"?!1:o.size<=Zp,`A imagem deve ter no m\xE1ximo ${Gn}MB.`).optional(),role:oe.enum(zp).optional()}).refine(o=>o.birthDate&&o.deathDate?o.deathDate>o.birthDate:!0,{message:"Data de falecimento deve ser posterior \xE0 data de nascimento",path:["deathDate"]}),Lt=class{constructor(e,r){this.inMemoriamRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t,name:i,birthDate:n,deathDate:s,biography:m,photo:p,role:u}=Go.parse({id:e.params.id,...e.body,photo:e.file}),T=await this.inMemoriamRepository.findById(t);if(!T)throw new f("O registro in memoriam n\xE3o existe.");let P=T.photoUrl;return p&&(P=await this.firebaseStorageService.uploadFile({file:p,id:t,folder:U.IN_MEMORIAM})),await this.inMemoriamRepository.update({id:t,name:i,birthDate:n,deathDate:s,biography:m,photoUrl:P??void 0,role:u}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new a(t.message)}}};var Yo=b.object({id:b.uuid(),name:b.string(),birthDate:b.date(),deathDate:b.date(),biography:b.string().nullable(),photoUrl:b.string().nullable(),role:b.enum(Vp),createdAt:b.date(),updatedAt:b.date()}),Yn={method:"post",path:"/in-memoriam",tags:["In Memoriam"],summary:"Create a new in memoriam record with optional photo upload",security:[{bearerAuth:[]}],request:{body:{content:{"multipart/form-data":{schema:Ho}}}},responses:{201:{description:"In memoriam record created successfully",summary:"In Memoriam Created"},400:{description:"Invalid input data, missing required fields, or invalid photo format/size",summary:"Validation Error",content:{"application/json":{schema:b.object({errors:b.record(b.string(),b.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:b.object({message:b.string()})}}},409:{description:"In memoriam record with this name already exists",summary:"Conflict",content:{"application/json":{schema:b.object({message:b.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:b.object({message:b.string()})}}}}},$n={method:"get",path:"/in-memoriam",tags:["In Memoriam"],summary:"List all in memoriam records with pagination and filters",request:{query:Ko},responses:{200:{description:"List of in memoriam records retrieved successfully with pagination",summary:"In Memoriam Records Retrieved",content:{"application/json":{schema:b.object({page:b.number(),totalPages:b.number(),offset:b.number(),limit:b.number(),inMemoriam:b.array(Yo)})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:b.object({errors:b.record(b.string(),b.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:b.object({message:b.string()})}}}}},Xn={method:"get",path:"/in-memoriam/{id}",tags:["In Memoriam"],summary:"Find in memoriam record by ID",request:{params:Ot},responses:{200:{description:"In memoriam record details retrieved successfully",summary:"In Memoriam Record Retrieved",content:{"application/json":{schema:Yo}}},400:{description:"Invalid in memoriam record ID format",summary:"Validation Error",content:{"application/json":{schema:b.object({errors:b.record(b.string(),b.string())})}}},404:{description:"In memoriam record not found with the provided ID",summary:"In Memoriam Record Not Found",content:{"application/json":{schema:b.object({message:b.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:b.object({message:b.string()})}}}}},Jn={method:"put",path:"/in-memoriam/{id}",tags:["In Memoriam"],summary:"Update in memoriam record with optional photo upload",security:[{bearerAuth:[]}],request:{params:Ot,body:{content:{"multipart/form-data":{schema:Go.omit({id:!0})}}}},responses:{200:{description:"In memoriam record updated successfully",summary:"In Memoriam Record Updated"},400:{description:"Invalid input data, in memoriam record ID format, or invalid photo format/size",summary:"Validation Error",content:{"application/json":{schema:b.object({errors:b.record(b.string(),b.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:b.object({message:b.string()})}}},404:{description:"In memoriam record not found with the provided ID",summary:"In Memoriam Record Not Found",content:{"application/json":{schema:b.object({message:b.string()})}}},409:{description:"In memoriam record with this name already exists",summary:"Conflict",content:{"application/json":{schema:b.object({message:b.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:b.object({message:b.string()})}}}}},Qn={method:"delete",path:"/in-memoriam/{id}",tags:["In Memoriam"],summary:"Delete in memoriam record",security:[{bearerAuth:[]}],request:{params:zo},responses:{200:{description:"In memoriam record deleted successfully",summary:"In Memoriam Record Deleted"},400:{description:"Invalid in memoriam record ID format",summary:"Validation Error",content:{"application/json":{schema:b.object({errors:b.record(b.string(),b.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:b.object({message:b.string()})}}},404:{description:"In memoriam record not found with the provided ID",summary:"In Memoriam Record Not Found",content:{"application/json":{schema:b.object({message:b.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:b.object({message:b.string()})}}}}},lg={method:"get",path:"/in-memoriam/role/{role}",tags:["In Memoriam"],summary:"Find in memoriam records by role",request:{params:Vo},responses:{200:{description:"In memoriam records retrieved successfully by role",summary:"In Memoriam Records Retrieved by Role",content:{"application/json":{schema:b.array(Yo)}}},400:{description:"Invalid role parameter provided",summary:"Validation Error",content:{"application/json":{schema:b.object({errors:b.record(b.string(),b.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:b.object({message:b.string()})}}}}};import{$Enums as Xp}from"@prisma/client";import v from"zod";import{extendZodWithOpenApi as Kp}from"@asteasolutions/zod-to-openapi";import Ke from"zod";Kp(Ke);var $o=Ke.object({role:Ke.string().min(1),description:Ke.string().optional(),userId:Ke.uuid(),order:Ke.number().optional()}),Ht=class{constructor(e){this.legitimatorCommitteeMemberRepository=e}async handle(e,r){try{let{role:t,description:i,userId:n,order:s}=$o.parse(e.body);return await this.legitimatorCommitteeMemberRepository.create({role:t,description:i,userId:n,order:s??0}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Gp}from"@asteasolutions/zod-to-openapi";import Xo from"zod";Gp(Xo);var Jo=Xo.object({id:Xo.uuid()}),_t=class{constructor(e){this.legitimatorCommitteeMemberRepository=e}async handle(e,r){try{let{id:t}=Jo.parse({id:e.params.id});if(!await this.legitimatorCommitteeMemberRepository.findById(t))throw new f("O membro do comit\xEA legitimador n\xE3o existe.");return await this.legitimatorCommitteeMemberRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Yp}from"@asteasolutions/zod-to-openapi";import Qo from"zod";Yp(Qo);var Wt=Qo.object({id:Qo.uuid()}),zt=class{constructor(e){this.legitimatorCommitteeMemberRepository=e}async handle(e,r){try{let{id:t}=Wt.parse({id:e.params.id}),i=await this.legitimatorCommitteeMemberRepository.findById(t);if(!i)throw new f("O membro do comit\xEA legitimador n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as $p}from"@asteasolutions/zod-to-openapi";import Te from"zod";$p(Te);var ei=Te.object({id:Te.uuid(),role:Te.string().min(1).optional(),description:Te.string().optional(),userId:Te.uuid().optional(),order:Te.number().optional()}),Zt=class{constructor(e){this.legitimatorCommitteeMemberRepository=e}async handle(e,r){try{let{id:t,role:i,description:n,userId:s,order:m}=ei.parse({id:e.params.id,...e.body});if(!await this.legitimatorCommitteeMemberRepository.findById(t))throw new f("O membro do comit\xEA legitimador n\xE3o existe.");return await this.legitimatorCommitteeMemberRepository.update({id:t,role:i,description:n,userId:s,order:m}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new a(t.message)}}};var Jp=v.object({id:v.uuid(),name:v.string(),emailAddress:v.string(),avatarUrl:v.string().nullable(),orcid:v.string().nullable(),phone:v.string().nullable(),lattesUrl:v.string().nullable(),role:v.enum(Xp.UserRole)}),es=v.object({id:v.uuid(),role:v.string(),description:v.string().nullable(),order:v.number(),createdAt:v.date(),updatedAt:v.date(),userId:v.uuid(),user:Jp}),ts={method:"post",path:"/legitimator-committee-member",tags:["Legitimator Committee Members"],summary:"Create a new Legitimator Committee Member",security:[{bearerAuth:[]}],request:{body:{content:{"application/json":{schema:$o}}}},responses:{201:{description:"Legitimator Committee Member created successfully",summary:"Legitimator Committee Member Created"},400:{description:"Invalid input data or missing required fields",summary:"Validation Error",content:{"application/json":{schema:v.object({errors:v.record(v.string(),v.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:v.object({message:v.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:v.object({message:v.string()})}}}}},rs={method:"get",path:"/legitimator-committee-member",tags:["Legitimator Committee Members"],summary:"List all Legitimator Committee Members with filters",request:{query:v.object({role:v.string().optional(),orderBy:v.enum(["asc","desc"]).optional()})},responses:{200:{description:"List of Legitimator Committee Members retrieved successfully",summary:"Legitimator Committee Members Retrieved",content:{"application/json":{schema:v.object({members:v.array(es)})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:v.object({message:v.string()})}}}}},os={method:"get",path:"/legitimator-committee-member/{id}",tags:["Legitimator Committee Members"],summary:"Find Legitimator Committee Member by ID",request:{params:Wt},responses:{200:{description:"Legitimator Committee Member details retrieved successfully",summary:"Legitimator Committee Member Retrieved",content:{"application/json":{schema:es}}},400:{description:"Invalid Legitimator Committee Member ID format",summary:"Validation Error",content:{"application/json":{schema:v.object({errors:v.record(v.string(),v.string())})}}},404:{description:"Legitimator Committee Member not found with the provided ID",summary:"Legitimator Committee Member Not Found",content:{"application/json":{schema:v.object({message:v.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:v.object({message:v.string()})}}}}},is={method:"put",path:"/legitimator-committee-member/{id}",tags:["Legitimator Committee Members"],summary:"Update Legitimator Committee Member",security:[{bearerAuth:[]}],request:{params:Wt,body:{content:{"application/json":{schema:ei.omit({id:!0})}}}},responses:{200:{description:"Legitimator Committee Member updated successfully",summary:"Legitimator Committee Member Updated"},400:{description:"Invalid input data or Legitimator Committee Member ID format",summary:"Validation Error",content:{"application/json":{schema:v.object({errors:v.record(v.string(),v.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:v.object({message:v.string()})}}},404:{description:"Legitimator Committee Member not found with the provided ID",summary:"Legitimator Committee Member Not Found",content:{"application/json":{schema:v.object({message:v.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:v.object({message:v.string()})}}}}},ns={method:"delete",path:"/legitimator-committee-member/{id}",tags:["Legitimator Committee Members"],summary:"Delete Legitimator Committee Member",security:[{bearerAuth:[]}],request:{params:Jo},responses:{200:{description:"Legitimator Committee Member deleted successfully",summary:"Legitimator Committee Member Deleted"},400:{description:"Invalid Legitimator Committee Member ID format",summary:"Validation Error",content:{"application/json":{schema:v.object({errors:v.record(v.string(),v.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:v.object({message:v.string()})}}},404:{description:"Legitimator Committee Member not found with the provided ID",summary:"Legitimator Committee Member Not Found",content:{"application/json":{schema:v.object({message:v.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:v.object({message:v.string()})}}}}};import{$Enums as oc}from"@prisma/client";import I from"zod";import{extendZodWithOpenApi as Qp}from"@asteasolutions/zod-to-openapi";import ie from"zod";Qp(ie);var ti=ie.object({name:ie.string().min(1),description:ie.string().optional(),members:ie.array(ie.object({userId:ie.uuid(),role:ie.string().min(1),order:ie.number().optional()}))}),Vt=class{constructor(e){this.managementTeamRepository=e}async handle(e,r){try{let{name:t,description:i,members:n}=ti.parse(e.body);if(await this.managementTeamRepository.findByName(t))throw new N("J\xE1 existe um time de gest\xE3o cadastrado com este nome.");return await this.managementTeamRepository.create({name:t,description:i,members:n.map(m=>({userId:m.userId,role:m.role,order:m.order??0}))}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as ec}from"@asteasolutions/zod-to-openapi";import ri from"zod";ec(ri);var oi=ri.object({id:ri.uuid()}),Kt=class{constructor(e){this.managementTeamRepository=e}async handle(e,r){try{let{id:t}=oi.parse({id:e.params.id});if(!await this.managementTeamRepository.findById(t))throw new f("O time de gest\xE3o n\xE3o existe.");return await this.managementTeamRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as tc}from"@asteasolutions/zod-to-openapi";import ii from"zod";tc(ii);var Yt=ii.object({id:ii.uuid()}),Gt=class{constructor(e){this.managementTeamRepository=e}async handle(e,r){try{let{id:t}=Yt.parse({id:e.params.id}),i=await this.managementTeamRepository.findById(t);if(!i)throw new f("O time de gest\xE3o n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as rc}from"@asteasolutions/zod-to-openapi";import Q from"zod";rc(Q);var ni=Q.object({id:Q.uuid(),name:Q.string().min(1).optional(),description:Q.string().optional(),members:Q.array(Q.object({userId:Q.uuid(),role:Q.string().min(1),order:Q.number().optional()})).optional()}),$t=class{constructor(e){this.managementTeamRepository=e}async handle(e,r){try{let{id:t,name:i,description:n,members:s}=ni.parse({id:e.params.id,...e.body}),m=await this.managementTeamRepository.findById(t);if(!m)throw new f("O time de gest\xE3o n\xE3o existe.");if(i&&i!==m.name){let p=await this.managementTeamRepository.findByName(i);if(p&&p.id!==t)throw new N("J\xE1 existe um time de gest\xE3o com este nome.")}return await this.managementTeamRepository.update({id:t,name:i,description:n,members:s?s.map(p=>({userId:p.userId,role:p.role,order:p.order??0})):void 0}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new a(t.message)}}};var ic=I.object({id:I.uuid(),name:I.string(),emailAddress:I.string(),avatarUrl:I.string().nullable(),orcid:I.string().nullable(),phone:I.string().nullable(),lattesUrl:I.string().nullable(),role:I.enum(oc.UserRole)}),nc=I.object({id:I.uuid(),role:I.string(),description:I.string().nullable(),order:I.number(),teamId:I.uuid(),userId:I.uuid(),createdAt:I.date(),updatedAt:I.date(),user:ic}),ss=I.object({id:I.uuid(),name:I.string(),description:I.string().nullable(),createdAt:I.date(),updatedAt:I.date(),members:I.array(nc)}),as={method:"post",path:"/management-team",tags:["Management Teams"],summary:"Create a new Management Team with multiple members",security:[{bearerAuth:[]}],request:{body:{content:{"application/json":{schema:ti}}}},responses:{201:{description:"Management Team created successfully",summary:"Management Team Created"},400:{description:"Invalid input data or missing required fields",summary:"Validation Error",content:{"application/json":{schema:I.object({errors:I.record(I.string(),I.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:I.object({message:I.string()})}}},409:{description:"Management Team with this name already exists",summary:"Conflict",content:{"application/json":{schema:I.object({message:I.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:I.object({message:I.string()})}}}}},ms={method:"get",path:"/management-team",tags:["Management Teams"],summary:"List all Management Teams with filters",request:{query:I.object({name:I.string().optional(),description:I.string().optional(),orderBy:I.enum(["asc","desc"]).optional()})},responses:{200:{description:"List of Management Teams retrieved successfully",summary:"Management Teams Retrieved",content:{"application/json":{schema:I.object({teams:I.array(ss)})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:I.object({message:I.string()})}}}}},ps={method:"get",path:"/management-team/{id}",tags:["Management Teams"],summary:"Find Management Team by ID",request:{params:Yt},responses:{200:{description:"Management Team details retrieved successfully",summary:"Management Team Retrieved",content:{"application/json":{schema:ss}}},400:{description:"Invalid Management Team ID format",summary:"Validation Error",content:{"application/json":{schema:I.object({errors:I.record(I.string(),I.string())})}}},404:{description:"Management Team not found with the provided ID",summary:"Management Team Not Found",content:{"application/json":{schema:I.object({message:I.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:I.object({message:I.string()})}}}}},cs={method:"put",path:"/management-team/{id}",tags:["Management Teams"],summary:"Update Management Team and manage member relationships",security:[{bearerAuth:[]}],request:{params:Yt,body:{content:{"application/json":{schema:ni.omit({id:!0})}}}},responses:{200:{description:"Management Team updated successfully",summary:"Management Team Updated"},400:{description:"Invalid input data or Management Team ID format",summary:"Validation Error",content:{"application/json":{schema:I.object({errors:I.record(I.string(),I.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:I.object({message:I.string()})}}},404:{description:"Management Team not found with the provided ID",summary:"Management Team Not Found",content:{"application/json":{schema:I.object({message:I.string()})}}},409:{description:"Management Team with this name already exists",summary:"Conflict",content:{"application/json":{schema:I.object({message:I.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:I.object({message:I.string()})}}}}},ds={method:"delete",path:"/management-team/{id}",tags:["Management Teams"],summary:"Delete Management Team",security:[{bearerAuth:[]}],request:{params:oi},responses:{200:{description:"Management Team deleted successfully",summary:"Management Team Deleted"},400:{description:"Invalid Management Team ID format",summary:"Validation Error",content:{"application/json":{schema:I.object({errors:I.record(I.string(),I.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:I.object({message:I.string()})}}},404:{description:"Management Team not found with the provided ID",summary:"Management Team Not Found",content:{"application/json":{schema:I.object({message:I.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:I.object({message:I.string()})}}}}};import{MeetingFormat as lc,MeetingStatus as fc}from"@prisma/client";import j from"zod";import{extendZodWithOpenApi as sc}from"@asteasolutions/zod-to-openapi";import Ge from"zod";var ls=10,us=1024,ac=us*us,mc=ls*ac;sc(Ge);var si=Ge.object({title:Ge.string().min(1,"T\xEDtulo \xE9 obrigat\xF3rio"),publishedAt:Ge.coerce.date(),meetingId:Ge.uuid(),document:Ge.any().refine(o=>o==null||typeof o!="object"||typeof o.size!="number"?!1:o.size<=mc,`O documento deve ter no m\xE1ximo ${ls}MB.`)}),Xt=class{constructor(e,r,t){this.meetingMinuteRepository=e;this.meetingRepository=r;this.firebaseStorageService=t}async handle(e,r){try{let{title:t,publishedAt:i,meetingId:n,document:s}=si.parse({...e.body,...e.params,document:e.file});if(!await this.meetingRepository.findById(n))throw new f("A reuni\xE3o n\xE3o existe.");if(await this.meetingMinuteRepository.findByMeetingId(n))throw new a("Esta reuni\xE3o j\xE1 possui uma ata.");let u=await this.meetingMinuteRepository.create({title:t,publishedAt:i,meetingId:n,documentUrl:""}),T=await this.firebaseStorageService.uploadFile({file:s,id:u.id,folder:U.MEETING_MINUTE});return await this.meetingMinuteRepository.update({id:u.id,documentUrl:T}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as pc}from"@asteasolutions/zod-to-openapi";import ai from"zod";pc(ai);var nt=ai.object({meetingId:ai.uuid()}),Jt=class{constructor(e){this.meetingMinuteRepository=e}async handle(e,r){try{let{meetingId:t}=nt.parse({meetingId:e.params.meetingId}),i=await this.meetingMinuteRepository.findByMeetingId(t);return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as cc}from"@asteasolutions/zod-to-openapi";import Ye from"zod";var ys=10,fs=1024,dc=fs*fs,uc=ys*dc;cc(Ye);var mi=Ye.object({meetingId:Ye.uuid(),title:Ye.string().min(1,"T\xEDtulo \xE9 obrigat\xF3rio").optional(),publishedAt:Ye.coerce.date().optional(),document:Ye.any().refine(o=>o==null?!0:typeof o!="object"||typeof o.size!="number"?!1:o.size<=uc,`O documento deve ter no m\xE1ximo ${ys}MB.`).optional()}),Qt=class{constructor(e,r){this.meetingMinuteRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{meetingId:t,title:i,publishedAt:n,document:s}=mi.parse({meetingId:e.params.meetingId,...e.body,document:e.file}),m=await this.meetingMinuteRepository.findByMeetingId(t);if(!m)throw new f("A ata n\xE3o existe para esta reuni\xE3o.");let p=m.documentUrl;return s&&(m.documentUrl&&await this.firebaseStorageService.deleteFile({fileUrl:m.documentUrl}),p=await this.firebaseStorageService.uploadFile({file:s,id:m.id,folder:U.MEETING_MINUTE})),await this.meetingMinuteRepository.update({id:m.id,title:i,publishedAt:n,documentUrl:p??void 0}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new a(t.message)}}};var yc=j.object({id:j.uuid(),title:j.string(),scheduledAt:j.date(),format:j.enum(lc),agenda:j.string(),meetingLink:j.string().nullable(),location:j.string().nullable(),status:j.enum(fc),createdAt:j.date(),updatedAt:j.date()}),gc=j.object({id:j.uuid(),title:j.string(),publishedAt:j.date(),documentUrl:j.string(),meetingId:j.uuid(),meeting:yc,createdAt:j.date(),updatedAt:j.date()}),gs={method:"post",path:"/meeting/{meetingId}/minute",tags:["Meetings"],summary:"Create a new meeting minute with document upload",security:[{bearerAuth:[]}],request:{params:j.object({meetingId:j.uuid()}),body:{content:{"multipart/form-data":{schema:si.omit({meetingId:!0})}}}},responses:{201:{description:"Meeting minute created successfully",summary:"Meeting Minute Created"},400:{description:"Invalid input data, missing required fields, or invalid document format/size",summary:"Validation Error",content:{"application/json":{schema:j.object({errors:j.record(j.string(),j.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:j.object({message:j.string()})}}},404:{description:"Meeting not found with the provided ID",summary:"Meeting Not Found",content:{"application/json":{schema:j.object({message:j.string()})}}},409:{description:"Meeting already has a minute",summary:"Conflict",content:{"application/json":{schema:j.object({message:j.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:j.object({message:j.string()})}}}}},hs={method:"get",path:"/meeting/{meetingId}/minute",tags:["Meetings"],summary:"Find meeting minute by meeting ID",request:{params:nt},responses:{200:{description:"Meeting minute retrieved successfully by meeting ID",summary:"Meeting Minute Retrieved by Meeting ID",content:{"application/json":{schema:gc.nullable()}}},400:{description:"Invalid meeting ID parameter provided",summary:"Validation Error",content:{"application/json":{schema:j.object({errors:j.record(j.string(),j.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:j.object({message:j.string()})}}}}},Rs={method:"put",path:"/meeting/{meetingId}/minute",tags:["Meetings"],summary:"Update meeting minute with optional document upload",security:[{bearerAuth:[]}],request:{params:nt,body:{content:{"multipart/form-data":{schema:mi.omit({meetingId:!0})}}}},responses:{200:{description:"Meeting minute updated successfully",summary:"Meeting Minute Updated"},400:{description:"Invalid input data, meeting minute ID format, or invalid document format/size",summary:"Validation Error",content:{"application/json":{schema:j.object({errors:j.record(j.string(),j.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:j.object({message:j.string()})}}},404:{description:"Meeting minute not found with the provided ID",summary:"Meeting Minute Not Found",content:{"application/json":{schema:j.object({message:j.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:j.object({message:j.string()})}}}}},Is={method:"delete",path:"/meeting/{meetingId}/minute",tags:["Meetings"],summary:"Delete meeting minute",security:[{bearerAuth:[]}],request:{params:nt},responses:{200:{description:"Meeting minute deleted successfully",summary:"Meeting Minute Deleted"},400:{description:"Invalid meeting minute ID format",summary:"Validation Error",content:{"application/json":{schema:j.object({errors:j.record(j.string(),j.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:j.object({message:j.string()})}}},404:{description:"Meeting minute not found with the provided ID",summary:"Meeting Minute Not Found",content:{"application/json":{schema:j.object({message:j.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:j.object({message:j.string()})}}}}};import{MeetingFormat as Pc,MeetingStatus as Ac}from"@prisma/client";import h from"zod";import{extendZodWithOpenApi as hc}from"@asteasolutions/zod-to-openapi";import{MeetingFormat as er,MeetingStatus as pi}from"@prisma/client";import ee from"zod";hc(ee);var ci=ee.object({title:ee.string().min(1,"T\xEDtulo \xE9 obrigat\xF3rio"),scheduledAt:ee.coerce.date(),format:ee.enum(er).default(er.ONLINE),agenda:ee.string().min(1,"Pauta \xE9 obrigat\xF3ria"),meetingLink:ee.string().url("Link da reuni\xE3o deve ser uma URL v\xE1lida").optional().or(ee.literal("")),location:ee.string().optional(),status:ee.enum(pi).default(pi.PENDING)}).refine(o=>o.format===er.ONLINE?!!o.meetingLink:o.format===er.IN_PERSON?!!o.location:!0,{message:"Reuni\xF5es online devem ter link e reuni\xF5es presenciais devem ter localiza\xE7\xE3o",path:["format"]}),tr=class{constructor(e){this.meetingRepository=e}async handle(e,r){try{let{title:t,scheduledAt:i,format:n,agenda:s,meetingLink:m,location:p,status:u}=ci.parse(e.body);return await this.meetingRepository.create({title:t,scheduledAt:i,format:n,agenda:s,meetingLink:m||void 0,location:p||void 0,status:u??pi.PENDING}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Rc}from"@asteasolutions/zod-to-openapi";import di from"zod";Rc(di);var ui=di.object({id:di.uuid()}),rr=class{constructor(e){this.meetingRepository=e}async handle(e,r){try{let{id:t}=ui.parse({id:e.params.id});if(!await this.meetingRepository.findById(t))throw new f("A reuni\xE3o n\xE3o existe.");return await this.meetingRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Ic}from"@asteasolutions/zod-to-openapi";import li from"zod";Ic(li);var ir=li.object({id:li.uuid()}),or=class{constructor(e){this.meetingRepository=e}async handle(e,r){try{let{id:t}=ir.parse({id:e.params.id}),i=await this.meetingRepository.findById(t);if(!i)throw new f("A reuni\xE3o n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as bc}from"@asteasolutions/zod-to-openapi";import{MeetingStatus as wc}from"@prisma/client";import fi from"zod";bc(fi);var yi=fi.object({status:fi.enum(wc)}),nr=class{constructor(e){this.meetingRepository=e}async handle(e,r){try{let{status:t}=yi.parse({status:e.params.status}),i=await this.meetingRepository.findByStatus(t);return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Cc}from"@asteasolutions/zod-to-openapi";import{MeetingFormat as Mc,MeetingStatus as Sc}from"@prisma/client";import ye from"zod";var vc=1,Ec=10;Cc(ye);var gi=ye.object({page:ye.coerce.number().min(1).default(vc),limit:ye.coerce.number().min(1).default(Ec),title:ye.string().optional(),format:ye.enum(Mc).optional(),status:ye.enum(Sc).optional(),orderBy:ye.enum(["asc","desc"]).optional()}),sr=class{constructor(e){this.meetingRepository=e}async handle(e,r){try{let{page:t,limit:i,...n}=gi.parse(e.query),s=i*t-i,[m,p]=await Promise.all([this.meetingRepository.find({pagination:{offset:s,limit:i},filter:n}),this.meetingRepository.count({filter:n})]),u=Math.max(Math.ceil(p/i),1);r.status(200).json({page:t,totalPages:u,offset:s,limit:i,meetings:m})}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as jc}from"@asteasolutions/zod-to-openapi";import{MeetingFormat as xc,MeetingStatus as Tc}from"@prisma/client";import X from"zod";jc(X);var hi=X.object({id:X.uuid(),title:X.string().min(1,"T\xEDtulo \xE9 obrigat\xF3rio").optional(),scheduledAt:X.coerce.date().optional(),format:X.enum(xc).optional(),agenda:X.string().min(1,"Pauta \xE9 obrigat\xF3ria").optional(),meetingLink:X.string().url("Link da reuni\xE3o deve ser uma URL v\xE1lida").optional().or(X.literal("")),location:X.string().optional(),status:X.enum(Tc).optional()}),ar=class{constructor(e){this.meetingRepository=e}async handle(e,r){try{let{id:t,title:i,scheduledAt:n,format:s,agenda:m,meetingLink:p,location:u,status:T}=hi.parse({id:e.params.id,...e.body});if(!await this.meetingRepository.findById(t))throw new f("A reuni\xE3o n\xE3o existe.");return await this.meetingRepository.update({id:t,title:i,scheduledAt:n,format:s,agenda:m,meetingLink:p||void 0,location:u||void 0,status:T}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new a(t.message)}}};var Uc=h.object({id:h.uuid(),title:h.string(),publishedAt:h.date(),documentUrl:h.string(),meetingId:h.uuid(),createdAt:h.date(),updatedAt:h.date()}),Ri=h.object({id:h.uuid(),title:h.string(),scheduledAt:h.date(),format:h.enum(Pc),agenda:h.string(),meetingLink:h.string().nullable(),location:h.string().nullable(),status:h.enum(Ac),minutes:Uc.nullable(),createdAt:h.date(),updatedAt:h.date()}),bs={method:"post",path:"/meeting",tags:["Meetings"],summary:"Create a new meeting",security:[{bearerAuth:[]}],request:{body:{content:{"application/json":{schema:ci}}}},responses:{201:{description:"Meeting created successfully",summary:"Meeting Created"},400:{description:"Invalid input data or missing required fields",summary:"Validation Error",content:{"application/json":{schema:h.object({errors:h.record(h.string(),h.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:h.object({message:h.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:h.object({message:h.string()})}}}}},ws={method:"get",path:"/meeting",tags:["Meetings"],summary:"List all meetings with pagination and filters",request:{query:gi},responses:{200:{description:"List of meetings retrieved successfully with pagination",summary:"Meetings Retrieved",content:{"application/json":{schema:h.object({page:h.number(),totalPages:h.number(),offset:h.number(),limit:h.number(),meetings:h.array(Ri)})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:h.object({errors:h.record(h.string(),h.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:h.object({message:h.string()})}}}}},Cs={method:"get",path:"/meeting/{id}",tags:["Meetings"],summary:"Find meeting by ID",request:{params:ir},responses:{200:{description:"Meeting details retrieved successfully",summary:"Meeting Retrieved",content:{"application/json":{schema:Ri}}},400:{description:"Invalid meeting ID format",summary:"Validation Error",content:{"application/json":{schema:h.object({errors:h.record(h.string(),h.string())})}}},404:{description:"Meeting not found with the provided ID",summary:"Meeting Not Found",content:{"application/json":{schema:h.object({message:h.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:h.object({message:h.string()})}}}}},Ms={method:"get",path:"/meeting/status/{status}",tags:["Meetings"],summary:"Find meetings by status",request:{params:yi},responses:{200:{description:"Meetings retrieved successfully by status",summary:"Meetings Retrieved by Status",content:{"application/json":{schema:h.array(Ri)}}},400:{description:"Invalid status parameter provided",summary:"Validation Error",content:{"application/json":{schema:h.object({errors:h.record(h.string(),h.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:h.object({message:h.string()})}}}}},Ss={method:"put",path:"/meeting/{id}",tags:["Meetings"],summary:"Update meeting",security:[{bearerAuth:[]}],request:{params:ir,body:{content:{"application/json":{schema:hi.omit({id:!0})}}}},responses:{200:{description:"Meeting updated successfully",summary:"Meeting Updated"},400:{description:"Invalid input data or meeting ID format",summary:"Validation Error",content:{"application/json":{schema:h.object({errors:h.record(h.string(),h.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:h.object({message:h.string()})}}},404:{description:"Meeting not found with the provided ID",summary:"Meeting Not Found",content:{"application/json":{schema:h.object({message:h.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:h.object({message:h.string()})}}}}},vs={method:"delete",path:"/meeting/{id}",tags:["Meetings"],summary:"Delete meeting",security:[{bearerAuth:[]}],request:{params:ui},responses:{200:{description:"Meeting deleted successfully",summary:"Meeting Deleted"},400:{description:"Invalid meeting ID format",summary:"Validation Error",content:{"application/json":{schema:h.object({errors:h.record(h.string(),h.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:h.object({message:h.string()})}}},404:{description:"Meeting not found with the provided ID",summary:"Meeting Not Found",content:{"application/json":{schema:h.object({message:h.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:h.object({message:h.string()})}}}}};import w from"zod";import{extendZodWithOpenApi as Dc}from"@asteasolutions/zod-to-openapi";import st from"zod";var Fc=5,Es=1024,qc=Es*Es,Bc=Fc*qc;Dc(st);var Ii=st.object({title:st.string().min(1),content:st.string().min(1),image:st.any().refine(o=>!o||typeof o=="object"&&typeof o.mimetype=="string"&&o.mimetype.startsWith("image/")&&typeof o.size=="number"&&o.size<=Bc,{message:"A imagem deve ser uma imagem v\xE1lida de no m\xE1ximo 5MB."})}),mr=class{constructor(e,r){this.newsRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{title:t,content:i,image:n}=Ii.parse({...e.body,image:e.file}),s=e.user.id,m=await this.firebaseStorageService.uploadFile({file:n,folder:U.NEWS,id:s});await this.newsRepository.create({title:t,content:i,authorId:s,imageUrl:m}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Oc}from"@asteasolutions/zod-to-openapi";import ge from"zod";var Nc=1,kc=7;Oc(ge);var cr=ge.object({page:ge.coerce.number().min(1).default(Nc),limit:ge.coerce.number().min(1).default(kc),authorId:ge.string(),title:ge.string().optional(),content:ge.string().optional(),orderBy:ge.enum(["asc","desc"]).default("desc")}),pr=class{constructor(e){this.newsRepository=e}async handle(e,r){try{let{page:t,limit:i,authorId:n,...s}=cr.parse(e.query),m=i*t-i,[p,u]=await Promise.all([this.newsRepository.findByAuthorId({authorId:n,pagination:{offset:m,limit:i},filter:s}),this.newsRepository.count({filter:{authorId:n,...s}})]),T=Math.max(Math.ceil(u/i),1);r.status(200).json({page:t,totalPages:T,offset:m,limit:i,news:p})}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Lc}from"@asteasolutions/zod-to-openapi";import bi from"zod";Lc(bi);var wi=bi.object({id:bi.string()}),dr=class{constructor(e){this.newsRepository=e}async handle(e,r){try{let{id:t}=wi.parse(e.params),i=await this.newsRepository.findById(t);if(!i)throw new f("Not\xEDcia n\xE3o encontrada.");r.status(200).json(i)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Hc}from"@asteasolutions/zod-to-openapi";import he from"zod";var _c=1,zc=9;Hc(he);var Ci=he.object({page:he.coerce.number().min(1).default(_c),limit:he.coerce.number().min(1).default(zc),title:he.string().optional(),content:he.string().optional(),authorId:he.string().optional(),orderBy:he.enum(["asc","desc"]).default("desc")}),ur=class{constructor(e){this.newsRepository=e}async handle(e,r){try{let{page:t,limit:i,...n}=Ci.parse(e.query),s=i*t-i,[m,p]=await Promise.all([this.newsRepository.find({pagination:{offset:s,limit:i},filter:n}),this.newsRepository.count({filter:n})]),u=Math.max(Math.ceil(p/i),1);r.status(200).json({page:t,totalPages:u,offset:s,limit:i,news:m})}catch(t){if(t instanceof Error)throw new a(t.message)}}};var js={method:"post",path:"/news",tags:["News"],summary:"Create news",security:[{bearerAuth:[]}],request:{body:{content:{"multipart/form-data":{schema:Ii}}}},responses:{201:{description:"News article created successfully",summary:"News Created",content:{"application/json":{schema:w.object({message:w.string()})}}},400:{description:"Invalid input data or file format",summary:"Validation Error",content:{"application/json":{schema:w.object({errors:w.record(w.string(),w.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:w.object({message:w.string()})}}}}},xs={method:"get",path:"/news",tags:["News"],summary:"List news",request:{query:Ci},responses:{200:{description:"Paginated list of news articles retrieved successfully",summary:"News Retrieved",content:{"application/json":{schema:w.object({page:w.number(),totalPages:w.number(),offset:w.number(),limit:w.number(),news:w.array(w.object({title:w.string(),content:w.string(),id:w.string(),createdAt:w.date(),updatedAt:w.date(),imageUrl:w.string().nullable()}))})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:w.object({errors:w.record(w.string(),w.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:w.object({message:w.string()})}}}}},Ts={method:"get",path:"/news/{id}",tags:["News"],summary:"Find news by ID",request:{params:wi},responses:{200:{description:"News article details retrieved successfully",summary:"News Retrieved",content:{"application/json":{schema:w.object({page:w.number(),totalPages:w.number(),offset:w.number(),limit:w.number(),news:w.object({title:w.string(),content:w.string(),id:w.string(),createdAt:w.date(),updatedAt:w.date(),imageUrl:w.string().nullable()})})}}},400:{description:"Invalid news ID format",summary:"Validation Error",content:{"application/json":{schema:w.object({errors:w.record(w.string(),w.string())})}}},404:{description:"News article not found with the provided ID",summary:"News Not Found",content:{"application/json":{schema:w.object({message:w.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:w.object({message:w.string()})}}}}},Ps={method:"get",path:"/news/author/{author_id}",tags:["News"],summary:"List news by author",request:{params:cr.pick({authorId:!0}).transform(()=>({author_id:""})),query:cr.omit({authorId:!0})},responses:{200:{description:"Paginated list of news articles by author retrieved successfully",summary:"Author News Retrieved",content:{"application/json":{schema:w.object({page:w.number(),totalPages:w.number(),offset:w.number(),limit:w.number(),news:w.array(w.object({title:w.string(),content:w.string(),id:w.string(),createdAt:w.date(),updatedAt:w.date(),imageUrl:w.string().nullable()}))})}}},400:{description:"Invalid author ID or query parameters",summary:"Validation Error",content:{"application/json":{schema:w.object({errors:w.record(w.string(),w.string())})}}},404:{description:"Author not found with the provided ID",summary:"Author Not Found",content:{"application/json":{schema:w.object({message:w.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:w.object({message:w.string()})}}}}};import M from"zod";import{extendZodWithOpenApi as Wc}from"@asteasolutions/zod-to-openapi";import te from"zod";var Us=2,As=1024,Zc=As*As,Vc=Us*Zc;Wc(te);var Mi=te.object({name:te.string().min(1,"Nome \xE9 obrigat\xF3rio"),logo:te.any().refine(o=>o==null||typeof o!="object"||typeof o.size!="number"?!1:o.size<=Vc,`A imagem deve ter no m\xE1ximo ${Us}MB.`),websiteUrl:te.url("URL do site deve ser v\xE1lida").optional(),description:te.string().optional(),category:te.string().optional(),since:te.coerce.date(),isActive:te.preprocess(o=>o==="true",te.boolean().optional())}),lr=class{constructor(e,r){this.partnerRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{name:t,logo:i,websiteUrl:n,description:s,category:m,since:p,isActive:u}=Mi.parse({...e.body,logo:e.file}),T=await this.partnerRepository.create({name:t,websiteUrl:n,description:s,category:m,since:p,isActive:u}),P=await this.firebaseStorageService.uploadFile({file:i,id:T.id,folder:U.PARTNER});return await this.partnerRepository.update({id:T.id,logoUrl:P}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Kc}from"@asteasolutions/zod-to-openapi";import Si from"zod";Kc(Si);var vi=Si.object({id:Si.uuid()}),fr=class{constructor(e,r){this.partnerRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t}=vi.parse({id:e.params.id}),i=await this.partnerRepository.findById(t);if(!i)throw new f("O parceiro n\xE3o existe.");return i.logoUrl&&this.firebaseStorageService.deleteFile({fileUrl:i.logoUrl}),await this.partnerRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Gc}from"@asteasolutions/zod-to-openapi";import Ei from"zod";Gc(Ei);var gr=Ei.object({id:Ei.uuid()}),yr=class{constructor(e){this.partnerRepository=e}async handle(e,r){try{let{id:t}=gr.parse({id:e.params.id}),i=await this.partnerRepository.findById(t);if(!i)throw new f("O parceiro n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Yc}from"@asteasolutions/zod-to-openapi";import ne from"zod";var $c=1,Xc=9;Yc(ne);var ji=ne.object({page:ne.coerce.number().min(1).default($c),limit:ne.coerce.number().min(1).default(Xc),name:ne.string().optional(),description:ne.string().optional(),category:ne.string().optional(),isActive:ne.coerce.boolean().optional(),orderBy:ne.enum(["asc","desc"]).optional()}),hr=class{constructor(e){this.partnerRepository=e}async handle(e,r){try{let{page:t,limit:i,...n}=ji.parse(e.query),s=i*t-i,[m,p]=await Promise.all([this.partnerRepository.find({pagination:{offset:s,limit:i},filter:n}),this.partnerRepository.count({filter:n})]),u=Math.max(Math.ceil(p/i),1);r.status(200).json({page:t,totalPages:u,offset:s,limit:i,partners:m})}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Jc}from"@asteasolutions/zod-to-openapi";import J from"zod";var Fs=2,Ds=1024,Qc=Ds*Ds,ed=Fs*Qc;Jc(J);var xi=J.object({id:J.uuid(),name:J.string().min(1,"Nome \xE9 obrigat\xF3rio").optional(),logo:J.any().refine(o=>o==null?!0:typeof o!="object"||typeof o.size!="number"?!1:o.size<=ed,`A imagem deve ter no m\xE1ximo ${Fs}MB.`).optional(),websiteUrl:J.url("URL do site deve ser v\xE1lida").optional(),description:J.string().optional(),category:J.string().optional(),since:J.coerce.date().optional(),isActive:J.preprocess(o=>o==="true",J.boolean().optional())}),Rr=class{constructor(e,r){this.partnerRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t,name:i,logo:n,websiteUrl:s,description:m,category:p,since:u,isActive:T}=xi.parse({id:e.params.id,...e.body,logo:e.file}),P=await this.partnerRepository.findById(t);if(!P)throw new f("O parceiro n\xE3o existe.");let B=P.logoUrl;if(n&&(B=await this.firebaseStorageService.uploadFile({file:n,id:t,folder:"images/partners"})),!B)throw new a("Logo URL \xE9 obrigat\xF3rio");return await this.partnerRepository.update({id:t,name:i,logoUrl:B,websiteUrl:s,description:m,category:p,since:u,isActive:T}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new a(t.message)}}};var qs=M.object({id:M.uuid(),name:M.string(),logoUrl:M.string(),websiteUrl:M.string().nullable(),description:M.string().nullable(),category:M.string().nullable(),since:M.date(),isActive:M.boolean(),createdAt:M.date(),updatedAt:M.date()}),Bs={method:"post",path:"/partner",tags:["Partners"],summary:"Create a new partner with logo upload",security:[{bearerAuth:[]}],request:{body:{content:{"multipart/form-data":{schema:Mi}}}},responses:{201:{description:"Partner created successfully",summary:"Partner Created"},400:{description:"Invalid input data, missing required fields, or invalid logo format/size",summary:"Validation Error",content:{"application/json":{schema:M.object({errors:M.record(M.string(),M.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:M.object({message:M.string()})}}},409:{description:"Partner with this name already exists",summary:"Conflict",content:{"application/json":{schema:M.object({message:M.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:M.object({message:M.string()})}}}}},Os={method:"get",path:"/partner",tags:["Partners"],summary:"List all partners with pagination and filters",request:{query:ji},responses:{200:{description:"List of partners retrieved successfully with pagination",summary:"Partners Retrieved",content:{"application/json":{schema:M.object({page:M.number(),totalPages:M.number(),offset:M.number(),limit:M.number(),partners:M.array(qs)})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:M.object({errors:M.record(M.string(),M.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:M.object({message:M.string()})}}}}},Ns={method:"get",path:"/partner/{id}",tags:["Partners"],summary:"Find partner by ID",request:{params:gr},responses:{200:{description:"Partner details retrieved successfully",summary:"Partner Retrieved",content:{"application/json":{schema:qs}}},400:{description:"Invalid partner ID format",summary:"Validation Error",content:{"application/json":{schema:M.object({errors:M.record(M.string(),M.string())})}}},404:{description:"Partner not found with the provided ID",summary:"Partner Not Found",content:{"application/json":{schema:M.object({message:M.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:M.object({message:M.string()})}}}}},ks={method:"put",path:"/partner/{id}",tags:["Partners"],summary:"Update partner with optional logo upload",security:[{bearerAuth:[]}],request:{params:gr,body:{content:{"multipart/form-data":{schema:xi.omit({id:!0})}}}},responses:{200:{description:"Partner updated successfully",summary:"Partner Updated"},400:{description:"Invalid input data, partner ID format, or invalid logo format/size",summary:"Validation Error",content:{"application/json":{schema:M.object({errors:M.record(M.string(),M.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:M.object({message:M.string()})}}},404:{description:"Partner not found with the provided ID",summary:"Partner Not Found",content:{"application/json":{schema:M.object({message:M.string()})}}},409:{description:"Partner with this name already exists",summary:"Conflict",content:{"application/json":{schema:M.object({message:M.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:M.object({message:M.string()})}}}}},Ls={method:"delete",path:"/partner/{id}",tags:["Partners"],summary:"Delete partner",security:[{bearerAuth:[]}],request:{params:vi},responses:{200:{description:"Partner deleted successfully",summary:"Partner Deleted"},400:{description:"Invalid partner ID format",summary:"Validation Error",content:{"application/json":{schema:M.object({errors:M.record(M.string(),M.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:M.object({message:M.string()})}}},404:{description:"Partner not found with the provided ID",summary:"Partner Not Found",content:{"application/json":{schema:M.object({message:M.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:M.object({message:M.string()})}}}}};import{$Enums as Hs}from"@prisma/client";import S from"zod";import{extendZodWithOpenApi as td}from"@asteasolutions/zod-to-openapi";import{PendencyStatus as rd}from"@prisma/client";import Re from"zod";td(Re);var br=Re.object({userId:Re.uuid(),title:Re.string().min(1),description:Re.string().optional(),status:Re.enum(rd).default("PENDING"),dueDate:Re.coerce.date().optional(),document:Re.any().refine(o=>o&&typeof o=="object"&&o.size>0,"Arquivo do documento \xE9 obrigat\xF3rio")}),Ir=class{constructor(e,r,t){this.userRepository=e;this.pendencyRepository=r;this.firebaseStorageService=t}async handle(e,r){try{let{userId:t,title:i,description:n,status:s,dueDate:m,document:p}=br.parse({...e.body,userId:e.params.user_id,document:e.file});if(!await this.userRepository.findById(t))throw new H("O usu\xE1rio n\xE3o existe.");let T=await this.firebaseStorageService.uploadFile({file:p,id:t,folder:U.PENDENCY});return await this.pendencyRepository.create({userId:t,title:i,description:n,status:s,dueDate:m,documentUrl:T}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as od}from"@asteasolutions/zod-to-openapi";import Ti from"zod";od(Ti);var Pi=Ti.object({id:Ti.uuid()}),wr=class{constructor(e,r){this.pendencyRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t}=Pi.parse({id:e.params.pendency_id}),i=await this.pendencyRepository.findById(t);if(!i)throw new f("A pend\xEAncia n\xE3o existe.");return await Promise.all([this.pendencyRepository.deleteById(i.id),this.firebaseStorageService.deleteFile({fileUrl:i.documentUrl})]),r.sendStatus(204)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as id}from"@asteasolutions/zod-to-openapi";import{PendencyStatus as nd}from"@prisma/client";import se from"zod";var sd=1,ad=6;id(se);var Ai=se.object({page:se.coerce.number().min(1).default(sd),limit:se.coerce.number().min(1).default(ad),title:se.string().optional(),description:se.string().optional(),status:se.enum(nd).default("PENDING"),userId:se.uuid().optional(),orderBy:se.enum(["asc","desc"]).default("desc")}),Cr=class{constructor(e){this.pendencyRepository=e}async handle(e,r){try{let{description:t,limit:i,orderBy:n,page:s,title:m,status:p,userId:u}=Ai.parse(e.query),T=s*i-i,[P,B]=await Promise.all([this.pendencyRepository.find({pagination:{offset:T,limit:i},filter:{title:m,description:t,status:p,orderBy:n,userId:u}}),this.pendencyRepository.count({filter:{title:m,description:t,status:p,userId:u}})]),L=Math.max(Math.ceil(B/i),1);return r.status(200).json({page:s,totalPages:L,offset:T,limit:i,pendencies:P})}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as md}from"@asteasolutions/zod-to-openapi";import Ui from"zod";md(Ui);var Di=Ui.object({pendencyId:Ui.uuid()}),Mr=class{constructor(e){this.pendencyRepository=e}async handle(e,r){try{let{pendencyId:t}=Di.parse({pendencyId:e.params.pendency_id}),i=await this.pendencyRepository.findById(t);if(!i)throw new f("Pend\xEAncia n\xE3o encontrada.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as pd}from"@asteasolutions/zod-to-openapi";import{PendencyStatus as cd}from"@prisma/client";import Ie from"zod";pd(Ie);var vr=Ie.object({id:Ie.uuid(),title:Ie.string().min(1),description:Ie.string().optional(),status:Ie.enum(cd),dueDate:Ie.coerce.date().optional(),document:Ie.any().refine(o=>o==null||typeof o=="object"&&typeof o.size=="number"&&(o.size===0||o.size>0),"Arquivo do documento \xE9 inv\xE1lido").optional()}),Sr=class{constructor(e,r){this.pendencyRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{document:t,id:i,...n}=vr.parse({...e.body,id:e.params.pendency_id,document:e.file}),s=await this.pendencyRepository.findById(i);if(!s)throw new H("A pend\xEAncia n\xE3o existe");let m=s.documentUrl;return t&&t.size>0&&(m=await this.firebaseStorageService.updateFile({file:t,id:s.userId,folder:U.PENDENCY,fileUrl:s.documentUrl})),await this.pendencyRepository.update({...n,id:i,documentUrl:m}),r.sendStatus(204)}catch(t){if(t instanceof Error)throw new a(t.message)}}};var _s={method:"post",path:"/pendency/{user_id}",tags:["Pendencies"],summary:"Create pendency for user",security:[{bearerAuth:[]}],request:{params:br.pick({userId:!0}).transform(()=>({user_id:""})),body:{content:{"multipart/form-data":{schema:br.omit({userId:!0})}}}},responses:{201:{description:"Pendency created successfully for the user",summary:"Pendency Created",content:{"application/json":{schema:S.object({})}}},400:{description:"Invalid input data or file format",summary:"Validation Error",content:{"application/json":{schema:S.object({errors:S.record(S.string(),S.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:S.object({message:S.string()})}}}}},zs={method:"get",path:"/pendency",tags:["Pendencies"],summary:"List pendencies",security:[{bearerAuth:[]}],request:{query:Ai},responses:{200:{description:"Paginated list of pendencies retrieved successfully",summary:"Pendencies Retrieved",content:{"application/json":{schema:S.object({page:S.number(),totalPages:S.number(),offset:S.number(),limit:S.number(),pendencies:S.array(S.object({id:S.string(),title:S.string(),description:S.string().nullable(),status:S.enum(Hs.PendencyStatus),dueDate:S.date().nullable(),documentUrl:S.string(),userId:S.string(),createdAt:S.date(),updatedAt:S.date()}))})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:S.object({errors:S.record(S.string(),S.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:S.object({message:S.string()})}}}}},Ws={method:"get",path:"/pendency/{pendency_id}",tags:["Pendencies"],summary:"Find pendency by ID",security:[{bearerAuth:[]}],request:{params:Di},responses:{200:{description:"Pendency details retrieved successfully",summary:"Pendency Retrieved",content:{"application/json":{schema:S.object({id:S.string(),title:S.string(),description:S.string().nullable(),status:S.enum(Hs.PendencyStatus),dueDate:S.date().nullable(),documentUrl:S.string(),userId:S.string(),createdAt:S.date(),updatedAt:S.date()}).nullable()}}},400:{description:"Invalid pendency ID format",summary:"Validation Error",content:{"application/json":{schema:S.object({errors:S.record(S.string(),S.string())})}}},404:{description:"Pendency not found with the provided ID",summary:"Pendency Not Found",content:{"application/json":{schema:S.object({message:S.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:S.object({message:S.string()})}}}}},Zs={method:"put",path:"/pendency/{pendency_id}",tags:["Pendencies"],summary:"Update pendency",security:[{bearerAuth:[]}],request:{params:vr.pick({id:!0}).transform(()=>({pendency_id:""})),body:{content:{"multipart/form-data":{schema:vr.omit({id:!0})}}}},responses:{204:{description:"Pendency updated successfully",summary:"Pendency Updated"},400:{description:"Invalid input data or pendency does not exist",summary:"Validation Error",content:{"application/json":{schema:S.object({errors:S.record(S.string(),S.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:S.object({message:S.string()})}}}}},Vs={method:"delete",path:"/pendency/{pendency_id}",tags:["Pendencies"],summary:"Delete pendency",security:[{bearerAuth:[]}],request:{params:Pi},responses:{204:{description:"Pendency deleted successfully",summary:"Pendency Deleted"},400:{description:"Invalid pendency ID format",summary:"Validation Error",content:{"application/json":{schema:S.object({errors:S.record(S.string(),S.string())})}}},404:{description:"Pendency not found with the provided ID",summary:"Pendency Not Found",content:{"application/json":{schema:S.object({message:S.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:S.object({message:S.string()})}}}}};import{RegimentStatus as Ed}from"@prisma/client";import C from"zod";import{extendZodWithOpenApi as dd}from"@asteasolutions/zod-to-openapi";import{RegimentStatus as Gs}from"@prisma/client";import Pe from"zod";var Ys=10,Ks=1024,ud=Ks*Ks,ld=Ys*ud;dd(Pe);var Fi=Pe.object({title:Pe.string().min(1,"T\xEDtulo \xE9 obrigat\xF3rio"),version:Pe.string().min(1,"Vers\xE3o \xE9 obrigat\xF3ria"),publishedAt:Pe.coerce.date(),document:Pe.any().refine(o=>o==null||typeof o!="object"||typeof o.size!="number"?!1:o.size<=ld,`O documento deve ter no m\xE1ximo ${Ys}MB.`),status:Pe.enum(Gs).optional()}),Er=class{constructor(e,r){this.regimentRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{title:t,version:i,publishedAt:n,document:s,status:m}=Fi.parse({...e.body,document:e.file}),p=await this.regimentRepository.create({title:t,version:i,publishedAt:n,documentUrl:"",status:m??Gs.IN_FORCE}),u=await this.firebaseStorageService.uploadFile({file:s,id:p.id,folder:U.REGIMENT});return await this.regimentRepository.update({id:p.id,documentUrl:u}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as fd}from"@asteasolutions/zod-to-openapi";import qi from"zod";fd(qi);var Bi=qi.object({id:qi.uuid()}),jr=class{constructor(e,r){this.regimentRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t}=Bi.parse({id:e.params.id}),i=await this.regimentRepository.findById(t);if(!i)throw new f("O regimento n\xE3o existe.");return i.documentUrl&&await this.firebaseStorageService.deleteFile({fileUrl:i.documentUrl}),await this.regimentRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as yd}from"@asteasolutions/zod-to-openapi";import Oi from"zod";yd(Oi);var Tr=Oi.object({id:Oi.uuid()}),xr=class{constructor(e){this.regimentRepository=e}async handle(e,r){try{let{id:t}=Tr.parse({id:e.params.id}),i=await this.regimentRepository.findById(t);if(!i)throw new f("O regimento n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as gd}from"@asteasolutions/zod-to-openapi";import{RegimentStatus as hd}from"@prisma/client";import Ni from"zod";gd(Ni);var ki=Ni.object({status:Ni.enum(hd)}),Pr=class{constructor(e){this.regimentRepository=e}async handle(e,r){try{let{status:t}=ki.parse({status:e.params.status}),i=await this.regimentRepository.findByStatus(t);return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Rd}from"@asteasolutions/zod-to-openapi";import{RegimentStatus as Id}from"@prisma/client";import Ae from"zod";var bd=1,wd=10;Rd(Ae);var Li=Ae.object({page:Ae.coerce.number().min(1).default(bd),limit:Ae.coerce.number().min(1).default(wd),title:Ae.string().optional(),status:Ae.enum(Id).optional(),orderBy:Ae.enum(["asc","desc"]).optional()}),Ar=class{constructor(e){this.regimentRepository=e}async handle(e,r){try{let{page:t,limit:i,...n}=Li.parse(e.query),s=i*t-i,[m,p]=await Promise.all([this.regimentRepository.find({pagination:{offset:s,limit:i},filter:n}),this.regimentRepository.count({filter:n})]),u=Math.max(Math.ceil(p/i),1);r.status(200).json({page:t,totalPages:u,offset:s,limit:i,regiments:m})}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Cd}from"@asteasolutions/zod-to-openapi";import{RegimentStatus as Md}from"@prisma/client";import be from"zod";var Xs=10,$s=1024,Sd=$s*$s,vd=Xs*Sd;Cd(be);var Hi=be.object({id:be.uuid(),title:be.string().min(1,"T\xEDtulo \xE9 obrigat\xF3rio").optional(),version:be.string().min(1,"Vers\xE3o \xE9 obrigat\xF3ria").optional(),publishedAt:be.coerce.date().optional(),document:be.any().refine(o=>o==null?!0:typeof o!="object"||typeof o.size!="number"?!1:o.size<=vd,`O documento deve ter no m\xE1ximo ${Xs}MB.`).optional(),status:be.enum(Md).optional()}),Ur=class{constructor(e,r){this.regimentRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t,title:i,version:n,publishedAt:s,document:m,status:p}=Hi.parse({id:e.params.id,...e.body,document:e.file}),u=await this.regimentRepository.findById(t);if(!u)throw new f("O regimento n\xE3o existe.");let T=u.documentUrl;return m&&(u.documentUrl&&await this.firebaseStorageService.deleteFile({fileUrl:u.documentUrl}),T=await this.firebaseStorageService.uploadFile({file:m,id:t,folder:U.REGIMENT})),await this.regimentRepository.update({id:t,title:i,version:n,publishedAt:s,documentUrl:T??void 0,status:p}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new a(t.message)}}};var _i=C.object({id:C.uuid(),title:C.string(),version:C.string(),publishedAt:C.date(),documentUrl:C.string(),status:C.enum(Ed),createdAt:C.date(),updatedAt:C.date()}),Js={method:"post",path:"/regiment",tags:["Regiments"],summary:"Create a new regiment with document upload",security:[{bearerAuth:[]}],request:{body:{content:{"multipart/form-data":{schema:Fi}}}},responses:{201:{description:"Regiment created successfully",summary:"Regiment Created"},400:{description:"Invalid input data, missing required fields, or invalid document format/size",summary:"Validation Error",content:{"application/json":{schema:C.object({errors:C.record(C.string(),C.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:C.object({message:C.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:C.object({message:C.string()})}}}}},Qs={method:"get",path:"/regiment",tags:["Regiments"],summary:"List all regiments with pagination and filters",request:{query:Li},responses:{200:{description:"List of regiments retrieved successfully with pagination",summary:"Regiments Retrieved",content:{"application/json":{schema:C.object({page:C.number(),totalPages:C.number(),offset:C.number(),limit:C.number(),regiments:C.array(_i)})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:C.object({errors:C.record(C.string(),C.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:C.object({message:C.string()})}}}}},ea={method:"get",path:"/regiment/{id}",tags:["Regiments"],summary:"Find regiment by ID",request:{params:Tr},responses:{200:{description:"Regiment details retrieved successfully",summary:"Regiment Retrieved",content:{"application/json":{schema:_i}}},400:{description:"Invalid regiment ID format",summary:"Validation Error",content:{"application/json":{schema:C.object({errors:C.record(C.string(),C.string())})}}},404:{description:"Regiment not found with the provided ID",summary:"Regiment Not Found",content:{"application/json":{schema:C.object({message:C.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:C.object({message:C.string()})}}}}},ta={method:"get",path:"/regiment/status/{status}",tags:["Regiments"],summary:"Find regiments by status",request:{params:ki},responses:{200:{description:"Regiments retrieved successfully by status",summary:"Regiments Retrieved by Status",content:{"application/json":{schema:C.array(_i)}}},400:{description:"Invalid status parameter provided",summary:"Validation Error",content:{"application/json":{schema:C.object({errors:C.record(C.string(),C.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:C.object({message:C.string()})}}}}},ra={method:"put",path:"/regiment/{id}",tags:["Regiments"],summary:"Update regiment with optional document upload",security:[{bearerAuth:[]}],request:{params:Tr,body:{content:{"multipart/form-data":{schema:Hi.omit({id:!0})}}}},responses:{200:{description:"Regiment updated successfully",summary:"Regiment Updated"},400:{description:"Invalid input data, regiment ID format, or invalid document format/size",summary:"Validation Error",content:{"application/json":{schema:C.object({errors:C.record(C.string(),C.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:C.object({message:C.string()})}}},404:{description:"Regiment not found with the provided ID",summary:"Regiment Not Found",content:{"application/json":{schema:C.object({message:C.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:C.object({message:C.string()})}}}}},oa={method:"delete",path:"/regiment/{id}",tags:["Regiments"],summary:"Delete regiment",security:[{bearerAuth:[]}],request:{params:Bi},responses:{200:{description:"Regiment deleted successfully",summary:"Regiment Deleted"},400:{description:"Invalid regiment ID format",summary:"Validation Error",content:{"application/json":{schema:C.object({errors:C.record(C.string(),C.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:C.object({message:C.string()})}}},404:{description:"Regiment not found with the provided ID",summary:"Regiment Not Found",content:{"application/json":{schema:C.object({message:C.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:C.object({message:C.string()})}}}}};import{$Enums as $i}from"@prisma/client";import d from"zod";import{extendZodWithOpenApi as jd}from"@asteasolutions/zod-to-openapi";import{Degree as xd,Seniority as Td}from"@prisma/client";import K from"zod";jd(K);var zi=K.object({registrationNumber:K.string(),mainEtps:K.string().optional(),formations:K.string().optional(),degrees:K.array(K.enum(xd)),occupations:K.string(),seniority:K.enum(Td),institutions:K.string(),biography:K.string().optional(),userId:K.string()}),Dr=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{registrationNumber:t,mainEtps:i,formations:n,degrees:s,occupations:m,seniority:p,institutions:u,biography:T,userId:P}=zi.parse(e.body);if(await this.researcherRepository.findByRegistrationNumber(t))throw new N("J\xE1 existe um pesquisador cadastrado com este n\xFAmero de registro.");if(await this.researcherRepository.findByUserId(P))throw new N("Usu\xE1rio j\xE1 possui um perfil de pesquisador.");return await this.researcherRepository.create({registrationNumber:t,mainEtps:i,formations:n,degrees:s,occupations:m,seniority:p,institutions:u,biography:T,userId:P}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Pd}from"@asteasolutions/zod-to-openapi";import Wi from"zod";Pd(Wi);var Zi=Wi.object({id:Wi.uuid()}),Fr=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{id:t}=Zi.parse({id:e.params.id});if(!await this.researcherRepository.findById(t))throw new f("O pesquisador n\xE3o existe.");return await this.researcherRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Ad}from"@asteasolutions/zod-to-openapi";import Vi from"zod";Ad(Vi);var Br=Vi.object({id:Vi.uuid()}),qr=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{id:t}=Br.parse({id:e.params.id}),i=await this.researcherRepository.findById(t);if(!i)throw new f("O pesquisador n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Ud}from"@asteasolutions/zod-to-openapi";import Ki from"zod";Ud(Ki);var Gi=Ki.object({userId:Ki.uuid()}),Or=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{userId:t}=Gi.parse({userId:e.params.userId}),i=await this.researcherRepository.findByUserId(t);if(!i)throw new f("O pesquisador n\xE3o existe para este usu\xE1rio.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Dd}from"@asteasolutions/zod-to-openapi";import{Degree as Fd,Seniority as qd}from"@prisma/client";import G from"zod";Dd(G);var Yi=G.object({id:G.uuid(),registrationNumber:G.string().optional(),mainEtps:G.string().optional(),formations:G.string().optional(),degrees:G.array(G.enum(Fd)).optional(),occupations:G.string().optional(),seniority:G.enum(qd).optional(),institutions:G.string().optional(),biography:G.string().optional()}),Nr=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{id:t,registrationNumber:i,mainEtps:n,formations:s,degrees:m,occupations:p,seniority:u,institutions:T,biography:P}=Yi.parse({id:e.params.id,...e.body}),B=await this.researcherRepository.findById(t);if(!B)throw new f("O pesquisador n\xE3o existe.");if(i&&i!==B.registrationNumber){let L=await this.researcherRepository.findByRegistrationNumber(i);if(L&&L.id!==t)throw new N("J\xE1 existe um pesquisador com este n\xFAmero de registro.")}return await this.researcherRepository.update({id:t,registrationNumber:i,mainEtps:n,formations:s,degrees:m,occupations:p,seniority:u,institutions:T,biography:P}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new a(t.message)}}};var Bd=1,Od=9,Xi=d.object({id:d.uuid(),registrationNumber:d.string(),mainEtps:d.string().nullable(),formations:d.string().nullable(),degrees:d.array(d.enum($i.Degree)),occupations:d.string(),seniority:d.enum($i.Seniority),institutions:d.string(),biography:d.string().nullable(),createdAt:d.date(),updatedAt:d.date(),userId:d.uuid(),user:d.object({id:d.uuid(),name:d.string(),emailAddress:d.string(),avatarUrl:d.string().nullable(),orcid:d.string().nullable(),phone:d.string().nullable(),lattesUrl:d.string().nullable(),role:d.enum($i.UserRole)})}),ia={method:"post",path:"/researcher",tags:["Researchers"],summary:"Create a new researcher profile",security:[{bearerAuth:[]}],request:{body:{content:{"application/json":{schema:zi}}}},responses:{201:{description:"Researcher profile created successfully",summary:"Researcher Created",content:{"application/json":{schema:d.object({message:d.string()})}}},400:{description:"Invalid input data or missing required fields",summary:"Validation Error",content:{"application/json":{schema:d.object({errors:d.record(d.string(),d.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:d.object({message:d.string()})}}},409:{description:"Researcher with this registration number already exists or user already has a researcher profile",summary:"Conflict",content:{"application/json":{schema:d.object({message:d.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:d.object({message:d.string()})}}}}},na={method:"get",path:"/researcher",tags:["Researchers"],summary:"List all researchers with pagination and filters",request:{query:d.object({page:d.coerce.number().min(1).default(Bd).optional(),limit:d.coerce.number().min(1).default(Od).optional(),userId:d.string().optional(),registrationNumber:d.string().optional(),name:d.string().optional(),emailAddress:d.string().optional(),mainEtps:d.string().optional(),formations:d.string().optional(),occupations:d.string().optional(),institutions:d.string().optional(),biography:d.string().optional(),orderBy:d.enum(["asc","desc"]).optional()})},responses:{200:{description:"List of researchers retrieved successfully with pagination",summary:"Researchers Retrieved",content:{"application/json":{schema:d.object({page:d.number(),totalPages:d.number(),offset:d.number(),limit:d.number(),researchers:d.array(Xi)})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:d.object({message:d.string()})}}}}},sa={method:"get",path:"/researcher/{id}",tags:["Researchers"],summary:"Find researcher by ID",request:{params:Br},responses:{200:{description:"Researcher details retrieved successfully",summary:"Researcher Retrieved",content:{"application/json":{schema:Xi}}},400:{description:"Invalid researcher ID format",summary:"Validation Error",content:{"application/json":{schema:d.object({errors:d.record(d.string(),d.string())})}}},404:{description:"Researcher not found with the provided ID",summary:"Researcher Not Found",content:{"application/json":{schema:d.object({message:d.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:d.object({message:d.string()})}}}}},aa={method:"get",path:"/researcher/user/{userId}",tags:["Researchers"],summary:"Find researcher by user ID",request:{params:Gi},responses:{200:{description:"Researcher details retrieved successfully",summary:"Researcher Retrieved",content:{"application/json":{schema:Xi}}},400:{description:"Invalid user ID format",summary:"Validation Error",content:{"application/json":{schema:d.object({errors:d.record(d.string(),d.string())})}}},404:{description:"Researcher not found for this user",summary:"Researcher Not Found",content:{"application/json":{schema:d.object({message:d.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:d.object({message:d.string()})}}}}},ma={method:"put",path:"/researcher/{id}",tags:["Researchers"],summary:"Update researcher profile",security:[{bearerAuth:[]}],request:{params:Br,body:{content:{"application/json":{schema:Yi.omit({id:!0})}}}},responses:{200:{description:"Researcher profile updated successfully",summary:"Researcher Updated",content:{"application/json":{schema:d.object({message:d.string()})}}},400:{description:"Invalid input data or researcher ID format",summary:"Validation Error",content:{"application/json":{schema:d.object({errors:d.record(d.string(),d.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:d.object({message:d.string()})}}},404:{description:"Researcher not found with the provided ID",summary:"Researcher Not Found",content:{"application/json":{schema:d.object({message:d.string()})}}},409:{description:"Researcher with this registration number already exists",summary:"Conflict",content:{"application/json":{schema:d.object({message:d.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:d.object({message:d.string()})}}}}},pa={method:"delete",path:"/researcher/{id}",tags:["Researchers"],summary:"Delete researcher profile",security:[{bearerAuth:[]}],request:{params:Zi},responses:{200:{description:"Researcher profile deleted successfully",summary:"Researcher Deleted"},400:{description:"Invalid researcher ID format",summary:"Validation Error",content:{"application/json":{schema:d.object({errors:d.record(d.string(),d.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:d.object({message:d.string()})}}},404:{description:"Researcher not found with the provided ID",summary:"Researcher Not Found",content:{"application/json":{schema:d.object({message:d.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:d.object({message:d.string()})}}}}};import{$Enums as _d}from"@prisma/client";import E from"zod";import{extendZodWithOpenApi as Nd}from"@asteasolutions/zod-to-openapi";import $e from"zod";Nd($e);var Ji=$e.object({role:$e.string().min(1),description:$e.string().optional(),userId:$e.uuid(),order:$e.number().optional()}),kr=class{constructor(e){this.sdhcTeamMemberRepository=e}async handle(e,r){try{let{role:t,description:i,userId:n,order:s}=Ji.parse(e.body);return await this.sdhcTeamMemberRepository.create({role:t,description:i,userId:n,order:s??0}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as kd}from"@asteasolutions/zod-to-openapi";import Qi from"zod";kd(Qi);var en=Qi.object({id:Qi.uuid()}),Lr=class{constructor(e){this.sdhcTeamMemberRepository=e}async handle(e,r){try{let{id:t}=en.parse({id:e.params.id});if(!await this.sdhcTeamMemberRepository.findById(t))throw new f("O membro da equipe SDHC n\xE3o existe.");return await this.sdhcTeamMemberRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Ld}from"@asteasolutions/zod-to-openapi";import tn from"zod";Ld(tn);var _r=tn.object({id:tn.uuid()}),Hr=class{constructor(e){this.sdhcTeamMemberRepository=e}async handle(e,r){try{let{id:t}=_r.parse({id:e.params.id}),i=await this.sdhcTeamMemberRepository.findById(t);if(!i)throw new f("O membro da equipe SDHC n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Hd}from"@asteasolutions/zod-to-openapi";import Ue from"zod";Hd(Ue);var rn=Ue.object({id:Ue.uuid(),role:Ue.string().min(1).optional(),description:Ue.string().optional(),userId:Ue.uuid().optional(),order:Ue.number().optional()}),zr=class{constructor(e){this.sdhcTeamMemberRepository=e}async handle(e,r){try{let{id:t,role:i,description:n,userId:s,order:m}=rn.parse({id:e.params.id,...e.body});if(!await this.sdhcTeamMemberRepository.findById(t))throw new f("O membro da equipe SDHC n\xE3o existe.");return await this.sdhcTeamMemberRepository.update({id:t,role:i,description:n,userId:s,order:m}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new a(t.message)}}};var zd=E.object({id:E.uuid(),name:E.string(),emailAddress:E.string(),avatarUrl:E.string().nullable(),orcid:E.string().nullable(),phone:E.string().nullable(),lattesUrl:E.string().nullable(),role:E.enum(_d.UserRole)}),ca=E.object({id:E.uuid(),role:E.string(),description:E.string().nullable(),order:E.number(),createdAt:E.date(),updatedAt:E.date(),userId:E.uuid(),user:zd}),da={method:"post",path:"/sdhc-team-member",tags:["SDHC Team Members"],summary:"Create a new SDHC Team Member",security:[{bearerAuth:[]}],request:{body:{content:{"application/json":{schema:Ji}}}},responses:{201:{description:"SDHC Team Member created successfully",summary:"SDHC Team Member Created"},400:{description:"Invalid input data or missing required fields",summary:"Validation Error",content:{"application/json":{schema:E.object({errors:E.record(E.string(),E.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:E.object({message:E.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:E.object({message:E.string()})}}}}},ua={method:"get",path:"/sdhc-team-member",tags:["SDHC Team Members"],summary:"List all SDHC Team Members with filters",request:{query:E.object({role:E.string().optional(),orderBy:E.enum(["asc","desc"]).optional()})},responses:{200:{description:"List of SDHC Team Members retrieved successfully",summary:"SDHC Team Members Retrieved",content:{"application/json":{schema:E.object({members:E.array(ca)})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:E.object({message:E.string()})}}}}},la={method:"get",path:"/sdhc-team-member/{id}",tags:["SDHC Team Members"],summary:"Find SDHC Team Member by ID",request:{params:_r},responses:{200:{description:"SDHC Team Member details retrieved successfully",summary:"SDHC Team Member Retrieved",content:{"application/json":{schema:ca}}},400:{description:"Invalid SDHC Team Member ID format",summary:"Validation Error",content:{"application/json":{schema:E.object({errors:E.record(E.string(),E.string())})}}},404:{description:"SDHC Team Member not found with the provided ID",summary:"SDHC Team Member Not Found",content:{"application/json":{schema:E.object({message:E.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:E.object({message:E.string()})}}}}},fa={method:"put",path:"/sdhc-team-member/{id}",tags:["SDHC Team Members"],summary:"Update SDHC Team Member",security:[{bearerAuth:[]}],request:{params:_r,body:{content:{"application/json":{schema:rn.omit({id:!0})}}}},responses:{200:{description:"SDHC Team Member updated successfully",summary:"SDHC Team Member Updated"},400:{description:"Invalid input data or SDHC Team Member ID format",summary:"Validation Error",content:{"application/json":{schema:E.object({errors:E.record(E.string(),E.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:E.object({message:E.string()})}}},404:{description:"SDHC Team Member not found with the provided ID",summary:"SDHC Team Member Not Found",content:{"application/json":{schema:E.object({message:E.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:E.object({message:E.string()})}}}}},ya={method:"delete",path:"/sdhc-team-member/{id}",tags:["SDHC Team Members"],summary:"Delete SDHC Team Member",security:[{bearerAuth:[]}],request:{params:en},responses:{200:{description:"SDHC Team Member deleted successfully",summary:"SDHC Team Member Deleted"},400:{description:"Invalid SDHC Team Member ID format",summary:"Validation Error",content:{"application/json":{schema:E.object({errors:E.record(E.string(),E.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:E.object({message:E.string()})}}},404:{description:"SDHC Team Member not found with the provided ID",summary:"SDHC Team Member Not Found",content:{"application/json":{schema:E.object({message:E.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:E.object({message:E.string()})}}}}};import{$Enums as Ra}from"@prisma/client";import x from"zod";import{extendZodWithOpenApi as Wd}from"@asteasolutions/zod-to-openapi";import on from"zod";Wd(on);var nn=on.object({id:on.string()}),Wr=class{constructor(e){this.userRepository=e}async handle(e,r){try{let{id:t}=nn.parse({id:e.params.id}),i=await this.userRepository.findById(t);if(!i)throw new f("O usu\xE1rio n\xE3o existe.");let n=e.user.id;if(i.id!==n)throw new Z("Voc\xEA n\xE3o tem permiss\xE3o para deletar o usu\xE1rio");return await this.userRepository.deleteById(i.id),r.sendStatus(204)}catch(t){if(console.log(t),t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Zd}from"@asteasolutions/zod-to-openapi";import{z as sn}from"zod";Zd(sn);var an=sn.object({id:sn.string().min(1,"id do usu\xE1rio n\xE3o fornecido.")}),Zr=class{constructor(e){this.userRepository=e}async handle(e,r){try{let{id:t}=an.parse(e.params),i=await this.userRepository.findById(t);if(!i)throw new f("Usu\xE1rio n\xE3o encontrado");r.status(200).json(i)}catch(t){if(console.log(t),t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Vd}from"@asteasolutions/zod-to-openapi";import De from"zod";var ha=2,ga=1024,Kd=ga*ga,Gd=ha*Kd,Yd=/^\d{4}-\d{4}-\d{4}-\d{4}$/,$d=/^\(?\d{2}\)?[\s-]?\d{4,5}-?\d{4}$/;Vd(De);var mn=De.object({name:De.string().optional(),lattesUrl:De.string().optional(),orcid:De.string().optional().transform(o=>o===void 0?void 0:o.trim()).refine(o=>o===void 0||o===""||Yd.test(o),{message:"ORCID inv\xE1lido. Deve estar no formato 0000-0000-0000-0000"}),phone:De.string().optional().refine(o=>o===void 0||o===""||$d.test(o),{message:"Telefone inv\xE1lido. Deve estar no formato (99) 99999-9999"}),avatarImage:De.any().refine(o=>o==null?!0:typeof o!="object"||typeof o.size!="number"?!1:o.size<=Gd,`A imagem deve ter no m\xE1ximo ${ha}MB.`).optional()}),Vr=class{constructor(e,r){this.userRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{avatarImage:t,...i}=mn.parse({...e.body,avatarImage:e.file}),n=e.user.id,s=await this.userRepository.findById(n);if(!s)throw new H("O usu\xE1rio n\xE3o existe");let m=s.avatarUrl;return t&&(s.avatarUrl?m=await this.firebaseStorageService.updateFile({file:t,id:n,folder:U.USER,fileUrl:s.avatarUrl}):m=await this.firebaseStorageService.uploadFile({file:t,id:n,folder:U.USER})),await this.userRepository.update({...i,id:n,avatarUrl:m||void 0}),r.sendStatus(204)}catch(t){if(t instanceof Error)throw new a(t.message)}}};var Ia={method:"get",path:"/users/{id}",tags:["Users"],summary:"Find user by ID",request:{params:an},responses:{200:{description:"User details retrieved successfully",summary:"User Retrieved",content:{"application/json":{schema:x.object({id:x.string(),name:x.string(),createdAt:x.date(),updatedAt:x.date(),role:x.enum(Ra.UserRole),lattesUrl:x.string().nullable(),orcid:x.string().nullable(),phone:x.string().nullable(),avatarUrl:x.url().nullable(),emailAddress:x.email()})}}},400:{description:"Invalid user ID format",summary:"Validation Error",content:{"application/json":{schema:x.object({errors:x.record(x.string(),x.string())})}}},404:{description:"User not found with the provided ID",summary:"User Not Found",content:{"application/json":{schema:x.object({message:x.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:x.object({message:x.string()})}}}}},ba={method:"put",path:"/users",tags:["Users"],summary:"Update authenticated user",security:[{bearerAuth:[]}],request:{body:{content:{"multipart/form-data":{schema:mn}}}},responses:{200:{description:"User profile updated successfully",summary:"User Updated",content:{"application/json":{schema:x.object({message:x.string()})}}},400:{description:"Invalid input data or file format",summary:"Validation Error",content:{"application/json":{schema:x.object({errors:x.record(x.string(),x.string())})}}},401:{description:"User not authenticated or unauthorized",summary:"Authentication Required",content:{"application/json":{schema:x.object({message:x.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:x.object({message:x.string()})}}}}},wa={method:"delete",path:"/users",tags:["Users"],summary:"Delete authenticated user",security:[{bearerAuth:[]}],request:{params:nn},responses:{200:{description:"User account deleted successfully",summary:"User Deleted",content:{"application/json":{schema:x.object({message:x.string()})}}},400:{description:"Invalid request parameters",summary:"Validation Error",content:{"application/json":{schema:x.object({errors:x.record(x.string(),x.string())})}}},401:{description:"User not authenticated or unauthorized",summary:"Authentication Required",content:{"application/json":{schema:x.object({message:x.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:x.object({message:x.string()})}}}}},Ca={method:"get",path:"/users",tags:["Users"],summary:"List users",responses:{200:{description:"Complete list of users retrieved successfully",summary:"Users Retrieved",content:{"application/json":{schema:x.array(x.object({id:x.string(),name:x.string(),createdAt:x.date(),updatedAt:x.date(),role:x.enum(Ra.UserRole),lattesUrl:x.url().nullable(),orcid:x.string().nullable(),phone:x.string().nullable(),avatarUrl:x.string().nullable(),emailAddress:x.email()}))}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:x.object({message:x.string()})}}}}};var g=new Xd;g.registerComponent("securitySchemes","bearerAuth",{type:"http",scheme:"bearer",bearerFormat:"JWT"});g.registerPath(jn);g.registerPath(xn);g.registerPath(Tn);g.registerPath(Pn);g.registerPath(Un);g.registerPath(Dn);g.registerPath(An);g.registerPath(Ia);g.registerPath(ba);g.registerPath(wa);g.registerPath(Ca);g.registerPath(js);g.registerPath(xs);g.registerPath(Ts);g.registerPath(Ps);g.registerPath(Fn);g.registerPath(qn);g.registerPath(Bn);g.registerPath(On);g.registerPath(Nn);g.registerPath(_s);g.registerPath(zs);g.registerPath(Ws);g.registerPath(Zs);g.registerPath(Vs);g.registerPath(Yn);g.registerPath($n);g.registerPath(Xn);g.registerPath(Jn);g.registerPath(Qn);g.registerPath(ia);g.registerPath(na);g.registerPath(sa);g.registerPath(aa);g.registerPath(ma);g.registerPath(pa);g.registerPath(Ln);g.registerPath(Hn);g.registerPath(_n);g.registerPath(zn);g.registerPath(Wn);g.registerPath(Bs);g.registerPath(Os);g.registerPath(Ns);g.registerPath(ks);g.registerPath(Ls);g.registerPath(as);g.registerPath(ms);g.registerPath(ps);g.registerPath(cs);g.registerPath(ds);g.registerPath(da);g.registerPath(ua);g.registerPath(la);g.registerPath(fa);g.registerPath(ya);g.registerPath(ts);g.registerPath(rs);g.registerPath(os);g.registerPath(is);g.registerPath(ns);g.registerPath(Js);g.registerPath(Qs);g.registerPath(ea);g.registerPath(ta);g.registerPath(ra);g.registerPath(oa);g.registerPath(bs);g.registerPath(ws);g.registerPath(Cs);g.registerPath(Ms);g.registerPath(Ss);g.registerPath(vs);g.registerPath(gs);g.registerPath(hs);g.registerPath(Rs);g.registerPath(Is);var Qd=new Jd(g.definitions),Ma=Qd.generateDocument({openapi:"3.0.0",info:{title:"API da Rede CT",version:"1.0.0",description:"API com valida\xE7\xE3o Zod"}});import{Router as su}from"express";import{extendZodWithOpenApi as eu}from"@asteasolutions/zod-to-openapi";import pn from"zod";eu(pn);var tu=pn.object({authenticatedUserId:pn.uuid()}),Kr=class{constructor(e){this.userRepository=e}async handle(e,r){try{let{authenticatedUserId:t}=tu.parse({authenticatedUserId:e.user.id}),i=await this.userRepository.findById(t);if(!i)throw new f("Usu\xE1rio n\xE3o encontrado.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{PrismaClient as ru}from"@prisma/client";var D=new ru({log:["warn","error"]});var Gr=class{constructor(e){this.prisma=e}async register({userId:e,title:r,description:t,certificationUrl:i}){await this.prisma.certification.create({data:{title:r,description:t,certificationUrl:i,user:{connect:{id:e}}}})}async find({pagination:{offset:e,limit:r},filter:{description:t,orderBy:i,title:n,userId:s}}){let m={},p=[];return s&&(m.userId=s),n&&p.push({title:{contains:n,mode:"insensitive"}}),t&&p.push({description:{contains:t,mode:"insensitive"}}),p.length>0&&(m.OR=p),await this.prisma.certification.findMany({where:m,include:{user:{omit:{passwordHash:!0}}},orderBy:{updatedAt:i},skip:e,take:r})}async findById(e){return await this.prisma.certification.findFirst({where:{id:e}})}async findByUserId({pagination:{limit:e,offset:r},filter:{description:t,orderBy:i,title:n},userId:s}){let m={userId:s},p=[];return n&&p.push({title:{contains:n,mode:"insensitive"}}),t&&p.push({description:{contains:t,mode:"insensitive"}}),p.length>0&&(m.OR=p),await this.prisma.certification.findMany({where:m,include:{user:{omit:{passwordHash:!0}}},skip:r,take:e,orderBy:i?{updatedAt:i}:{updatedAt:"desc"}})}async update({id:e,...r}){await this.prisma.certification.update({where:{id:e},data:r})}async deleteById(e){await this.prisma.certification.delete({where:{id:e}})}async count({filter:{description:e,title:r,userId:t}}){let i={},n=[];return t&&(i.userId=t),r&&n.push({title:{contains:r,mode:"insensitive"}}),e&&n.push({description:{contains:e,mode:"insensitive"}}),n.length>0&&(i.OR=n),await this.prisma.certification.count({where:i})}};function we(){return new Gr(D)}var Yr=class{constructor(e){this.prisma=e}async create(e){await this.prisma.news.create({data:e})}async find({pagination:{offset:e,limit:r},filter:{authorId:t,content:i,title:n,orderBy:s}}){let m={};t&&(m.authorId={contains:t,mode:"insensitive"});let p=[];return n&&p.push({title:{contains:n,mode:"insensitive"}}),i&&p.push({content:{contains:i,mode:"insensitive"}}),p.length>0&&(m.OR=p),await this.prisma.news.findMany({where:m,omit:{authorId:!0},include:{author:!0},orderBy:{updatedAt:s},skip:e,take:r})}async findById(e){return await this.prisma.news.findUnique({where:{id:e},omit:{authorId:!0},include:{author:!0}})}async findByAuthorId({authorId:e,pagination:{offset:r,limit:t},filter:{orderBy:i="desc",content:n,title:s}}){let m={authorId:e},p=[];return s&&p.push({title:{contains:s,mode:"insensitive"}}),n&&p.push({content:{contains:n,mode:"insensitive"}}),p.length>0&&(m.OR=p),await this.prisma.news.findMany({omit:{authorId:!0},where:m,orderBy:{updatedAt:i},skip:r,take:t})}async update(e){await this.prisma.news.update({where:{id:e.id},data:{title:e.title,content:e.content,imageUrl:e.imageUrl}})}async delete(e){await this.prisma.news.delete({where:{id:e}})}async count({filter:{authorId:e,content:r,title:t}}){let i={};e&&(i.authorId={contains:e,mode:"insensitive"});let n=[];return t&&n.push({title:{contains:t,mode:"insensitive"}}),r&&n.push({content:{contains:r,mode:"insensitive"}}),n.length>0&&(i.OR=n),await this.prisma.news.count({where:i})}};function ae(){return new Yr(D)}var $r=class{constructor(e){this.prisma=e}async create(e){await this.prisma.pendency.create({data:e})}async find({filter:{description:e,orderBy:r,title:t,status:i,userId:n},pagination:{limit:s,offset:m}}){let p={userId:n,AND:{status:{equals:i}}};e&&(p.description={contains:e,mode:"insensitive"});let u=[];return t&&u.push({title:{contains:t,mode:"insensitive"}}),u.length>0&&(p.OR=u),await this.prisma.pendency.findMany({where:p,orderBy:{updatedAt:r},include:{user:{omit:{passwordHash:!0}}},skip:m,take:s})}async findById(e){return await this.prisma.pendency.findFirst({where:{id:e},include:{user:{omit:{passwordHash:!0}}}})}async findByUserId({filter:{description:e,orderBy:r,title:t,status:i},pagination:{limit:n,offset:s},userId:m}){let p={userId:m,AND:{status:{equals:i}}},u=[];return e&&u.push({description:{contains:e,mode:"insensitive"}}),t&&u.push({title:{contains:t,mode:"insensitive"}}),u.length>0&&(p.OR=u),await this.prisma.pendency.findMany({where:p,orderBy:{updatedAt:r},include:{user:{omit:{passwordHash:!0}}},skip:s,take:n})}async update({id:e,...r}){await this.prisma.pendency.update({where:{id:e},data:r})}async deleteById(e){await this.prisma.pendency.delete({where:{id:e}})}async count({filter:{description:e,title:r,status:t,userId:i}}){let n={userId:i},s=[];return e&&s.push({description:{contains:e,mode:"insensitive"}}),r&&s.push({title:{contains:r,mode:"insensitive"}}),t&&s.push({status:{equals:t}}),s.length>0&&(n.OR=s),await this.prisma.pendency.count({where:n})}};function Ce(){return new $r(D)}var Xr=class{constructor(e){this.prisma=e}async create(e){await this.prisma.user.create({data:e})}async update(e){await this.prisma.user.update({where:{id:e.id},data:{lattesUrl:e.lattesUrl??null,orcid:e.orcid??null,phone:e.phone??null,avatarUrl:e.avatarUrl??null}})}async deleteById(e){await this.prisma.user.delete({where:{id:e}})}async find(){return await this.prisma.user.findMany({omit:{passwordHash:!0}})}async findByEmail(e){return await this.prisma.user.findFirst({where:{emailAddress:e}})}async findById(e){return await this.prisma.user.findFirst({where:{id:e},omit:{passwordHash:!0}})}};function z(){return new Xr(D)}import{compare as ou,hash as iu}from"bcryptjs";var Jr=class{constructor(e,r){this.hashFn=e;this.compareFn=r}async hash(e){return await this.hashFn(e,6)}async compare({password:e,hashedPassword:r}){return await this.compareFn(e,r)}};function cn(){return new Jr(iu,ou)}import Sa from"jsonwebtoken";import W from"zod";var nu=W.object({JWT_SECRET:W.string(),FIREBASE_BUCKET:W.string(),FIREBASE_CLIENT_EMAIL:W.string(),FIREBASE_PRIVATE_KEY:W.string(),FIREBASE_PROJECT_ID:W.string(),FIREBASE_TYPE:W.string(),FIREBASE_PRIVATE_KEY_ID:W.string(),FIREBASE_CLIENT_ID:W.string(),FIREBASE_AUTH_URI:W.string(),FIREBASE_TOKEN_URI:W.string(),FIREBASE_AUTH_PROVIDER_X509_CERT_URL:W.string(),FIREBASE_CLIENT_X509_CERT_URL:W.string()}),k=nu.parse(process.env);var Qr=class{constructor(e,r){this.signFn=e;this.verifyFn=r}sign(e){try{return this.signFn(e,k.JWT_SECRET,{expiresIn:"3d",subject:e.id})}catch{return null}}verify(e){try{return this.verifyFn(e,k.JWT_SECRET)}catch{return null}}};function eo(){return new Qr(Sa.sign,Sa.verify)}function va(){return{signUpController:new bt(z(),cn())}}function Ea(){return{signInController:new Rt(z(),cn(),eo())}}function ja(){return{findAuthenticatedUserController:new Kr(z())}}function xa(){return{findAuthenticatedUserController:new yt(ae())}}function Ta(){return{findAuthenticatedUserCertificationsController:new ft(we())}}function Pa(){return{findAuthenticatedUserPendenciesController:new gt(Ce())}}var to=class{constructor(e){this.jwtService=e}authenticated(e,r,t){let i=e.headers.authorization;if(!i?.startsWith("Bearer "))return r.status(401).json({message:"Token inv\xE1lido.",invalid:!0});let n=i.split(" ")[1];if(!n)return r.status(401).json({message:"Token n\xE3o fornecido."});try{let s=this.jwtService.verify(n);if(!s)return r.status(401).json({message:"Token inv\xE1lido.",invalid:!0});e.user=s,t()}catch(s){if(console.log(s),s instanceof Error)return r.status(401).json({message:s.message})}}isAdmin(e,r,t){let i=e.headers.authorization;if(!i?.startsWith("Bearer "))return r.status(401).json({message:"Token inv\xE1lido.",invalid:!0});let n=i.split(" ")[1];if(!n)return r.status(401).json({message:"Token n\xE3o fornecido."});try{let s=this.jwtService.verify(n);if(!s)return r.status(401).json({message:"Token inv\xE1lido.",invalid:!0});if(s.role!=="ADMIN")return r.status(401).json({message:"\xC9 necess\xE1rio ter permiss\xF5es de administrador."});t()}catch(s){if(console.log(s),s instanceof Error)return r.status(401).json({message:s.message})}}};function F(){return{authMiddleware:new to(eo())}}var me=su(),{authMiddleware:at}=F();me.post("/sign-up",async(o,e)=>{let{signUpController:r}=va();await r.handle(o,e)});me.post("/sign-in",async(o,e)=>{let{signInController:r}=Ea();await r.handle(o,e)});me.get("/user",(o,e,r)=>{at.authenticated(o,e,r)},async(o,e)=>{let{findAuthenticatedUserController:r}=ja();await r.handle(o,e)});me.get("/user/news",(o,e,r)=>{at.authenticated(o,e,r)},async(o,e)=>{let{findAuthenticatedUserController:r}=xa();await r.handle(o,e)});me.get("/admin",(o,e,r)=>{at.isAdmin(o,e,r)},(o,e)=>{try{e.status(200).json({success:!0})}catch(r){r instanceof Error&&e.status(500).json({message:r.message})}});me.get("/certifications",(o,e,r)=>{at.authenticated(o,e,r)},async(o,e)=>{let{findAuthenticatedUserCertificationsController:r}=Ta();await r.handle(o,e)});me.get("/pendencies",(o,e,r)=>{at.authenticated(o,e,r)},async(o,e)=>{let{findAuthenticatedUserPendenciesController:r}=Pa();await r.handle(o,e)});import{Router as uu}from"express";import{getStorage as mu}from"firebase-admin/storage";import{config as au}from"dotenv";import Aa from"firebase-admin";au();var dn=Aa.initializeApp({credential:Aa.credential.cert({clientEmail:k.FIREBASE_CLIENT_EMAIL,privateKey:k.FIREBASE_PRIVATE_KEY,projectId:k.FIREBASE_PROJECT_ID,type:k.FIREBASE_TYPE,privateKeyId:k.FIREBASE_PRIVATE_KEY_ID,clientId:k.FIREBASE_CLIENT_ID,authUri:k.FIREBASE_AUTH_URI,tokenUri:k.FIREBASE_TOKEN_URI,authProviderX509CertUrl:k.FIREBASE_AUTH_PROVIDER_X509_CERT_URL,clientX509CertUrl:k.FIREBASE_CLIENT_X509_CERT_URL}),storageBucket:k.FIREBASE_BUCKET});dn.name?console.log("\u{1F525} Firebase conectado com sucesso!"):console.error("\u274C Erro ao se conectar ao Firebase.");var pu=mu(dn),Ua=pu.bucket(k.FIREBASE_BUCKET);import{randomUUID as cu}from"node:crypto";var du=/https:\/\/storage\.googleapis\.com\/[^/]+\/(.+)$/,ro=class{constructor(e){this.bucket=e}async uploadFile({file:e,folder:r,id:t}){let i=`${cu()}-${e?.originalname}`,n=this.bucket.file(`${r}/${t}/${i}`);return await new Promise((s,m)=>{let p=n.createWriteStream({metadata:{contentType:e?.mimetype}});p.on("error",u=>{m(u)}),p.on("finish",async()=>{try{await n.makePublic();let u=`https://storage.googleapis.com/${this.bucket.name}/${n.name}`;s(u)}catch(u){m(u)}}),p.end(e.buffer)})}async updateFile({file:e,id:r,fileUrl:t,folder:i}){try{let n=this.getPath(t);if(!n)throw new Error("Arquivo n\xE3o encontrado.");let[s,m]=await Promise.all([this.bucket.file(n).delete(),this.uploadFile({file:e,id:r,folder:i})]);return m}catch{throw new Error("Erro ao atualizar o arquivo.")}}async deleteFile({fileUrl:e}){let r=this.getPath(e);if(!r)throw new Error("Arquivo n\xE3o encontrado.");try{await this.bucket.file(r).delete()}catch{throw new Error("Erro ao deletar o arquivo.")}}getPath(e){let r=e.match(du);return r?r[1]:null}};function A(){return new ro(Ua)}function Da(){return{registerCertificationController:new St(z(),we(),A())}}function Fa(){return{findCertificationsController:new Mt(we())}}function qa(){return{findCertificationByIdController:new Ct(we())}}function Ba(){return{updateCertificationController:new Et(we(),A())}}function Oa(){return{deleteCertificationController:new wt(we(),A())}}import Na from"multer";var q=Na({storage:Na.memoryStorage()});var Fe=uu(),{authMiddleware:mt}=F();Fe.post("/:user_id",(o,e,r)=>{mt.isAdmin(o,e,r)},q.single("certification"),async(o,e)=>{let{registerCertificationController:r}=Da();await r.handle(o,e)});Fe.get("/",(o,e,r)=>{mt.isAdmin(o,e,r)},async(o,e)=>{let{findCertificationsController:r}=Fa();await r.handle(o,e)});Fe.get("/:certification_id",(o,e,r)=>{mt.isAdmin(o,e,r)},async(o,e)=>{let{findCertificationByIdController:r}=qa();await r.handle(o,e)});Fe.put("/:certification_id",(o,e,r)=>{mt.isAdmin(o,e,r)},q.single("certification"),async(o,e)=>{let{updateCertificationController:r}=Ba();await r.handle(o,e)});Fe.delete("/:certification_id",(o,e,r)=>{mt.isAdmin(o,e,r)},async(o,e)=>{let{deleteCertificationController:r}=Oa();await r.handle(o,e)});import{Router as hu}from"express";import{extendZodWithOpenApi as lu}from"@asteasolutions/zod-to-openapi";import pe from"zod";var fu=1,yu=9;lu(pe);var gu=pe.object({page:pe.coerce.number().min(1).default(fu),limit:pe.coerce.number().min(1).default(yu),code:pe.string().optional(),title:pe.string().optional(),description:pe.string().optional(),notes:pe.string().optional(),orderBy:pe.enum(["asc","desc"]).default("desc")}),oo=class{constructor(e){this.etpRepository=e}async handle(e,r){try{let{page:t,limit:i,...n}=gu.parse(e.query),s=i*t-i,[m,p]=await Promise.all([this.etpRepository.find({pagination:{offset:s,limit:i},filter:n}),this.etpRepository.count({filter:n})]),u=Math.max(Math.ceil(p/i),1);r.status(200).json({page:t,totalPages:u,offset:s,limit:i,etps:m})}catch(t){if(t instanceof Error)throw new a(t.message)}}};var io=class{constructor(e){this.prisma=e}async create(e){let{leaderId:r,deputyLeaderId:t,secretaryId:i,memberIds:n,...s}=e;await this.prisma.$transaction(async m=>{let p=await m.eTP.create({data:s});await m.eTPLeader.create({data:{etpId:p.id,researcherId:r}}),await m.eTPDeputy.create({data:{etpId:p.id,researcherId:t}}),await m.eTPSecretary.create({data:{etpId:p.id,researcherId:i}}),await m.eTP.update({where:{id:p.id},data:{members:{connect:n.map(u=>({id:u}))}}})})}async update(e){let{leaderId:r,deputyLeaderId:t,secretaryId:i,memberIds:n,...s}=e;await this.prisma.$transaction(async m=>{await m.eTP.update({where:{id:e.id},data:s}),await this.updateLeader(m,e.id,r),await this.updateDeputyLeader(m,e.id,t),await this.updateSecretary(m,e.id,i),await this.updateMembers(m,e.id,n)})}async updateLeader(e,r,t){t!==void 0&&(await e.eTPLeader.deleteMany({where:{etpId:r}}),t&&await e.eTPLeader.create({data:{etpId:r,researcherId:t}}))}async updateDeputyLeader(e,r,t){t!==void 0&&(await e.eTPDeputy.deleteMany({where:{etpId:r}}),t&&await e.eTPDeputy.create({data:{etpId:r,researcherId:t}}))}async updateSecretary(e,r,t){t!==void 0&&(await e.eTPSecretary.deleteMany({where:{etpId:r}}),t&&await e.eTPSecretary.create({data:{etpId:r,researcherId:t}}))}async updateMembers(e,r,t){t!==void 0&&await e.eTP.update({where:{id:r},data:{members:{set:t.map(i=>({id:i}))}}})}async deleteById(e){await this.prisma.eTP.delete({where:{id:e}})}async find({pagination:{offset:e,limit:r},filter:{code:t,title:i,description:n,notes:s,orderBy:m}}){let p={},u=[];return t&&u.push({code:{contains:t,mode:"insensitive"}}),i&&u.push({title:{contains:i,mode:"insensitive"}}),n&&u.push({description:{contains:n,mode:"insensitive"}}),s&&u.push({notes:{contains:s,mode:"insensitive"}}),u.length>0&&(p.OR=u),await this.prisma.eTP.findMany({where:p,include:{leader:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},deputyLeader:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},secretary:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},members:{include:{user:{omit:{passwordHash:!0}}}}},orderBy:{updatedAt:m},skip:e,take:r})}async findById(e){return await this.prisma.eTP.findFirst({where:{id:e},include:{leader:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},deputyLeader:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},secretary:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},members:{include:{user:{omit:{passwordHash:!0}}}}}})}async findByCode(e){return await this.prisma.eTP.findFirst({where:{code:e},include:{leader:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},deputyLeader:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},secretary:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},members:{include:{user:{omit:{passwordHash:!0}}}}}})}async count({filter:{code:e,title:r,description:t,notes:i}}){let n={},s=[];return e&&s.push({code:{contains:e,mode:"insensitive"}}),r&&s.push({title:{contains:r,mode:"insensitive"}}),t&&s.push({description:{contains:t,mode:"insensitive"}}),i&&s.push({notes:{contains:i,mode:"insensitive"}}),s.length>0&&(n.OR=s),await this.prisma.eTP.count({where:n})}};function Xe(){return new io(D)}function ka(){return{createETPController:new xt(Xe())}}function La(){return{findETPsController:new oo(Xe())}}function Ha(){return{findETPByIdController:new Pt(Xe())}}function _a(){return{updateETPController:new Ut(Xe())}}function za(){return{deleteETPController:new Tt(Xe())}}var qe=hu(),{authMiddleware:un}=F();qe.post("/",(o,e,r)=>{un.authenticated(o,e,r)},async(o,e)=>{let{createETPController:r}=ka();await r.handle(o,e)});qe.get("/",async(o,e)=>{let{findETPsController:r}=La();await r.handle(o,e)});qe.get("/:id",async(o,e)=>{let{findETPByIdController:r}=Ha();await r.handle(o,e)});qe.put("/:id",(o,e,r)=>{un.authenticated(o,e,r)},async(o,e)=>{let{updateETPController:r}=_a();await r.handle(o,e)});qe.delete("/:id",(o,e,r)=>{un.authenticated(o,e,r)},async(o,e)=>{let{deleteETPController:r}=za();await r.handle(o,e)});import{Router as Ru}from"express";var no=class{constructor(e){this.prisma=e}async create(e){return await this.prisma.inMemoriam.create({data:e})}async update(e){await this.prisma.inMemoriam.update({where:{id:e.id},data:e})}async deleteById(e){await this.prisma.inMemoriam.delete({where:{id:e}})}async find({pagination:{offset:e,limit:r},filter:{name:t,biography:i,role:n,orderBy:s}}){let m={},p=[];return n&&(m.role=n),t&&p.push({name:{contains:t,mode:"insensitive"}}),i&&p.push({biography:{contains:i,mode:"insensitive"}}),p.length>0&&(m.OR=p),await this.prisma.inMemoriam.findMany({where:m,orderBy:{updatedAt:s},skip:e,take:r})}async findById(e){return await this.prisma.inMemoriam.findFirst({where:{id:e}})}async findByRole(e){return await this.prisma.inMemoriam.findMany({where:{role:e}})}async count({filter:{name:e,biography:r,role:t}}){let i={},n=[];return t&&(i.role=t),e&&n.push({name:{contains:e,mode:"insensitive"}}),r&&n.push({biography:{contains:r,mode:"insensitive"}}),n.length>0&&(i.OR=n),await this.prisma.inMemoriam.count({where:i})}};function Be(){return new no(D)}function Wa(){return{createInMemoriamController:new Ft(Be(),A())}}function Za(){return{findInMemoriamsController:new kt(Be())}}function Va(){return{findInMemoriamByIdController:new Bt(Be())}}function Ka(){return{findInMemoriamByRoleController:new Nt(Be())}}function Ga(){return{updateInMemoriamController:new Lt(Be(),A())}}function Ya(){return{deleteInMemoriamController:new qt(Be(),A())}}var Me=Ru(),{authMiddleware:ln}=F();Me.post("/",(o,e,r)=>{ln.authenticated(o,e,r)},q.single("photo"),async(o,e)=>{let{createInMemoriamController:r}=Wa();await r.handle(o,e)});Me.get("/",async(o,e)=>{let{findInMemoriamsController:r}=Za();await r.handle(o,e)});Me.get("/:id",async(o,e)=>{let{findInMemoriamByIdController:r}=Va();await r.handle(o,e)});Me.get("/role/:role",async(o,e)=>{let{findInMemoriamByRoleController:r}=Ka();await r.handle(o,e)});Me.put("/:id",(o,e,r)=>{ln.authenticated(o,e,r)},q.single("photo"),async(o,e)=>{let{updateInMemoriamController:r}=Ga();await r.handle(o,e)});Me.delete("/:id",(o,e,r)=>{ln.authenticated(o,e,r)},async(o,e)=>{let{deleteInMemoriamController:r}=Ya();await r.handle(o,e)});import{Router as Iu}from"express";var fn=Iu();fn.get("/",(o,e)=>{e.status(200).json({message:"Rede CT"})});import{Router as Cu}from"express";import{extendZodWithOpenApi as bu}from"@asteasolutions/zod-to-openapi";import so from"zod";bu(so);var wu=so.object({role:so.string().optional(),orderBy:so.enum(["asc","desc"]).optional()}),ao=class{constructor(e){this.legitimatorCommitteeMemberRepository=e}async handle(e,r){try{let t=wu.parse(e.query),i=await this.legitimatorCommitteeMemberRepository.find({filter:t});r.status(200).json({members:i})}catch(t){if(t instanceof Error)throw new a(t.message)}}};var mo=class{constructor(e){this.prisma=e}async create(e){await this.prisma.legitimatorCommitteeMember.create({data:{...e,order:e.order??0}})}async update(e){let{id:r,...t}=e;await this.prisma.legitimatorCommitteeMember.update({where:{id:r},data:t})}async deleteById(e){await this.prisma.legitimatorCommitteeMember.delete({where:{id:e}})}async find({filter:{role:e,orderBy:r}}){let t={};return e&&(t.role={contains:e,mode:"insensitive"}),await this.prisma.legitimatorCommitteeMember.findMany({where:t,include:{user:{omit:{passwordHash:!0}}},orderBy:r?[{order:"asc"},{updatedAt:r}]:[{order:"asc"},{updatedAt:"desc"}]})}async findById(e){return await this.prisma.legitimatorCommitteeMember.findFirst({where:{id:e},include:{user:{omit:{passwordHash:!0}}}})}async count({filter:{role:e}}){let r={};return e&&(r.role={contains:e,mode:"insensitive"}),await this.prisma.legitimatorCommitteeMember.count({where:r})}};function Je(){return new mo(D)}function $a(){return{createLegitimatorCommitteeMemberController:new Ht(Je())}}function Xa(){return{findLegitimatorCommitteeMembersController:new ao(Je())}}function Ja(){return{findLegitimatorCommitteeMemberByIdController:new zt(Je())}}function Qa(){return{updateLegitimatorCommitteeMemberController:new Zt(Je())}}function em(){return{deleteLegitimatorCommitteeMemberController:new _t(Je())}}var Oe=Cu(),{authMiddleware:yn}=F();Oe.post("/",(o,e,r)=>{yn.authenticated(o,e,r)},async(o,e)=>{let{createLegitimatorCommitteeMemberController:r}=$a();await r.handle(o,e)});Oe.get("/",async(o,e)=>{let{findLegitimatorCommitteeMembersController:r}=Xa();await r.handle(o,e)});Oe.get("/:id",async(o,e)=>{let{findLegitimatorCommitteeMemberByIdController:r}=Ja();await r.handle(o,e)});Oe.put("/:id",(o,e,r)=>{yn.authenticated(o,e,r)},async(o,e)=>{let{updateLegitimatorCommitteeMemberController:r}=Qa();await r.handle(o,e)});Oe.delete("/:id",(o,e,r)=>{yn.authenticated(o,e,r)},async(o,e)=>{let{deleteLegitimatorCommitteeMemberController:r}=em();await r.handle(o,e)});import{Router as vu}from"express";import{extendZodWithOpenApi as Mu}from"@asteasolutions/zod-to-openapi";import pt from"zod";Mu(pt);var Su=pt.object({name:pt.string().optional(),description:pt.string().optional(),orderBy:pt.enum(["asc","desc"]).default("desc")}),po=class{constructor(e){this.managementTeamRepository=e}async handle(e,r){try{let t=Su.parse(e.query),i=await this.managementTeamRepository.find({filter:t});r.status(200).json({teams:i})}catch(t){if(t instanceof Error)throw new a(t.message)}}};var co=class{constructor(e){this.prisma=e}async create(e){let{members:r,...t}=e;await this.prisma.$transaction(async i=>{let n=await i.managementTeam.create({data:t});return await i.managementTeamMember.createMany({data:r.map(({userId:s,role:m,order:p})=>({teamId:n.id,userId:s,role:m,order:p??0}))}),n})}async update(e){let{members:r,...t}=e;await this.prisma.$transaction(async i=>{let n=await i.managementTeam.update({where:{id:e.id},data:t});return r!==void 0&&(await i.managementTeamMember.deleteMany({where:{teamId:e.id}}),r.length>0&&await i.managementTeamMember.createMany({data:r.map(({userId:s,role:m,order:p})=>({teamId:e.id,userId:s,role:m,order:p??0}))})),n})}async deleteById(e){await this.prisma.managementTeam.delete({where:{id:e}})}async find({filter:{name:e,description:r,orderBy:t}}){let i={},n=[];return e&&n.push({name:{contains:e,mode:"insensitive"}}),r&&n.push({description:{contains:r,mode:"insensitive"}}),n.length>0&&(i.OR=n),await this.prisma.managementTeam.findMany({where:i,include:{members:{include:{user:{omit:{passwordHash:!0}}},orderBy:{order:"asc"}}},orderBy:{updatedAt:t}})}async findById(e){return await this.prisma.managementTeam.findFirst({where:{id:e},include:{members:{include:{user:{omit:{passwordHash:!0}}},orderBy:{order:"asc"}}}})}async findByName(e){return await this.prisma.managementTeam.findFirst({where:{name:e},include:{members:{include:{user:{omit:{passwordHash:!0}}},orderBy:{order:"asc"}}}})}async count({filter:{name:e,description:r}}){let t={},i=[];return e&&i.push({name:{contains:e,mode:"insensitive"}}),r&&i.push({description:{contains:r,mode:"insensitive"}}),i.length>0&&(t.OR=i),await this.prisma.managementTeam.count({where:t})}};function Qe(){return new co(D)}function tm(){return{createManagementTeamController:new Vt(Qe())}}function rm(){return{findManagementTeamsController:new po(Qe())}}function om(){return{findManagementTeamByIdController:new Gt(Qe())}}function im(){return{updateManagementTeamController:new $t(Qe())}}function nm(){return{deleteManagementTeamController:new Kt(Qe())}}var Ne=vu(),{authMiddleware:gn}=F();Ne.post("/",(o,e,r)=>{gn.authenticated(o,e,r)},async(o,e)=>{let{createManagementTeamController:r}=tm();await r.handle(o,e)});Ne.get("/",async(o,e)=>{let{findManagementTeamsController:r}=rm();await r.handle(o,e)});Ne.get("/:id",async(o,e)=>{let{findManagementTeamByIdController:r}=om();await r.handle(o,e)});Ne.put("/:id",(o,e,r)=>{gn.authenticated(o,e,r)},async(o,e)=>{let{updateManagementTeamController:r}=im();await r.handle(o,e)});Ne.delete("/:id",(o,e,r)=>{gn.authenticated(o,e,r)},async(o,e)=>{let{deleteManagementTeamController:r}=nm();await r.handle(o,e)});import{Router as xu}from"express";var uo=class{constructor(e){this.prisma=e}async create(e){return await this.prisma.meeting.create({data:e})}async update(e){await this.prisma.meeting.update({where:{id:e.id},data:e})}async deleteById(e){await this.prisma.meeting.delete({where:{id:e}})}async find({pagination:{offset:e,limit:r},filter:{title:t,format:i,status:n,orderBy:s}}){let m={},p=[];return i&&(m.format=i),n&&(m.status=n),t&&p.push({title:{contains:t,mode:"insensitive"}}),p.length>0&&(m.OR=p),await this.prisma.meeting.findMany({where:m,include:{minutes:!0},orderBy:s?{scheduledAt:s}:{scheduledAt:"desc"},skip:e,take:r})}async findById(e){return await this.prisma.meeting.findFirst({where:{id:e},include:{minutes:!0}})}async findByStatus(e){return await this.prisma.meeting.findMany({where:{status:e},include:{minutes:!0}})}async count({filter:{title:e,format:r,status:t}}){let i={},n=[];return r&&(i.format=r),t&&(i.status=t),e&&n.push({title:{contains:e,mode:"insensitive"}}),n.length>0&&(i.OR=n),await this.prisma.meeting.count({where:i})}};function ce(){return new uo(D)}function sm(){return{createMeetingController:new tr(ce())}}function am(){return{findMeetingsController:new sr(ce())}}function mm(){return{findMeetingByIdController:new or(ce())}}function pm(){return{findMeetingByStatusController:new nr(ce())}}function cm(){return{updateMeetingController:new ar(ce())}}function dm(){return{deleteMeetingController:new rr(ce())}}import{extendZodWithOpenApi as Eu}from"@asteasolutions/zod-to-openapi";import hn from"zod";Eu(hn);var ju=hn.object({meetingId:hn.uuid()}),lo=class{constructor(e,r){this.meetingMinuteRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{meetingId:t}=ju.parse({meetingId:e.params.meetingId}),i=await this.meetingMinuteRepository.findByMeetingId(t);if(!i)throw new f("A ata n\xE3o existe para esta reuni\xE3o.");return i.documentUrl&&await this.firebaseStorageService.deleteFile({fileUrl:i.documentUrl}),await this.meetingMinuteRepository.deleteByMeetingId(i.id),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new a(t.message)}}};var fo=class{constructor(e){this.prisma=e}async create(e){return await this.prisma.meetingMinute.create({data:e,include:{meeting:!0}})}async update(e){await this.prisma.meetingMinute.update({where:{id:e.id},data:e})}async deleteByMeetingId(e){await this.prisma.meetingMinute.delete({where:{id:e}})}async findByMeetingId(e){return await this.prisma.meetingMinute.findFirst({where:{meetingId:e},include:{meeting:!0}})}};function ct(){return new fo(D)}function um(){return{createMeetingMinuteController:new Xt(ct(),ce(),A())}}function lm(){return{findMeetingMinuteByMeetingIdController:new Jt(ct())}}function fm(){return{updateMeetingMinuteByMeetingIdController:new Qt(ct(),A())}}function ym(){return{deleteMeetingMinuteByMeetingIdController:new lo(ct(),A())}}var Y=xu(),{authMiddleware:et}=F();Y.post("/",(o,e,r)=>{et.authenticated(o,e,r)},async(o,e)=>{let{createMeetingController:r}=sm();await r.handle(o,e)});Y.get("/",async(o,e)=>{let{findMeetingsController:r}=am();await r.handle(o,e)});Y.get("/:id",async(o,e)=>{let{findMeetingByIdController:r}=mm();await r.handle(o,e)});Y.get("/status/:status",async(o,e)=>{let{findMeetingByStatusController:r}=pm();await r.handle(o,e)});Y.put("/:id",(o,e,r)=>{et.authenticated(o,e,r)},async(o,e)=>{let{updateMeetingController:r}=cm();await r.handle(o,e)});Y.delete("/:id",(o,e,r)=>{et.authenticated(o,e,r)},async(o,e)=>{let{deleteMeetingController:r}=dm();await r.handle(o,e)});Y.post("/:meetingId/minute",(o,e,r)=>{et.authenticated(o,e,r)},q.single("document"),async(o,e)=>{let{createMeetingMinuteController:r}=um();await r.handle(o,e)});Y.get("/:meetingId/minute",async(o,e)=>{let{findMeetingMinuteByMeetingIdController:r}=lm();await r.handle(o,e)});Y.put("/:meetingId/minute",(o,e,r)=>{et.authenticated(o,e,r)},q.single("document"),async(o,e)=>{let{updateMeetingMinuteByMeetingIdController:r}=fm();await r.handle(o,e)});Y.delete("/:meetingId/minute",(o,e,r)=>{et.authenticated(o,e,r)},async(o,e)=>{let{deleteMeetingMinuteByMeetingIdController:r}=ym();await r.handle(o,e)});import{Router as Bu}from"express";import{extendZodWithOpenApi as Tu}from"@asteasolutions/zod-to-openapi";import Rn from"zod";Tu(Rn);var Pu=Rn.object({id:Rn.string()}),yo=class{constructor(e,r){this.newsRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t}=Pu.parse(e.params),i=e.user.id,n=await this.newsRepository.findById(t);if(!n)throw new f("Not\xEDcia n\xE3o encontrada.");if(n.author.id!==i)throw new Z("Sem permiss\xE3o.");await Promise.all([this.newsRepository.delete(t),this.firebaseStorageService.deleteFile({fileUrl:n.imageUrl})]),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new a(t.message)}}};import{extendZodWithOpenApi as Au}from"@asteasolutions/zod-to-openapi";import tt from"zod";var Uu=5,gm=1024,Du=gm*gm,Fu=Uu*Du;Au(tt);var qu=tt.object({id:tt.string(),title:tt.string().min(1),content:tt.string().min(1),image:tt.any().optional().refine(o=>!o||typeof o=="object"&&typeof o.mimetype=="string"&&o.mimetype.startsWith("image/")&&typeof o.size=="number"&&o.size<=Fu,"A imagem deve ser uma imagem v\xE1lida de no m\xE1ximo 5MB.")}),go=class{constructor(e,r){this.newsRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t,title:i,content:n,image:s}=qu.parse({id:e.params.id,image:e.file,...e.body}),m=await this.newsRepository.findById(t);if(!m)throw new f("Not\xEDcia n\xE3o encontrada.");let p=e.user.id;if(m.author.id!==p)throw new Z("Sem permiss\xE3o.");let u=m.imageUrl||"";s&&m.imageUrl&&(u=await this.firebaseStorageService.updateFile({file:s,folder:U.NEWS,id:t,fileUrl:m.imageUrl}));let T=await this.newsRepository.update({id:t,title:i,content:n,imageUrl:u});r.status(200).json(T)}catch(t){if(t instanceof Error)throw new a(t.message)}}};function hm(){return{createNewsController:new mr(ae(),A())}}function Rm(){return{findAllNewsController:new ur(ae())}}function Im(){return{findNewsByIdController:new dr(ae())}}function bm(){return{findNewsByAuthorIdController:new pr(ae())}}function wm(){return{updateNewsController:new go(ae(),A())}}function Cm(){return{deleteNewsController:new yo(ae(),A())}}var Se=Bu(),{authMiddleware:In}=F();Se.post("/",(o,e,r)=>{In.authenticated(o,e,r)},q.single("image"),async(o,e)=>{let{createNewsController:r}=hm();await r.handle(o,e)});Se.get("/",async(o,e)=>{let{findAllNewsController:r}=Rm();await r.handle(o,e)});Se.get("/:id",async(o,e)=>{let{findNewsByIdController:r}=Im();await r.handle(o,e)});Se.get("/author/:authorId",async(o,e)=>{let{findNewsByAuthorIdController:r}=bm();await r.handle(o,e)});Se.put("/:id",(o,e,r)=>{In.authenticated(o,e,r)},q.single("image"),async(o,e)=>{let{updateNewsController:r}=wm();await r.handle(o,e)});Se.delete("/:id",(o,e,r)=>{In.authenticated(o,e,r)},async(o,e)=>{let{deleteNewsController:r}=Cm();await r.handle(o,e)});import{Router as Ou}from"express";var ho=class{constructor(e){this.prisma=e}async create(e){return await this.prisma.partner.create({data:e})}async update(e){await this.prisma.partner.update({where:{id:e.id},data:e})}async deleteById(e){await this.prisma.partner.delete({where:{id:e}})}async find({pagination:e,filter:{name:r,description:t,category:i,isActive:n,orderBy:s}}){let m={},p=[];return n!==void 0&&(m.isActive=n),r&&p.push({name:{contains:r,mode:"insensitive"}}),t&&p.push({description:{contains:t,mode:"insensitive"}}),i&&p.push({category:{contains:i,mode:"insensitive"}}),p.length>0&&(m.OR=p),await this.prisma.partner.findMany({where:m,orderBy:s?{updatedAt:s}:{updatedAt:"desc"},...e&&{skip:e.offset,take:e.limit}})}async findById(e){return await this.prisma.partner.findFirst({where:{id:e}})}async count({filter:{name:e,description:r,category:t,isActive:i}}){let n={},s=[];return i!==void 0&&(n.isActive=i),e&&s.push({name:{contains:e,mode:"insensitive"}}),r&&s.push({description:{contains:r,mode:"insensitive"}}),t&&s.push({category:{contains:t,mode:"insensitive"}}),s.length>0&&(n.OR=s),await this.prisma.partner.count({where:n})}};function rt(){return new ho(D)}function Mm(){return{createPartnerController:new lr(rt(),A())}}function Sm(){return{findPartnersController:new hr(rt())}}function vm(){return{findPartnerByIdController:new yr(rt())}}function Em(){return{updatePartnerController:new Rr(rt(),A())}}function jm(){return{deletePartnerController:new fr(rt(),A())}}var ke=Ou(),{authMiddleware:bn}=F();ke.post("/",(o,e,r)=>{bn.authenticated(o,e,r)},q.single("logo"),async(o,e)=>{let{createPartnerController:r}=Mm();await r.handle(o,e)});ke.get("/",async(o,e)=>{let{findPartnersController:r}=Sm();await r.handle(o,e)});ke.get("/:id",async(o,e)=>{let{findPartnerByIdController:r}=vm();await r.handle(o,e)});ke.put("/:id",(o,e,r)=>{bn.authenticated(o,e,r)},q.single("logo"),async(o,e)=>{let{updatePartnerController:r}=Em();await r.handle(o,e)});ke.delete("/:id",(o,e,r)=>{bn.authenticated(o,e,r)},async(o,e)=>{let{deletePartnerController:r}=jm();await r.handle(o,e)});import{Router as Nu}from"express";function xm(){return{createPendencyController:new Ir(z(),Ce(),A())}}function Tm(){return{findPendenciesController:new Cr(Ce())}}function Pm(){return{findPendencyByIdController:new Mr(Ce())}}function Am(){return{updatePendencyController:new Sr(Ce(),A())}}function Um(){return{deletePendencyController:new wr(Ce(),A())}}var Le=Nu(),{authMiddleware:dt}=F();Le.post("/:user_id",(o,e,r)=>{dt.isAdmin(o,e,r)},q.single("document"),async(o,e)=>{let{createPendencyController:r}=xm();await r.handle(o,e)});Le.get("/",(o,e,r)=>{dt.isAdmin(o,e,r)},async(o,e)=>{let{findPendenciesController:r}=Tm();await r.handle(o,e)});Le.get("/:pendency_id",(o,e,r)=>{dt.isAdmin(o,e,r)},async(o,e)=>{let{findPendencyByIdController:r}=Pm();await r.handle(o,e)});Le.put("/:pendency_id",(o,e,r)=>{dt.isAdmin(o,e,r)},q.single("document"),async(o,e)=>{let{updatePendencyController:r}=Am();await r.handle(o,e)});Le.delete("/:pendency_id",(o,e,r)=>{dt.isAdmin(o,e,r)},async(o,e)=>{let{deletePendencyController:r}=Um();await r.handle(o,e)});import{Router as ku}from"express";var Ro=class{constructor(e){this.prisma=e}async create(e){return await this.prisma.regiment.create({data:e})}async update(e){await this.prisma.regiment.update({where:{id:e.id},data:e})}async deleteById(e){await this.prisma.regiment.delete({where:{id:e}})}async find({pagination:{offset:e,limit:r},filter:{title:t,status:i,orderBy:n}}){let s={},m=[];return i&&(s.status=i),t&&m.push({title:{contains:t,mode:"insensitive"}}),m.length>0&&(s.OR=m),await this.prisma.regiment.findMany({where:s,orderBy:n?{updatedAt:n}:{updatedAt:"desc"},skip:e,take:r})}async findById(e){return await this.prisma.regiment.findFirst({where:{id:e}})}async findByStatus(e){return await this.prisma.regiment.findMany({where:{status:e}})}async count({filter:{title:e,status:r}}){let t={},i=[];return r&&(t.status=r),e&&i.push({title:{contains:e,mode:"insensitive"}}),i.length>0&&(t.OR=i),await this.prisma.regiment.count({where:t})}};function He(){return new Ro(D)}function Dm(){return{createRegimentController:new Er(He(),A())}}function Fm(){return{findRegimentsController:new Ar(He())}}function qm(){return{findRegimentByIdController:new xr(He())}}function Bm(){return{findRegimentByStatusController:new Pr(He())}}function Om(){return{updateRegimentController:new Ur(He(),A())}}function Nm(){return{deleteRegimentController:new jr(He(),A())}}var ve=ku(),{authMiddleware:wn}=F();ve.post("/",(o,e,r)=>{wn.authenticated(o,e,r)},q.single("document"),async(o,e)=>{let{createRegimentController:r}=Dm();await r.handle(o,e)});ve.get("/",async(o,e)=>{let{findRegimentsController:r}=Fm();await r.handle(o,e)});ve.get("/:id",async(o,e)=>{let{findRegimentByIdController:r}=qm();await r.handle(o,e)});ve.get("/status/:status",async(o,e)=>{let{findRegimentByStatusController:r}=Bm();await r.handle(o,e)});ve.put("/:id",(o,e,r)=>{wn.authenticated(o,e,r)},q.single("document"),async(o,e)=>{let{updateRegimentController:r}=Om();await r.handle(o,e)});ve.delete("/:id",(o,e,r)=>{wn.authenticated(o,e,r)},async(o,e)=>{let{deleteRegimentController:r}=Nm();await r.handle(o,e)});import{Router as Wu}from"express";import{extendZodWithOpenApi as Lu}from"@asteasolutions/zod-to-openapi";import _ from"zod";var Hu=1,_u=9;Lu(_);var zu=_.object({page:_.coerce.number().min(1).default(Hu),limit:_.coerce.number().min(1).default(_u),userId:_.string().optional(),registrationNumber:_.string().optional(),name:_.string().optional(),emailAddress:_.string().optional(),mainEtps:_.string().optional(),formations:_.string().optional(),occupations:_.string().optional(),institutions:_.string().optional(),biography:_.string().optional(),orderBy:_.enum(["asc","desc"]).default("desc")}),Io=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{page:t,limit:i,...n}=zu.parse(e.query),s=i*t-i,[m,p]=await Promise.all([this.researcherRepository.find({pagination:{offset:s,limit:i},filter:{userName:n.name,...n}}),this.researcherRepository.count({filter:{userName:n.name,...n}})]),u=Math.max(Math.ceil(p/i),1);r.status(200).json({page:t,totalPages:u,offset:s,limit:i,researchers:m})}catch(t){if(t instanceof Error)throw new a(t.message)}}};var bo=class{constructor(e){this.prisma=e}async create(e){await this.prisma.researcher.create({data:e})}async update(e){await this.prisma.researcher.update({where:{id:e.id},data:e})}async deleteById(e){await this.prisma.researcher.delete({where:{id:e}})}async find({pagination:e,filter:{biography:r,degrees:t,formations:i,institutions:n,mainEtps:s,occupations:m,orderBy:p,registrationNumber:u,seniority:T,userId:P,userName:B}}){let L={},re=[];return B&&re.push({user:{name:{contains:B,mode:"insensitive"}}}),u&&re.push({registrationNumber:{contains:u,mode:"insensitive"}}),s&&re.push({mainEtps:{contains:s,mode:"insensitive"}}),i&&re.push({formations:{contains:i,mode:"insensitive"}}),m&&re.push({occupations:{contains:m,mode:"insensitive"}}),n&&re.push({institutions:{contains:n,mode:"insensitive"}}),r&&re.push({biography:{contains:r,mode:"insensitive"}}),re.length>0&&(L.OR=re),t&&t.length>0&&(L.degrees={hasSome:t}),T&&(L.seniority=T),P&&(L.userId={equals:P}),await this.prisma.researcher.findMany({where:L,omit:{userId:!0},include:{user:{omit:{passwordHash:!0}}},orderBy:{updatedAt:p},...e&&{skip:e.offset,take:e.limit}})}async findById(e){return await this.prisma.researcher.findFirst({where:{id:e},include:{user:{omit:{passwordHash:!0}}}})}async findByUserId(e){return await this.prisma.researcher.findFirst({where:{userId:e},include:{user:{omit:{passwordHash:!0}}}})}async findByRegistrationNumber(e){return await this.prisma.researcher.findFirst({where:{registrationNumber:e},include:{user:{omit:{passwordHash:!0}}}})}async count({filter:{biography:e,degrees:r,formations:t,institutions:i,mainEtps:n,occupations:s,registrationNumber:m,seniority:p,userId:u,userName:T}}){let P={},B=[];return T&&B.push({user:{name:{contains:T,mode:"insensitive"}}}),m&&B.push({registrationNumber:{contains:m,mode:"insensitive"}}),B.length>0&&(P.OR=B),n&&(P.mainEtps={contains:n,mode:"insensitive"}),t&&(P.formations={contains:t,mode:"insensitive"}),r&&r.length>0&&(P.degrees={hasSome:r}),s&&(P.occupations={contains:s,mode:"insensitive"}),p&&(P.seniority=p),i&&(P.institutions={contains:i,mode:"insensitive"}),e&&(P.biography={contains:e,mode:"insensitive"}),u&&(P.userId={equals:u}),await this.prisma.researcher.count({where:P})}};function _e(){return new bo(D)}function km(){return{createResearcherController:new Dr(_e())}}function Lm(){return{findResearchersController:new Io(_e())}}function Hm(){return{findResearcherByIdController:new qr(_e())}}function _m(){return{findResearcherByUserIdController:new Or(_e())}}function zm(){return{updateResearcherController:new Nr(_e())}}function Wm(){return{deleteResearcherController:new Fr(_e())}}var Ee=Wu(),{authMiddleware:Cn}=F();Ee.post("/",(o,e,r)=>{Cn.authenticated(o,e,r)},async(o,e)=>{let{createResearcherController:r}=km();await r.handle(o,e)});Ee.get("/",async(o,e)=>{let{findResearchersController:r}=Lm();await r.handle(o,e)});Ee.get("/:id",async(o,e)=>{let{findResearcherByIdController:r}=Hm();await r.handle(o,e)});Ee.get("/user/:userId",async(o,e)=>{let{findResearcherByUserIdController:r}=_m();await r.handle(o,e)});Ee.put("/:id",(o,e,r)=>{Cn.authenticated(o,e,r)},async(o,e)=>{let{updateResearcherController:r}=zm();await r.handle(o,e)});Ee.delete("/:id",(o,e,r)=>{Cn.authenticated(o,e,r)},async(o,e)=>{let{deleteResearcherController:r}=Wm();await r.handle(o,e)});import{Router as Ku}from"express";import{extendZodWithOpenApi as Zu}from"@asteasolutions/zod-to-openapi";import wo from"zod";Zu(wo);var Vu=wo.object({role:wo.string().optional(),orderBy:wo.enum(["asc","desc"]).optional()}),Co=class{constructor(e){this.sdhcTeamMemberRepository=e}async handle(e,r){try{let t=Vu.parse(e.query),i=await this.sdhcTeamMemberRepository.find({filter:t});r.status(200).json({members:i})}catch(t){if(t instanceof Error)throw new a(t.message)}}};var Mo=class{constructor(e){this.prisma=e}async create(e){await this.prisma.sDHCTeamMember.create({data:{...e,order:e.order??0}})}async update(e){let{id:r,...t}=e;await this.prisma.sDHCTeamMember.update({where:{id:r},data:t})}async deleteById(e){await this.prisma.sDHCTeamMember.delete({where:{id:e}})}async find({filter:{role:e,orderBy:r}}){let t={};return e&&(t.role={contains:e,mode:"insensitive"}),await this.prisma.sDHCTeamMember.findMany({where:t,include:{user:{omit:{passwordHash:!0}}},orderBy:r?[{order:"asc"},{updatedAt:r}]:[{order:"asc"},{updatedAt:"desc"}]})}async findById(e){return await this.prisma.sDHCTeamMember.findFirst({where:{id:e},include:{user:{omit:{passwordHash:!0}}}})}async count({filter:{role:e}}){let r={};return e&&(r.role={contains:e,mode:"insensitive"}),await this.prisma.sDHCTeamMember.count({where:r})}};function ot(){return new Mo(D)}function Zm(){return{createSDHCTeamMemberController:new kr(ot())}}function Vm(){return{findSDHCTeamMembersController:new Co(ot())}}function Km(){return{findSDHCTeamMemberByIdController:new Hr(ot())}}function Gm(){return{updateSDHCTeamMemberController:new zr(ot())}}function Ym(){return{deleteSDHCTeamMemberController:new Lr(ot())}}var ze=Ku(),{authMiddleware:Mn}=F();ze.post("/",(o,e,r)=>{Mn.authenticated(o,e,r)},async(o,e)=>{let{createSDHCTeamMemberController:r}=Zm();await r.handle(o,e)});ze.get("/",async(o,e)=>{let{findSDHCTeamMembersController:r}=Vm();await r.handle(o,e)});ze.get("/:id",async(o,e)=>{let{findSDHCTeamMemberByIdController:r}=Km();await r.handle(o,e)});ze.put("/:id",(o,e,r)=>{Mn.authenticated(o,e,r)},async(o,e)=>{let{updateSDHCTeamMemberController:r}=Gm();await r.handle(o,e)});ze.delete("/:id",(o,e,r)=>{Mn.authenticated(o,e,r)},async(o,e)=>{let{deleteSDHCTeamMemberController:r}=Ym();await r.handle(o,e)});import{Router as Gu}from"express";var So=class{constructor(e){this.userRepository=e}async handle(e,r){try{let t=await this.userRepository.find();r.status(200).json(t)}catch(t){if(t instanceof Error)throw new a(t.message)}}};function $m(){return{updateUserController:new Vr(z(),A())}}function Xm(){return{deleteUserController:new Wr(z())}}function Jm(){return{findUsersController:new So(z())}}function Qm(){return{findUserController:new Zr(z())}}var it=Gu(),{authMiddleware:ep}=F();it.get("/:id",async(o,e)=>{let{findUserController:r}=Qm();await r.handle(o,e)});it.put("/",(o,e,r)=>{ep.authenticated(o,e,r)},q.single("avatarImage"),async(o,e)=>{let{updateUserController:r}=$m();await r.handle(o,e)});it.delete("/:id",(o,e,r)=>{ep.authenticated(o,e,r)},async(o,e)=>{let{deleteUserController:r}=Xm();await r.handle(o,e)});it.get("/",async(o,e)=>{let{findUsersController:r}=Jm();await r.handle(o,e)});var O=Sn(),Xu={methods:["GET","POST","PUT","DELETE"],origin:["http://localhost:3000","https://rede-ct.vercel.app"],credentials:!0};O.use($u(Xu));O.use(Sn.json());O.use(Sn.urlencoded({extended:!1}));O.use("/docs",Yu({content:Ma,theme:"kepler"}));O.use("/",fn);O.use("/auth",me);O.use("/user",it);O.use("/news",Se);O.use("/certification",Fe);O.use("/pendency",Le);O.use("/researcher",Ee);O.use("/in-memoriam",Me);O.use("/etp",qe);O.use("/partner",ke);O.use("/management-team",Ne);O.use("/sdhc-team-member",ze);O.use("/legitimator-committee-member",Oe);O.use("/regiment",ve);O.use("/meeting",Y);O.use((o,e,r,t)=>{let{errorHandler:i}=vn();i.handle(o,e,r,t)});var Qu=Ju.createServer(O),tp=4e3;Qu.listen(tp,()=>{console.log(`\u{1F680} Aplica\xE7\xE3o rodando na porta ${tp}.`)});

import Ea from"node:http";import{apiReference as wa}from"@scalar/express-api-reference";import ba from"cors";import Yt from"express";import rs from"zod";var F=class extends Error{};var k=class extends Error{};var m=class extends Error{};var b=class extends Error{};var B=class extends Error{};import{ZodError as es}from"zod";var Ue=class extends es{};var Pe=class{handle(e,r,t,i){return e instanceof Ue?t.status(400).json({message:"Validation error",error:rs.treeifyError(e)}):e instanceof F?t.status(400).json({message:e.message}):e instanceof b?t.status(404).json({message:e.message}):e instanceof B?t.status(401).json({message:e.message}):e instanceof k?t.status(409).json({message:e.message}):e instanceof m?t.status(500).json({message:e.message}):t.status(500).json({message:"Internal server error"})}};function Jt(){return{errorHandler:new Pe}}import{OpenAPIRegistry as Cn,OpenApiGeneratorV3 as Sn}from"@asteasolutions/zod-to-openapi";import{$Enums as $t}from"@prisma/client";import a from"zod";import{extendZodWithOpenApi as ts}from"@asteasolutions/zod-to-openapi";import me from"zod";var os=1,is=6;ts(me);var Yr=me.object({page:me.coerce.number().min(1).default(os),limit:me.coerce.number().min(1).default(is),title:me.string(),description:me.string(),orderBy:me.enum(["asc","desc"]).default("desc")}),Fe=class{constructor(e){this.certificationRepository=e}async handle(e,r){try{let{title:t,description:i,limit:s,orderBy:n,page:p}=Yr.parse(e.query),d=p*s-s,y=e.user.id,[v,E]=await Promise.all([this.certificationRepository.findByUserId({userId:y,pagination:{offset:d,limit:s},filter:{title:t,description:i,orderBy:n}}),this.certificationRepository.count({filter:{title:t,description:i,userId:y}})]),S=Math.max(Math.ceil(E/s),1);return r.status(200).json({page:p,totalPages:S,offset:d,limit:s,certifications:v})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as ss}from"@asteasolutions/zod-to-openapi";import ce from"zod";var ns=1,as=7;ss(ce);var Jr=ce.object({page:ce.coerce.number().min(1).default(ns),limit:ce.coerce.number().min(1).default(as),title:ce.string().optional(),content:ce.string().optional(),orderBy:ce.enum(["asc","desc"]).default("desc")}),Me=class{constructor(e){this.newsRepository=e}async handle(e,r){try{let{page:t,limit:i,content:s,orderBy:n,title:p}=Jr.parse(e.query),d=i*t-i,y=e.user.id,[v,E]=await Promise.all([this.newsRepository.findByAuthorId({authorId:y,pagination:{offset:d,limit:i},filter:{orderBy:n,title:p,content:s}}),this.newsRepository.count({filter:{authorId:y,content:s,title:p}})]),S=Math.ceil(E/i);r.status(200).json({page:t,totalPages:S,offset:d,limit:i,news:v})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as ms}from"@asteasolutions/zod-to-openapi";import{PendencyStatus as cs}from"@prisma/client";import Y from"zod";var ps=1,ds=6;ms(Y);var $r=Y.object({page:Y.coerce.number().min(1).default(ps),limit:Y.coerce.number().min(1).default(ds),title:Y.string().optional(),description:Y.string().optional(),status:Y.enum(cs).default("PENDING"),orderBy:Y.enum(["asc","desc"]).default("desc")}),Ne=class{constructor(e){this.pendencyRepository=e}async handle(e,r){try{let{title:t,description:i,limit:s,orderBy:n,page:p,status:d}=$r.parse(e.query),y=p*s-s,v=e.user.id,[E,S]=await Promise.all([this.pendencyRepository.findByUserId({userId:v,pagination:{offset:y,limit:s},filter:{title:t,description:i,orderBy:n,status:d}}),this.pendencyRepository.count({filter:{title:t,description:i,userId:v,status:d}})]),_=Math.max(Math.ceil(S/s),1);return r.status(200).json({page:p,totalPages:_,offset:y,limit:s,pendencies:E})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as us}from"@asteasolutions/zod-to-openapi";import qe from"zod";us(qe);var Xr=qe.object({password:qe.string(),email:qe.email()}),Be=class{constructor(e,r,t){this.userRepository=e;this.bcrypt=r;this.jwtService=t}async handle(e,r){try{let{email:t,password:i}=Xr.parse(e.body),s=await this.userRepository.findByEmail(t);if(!s)return r.status(401).json({message:"Usu\xE1rio n\xE3o existe."});if(!await this.bcrypt.compare({password:i,hashedPassword:s.passwordHash}))throw new B("Senha inv\xE1lida.");let{id:p,role:d}=s,y=this.jwtService.sign({id:p,role:d,email:t});return r.status(200).json({token:y})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as ls}from"@asteasolutions/zod-to-openapi";import ge from"zod";var Oe=8;ls(ge);var Qr=ge.object({name:ge.string("Nome \xE9 obrigat\xF3rio.").min(1,"Nome \xE9 obrigat\xF3rio."),emailAddress:ge.email("E-mail inv\xE1lido.").min(1,"E-mail \xE9 obrigat\xF3rio."),password:ge.string("A senha \xE9 obrigat\xF3ria.").min(Oe,`A senha deve ter pelo menos ${Oe} caracteres.`),confirmPassword:ge.string("A senha \xE9 obrigat\xF3ria.").min(Oe,`A senha deve ter pelo menos ${Oe} caracteres.`)}).refine(o=>o.password===o.confirmPassword,{message:"As senhas n\xE3o coincidem.",path:["confirmPassword"]}),De=class{constructor(e,r){this.userRepository=e;this.bcrypt=r}async handle(e,r){try{let{emailAddress:t,name:i,password:s}=Qr.parse(e.body);if(await this.userRepository.findByEmail(t))throw new k("Usu\xE1rio j\xE1 existe.");let p=await this.bcrypt.hash(s);return await this.userRepository.create({name:i,emailAddress:t,passwordHash:p}),r.status(201).json()}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Xt={method:"post",path:"/auth/sign-up",tags:["Authentication"],summary:"Create a new user",request:{body:{content:{"application/json":{schema:Qr}}}},responses:{201:{description:"User created successfully",summary:"User Registration Successful",content:{"application/json":{schema:a.object({message:a.string()})}}},400:{description:"Invalid input data provided",summary:"Validation Error",content:{"application/json":{schema:a.object({errors:a.record(a.string(),a.string())})}}},409:{description:"User already exists with this email",summary:"User Already Exists",content:{"application/json":{schema:a.object({message:a.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:a.object({message:a.string()})}}}}},Qt={method:"post",path:"/auth/sign-in",tags:["Authentication"],summary:"Sign in",request:{body:{content:{"application/json":{schema:Xr}}}},responses:{200:{description:"Authentication successful, JWT token returned",summary:"Login Successful",content:{"application/json":{schema:a.object({token:a.string()})}}},400:{description:"Invalid credentials or input data",summary:"Validation Error",content:{"application/json":{schema:a.object({errors:a.record(a.string(),a.string())})}}},401:{description:"Invalid email or password",summary:"Authentication Failed",content:{"application/json":{schema:a.object({message:a.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:a.object({message:a.string()})}}}}},eo={method:"get",path:"/auth/user",tags:["Authentication"],summary:"Search for authenticated user",security:[{bearerAuth:[]}],responses:{200:{description:"Authenticated user information retrieved successfully",summary:"User Information Retrieved",content:{"application/json":{schema:a.object({name:a.string(),id:a.string(),avatarUrl:a.string().nullable(),createdAt:a.date(),updatedAt:a.date(),emailAddress:a.string(),orcid:a.string().nullable(),phone:a.string().nullable(),lattesUrl:a.string().nullable(),role:a.enum($t.UserRole)}).nullable()}}},400:{description:"Invalid request parameters",summary:"Validation Error",content:{"application/json":{schema:a.object({errors:a.record(a.string(),a.string())})}}},404:{description:"User not found or not authenticated",summary:"User Not Found",content:{"application/json":{schema:a.object({message:a.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:a.object({message:a.string()})}}}}},ro={method:"get",path:"/auth/user/news",tags:["Authentication"],summary:"List authenticated user news",security:[{bearerAuth:[]}],request:{query:Jr},responses:{200:{description:"Paginated list of authenticated user news retrieved successfully",summary:"User News Retrieved",content:{"application/json":{schema:a.object({page:a.number(),totalPages:a.number(),offset:a.number(),limit:a.number(),news:a.object({content:a.string(),id:a.string(),title:a.string(),createdAt:a.date(),updatedAt:a.date(),imageUrl:a.string().nullable()})})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:a.object({errors:a.record(a.string(),a.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:a.object({message:a.string()})}}}}},to={method:"get",path:"/auth/admin",tags:["Authentication"],summary:"Verify admin access",security:[{bearerAuth:[]}],responses:{200:{description:"Admin access verified successfully",summary:"Admin Access Granted",content:{"application/json":{schema:a.object({success:a.boolean()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:a.object({message:a.string()})}}}}},oo={method:"get",path:"/auth/certifications",tags:["Authentication"],summary:"List all authenticated user's certifications",security:[{bearerAuth:[]}],request:{query:Yr},responses:{200:{description:"Paginated list of authenticated user certifications retrieved successfully",summary:"User Certifications Retrieved",content:{"application/json":{schema:a.object({page:a.number(),totalPages:a.number(),offset:a.number(),limit:a.number(),certifications:a.object({description:a.string(),id:a.string(),title:a.string(),certificationUrl:a.string(),createdAt:a.date(),updatedAt:a.date(),userId:a.string()})})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:a.object({errors:a.record(a.string(),a.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:a.object({message:a.string()})}}}}},io={method:"get",path:"/auth/pendencies",tags:["Authentication"],summary:"List all authenticated user's pendencies",security:[{bearerAuth:[]}],request:{query:$r},responses:{200:{description:"Paginated list of authenticated user pendencies retrieved successfully",summary:"User Pendencies Retrieved",content:{"application/json":{schema:a.object({page:a.number(),totalPages:a.number(),offset:a.number(),limit:a.number(),pendencies:a.object({id:a.string(),title:a.string(),description:a.string(),status:a.enum($t.PendencyStatus),createdAt:a.date(),updatedAt:a.date(),userId:a.string()})})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:a.object({errors:a.record(a.string(),a.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:a.object({message:a.string()})}}}}};import{$Enums as bs}from"@prisma/client";import u from"zod";import{extendZodWithOpenApi as fs}from"@asteasolutions/zod-to-openapi";import et from"zod";fs(et);var rt=et.object({id:et.string()}),ke=class{constructor(e,r){this.certificationRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t}=rt.parse({id:e.params.certification_id}),i=await this.certificationRepository.findById(t);if(!i)throw new b("A certifica\xE7\xE3o n\xE3o existe.");return await Promise.all([this.certificationRepository.deleteById(i.id),this.firebaseStorageService.deleteFile({fileUrl:i.certificationUrl})]),r.sendStatus(204)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as ys}from"@asteasolutions/zod-to-openapi";import tt from"zod";ys(tt);var ot=tt.object({certificationId:tt.uuid()}),_e=class{constructor(e){this.certificationRepository=e}async handle(e,r){try{let{certificationId:t}=ot.parse({certificationId:e.params.certification_id}),i=await this.certificationRepository.findById(t);if(!i)throw new b("Certificado n\xE3o encontrado.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as hs}from"@asteasolutions/zod-to-openapi";import J from"zod";var gs=1,Rs=6;hs(J);var it=J.object({page:J.coerce.number().min(1).default(gs),limit:J.coerce.number().min(1).default(Rs),title:J.string().optional(),description:J.string().optional(),userId:J.uuid().optional(),orderBy:J.enum(["asc","desc"]).default("desc")}),We=class{constructor(e){this.certificationRepository=e}async handle(e,r){try{let{description:t,limit:i,orderBy:s,page:n,title:p,userId:d}=it.parse(e.query),y=n*i-i,[v,E]=await Promise.all([this.certificationRepository.find({pagination:{offset:y,limit:i},filter:{title:p,description:t,orderBy:s,userId:d}}),this.certificationRepository.count({filter:{title:p,description:t}})]),S=Math.max(Math.ceil(E/i),1);return r.status(200).json({page:n,totalPages:S,offset:y,limit:i,certifications:v})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Is}from"@asteasolutions/zod-to-openapi";import Re from"zod";var j={NEWS:"images/news",USER:"images/user",IN_MEMORIAM:"images/in-memoriam",CERTIFICATION:"documents/certifications",PENDENCY:"documents/pendencies"};Is(Re);var He=Re.object({userId:Re.uuid(),title:Re.string().min(1,"T\xEDtulo \xE9 obrigat\xF3rio."),description:Re.string().min(1,"Descri\xE7\xE3o \xE9 obrigat\xF3ria."),certification:Re.any().refine(o=>o&&typeof o=="object"&&o.size>0,"Arquivo do certificado \xE9 obrigat\xF3rio")}),ze=class{constructor(e,r,t){this.userRepository=e;this.certificationRepository=r;this.firebaseStorageService=t}async handle(e,r){try{let{userId:t,title:i,description:s,certification:n}=He.parse({...e.body,userId:e.params.user_id,certification:e.file});if(!await this.userRepository.findById(t))throw new F("O usu\xE1rio n\xE3o existe.");let d=await this.firebaseStorageService.uploadFile({file:n,id:t,folder:j.CERTIFICATION});return await this.certificationRepository.register({userId:t,title:i,description:s,certificationUrl:d}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as ws}from"@asteasolutions/zod-to-openapi";import Ie from"zod";ws(Ie);var Ze=Ie.object({id:Ie.uuid(),title:Ie.string().min(1,"T\xEDtulo \xE9 obrigat\xF3rio."),description:Ie.string().min(1,"Descri\xE7\xE3o \xE9 obrigat\xF3ria."),certification:Ie.any().refine(o=>o==null||typeof o=="object"&&typeof o.size=="number"&&(o.size===0||o.size>0),"Arquivo do certificado \xE9 inv\xE1lido").optional()}),Le=class{constructor(e,r){this.certificationRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{certification:t,id:i,...s}=Ze.parse({...e.body,id:e.params.certification_id,certification:e.file}),n=await this.certificationRepository.findById(i);if(!n)throw new F("A certifica\xE7\xE3o n\xE3o existe");let p=n.certificationUrl;return t&&t.size>0&&(p=await this.firebaseStorageService.updateFile({file:t,id:n.userId,folder:j.CERTIFICATION,fileUrl:n.certificationUrl})),await this.certificationRepository.update({...s,id:i,certificationUrl:p}),r.sendStatus(204)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var so={method:"post",path:"/certifications/{user_id}",tags:["Certifications"],summary:"Register certification for user",security:[{bearerAuth:[]}],request:{params:He.pick({userId:!0}).transform(()=>({user_id:""})),body:{content:{"multipart/form-data":{schema:He.omit({userId:!0})}}}},responses:{201:{description:"Certification registered successfully for the user",summary:"Certification Registered",content:{"application/json":{schema:u.object({message:u.string()})}}},400:{description:"Invalid input data or file format",summary:"Validation Error",content:{"application/json":{schema:u.object({errors:u.record(u.string(),u.string())})}}},404:{description:"User not found with the provided ID",summary:"User Not Found",content:{"application/json":{schema:u.object({message:u.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:u.object({message:u.string()})}}}}},no={method:"get",path:"/certifications",tags:["Certifications"],summary:"List certifications",security:[{bearerAuth:[]}],request:{query:it},responses:{200:{description:"Paginated list of certifications with user information retrieved successfully",summary:"Certifications Retrieved",content:{"application/json":{schema:u.object({page:u.number(),totalPages:u.number(),offset:u.number(),limit:u.number(),certifications:u.array(u.object({description:u.string(),userId:u.string(),title:u.string(),id:u.string(),createdAt:u.date(),updatedAt:u.date(),certificationUrl:u.url(),user:u.object({id:u.uuid(),name:u.string(),createdAt:u.date(),updatedAt:u.date(),avatarUrl:u.string().nullable(),emailAddress:u.email(),orcid:u.string().nullable(),phone:u.string().nullable(),lattesUrl:u.url().nullable(),role:u.enum(bs.UserRole)})}))})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:u.object({errors:u.record(u.string(),u.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:u.object({message:u.string()})}}}}},ao={method:"get",path:"/certifications/{certification_id}",tags:["Certifications"],summary:"Find certification by ID",security:[{bearerAuth:[]}],request:{params:ot},responses:{200:{description:"Certification details retrieved successfully",summary:"Certification Retrieved",content:{"application/json":{schema:u.object({description:u.string(),userId:u.string(),title:u.string(),id:u.string(),createdAt:u.date(),updatedAt:u.date(),certificationUrl:u.url()}).nullable()}}},400:{description:"Invalid certification ID format",summary:"Validation Error",content:{"application/json":{schema:u.object({errors:u.record(u.string(),u.string())})}}},404:{description:"Certification not found with the provided ID",summary:"Certification Not Found",content:{"application/json":{schema:u.object({message:u.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:u.object({message:u.string()})}}}}},mo={method:"put",path:"/certifications/{certification_id}",tags:["Certifications"],summary:"Update certification",security:[{bearerAuth:[]}],request:{params:Ze.pick({id:!0}).transform(()=>({certification_id:""})),body:{content:{"multipart/form-data":{schema:Ze.omit({id:!0})}}}},responses:{204:{description:"Certification updated successfully",summary:"Certification Updated"},400:{description:"Invalid input data or file format",summary:"Validation Error",content:{"application/json":{schema:u.object({errors:u.record(u.string(),u.string())})}}},404:{description:"Certification not found with the provided ID",summary:"Certification Not Found",content:{"application/json":{schema:u.object({message:u.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:u.object({message:u.string()})}}}}},co={method:"delete",path:"/certifications/{certification_id}",tags:["Certifications"],summary:"Delete certification",security:[{bearerAuth:[]}],request:{params:rt},responses:{204:{description:"Certification deleted successfully",summary:"Certification Deleted"},400:{description:"Invalid certification ID format",summary:"Validation Error",content:{"application/json":{schema:u.object({errors:u.record(u.string(),u.string())})}}},404:{description:"Certification not found with the provided ID",summary:"Certification Not Found",content:{"application/json":{schema:u.object({message:u.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:u.object({message:u.string()})}}}}};import{InMemoriamRole as yo}from"@prisma/client";import l from"zod";import{extendZodWithOpenApi as vs}from"@asteasolutions/zod-to-openapi";import{InMemoriamRole as Es}from"@prisma/client";import $ from"zod";var uo=2,po=1024,Cs=po*po,Ss=uo*Cs;vs($);var st=$.object({name:$.string().min(1,"Nome \xE9 obrigat\xF3rio"),birthDate:$.coerce.date(),deathDate:$.coerce.date(),biography:$.string().optional(),photo:$.any().refine(o=>o==null?!0:typeof o!="object"||typeof o.size!="number"?!1:o.size<=Ss,`A imagem deve ter no m\xE1ximo ${uo}MB.`).optional(),role:$.enum(Es)}).refine(o=>o.deathDate>o.birthDate,{message:"Data de falecimento deve ser posterior \xE0 data de nascimento",path:["deathDate"]}),Ve=class{constructor(e,r){this.inMemoriamRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{name:t,birthDate:i,deathDate:s,biography:n,role:p,photo:d}=st.parse({...e.body,photo:e.file}),y=await this.inMemoriamRepository.create({name:t,birthDate:i,deathDate:s,biography:n??void 0,role:p}),v;return d&&(v=await this.firebaseStorageService.uploadFile({file:d,id:y.id,folder:j.IN_MEMORIAM}),await this.inMemoriamRepository.update({id:y.id,photoUrl:v})),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as js}from"@asteasolutions/zod-to-openapi";import nt from"zod";js(nt);var at=nt.object({id:nt.uuid()}),Ke=class{constructor(e,r){this.inMemoriamRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t}=at.parse({id:e.params.id}),i=await this.inMemoriamRepository.findById(t);if(!i)throw new b("O in memoriam n\xE3o existe.");return i.photoUrl&&this.firebaseStorageService.deleteFile({fileUrl:i.photoUrl}),await this.inMemoriamRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as xs}from"@asteasolutions/zod-to-openapi";import mt from"zod";xs(mt);var Ye=mt.object({id:mt.uuid()}),Ge=class{constructor(e){this.inMemoriamRepository=e}async handle(e,r){try{let{id:t}=Ye.parse({id:e.params.id}),i=await this.inMemoriamRepository.findById(t);if(!i)throw new b("O in memoriam n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as As}from"@asteasolutions/zod-to-openapi";import{InMemoriamRole as Ts}from"@prisma/client";import H from"zod";var fo=2,lo=1024,Us=lo*lo,Ps=fo*Us;As(H);var ct=H.object({id:H.uuid(),name:H.string().min(1,"Nome \xE9 obrigat\xF3rio").optional(),birthDate:H.coerce.date().optional(),deathDate:H.coerce.date().optional(),biography:H.string().optional(),photo:H.any().refine(o=>o==null?!0:typeof o!="object"||typeof o.size!="number"?!1:o.size<=Ps,`A imagem deve ter no m\xE1ximo ${fo}MB.`).optional(),role:H.enum(Ts).optional()}).refine(o=>o.birthDate&&o.deathDate?o.deathDate>o.birthDate:!0,{message:"Data de falecimento deve ser posterior \xE0 data de nascimento",path:["deathDate"]}),Je=class{constructor(e,r){this.inMemoriamRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t,name:i,birthDate:s,deathDate:n,biography:p,photo:d,role:y}=ct.parse({id:e.params.id,...e.body,photo:e.file}),v=await this.inMemoriamRepository.findById(t);if(!v)throw new b("O registro in memoriam n\xE3o existe.");let E=v.photoUrl;return d&&(E=await this.firebaseStorageService.uploadFile({file:d,id:t,folder:j.IN_MEMORIAM})),await this.inMemoriamRepository.update({id:t,name:i,birthDate:s,deathDate:n,biography:p,photoUrl:E??void 0,role:y}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Fs=1,Ms=9,ho=l.object({id:l.uuid(),name:l.string(),birthDate:l.date(),deathDate:l.date(),biography:l.string().nullable(),photoUrl:l.string().nullable(),role:l.enum(yo),createdAt:l.date(),updatedAt:l.date()}),go={method:"post",path:"/in-memoriam",tags:["In Memoriam"],summary:"Create a new in memoriam record with optional photo upload",security:[{bearerAuth:[]}],request:{body:{content:{"multipart/form-data":{schema:st}}}},responses:{201:{description:"In memoriam record created successfully",summary:"In Memoriam Created",content:{"application/json":{schema:l.object({message:l.string()})}}},400:{description:"Invalid input data, missing required fields, or invalid photo format/size",summary:"Validation Error",content:{"application/json":{schema:l.object({errors:l.record(l.string(),l.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:l.object({message:l.string()})}}},409:{description:"In memoriam record with this name already exists",summary:"Conflict",content:{"application/json":{schema:l.object({message:l.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:l.object({message:l.string()})}}}}},Ro={method:"get",path:"/in-memoriam",tags:["In Memoriam"],summary:"List all in memoriam records with pagination and filters",request:{query:l.object({page:l.coerce.number().min(1).default(Fs).optional(),limit:l.coerce.number().min(1).default(Ms).optional(),name:l.string().optional(),biography:l.string().optional(),role:l.enum(yo).optional(),orderBy:l.enum(["asc","desc"]).optional()})},responses:{200:{description:"List of in memoriam records retrieved successfully with pagination",summary:"In Memoriam Records Retrieved",content:{"application/json":{schema:l.object({page:l.number(),totalPages:l.number(),offset:l.number(),limit:l.number(),inMemoriams:l.array(ho)})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:l.object({errors:l.record(l.string(),l.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:l.object({message:l.string()})}}}}},Io={method:"get",path:"/in-memoriam/{id}",tags:["In Memoriam"],summary:"Find in memoriam record by ID",request:{params:Ye},responses:{200:{description:"In memoriam record details retrieved successfully",summary:"In Memoriam Record Retrieved",content:{"application/json":{schema:ho}}},400:{description:"Invalid in memoriam record ID format",summary:"Validation Error",content:{"application/json":{schema:l.object({errors:l.record(l.string(),l.string())})}}},404:{description:"In memoriam record not found with the provided ID",summary:"In Memoriam Record Not Found",content:{"application/json":{schema:l.object({message:l.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:l.object({message:l.string()})}}}}},wo={method:"put",path:"/in-memoriam/{id}",tags:["In Memoriam"],summary:"Update in memoriam record with optional photo upload",security:[{bearerAuth:[]}],request:{params:Ye,body:{content:{"multipart/form-data":{schema:ct.omit({id:!0})}}}},responses:{200:{description:"In memoriam record updated successfully",summary:"In Memoriam Record Updated",content:{"application/json":{schema:l.object({message:l.string()})}}},400:{description:"Invalid input data, in memoriam record ID format, or invalid photo format/size",summary:"Validation Error",content:{"application/json":{schema:l.object({errors:l.record(l.string(),l.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:l.object({message:l.string()})}}},404:{description:"In memoriam record not found with the provided ID",summary:"In Memoriam Record Not Found",content:{"application/json":{schema:l.object({message:l.string()})}}},409:{description:"In memoriam record with this name already exists",summary:"Conflict",content:{"application/json":{schema:l.object({message:l.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:l.object({message:l.string()})}}}}},bo={method:"delete",path:"/in-memoriam/{id}",tags:["In Memoriam"],summary:"Delete in memoriam record",security:[{bearerAuth:[]}],request:{params:at},responses:{200:{description:"In memoriam record deleted successfully",summary:"In Memoriam Record Deleted"},400:{description:"Invalid in memoriam record ID format",summary:"Validation Error",content:{"application/json":{schema:l.object({errors:l.record(l.string(),l.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:l.object({message:l.string()})}}},404:{description:"In memoriam record not found with the provided ID",summary:"In Memoriam Record Not Found",content:{"application/json":{schema:l.object({message:l.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:l.object({message:l.string()})}}}}};import f from"zod";import{extendZodWithOpenApi as Ns}from"@asteasolutions/zod-to-openapi";import Se from"zod";var qs=5,vo=1024,Bs=vo*vo,Os=qs*Bs;Ns(Se);var pt=Se.object({title:Se.string().min(1),content:Se.string().min(1),image:Se.any().refine(o=>!o||typeof o=="object"&&typeof o.mimetype=="string"&&o.mimetype.startsWith("image/")&&typeof o.size=="number"&&o.size<=Os,{message:"A imagem deve ser uma imagem v\xE1lida de no m\xE1ximo 5MB."})}),$e=class{constructor(e,r){this.newsRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{title:t,content:i,image:s}=pt.parse({...e.body,image:e.file}),n=e.user.id,p=await this.firebaseStorageService.uploadFile({file:s,folder:j.NEWS,id:n});await this.newsRepository.create({title:t,content:i,authorId:n,imageUrl:p}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Ds}from"@asteasolutions/zod-to-openapi";import X from"zod";var ks=1,_s=7;Ds(X);var Qe=X.object({page:X.coerce.number().min(1).default(ks),limit:X.coerce.number().min(1).default(_s),authorId:X.string(),title:X.string().optional(),content:X.string().optional(),orderBy:X.enum(["asc","desc"]).default("desc")}),Xe=class{constructor(e){this.newsRepository=e}async handle(e,r){try{let{page:t,limit:i,authorId:s,content:n,orderBy:p,title:d}=Qe.parse(e.query),y=i*t-i,[v,E]=await Promise.all([this.newsRepository.findByAuthorId({authorId:s,pagination:{offset:y,limit:i},filter:{orderBy:p,title:d,content:n}}),this.newsRepository.count({filter:{authorId:s,content:n,title:d}})]),S=Math.max(Math.ceil(E/i),1);r.status(200).json({page:t,totalPages:S,offset:y,limit:i,news:v})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Ws}from"@asteasolutions/zod-to-openapi";import dt from"zod";Ws(dt);var ut=dt.object({id:dt.string()}),er=class{constructor(e){this.newsRepository=e}async handle(e,r){try{let{id:t}=ut.parse(e.params),i=await this.newsRepository.findById(t);if(!i)throw new b("Not\xEDcia n\xE3o encontrada.");r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as zs}from"@asteasolutions/zod-to-openapi";import Q from"zod";var Hs=1,Ls=9;zs(Q);var lt=Q.object({page:Q.coerce.number().min(1).default(Hs),limit:Q.coerce.number().min(1).default(Ls),title:Q.string().optional(),content:Q.string().optional(),authorId:Q.string().optional(),orderBy:Q.enum(["asc","desc"]).default("desc")}),rr=class{constructor(e){this.newsRepository=e}async handle(e,r){try{let{page:t,limit:i,authorId:s,content:n,orderBy:p,title:d}=lt.parse(e.query),y=i*t-i,[v,E]=await Promise.all([this.newsRepository.find({pagination:{offset:y,limit:i},filter:{authorId:s,content:n,title:d,orderBy:p}}),this.newsRepository.count({filter:{title:d,content:n,authorId:s}})]),S=Math.max(Math.ceil(E/i),1);r.status(200).json({page:t,totalPages:S,offset:y,limit:i,news:v})}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Eo={method:"post",path:"/news",tags:["News"],summary:"Create news",security:[{bearerAuth:[]}],request:{body:{content:{"multipart/form-data":{schema:pt}}}},responses:{201:{description:"News article created successfully",summary:"News Created",content:{"application/json":{schema:f.object({message:f.string()})}}},400:{description:"Invalid input data or file format",summary:"Validation Error",content:{"application/json":{schema:f.object({errors:f.record(f.string(),f.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:f.object({message:f.string()})}}}}},Co={method:"get",path:"/news",tags:["News"],summary:"List news",request:{query:lt},responses:{200:{description:"Paginated list of news articles retrieved successfully",summary:"News Retrieved",content:{"application/json":{schema:f.object({page:f.number(),totalPages:f.number(),offset:f.number(),limit:f.number(),news:f.array(f.object({title:f.string(),content:f.string(),id:f.string(),createdAt:f.date(),updatedAt:f.date(),imageUrl:f.string().nullable()}))})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:f.object({errors:f.record(f.string(),f.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:f.object({message:f.string()})}}}}},So={method:"get",path:"/news/{id}",tags:["News"],summary:"Find news by ID",request:{params:ut},responses:{200:{description:"News article details retrieved successfully",summary:"News Retrieved",content:{"application/json":{schema:f.object({page:f.number(),totalPages:f.number(),offset:f.number(),limit:f.number(),news:f.object({title:f.string(),content:f.string(),id:f.string(),createdAt:f.date(),updatedAt:f.date(),imageUrl:f.string().nullable()})})}}},400:{description:"Invalid news ID format",summary:"Validation Error",content:{"application/json":{schema:f.object({errors:f.record(f.string(),f.string())})}}},404:{description:"News article not found with the provided ID",summary:"News Not Found",content:{"application/json":{schema:f.object({message:f.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:f.object({message:f.string()})}}}}},jo={method:"get",path:"/news/author/{author_id}",tags:["News"],summary:"List news by author",request:{params:Qe.pick({authorId:!0}).transform(()=>({author_id:""})),query:Qe.omit({authorId:!0})},responses:{200:{description:"Paginated list of news articles by author retrieved successfully",summary:"Author News Retrieved",content:{"application/json":{schema:f.object({page:f.number(),totalPages:f.number(),offset:f.number(),limit:f.number(),news:f.array(f.object({title:f.string(),content:f.string(),id:f.string(),createdAt:f.date(),updatedAt:f.date(),imageUrl:f.string().nullable()}))})}}},400:{description:"Invalid author ID or query parameters",summary:"Validation Error",content:{"application/json":{schema:f.object({errors:f.record(f.string(),f.string())})}}},404:{description:"Author not found with the provided ID",summary:"Author Not Found",content:{"application/json":{schema:f.object({message:f.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:f.object({message:f.string()})}}}}};import{$Enums as xo}from"@prisma/client";import g from"zod";import{extendZodWithOpenApi as Zs}from"@asteasolutions/zod-to-openapi";import{PendencyStatus as Vs}from"@prisma/client";import ee from"zod";Zs(ee);var or=ee.object({userId:ee.uuid(),title:ee.string().min(1),description:ee.string().optional(),status:ee.enum(Vs).default("PENDING"),dueDate:ee.coerce.date().optional(),document:ee.any().refine(o=>o&&typeof o=="object"&&o.size>0,"Arquivo do documento \xE9 obrigat\xF3rio")}),tr=class{constructor(e,r,t){this.userRepository=e;this.pendencyRepository=r;this.firebaseStorageService=t}async handle(e,r){try{let{userId:t,title:i,description:s,status:n,dueDate:p,document:d}=or.parse({...e.body,userId:e.params.user_id,document:e.file});if(!await this.userRepository.findById(t))throw new F("O usu\xE1rio n\xE3o existe.");let v=await this.firebaseStorageService.uploadFile({file:d,id:t,folder:j.PENDENCY});return await this.pendencyRepository.create({userId:t,title:i,description:s,status:n,dueDate:p,documentUrl:v}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Ks}from"@asteasolutions/zod-to-openapi";import ft from"zod";Ks(ft);var yt=ft.object({id:ft.uuid()}),ir=class{constructor(e,r){this.pendencyRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t}=yt.parse({id:e.params.pendency_id}),i=await this.pendencyRepository.findById(t);if(!i)throw new b("A pend\xEAncia n\xE3o existe.");return await Promise.all([this.pendencyRepository.deleteById(i.id),this.firebaseStorageService.deleteFile({fileUrl:i.documentUrl})]),r.sendStatus(204)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Gs}from"@asteasolutions/zod-to-openapi";import{PendencyStatus as Ys}from"@prisma/client";import L from"zod";var Js=1,$s=6;Gs(L);var ht=L.object({page:L.coerce.number().min(1).default(Js),limit:L.coerce.number().min(1).default($s),title:L.string().optional(),description:L.string().optional(),status:L.enum(Ys).default("PENDING"),userId:L.uuid().optional(),orderBy:L.enum(["asc","desc"]).default("desc")}),sr=class{constructor(e){this.pendencyRepository=e}async handle(e,r){try{let{description:t,limit:i,orderBy:s,page:n,title:p,status:d,userId:y}=ht.parse(e.query),v=n*i-i,[E,S]=await Promise.all([this.pendencyRepository.find({pagination:{offset:v,limit:i},filter:{title:p,description:t,status:d,orderBy:s,userId:y}}),this.pendencyRepository.count({filter:{title:p,description:t,status:d,userId:y}})]),_=Math.max(Math.ceil(S/i),1);return r.status(200).json({page:n,totalPages:_,offset:v,limit:i,pendencies:E})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Xs}from"@asteasolutions/zod-to-openapi";import gt from"zod";Xs(gt);var Rt=gt.object({pendencyId:gt.uuid()}),nr=class{constructor(e){this.pendencyRepository=e}async handle(e,r){try{let{pendencyId:t}=Rt.parse({pendencyId:e.params.pendency_id}),i=await this.pendencyRepository.findById(t);if(!i)throw new b("Pend\xEAncia n\xE3o encontrada.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Qs}from"@asteasolutions/zod-to-openapi";import{PendencyStatus as en}from"@prisma/client";import re from"zod";Qs(re);var mr=re.object({id:re.uuid(),title:re.string().min(1),description:re.string().optional(),status:re.enum(en),dueDate:re.coerce.date().optional(),document:re.any().refine(o=>o==null||typeof o=="object"&&typeof o.size=="number"&&(o.size===0||o.size>0),"Arquivo do documento \xE9 inv\xE1lido").optional()}),ar=class{constructor(e,r){this.pendencyRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{document:t,id:i,...s}=mr.parse({...e.body,id:e.params.pendency_id,document:e.file}),n=await this.pendencyRepository.findById(i);if(!n)throw new F("A pend\xEAncia n\xE3o existe");let p=n.documentUrl;return t&&t.size>0&&(p=await this.firebaseStorageService.updateFile({file:t,id:n.userId,folder:j.PENDENCY,fileUrl:n.documentUrl})),await this.pendencyRepository.update({...s,id:i,documentUrl:p}),r.sendStatus(204)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Ao={method:"post",path:"/pendency/{user_id}",tags:["Pendencies"],summary:"Create pendency for user",security:[{bearerAuth:[]}],request:{params:or.pick({userId:!0}).transform(()=>({user_id:""})),body:{content:{"multipart/form-data":{schema:or.omit({userId:!0})}}}},responses:{201:{description:"Pendency created successfully for the user",summary:"Pendency Created",content:{"application/json":{schema:g.object({})}}},400:{description:"Invalid input data or file format",summary:"Validation Error",content:{"application/json":{schema:g.object({errors:g.record(g.string(),g.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:g.object({message:g.string()})}}}}},To={method:"get",path:"/pendency",tags:["Pendencies"],summary:"List pendencies",security:[{bearerAuth:[]}],request:{query:ht},responses:{200:{description:"Paginated list of pendencies retrieved successfully",summary:"Pendencies Retrieved",content:{"application/json":{schema:g.object({page:g.number(),totalPages:g.number(),offset:g.number(),limit:g.number(),pendencies:g.array(g.object({id:g.string(),title:g.string(),description:g.string().nullable(),status:g.enum(xo.PendencyStatus),dueDate:g.date().nullable(),documentUrl:g.string(),userId:g.string(),createdAt:g.date(),updatedAt:g.date()}))})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:g.object({errors:g.record(g.string(),g.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:g.object({message:g.string()})}}}}},Uo={method:"get",path:"/pendency/{pendency_id}",tags:["Pendencies"],summary:"Find pendency by ID",security:[{bearerAuth:[]}],request:{params:Rt},responses:{200:{description:"Pendency details retrieved successfully",summary:"Pendency Retrieved",content:{"application/json":{schema:g.object({id:g.string(),title:g.string(),description:g.string().nullable(),status:g.enum(xo.PendencyStatus),dueDate:g.date().nullable(),documentUrl:g.string(),userId:g.string(),createdAt:g.date(),updatedAt:g.date()}).nullable()}}},400:{description:"Invalid pendency ID format",summary:"Validation Error",content:{"application/json":{schema:g.object({errors:g.record(g.string(),g.string())})}}},404:{description:"Pendency not found with the provided ID",summary:"Pendency Not Found",content:{"application/json":{schema:g.object({message:g.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:g.object({message:g.string()})}}}}},Po={method:"put",path:"/pendency/{pendency_id}",tags:["Pendencies"],summary:"Update pendency",security:[{bearerAuth:[]}],request:{params:mr.pick({id:!0}).transform(()=>({pendency_id:""})),body:{content:{"multipart/form-data":{schema:mr.omit({id:!0})}}}},responses:{204:{description:"Pendency updated successfully",summary:"Pendency Updated"},400:{description:"Invalid input data or pendency does not exist",summary:"Validation Error",content:{"application/json":{schema:g.object({errors:g.record(g.string(),g.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:g.object({message:g.string()})}}}}},Fo={method:"delete",path:"/pendency/{pendency_id}",tags:["Pendencies"],summary:"Delete pendency",security:[{bearerAuth:[]}],request:{params:yt},responses:{204:{description:"Pendency deleted successfully",summary:"Pendency Deleted"},400:{description:"Invalid pendency ID format",summary:"Validation Error",content:{"application/json":{schema:g.object({errors:g.record(g.string(),g.string())})}}},404:{description:"Pendency not found with the provided ID",summary:"Pendency Not Found",content:{"application/json":{schema:g.object({message:g.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:g.object({message:g.string()})}}}}};import{$Enums as jt}from"@prisma/client";import c from"zod";import{extendZodWithOpenApi as rn}from"@asteasolutions/zod-to-openapi";import{Degree as tn,Seniority as on}from"@prisma/client";import O from"zod";rn(O);var It=O.object({registrationNumber:O.string(),mainEtps:O.string().optional(),formations:O.string().optional(),degrees:O.array(O.enum(tn)),occupations:O.string(),seniority:O.enum(on),institutions:O.string(),biography:O.string().optional(),userId:O.string()}),cr=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{registrationNumber:t,mainEtps:i,formations:s,degrees:n,occupations:p,seniority:d,institutions:y,biography:v,userId:E}=It.parse(e.body);if(await this.researcherRepository.findByRegistrationNumber(t))throw new k("J\xE1 existe um pesquisador cadastrado com este n\xFAmero de registro.");if(await this.researcherRepository.findByUserId(E))throw new k("Usu\xE1rio j\xE1 possui um perfil de pesquisador.");return await this.researcherRepository.create({registrationNumber:t,mainEtps:i,formations:s,degrees:n,occupations:p,seniority:d,institutions:y,biography:v,userId:E}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as sn}from"@asteasolutions/zod-to-openapi";import wt from"zod";sn(wt);var bt=wt.object({id:wt.uuid()}),pr=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{id:t}=bt.parse({id:e.params.id});if(!await this.researcherRepository.findById(t))throw new b("O pesquisador n\xE3o existe.");return await this.researcherRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as nn}from"@asteasolutions/zod-to-openapi";import vt from"zod";nn(vt);var ur=vt.object({id:vt.uuid()}),dr=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{id:t}=ur.parse({id:e.params.id}),i=await this.researcherRepository.findById(t);if(!i)throw new b("O pesquisador n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as an}from"@asteasolutions/zod-to-openapi";import Et from"zod";an(Et);var Ct=Et.object({userId:Et.uuid()}),lr=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{userId:t}=Ct.parse({userId:e.params.userId}),i=await this.researcherRepository.findByUserId(t);if(!i)throw new b("O pesquisador n\xE3o existe para este usu\xE1rio.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as mn}from"@asteasolutions/zod-to-openapi";import{Degree as cn,Seniority as pn}from"@prisma/client";import D from"zod";mn(D);var St=D.object({id:D.uuid(),registrationNumber:D.string().optional(),mainEtps:D.string().optional(),formations:D.string().optional(),degrees:D.array(D.enum(cn)).optional(),occupations:D.string().optional(),seniority:D.enum(pn).optional(),institutions:D.string().optional(),biography:D.string().optional()}),fr=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{id:t,registrationNumber:i,mainEtps:s,formations:n,degrees:p,occupations:d,seniority:y,institutions:v,biography:E}=St.parse({id:e.params.id,...e.body}),S=await this.researcherRepository.findById(t);if(!S)throw new b("O pesquisador n\xE3o existe.");if(i&&i!==S.registrationNumber){let _=await this.researcherRepository.findByRegistrationNumber(i);if(_&&_.id!==t)throw new k("J\xE1 existe um pesquisador com este n\xFAmero de registro.")}return await this.researcherRepository.update({id:t,registrationNumber:i,mainEtps:s,formations:n,degrees:p,occupations:d,seniority:y,institutions:v,biography:E}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var dn=1,un=9,xt=c.object({id:c.uuid(),registrationNumber:c.string(),mainEtps:c.string().nullable(),formations:c.string().nullable(),degrees:c.array(c.enum(jt.Degree)),occupations:c.string(),seniority:c.enum(jt.Seniority),institutions:c.string(),biography:c.string().nullable(),createdAt:c.date(),updatedAt:c.date(),userId:c.uuid(),user:c.object({id:c.uuid(),name:c.string(),emailAddress:c.string(),avatarUrl:c.string().nullable(),orcid:c.string().nullable(),phone:c.string().nullable(),lattesUrl:c.string().nullable(),role:c.enum(jt.UserRole)})}),Mo={method:"post",path:"/researcher",tags:["Researchers"],summary:"Create a new researcher profile",security:[{bearerAuth:[]}],request:{body:{content:{"application/json":{schema:It}}}},responses:{201:{description:"Researcher profile created successfully",summary:"Researcher Created",content:{"application/json":{schema:c.object({message:c.string()})}}},400:{description:"Invalid input data or missing required fields",summary:"Validation Error",content:{"application/json":{schema:c.object({errors:c.record(c.string(),c.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:c.object({message:c.string()})}}},409:{description:"Researcher with this registration number already exists or user already has a researcher profile",summary:"Conflict",content:{"application/json":{schema:c.object({message:c.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:c.object({message:c.string()})}}}}},No={method:"get",path:"/researcher",tags:["Researchers"],summary:"List all researchers with pagination and filters",request:{query:c.object({page:c.coerce.number().min(1).default(dn).optional(),limit:c.coerce.number().min(1).default(un).optional(),userId:c.string().optional(),registrationNumber:c.string().optional(),name:c.string().optional(),emailAddress:c.string().optional(),mainEtps:c.string().optional(),formations:c.string().optional(),occupations:c.string().optional(),institutions:c.string().optional(),biography:c.string().optional(),orderBy:c.enum(["asc","desc"]).optional()})},responses:{200:{description:"List of researchers retrieved successfully with pagination",summary:"Researchers Retrieved",content:{"application/json":{schema:c.object({page:c.number(),totalPages:c.number(),offset:c.number(),limit:c.number(),researchers:c.array(xt)})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:c.object({message:c.string()})}}}}},qo={method:"get",path:"/researcher/{id}",tags:["Researchers"],summary:"Find researcher by ID",request:{params:ur},responses:{200:{description:"Researcher details retrieved successfully",summary:"Researcher Retrieved",content:{"application/json":{schema:xt}}},400:{description:"Invalid researcher ID format",summary:"Validation Error",content:{"application/json":{schema:c.object({errors:c.record(c.string(),c.string())})}}},404:{description:"Researcher not found with the provided ID",summary:"Researcher Not Found",content:{"application/json":{schema:c.object({message:c.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:c.object({message:c.string()})}}}}},Bo={method:"get",path:"/researcher/user/{userId}",tags:["Researchers"],summary:"Find researcher by user ID",request:{params:Ct},responses:{200:{description:"Researcher details retrieved successfully",summary:"Researcher Retrieved",content:{"application/json":{schema:xt}}},400:{description:"Invalid user ID format",summary:"Validation Error",content:{"application/json":{schema:c.object({errors:c.record(c.string(),c.string())})}}},404:{description:"Researcher not found for this user",summary:"Researcher Not Found",content:{"application/json":{schema:c.object({message:c.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:c.object({message:c.string()})}}}}},Oo={method:"put",path:"/researcher/{id}",tags:["Researchers"],summary:"Update researcher profile",security:[{bearerAuth:[]}],request:{params:ur,body:{content:{"application/json":{schema:St.omit({id:!0})}}}},responses:{200:{description:"Researcher profile updated successfully",summary:"Researcher Updated",content:{"application/json":{schema:c.object({message:c.string()})}}},400:{description:"Invalid input data or researcher ID format",summary:"Validation Error",content:{"application/json":{schema:c.object({errors:c.record(c.string(),c.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:c.object({message:c.string()})}}},404:{description:"Researcher not found with the provided ID",summary:"Researcher Not Found",content:{"application/json":{schema:c.object({message:c.string()})}}},409:{description:"Researcher with this registration number already exists",summary:"Conflict",content:{"application/json":{schema:c.object({message:c.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:c.object({message:c.string()})}}}}},Do={method:"delete",path:"/researcher/{id}",tags:["Researchers"],summary:"Delete researcher profile",security:[{bearerAuth:[]}],request:{params:bt},responses:{200:{description:"Researcher profile deleted successfully",summary:"Researcher Deleted"},400:{description:"Invalid researcher ID format",summary:"Validation Error",content:{"application/json":{schema:c.object({errors:c.record(c.string(),c.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:c.object({message:c.string()})}}},404:{description:"Researcher not found with the provided ID",summary:"Researcher Not Found",content:{"application/json":{schema:c.object({message:c.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:c.object({message:c.string()})}}}}};import h from"zod";import{extendZodWithOpenApi as ln}from"@asteasolutions/zod-to-openapi";import Z from"zod";ln(Z);var At=Z.object({name:Z.string().min(1),type:Z.string().min(1),members:Z.array(Z.object({role:Z.string().min(1),user:Z.object({id:Z.string()})}))}),yr=class{constructor(e){this.teamRepository=e}async handle(e,r){try{let{name:t,type:i,members:s}=At.parse(e.body);await this.teamRepository.create({name:t,type:i,members:s}),r.status(201).json()}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as fn}from"@asteasolutions/zod-to-openapi";import{z as Tt}from"zod";fn(Tt);var je=Tt.object({id:Tt.uuid()}),hr=class{constructor(e){this.teamRepository=e}async handle(e,r){try{let{id:t}=je.parse(e.params),i=await this.teamRepository.findById(t);r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as yn}from"@asteasolutions/zod-to-openapi";import{z as gr}from"zod";yn(gr);var Ut=gr.object({type:gr.string(),name:gr.string().optional()}),Rr=class{constructor(e){this.teamRepository=e}async handle(e,r){try{let{type:t,name:i}=Ut.parse({type:e.params.type,name:e.query.name}),s=await this.teamRepository.findByType({type:t,filter:{name:i}});r.status(200).json(s)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as hn}from"@asteasolutions/zod-to-openapi";import{z}from"zod";hn(z);var Pt=z.object({id:z.uuid(),name:z.string().min(1),members:z.array(z.object({role:z.string(),id:z.uuid().optional(),user:z.object({id:z.uuid()})}))}),Ir=class{constructor(e,r){this.teamRepository=e;this.teamMemberRepository=r}async handle(e,r){try{let{id:t,members:i,name:s}=Pt.parse({id:e.params.id,...e.body}),n=await this.teamMemberRepository.findByTeamId(t),p=i.map(y=>y.id),d=n.filter(y=>!p.includes(y.id)).map(y=>y.id);await this.teamMemberRepository.deleteMany(d),await this.teamMemberRepository.updateMany({teamId:t,members:i}),await this.teamRepository.update({id:t,name:s}),r.sendStatus(204)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var ko={method:"post",path:"/team",tags:["Teams"],summary:"Create team",security:[{bearerAuth:[]}],request:{body:{content:{"application/json":{schema:At}}}},responses:{201:{description:"Team created successfully",summary:"Team Created",content:{"application/json":{schema:h.object({message:h.string()})}}},400:{description:"Invalid input data provided",summary:"Validation Error",content:{"application/json":{schema:h.object({errors:h.record(h.string(),h.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:h.object({message:h.string()})}}}}},_o={method:"put",path:"/team/{id}",tags:["Teams"],summary:"Update team",security:[{bearerAuth:[]}],request:{params:je,body:{content:{"application/json":{schema:Pt}}}},responses:{204:{description:"Team updated successfully",summary:"Team Updated"},400:{description:"Invalid input data or team ID format",summary:"Validation Error",content:{"application/json":{schema:h.object({errors:h.record(h.string(),h.string())})}}},404:{description:"Team not found with the provided ID",summary:"Team Not Found",content:{"application/json":{schema:h.object({message:h.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:h.object({message:h.string()})}}}}},Wo={method:"delete",path:"/team/{id}",tags:["Teams"],summary:"Delete team",security:[{bearerAuth:[]}],request:{params:je},responses:{204:{description:"Team deleted successfully",summary:"Team Deleted"},400:{description:"Invalid team ID format",summary:"Validation Error",content:{"application/json":{schema:h.object({errors:h.record(h.string(),h.string())})}}},404:{description:"Team not found with the provided ID",summary:"Team Not Found",content:{"application/json":{schema:h.object({message:h.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:h.object({message:h.string()})}}}}},zo={method:"get",path:"/team/id/{id}",tags:["Teams"],summary:"Find team by ID",request:{params:je},responses:{200:{description:"Team details retrieved successfully",summary:"Team Retrieved",content:{"application/json":{schema:h.object({type:h.string(),name:h.string(),id:h.string(),createdAt:h.date(),updatedAt:h.date(),description:h.string().nullable()})}}},400:{description:"Invalid team ID format",summary:"Validation Error",content:{"application/json":{schema:h.object({errors:h.record(h.string(),h.string())})}}},404:{description:"Team not found with the provided ID",summary:"Team Not Found",content:{"application/json":{schema:h.object({message:h.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:h.object({message:h.string()})}}}}},Ho={method:"get",path:"/team/type/{type}",tags:["Teams"],summary:"Find teams by type",request:{params:Ut.pick({type:!0})},responses:{200:{description:"List of teams by type retrieved successfully",summary:"Teams Retrieved",content:{"application/json":{schema:h.array(h.object({type:h.string(),name:h.string(),id:h.string(),createdAt:h.date(),updatedAt:h.date(),description:h.string().nullable()})).nullable()}}},400:{description:"Invalid team type parameter",summary:"Validation Error",content:{"application/json":{schema:h.object({errors:h.record(h.string(),h.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:h.object({message:h.string()})}}}}},Lo={method:"get",path:"/team",tags:["Teams"],summary:"List teams",responses:{200:{description:"Complete list of teams retrieved successfully",summary:"Teams Retrieved",content:{"application/json":{schema:h.array(h.object({type:h.string(),name:h.string(),id:h.string(),createdAt:h.date(),updatedAt:h.date(),description:h.string().nullable()}))}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:h.object({message:h.string()})}}}}};import{$Enums as Ko}from"@prisma/client";import R from"zod";import{extendZodWithOpenApi as gn}from"@asteasolutions/zod-to-openapi";import Ft from"zod";gn(Ft);var Mt=Ft.object({id:Ft.string()}),wr=class{constructor(e){this.userRepository=e}async handle(e,r){try{let{id:t}=Mt.parse({id:e.params.id}),i=await this.userRepository.findById(t);if(!i)throw new b("O usu\xE1rio n\xE3o existe.");let s=e.user.id;if(i.id!==s)throw new B("Voc\xEA n\xE3o tem permiss\xE3o para deletar o usu\xE1rio");return await this.userRepository.deleteById(i.id),r.sendStatus(204)}catch(t){if(console.log(t),t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Rn}from"@asteasolutions/zod-to-openapi";import{z as Nt}from"zod";Rn(Nt);var qt=Nt.object({id:Nt.string().min(1,"id do usu\xE1rio n\xE3o fornecido.")}),br=class{constructor(e){this.userRepository=e}async handle(e,r){try{let{id:t}=qt.parse(e.params),i=await this.userRepository.findById(t);if(!i)throw new b("Usu\xE1rio n\xE3o encontrado");r.status(200).json(i)}catch(t){if(console.log(t),t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as In}from"@asteasolutions/zod-to-openapi";import pe from"zod";var Vo=2,Zo=1024,wn=Zo*Zo,bn=Vo*wn,vn=/^\d{4}-\d{4}-\d{4}-\d{4}$/,vr=/^[^0-9]*$/,En=/^\(?\d{2}\)?[\s-]?\d{4,5}-?\d{4}$/;In(pe);var Bt=pe.object({name:pe.string().optional(),lattesUrl:pe.string().optional(),orcid:pe.string().transform(o=>o.trim()).transform(o=>vr.test(o)?"":o).refine(o=>vr.test(o)||vn.test(o),{message:"ORCID inv\xE1lido. Deve estar no formato 0000-0000-0000-0000"}),phone:pe.string().transform(o=>vr.test(o)?"":o).refine(o=>vr.test(o)||En.test(o),{message:"Telefone inv\xE1lido. Deve estar no formato (99) 99999-9999"}),avatarImage:pe.any().refine(o=>o==null?!0:typeof o!="object"||typeof o.size!="number"?!1:o.size<=bn,`A imagem deve ter no m\xE1ximo ${Vo}MB.`).optional()}),Er=class{constructor(e,r){this.userRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{avatarImage:t,...i}=Bt.parse({...e.body,avatarImage:e.file}),s=e.user.id,n=await this.userRepository.findById(s);if(!n)throw new F("O usu\xE1rio n\xE3o existe");let p=n.avatarUrl;return t&&(n.avatarUrl?p=await this.firebaseStorageService.updateFile({file:t,id:s,folder:j.USER,fileUrl:n.avatarUrl}):p=await this.firebaseStorageService.uploadFile({file:t,id:s,folder:j.USER})),await this.userRepository.update({...i,id:s,avatarUrl:p||void 0}),r.sendStatus(204)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Go={method:"get",path:"/users/{id}",tags:["Users"],summary:"Find user by ID",request:{params:qt},responses:{200:{description:"User details retrieved successfully",summary:"User Retrieved",content:{"application/json":{schema:R.object({id:R.string(),name:R.string(),createdAt:R.date(),updatedAt:R.date(),role:R.enum(Ko.UserRole),lattesUrl:R.string().nullable(),orcid:R.string().nullable(),phone:R.string().nullable(),avatarUrl:R.url().nullable(),emailAddress:R.email()})}}},400:{description:"Invalid user ID format",summary:"Validation Error",content:{"application/json":{schema:R.object({errors:R.record(R.string(),R.string())})}}},404:{description:"User not found with the provided ID",summary:"User Not Found",content:{"application/json":{schema:R.object({message:R.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:R.object({message:R.string()})}}}}},Yo={method:"put",path:"/users",tags:["Users"],summary:"Update authenticated user",security:[{bearerAuth:[]}],request:{body:{content:{"multipart/form-data":{schema:Bt}}}},responses:{200:{description:"User profile updated successfully",summary:"User Updated",content:{"application/json":{schema:R.object({message:R.string()})}}},400:{description:"Invalid input data or file format",summary:"Validation Error",content:{"application/json":{schema:R.object({errors:R.record(R.string(),R.string())})}}},401:{description:"User not authenticated or unauthorized",summary:"Authentication Required",content:{"application/json":{schema:R.object({message:R.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:R.object({message:R.string()})}}}}},Jo={method:"delete",path:"/users",tags:["Users"],summary:"Delete authenticated user",security:[{bearerAuth:[]}],request:{params:Mt},responses:{200:{description:"User account deleted successfully",summary:"User Deleted",content:{"application/json":{schema:R.object({message:R.string()})}}},400:{description:"Invalid request parameters",summary:"Validation Error",content:{"application/json":{schema:R.object({errors:R.record(R.string(),R.string())})}}},401:{description:"User not authenticated or unauthorized",summary:"Authentication Required",content:{"application/json":{schema:R.object({message:R.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:R.object({message:R.string()})}}}}},$o={method:"get",path:"/users",tags:["Users"],summary:"List users",responses:{200:{description:"Complete list of users retrieved successfully",summary:"Users Retrieved",content:{"application/json":{schema:R.array(R.object({id:R.string(),name:R.string(),createdAt:R.date(),updatedAt:R.date(),role:R.enum(Ko.UserRole),lattesUrl:R.url().nullable(),orcid:R.string().nullable(),phone:R.string().nullable(),avatarUrl:R.string().nullable(),emailAddress:R.email()}))}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:R.object({message:R.string()})}}}}};var w=new Cn;w.registerComponent("securitySchemes","bearerAuth",{type:"http",scheme:"bearer",bearerFormat:"JWT"});w.registerPath(Xt);w.registerPath(Qt);w.registerPath(eo);w.registerPath(ro);w.registerPath(oo);w.registerPath(io);w.registerPath(to);w.registerPath(Go);w.registerPath(Yo);w.registerPath(Jo);w.registerPath($o);w.registerPath(ko);w.registerPath(_o);w.registerPath(Wo);w.registerPath(zo);w.registerPath(Ho);w.registerPath(Lo);w.registerPath(Eo);w.registerPath(Co);w.registerPath(So);w.registerPath(jo);w.registerPath(so);w.registerPath(no);w.registerPath(ao);w.registerPath(mo);w.registerPath(co);w.registerPath(Ao);w.registerPath(To);w.registerPath(Uo);w.registerPath(Po);w.registerPath(Fo);w.registerPath(go);w.registerPath(Ro);w.registerPath(Io);w.registerPath(wo);w.registerPath(bo);w.registerPath(Mo);w.registerPath(No);w.registerPath(qo);w.registerPath(Bo);w.registerPath(Oo);w.registerPath(Do);var jn=new Sn(w.definitions),Xo=jn.generateDocument({openapi:"3.0.0",info:{title:"API da Rede CT",version:"1.0.0",description:"API com valida\xE7\xE3o Zod"}});import{Router as Mn}from"express";import{extendZodWithOpenApi as xn}from"@asteasolutions/zod-to-openapi";import Ot from"zod";xn(Ot);var An=Ot.object({authenticatedUserId:Ot.uuid()}),Cr=class{constructor(e){this.userRepository=e}async handle(e,r){try{let{authenticatedUserId:t}=An.parse({authenticatedUserId:e.user.id}),i=await this.userRepository.findById(t);if(!i)throw new b("Usu\xE1rio n\xE3o encontrado.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{PrismaClient as Tn}from"@prisma/client";var C=new Tn({log:["warn","error"]});var Sr=class{constructor(e){this.prisma=e}async register({userId:e,title:r,description:t,certificationUrl:i}){await this.prisma.certification.create({data:{title:r,description:t,certificationUrl:i,user:{connect:{id:e}}}})}async find({pagination:{limit:e,offset:r},filter:{description:t,orderBy:i,title:s,userId:n}}){let p={userId:n},d=[];return s&&d.push({title:{contains:s,mode:"insensitive"}}),t&&d.push({description:{contains:t,mode:"insensitive"}}),d.length>0&&(p.OR=d),await this.prisma.certification.findMany({where:p,include:{user:{omit:{passwordHash:!0}}},skip:r,take:e,orderBy:{updatedAt:i}})}async findById(e){return await this.prisma.certification.findFirst({where:{id:e}})}async findByUserId({pagination:{limit:e,offset:r},filter:{description:t,orderBy:i,title:s},userId:n}){let p={userId:n},d=[];return s&&d.push({title:{contains:s,mode:"insensitive"}}),t&&d.push({description:{contains:t,mode:"insensitive"}}),d.length>0&&(p.OR=d),await this.prisma.certification.findMany({where:p,include:{user:{omit:{passwordHash:!0}}},skip:r,take:e,orderBy:{updatedAt:i}})}async update({id:e,...r}){await this.prisma.certification.update({where:{id:e},data:r})}async deleteById(e){await this.prisma.certification.delete({where:{id:e}})}async count({filter:{description:e,title:r,userId:t}}){let i={};r&&(i.title={contains:r,mode:"insensitive"});let s=[];return e&&s.push({description:{contains:e,mode:"insensitive"}}),t&&s.push({userId:t}),s.length>0&&(i.OR=s),await this.prisma.certification.count({where:i})}};function te(){return new Sr(C)}var jr=class{constructor(e){this.prisma=e}async create({authorId:e,...r}){return await this.prisma.news.create({data:{...r,author:{connect:{id:e}}}})}async find({pagination:{offset:e,limit:r},filter:{authorId:t,content:i,title:s,orderBy:n}}){let p={};t&&(p.authorId={contains:t,mode:"insensitive"});let d=[];return s&&d.push({title:{contains:s,mode:"insensitive"}}),i&&d.push({content:{contains:i,mode:"insensitive"}}),d.length>0&&(p.OR=d),await this.prisma.news.findMany({where:p,omit:{authorId:!0},include:{author:!0},orderBy:{updatedAt:n},skip:e,take:r})}async findById(e){return await this.prisma.news.findUnique({where:{id:e},omit:{authorId:!0},include:{author:!0}})}async findByAuthorId({authorId:e,pagination:{offset:r,limit:t},filter:{orderBy:i="desc",content:s,title:n}}){let p={authorId:e},d=[];return n&&d.push({title:{contains:n,mode:"insensitive"}}),s&&d.push({content:{contains:s,mode:"insensitive"}}),d.length>0&&(p.OR=d),await this.prisma.news.findMany({omit:{authorId:!0},where:p,orderBy:{updatedAt:i},skip:r,take:t})}async update(e){return await this.prisma.news.update({where:{id:e.id},data:{title:e.title,content:e.content,imageUrl:e.imageUrl}})}async delete(e){await this.prisma.news.delete({where:{id:e}})}async count({filter:{authorId:e,content:r,title:t}}){let i={};e&&(i.authorId={contains:e,mode:"insensitive"});let s=[];return t&&s.push({title:{contains:t,mode:"insensitive"}}),r&&s.push({content:{contains:r,mode:"insensitive"}}),s.length>0&&(i.OR=s),await this.prisma.news.count({where:i})}};function V(){return new jr(C)}var xr=class{constructor(e){this.prisma=e}async create(e){await this.prisma.pendency.create({data:e})}async find({filter:{description:e,orderBy:r,title:t,status:i,userId:s},pagination:{limit:n,offset:p}}){let d={userId:s,AND:{status:{equals:i}}};e&&(d.description={contains:e,mode:"insensitive"});let y=[];return t&&y.push({title:{contains:t,mode:"insensitive"}}),y.length>0&&(d.OR=y),await this.prisma.pendency.findMany({where:d,orderBy:{updatedAt:r},include:{user:{omit:{passwordHash:!0}}},skip:p,take:n})}async findById(e){return await this.prisma.pendency.findFirst({where:{id:e},include:{user:{omit:{passwordHash:!0}}}})}async findByUserId({filter:{description:e,orderBy:r,title:t,status:i},pagination:{limit:s,offset:n},userId:p}){let d={userId:p,AND:{status:{equals:i}}},y=[];return e&&y.push({description:{contains:e,mode:"insensitive"}}),t&&y.push({title:{contains:t,mode:"insensitive"}}),y.length>0&&(d.OR=y),await this.prisma.pendency.findMany({where:d,orderBy:{updatedAt:r},skip:n,take:s})}async update({id:e,...r}){await this.prisma.pendency.update({where:{id:e},data:r})}async deleteById(e){await this.prisma.pendency.delete({where:{id:e}})}async count({filter:{description:e,title:r,status:t,userId:i}}){let s={userId:i},n=[];return e&&n.push({description:{contains:e,mode:"insensitive"}}),r&&n.push({title:{contains:r,mode:"insensitive"}}),t&&n.push({status:{equals:t}}),n.length>0&&(s.OR=n),await this.prisma.pendency.count({where:s})}};function oe(){return new xr(C)}var Ar=class{constructor(e){this.prisma=e}async create(e){await this.prisma.user.create({data:e})}async update(e){await this.prisma.user.update({where:{id:e.id},data:e})}async deleteById(e){await this.prisma.user.delete({where:{id:e}})}async find(){return await this.prisma.user.findMany({omit:{passwordHash:!0}})}async findByEmail(e){return await this.prisma.user.findFirst({where:{emailAddress:e}})}async findById(e){return await this.prisma.user.findFirst({where:{id:e},omit:{passwordHash:!0}})}};function P(){return new Ar(C)}import{compare as Un,hash as Pn}from"bcryptjs";var Tr=class{constructor(e,r){this.hashFn=e;this.compareFn=r}async hash(e){return await this.hashFn(e,6)}async compare({password:e,hashedPassword:r}){return await this.compareFn(e,r)}};function Dt(){return new Tr(Pn,Un)}import Qo from"jsonwebtoken";import q from"zod";var Fn=q.object({JWT_SECRET:q.string(),FIREBASE_BUCKET:q.string(),FIREBASE_CLIENT_EMAIL:q.string(),FIREBASE_PRIVATE_KEY:q.string(),FIREBASE_PROJECT_ID:q.string(),FIREBASE_TYPE:q.string(),FIREBASE_PRIVATE_KEY_ID:q.string(),FIREBASE_CLIENT_ID:q.string(),FIREBASE_AUTH_URI:q.string(),FIREBASE_TOKEN_URI:q.string(),FIREBASE_AUTH_PROVIDER_X509_CERT_URL:q.string(),FIREBASE_CLIENT_X509_CERT_URL:q.string()}),T=Fn.parse(process.env);var Ur=class{constructor(e,r){this.signFn=e;this.verifyFn=r}sign(e){try{return this.signFn(e,T.JWT_SECRET,{expiresIn:"3d",subject:e.id})}catch{return null}}verify(e){try{return this.verifyFn(e,T.JWT_SECRET)}catch{return null}}};function Pr(){return new Ur(Qo.sign,Qo.verify)}function ei(){return{signUpController:new De(P(),Dt())}}function ri(){return{signInController:new Be(P(),Dt(),Pr())}}function ti(){return{findAuthenticatedUserController:new Cr(P())}}function oi(){return{findAuthenticatedUserController:new Me(V())}}function ii(){return{findAuthenticatedUserCertificationsController:new Fe(te())}}function si(){return{findAuthenticatedUserPendenciesController:new Ne(oe())}}var Fr=class{constructor(e){this.jwtService=e}authenticated(e,r,t){let i=e.headers.authorization;if(!i?.startsWith("Bearer "))return r.status(401).json({message:"Token inv\xE1lido.",invalid:!0});let s=i.split(" ")[1];if(!s)return r.status(401).json({message:"Token n\xE3o fornecido."});try{let n=this.jwtService.verify(s);if(!n)return r.status(401).json({message:"Token inv\xE1lido.",invalid:!0});e.user=n,t()}catch(n){if(console.log(n),n instanceof Error)return r.status(401).json({message:n.message})}}isAdmin(e,r,t){let i=e.headers.authorization;if(!i?.startsWith("Bearer "))return r.status(401).json({message:"Token inv\xE1lido.",invalid:!0});let s=i.split(" ")[1];if(!s)return r.status(401).json({message:"Token n\xE3o fornecido."});try{let n=this.jwtService.verify(s);if(!n)return r.status(401).json({message:"Token inv\xE1lido.",invalid:!0});if(n.role!=="ADMIN")return r.status(401).json({message:"\xC9 necess\xE1rio ter permiss\xF5es de administrador."});t()}catch(n){if(console.log(n),n instanceof Error)return r.status(401).json({message:n.message})}}};function x(){return{authMiddleware:new Fr(Pr())}}var K=Mn(),{authMiddleware:xe}=x();K.post("/sign-up",async(o,e)=>{let{signUpController:r}=ei();await r.handle(o,e)});K.post("/sign-in",async(o,e)=>{let{signInController:r}=ri();await r.handle(o,e)});K.get("/user",(o,e,r)=>{xe.authenticated(o,e,r)},async(o,e)=>{let{findAuthenticatedUserController:r}=ti();await r.handle(o,e)});K.get("/user/news",(o,e,r)=>{xe.authenticated(o,e,r)},async(o,e)=>{let{findAuthenticatedUserController:r}=oi();await r.handle(o,e)});K.get("/admin",(o,e,r)=>{xe.isAdmin(o,e,r)},(o,e)=>{try{e.status(200).json({success:!0})}catch(r){r instanceof Error&&e.status(500).json({message:r.message})}});K.get("/certifications",(o,e,r)=>{xe.authenticated(o,e,r)},async(o,e)=>{let{findAuthenticatedUserCertificationsController:r}=ii();await r.handle(o,e)});K.get("/pendencies",(o,e,r)=>{xe.authenticated(o,e,r)},async(o,e)=>{let{findAuthenticatedUserPendenciesController:r}=si();await r.handle(o,e)});import{Router as kn}from"express";import{getStorage as qn}from"firebase-admin/storage";import{config as Nn}from"dotenv";import ni from"firebase-admin";Nn();var kt=ni.initializeApp({credential:ni.credential.cert({clientEmail:T.FIREBASE_CLIENT_EMAIL,privateKey:T.FIREBASE_PRIVATE_KEY,projectId:T.FIREBASE_PROJECT_ID,type:T.FIREBASE_TYPE,privateKeyId:T.FIREBASE_PRIVATE_KEY_ID,clientId:T.FIREBASE_CLIENT_ID,authUri:T.FIREBASE_AUTH_URI,tokenUri:T.FIREBASE_TOKEN_URI,authProviderX509CertUrl:T.FIREBASE_AUTH_PROVIDER_X509_CERT_URL,clientX509CertUrl:T.FIREBASE_CLIENT_X509_CERT_URL}),storageBucket:T.FIREBASE_BUCKET});kt.name?console.log("\u{1F525} Firebase conectado com sucesso!"):console.error("\u274C Erro ao se conectar ao Firebase.");var Bn=qn(kt),ai=Bn.bucket(T.FIREBASE_BUCKET);import{randomUUID as On}from"node:crypto";var Dn=/https:\/\/storage\.googleapis\.com\/[^/]+\/(.+)$/,Mr=class{constructor(e){this.bucket=e}async uploadFile({file:e,folder:r,id:t}){let i=`${On()}-${e?.originalname}`,s=this.bucket.file(`${r}/${t}/${i}`);return await new Promise((n,p)=>{let d=s.createWriteStream({metadata:{contentType:e?.mimetype}});d.on("error",y=>{p(y)}),d.on("finish",async()=>{try{await s.makePublic();let y=`https://storage.googleapis.com/${this.bucket.name}/${s.name}`;n(y)}catch(y){p(y)}}),d.end(e.buffer)})}async updateFile({file:e,id:r,fileUrl:t,folder:i}){try{let s=this.getPath(t);if(!s)throw new Error("Arquivo n\xE3o encontrado.");let[n,p]=await Promise.all([this.bucket.file(s).delete(),this.uploadFile({file:e,id:r,folder:i})]);return p}catch{throw new Error("Erro ao atualizar o arquivo.")}}async deleteFile({fileUrl:e}){let r=this.getPath(e);if(!r)throw new Error("Arquivo n\xE3o encontrado.");try{await this.bucket.file(r).delete()}catch{throw new Error("Erro ao deletar o arquivo.")}}getPath(e){let r=e.match(Dn);return r?r[1]:null}};function A(){return new Mr(ai)}function mi(){return{registerCertificationController:new ze(P(),te(),A())}}function ci(){return{findCertificationsController:new We(te())}}function pi(){return{findCertificationByIdController:new _e(te())}}function di(){return{updateCertificationController:new Le(te(),A())}}function ui(){return{deleteCertificationController:new ke(te(),A())}}import li from"multer";var M=li({storage:li.memoryStorage()});var de=kn(),{authMiddleware:Ae}=x();de.post("/:user_id",(o,e,r)=>{Ae.isAdmin(o,e,r)},M.single("certification"),async(o,e)=>{let{registerCertificationController:r}=mi();await r.handle(o,e)});de.get("/",(o,e,r)=>{Ae.isAdmin(o,e,r)},async(o,e)=>{let{findCertificationsController:r}=ci();await r.handle(o,e)});de.get("/:certification_id",(o,e,r)=>{Ae.isAdmin(o,e,r)},async(o,e)=>{let{findCertificationByIdController:r}=pi();await r.handle(o,e)});de.put("/:certification_id",(o,e,r)=>{Ae.isAdmin(o,e,r)},M.single("certification"),async(o,e)=>{let{updateCertificationController:r}=di();await r.handle(o,e)});de.delete("/:certification_id",(o,e,r)=>{Ae.isAdmin(o,e,r)},async(o,e)=>{let{deleteCertificationController:r}=ui();await r.handle(o,e)});import{Router as Zn}from"express";import{extendZodWithOpenApi as _n}from"@asteasolutions/zod-to-openapi";import{InMemoriamRole as Wn}from"@prisma/client";import ie from"zod";var zn=1,Hn=9;_n(ie);var Ln=ie.object({page:ie.coerce.number().min(1).default(zn),limit:ie.coerce.number().min(1).default(Hn),name:ie.string().optional(),biography:ie.string().optional(),role:ie.enum(Wn).optional(),orderBy:ie.enum(["asc","desc"]).optional()}),Nr=class{constructor(e){this.inMemoriamRepository=e}async handle(e,r){try{let{page:t,limit:i,...s}=Ln.parse(e.query),n=i*t-i,[p,d]=await Promise.all([this.inMemoriamRepository.find({pagination:{offset:n,limit:i},filter:s}),this.inMemoriamRepository.count({filter:s})]),y=Math.max(Math.ceil(d/i),1);r.status(200).json({page:t,totalPages:y,offset:n,limit:i,inMemoriam:p})}catch(t){if(t instanceof Error)throw new m(t.message)}}};var qr=class{constructor(e){this.prisma=e}async create(e){return await this.prisma.inMemoriam.create({data:e})}async update(e){return await this.prisma.inMemoriam.update({where:{id:e.id},data:e})}async deleteById(e){await this.prisma.inMemoriam.delete({where:{id:e}})}async find({pagination:{offset:e,limit:r},filter:{name:t,biography:i,role:s,orderBy:n}}){let p={};return t&&(p.name={contains:t,mode:"insensitive"}),i&&(p.biography={contains:i,mode:"insensitive"}),s&&(p.role=s),await this.prisma.inMemoriam.findMany({where:p,orderBy:n?{updatedAt:n}:{updatedAt:"desc"},skip:e,take:r})}async findById(e){return await this.prisma.inMemoriam.findFirst({where:{id:e}})}async count({filter:{name:e,biography:r,role:t}}){let i={};return e&&(i.name={contains:e,mode:"insensitive"}),r&&(i.biography={contains:r,mode:"insensitive"}),t&&(i.role=t),await this.prisma.inMemoriam.count({where:i})}};function we(){return new qr(C)}function fi(){return{createInMemoriamController:new Ve(we(),A())}}function yi(){return{findInMemoriamsController:new Nr(we())}}function hi(){return{findInMemoriamByIdController:new Ge(we())}}function gi(){return{updateInMemoriamController:new Je(we(),A())}}function Ri(){return{deleteInMemoriamController:new Ke(we(),A())}}var ue=Zn(),{authMiddleware:_t}=x();ue.post("/",(o,e,r)=>{_t.authenticated(o,e,r)},M.single("photo"),async(o,e)=>{let{createInMemoriamController:r}=fi();await r.handle(o,e)});ue.get("/",async(o,e)=>{let{findInMemoriamsController:r}=yi();await r.handle(o,e)});ue.get("/:id",async(o,e)=>{let{findInMemoriamByIdController:r}=hi();await r.handle(o,e)});ue.put("/:id",(o,e,r)=>{_t.authenticated(o,e,r)},M.single("photo"),async(o,e)=>{let{updateInMemoriamController:r}=gi();await r.handle(o,e)});ue.delete("/:id",(o,e,r)=>{_t.authenticated(o,e,r)},async(o,e)=>{let{deleteInMemoriamController:r}=Ri();await r.handle(o,e)});import{Router as Vn}from"express";var Wt=Vn();Wt.get("/",(o,e)=>{e.status(200).json({message:"Rede CT"})});import{Router as ea}from"express";import{extendZodWithOpenApi as Kn}from"@asteasolutions/zod-to-openapi";import zt from"zod";Kn(zt);var Gn=zt.object({id:zt.string()}),Br=class{constructor(e,r){this.newsRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t}=Gn.parse(e.params),i=e.user.id,s=await this.newsRepository.findById(t);if(!s)throw new b("Not\xEDcia n\xE3o encontrada.");if(s.author.id!==i)throw new B("Sem permiss\xE3o.");await Promise.all([this.newsRepository.delete(t),this.firebaseStorageService.deleteFile({fileUrl:s.imageUrl})]),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Yn}from"@asteasolutions/zod-to-openapi";import be from"zod";var Jn=5,Ii=1024,$n=Ii*Ii,Xn=Jn*$n;Yn(be);var Qn=be.object({id:be.string(),title:be.string().min(1),content:be.string().min(1),image:be.any().optional().refine(o=>!o||typeof o=="object"&&typeof o.mimetype=="string"&&o.mimetype.startsWith("image/")&&typeof o.size=="number"&&o.size<=Xn,"A imagem deve ser uma imagem v\xE1lida de no m\xE1ximo 5MB.")}),Or=class{constructor(e,r){this.newsRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t,title:i,content:s,image:n}=Qn.parse({id:e.params.id,image:e.file,...e.body}),p=await this.newsRepository.findById(t);if(!p)throw new b("Not\xEDcia n\xE3o encontrada.");let d=e.user.id;if(p.author.id!==d)throw new B("Sem permiss\xE3o.");let y=p.imageUrl||"";n&&p.imageUrl&&(y=await this.firebaseStorageService.updateFile({file:n,folder:j.NEWS,id:t,fileUrl:p.imageUrl}));let v=await this.newsRepository.update({id:t,title:i,content:s,imageUrl:y});r.status(200).json(v)}catch(t){if(t instanceof Error)throw new m(t.message)}}};function wi(){return{createNewsController:new $e(V(),A())}}function bi(){return{findAllNewsController:new rr(V())}}function vi(){return{findNewsByIdController:new er(V())}}function Ei(){return{findNewsByAuthorIdController:new Xe(V())}}function Ci(){return{updateNewsController:new Or(V(),A())}}function Si(){return{deleteNewsController:new Br(V(),A())}}var se=ea(),{authMiddleware:Ht}=x();se.post("/",(o,e,r)=>{Ht.authenticated(o,e,r)},M.single("image"),async(o,e)=>{let{createNewsController:r}=wi();await r.handle(o,e)});se.get("/",async(o,e)=>{let{findAllNewsController:r}=bi();await r.handle(o,e)});se.get("/:id",async(o,e)=>{let{findNewsByIdController:r}=vi();await r.handle(o,e)});se.get("/author/:authorId",async(o,e)=>{let{findNewsByAuthorIdController:r}=Ei();await r.handle(o,e)});se.put("/:id",(o,e,r)=>{Ht.authenticated(o,e,r)},M.single("image"),async(o,e)=>{let{updateNewsController:r}=Ci();await r.handle(o,e)});se.delete("/:id",(o,e,r)=>{Ht.authenticated(o,e,r)},async(o,e)=>{let{deleteNewsController:r}=Si();await r.handle(o,e)});import{Router as ra}from"express";function ji(){return{createPendencyController:new tr(P(),oe(),A())}}function xi(){return{findPendenciesController:new sr(oe())}}function Ai(){return{findPendencyByIdController:new nr(oe())}}function Ti(){return{updatePendencyController:new ar(oe(),A())}}function Ui(){return{deletePendencyController:new ir(oe(),A())}}var le=ra(),{authMiddleware:Te}=x();le.post("/:user_id",(o,e,r)=>{Te.isAdmin(o,e,r)},M.single("document"),async(o,e)=>{let{createPendencyController:r}=ji();await r.handle(o,e)});le.get("/",(o,e,r)=>{Te.isAdmin(o,e,r)},async(o,e)=>{let{findPendenciesController:r}=xi();await r.handle(o,e)});le.get("/:pendency_id",(o,e,r)=>{Te.isAdmin(o,e,r)},async(o,e)=>{let{findPendencyByIdController:r}=Ai();await r.handle(o,e)});le.put("/:pendency_id",(o,e,r)=>{Te.isAdmin(o,e,r)},M.single("document"),async(o,e)=>{let{updatePendencyController:r}=Ti();await r.handle(o,e)});le.delete("/:pendency_id",(o,e,r)=>{Te.isAdmin(o,e,r)},async(o,e)=>{let{deletePendencyController:r}=Ui();await r.handle(o,e)});import{Router as na}from"express";import{extendZodWithOpenApi as ta}from"@asteasolutions/zod-to-openapi";import N from"zod";var oa=1,ia=9;ta(N);var sa=N.object({page:N.coerce.number().min(1).default(oa),limit:N.coerce.number().min(1).default(ia),userId:N.string().optional(),registrationNumber:N.string().optional(),name:N.string().optional(),emailAddress:N.string().optional(),mainEtps:N.string().optional(),formations:N.string().optional(),occupations:N.string().optional(),institutions:N.string().optional(),biography:N.string().optional(),orderBy:N.enum(["asc","desc"]).optional()}),Dr=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{page:t,limit:i,...s}=sa.parse(e.query),n=i*t-i,[p,d]=await Promise.all([this.researcherRepository.find({pagination:{offset:n,limit:i},filter:{userName:s.name,...s}}),this.researcherRepository.count({filter:{userName:s.name,...s}})]),y=Math.max(Math.ceil(d/i),1);r.status(200).json({page:t,totalPages:y,offset:n,limit:i,researchers:p})}catch(t){if(t instanceof Error)throw new m(t.message)}}};var kr=class{constructor(e){this.prisma=e}async create(e){return await this.prisma.researcher.create({data:e})}async update(e){return await this.prisma.researcher.update({where:{id:e.id},data:e})}async deleteById(e){await this.prisma.researcher.delete({where:{id:e}})}async find({pagination:{offset:e,limit:r},filter:{biography:t,degrees:i,formations:s,institutions:n,mainEtps:p,occupations:d,orderBy:y,registrationNumber:v,seniority:E,userId:S,userName:_}}){let W={OR:_?[{user:{name:{contains:_,mode:"insensitive"}}}]:void 0};return v&&W.OR?.push({registrationNumber:{contains:v,mode:"insensitive"}}),p&&(W.mainEtps={contains:p,mode:"insensitive"}),s&&(W.formations={contains:s,mode:"insensitive"}),i&&i.length>0&&(W.degrees={hasSome:i}),d&&(W.occupations={contains:d,mode:"insensitive"}),E&&(W.seniority=E),n&&(W.institutions={contains:n,mode:"insensitive"}),t&&(W.biography={contains:t,mode:"insensitive"}),S&&(W.userId={equals:S}),await this.prisma.researcher.findMany({where:W,omit:{userId:!0},include:{user:{omit:{passwordHash:!0}}},orderBy:y?{updatedAt:y}:{updatedAt:"desc"},skip:e,take:r})}async findById(e){return await this.prisma.researcher.findFirst({where:{id:e},include:{user:{omit:{passwordHash:!0}}}})}async findByUserId(e){return await this.prisma.researcher.findFirst({where:{userId:e},include:{user:{omit:{passwordHash:!0}}}})}async findByRegistrationNumber(e){return await this.prisma.researcher.findFirst({where:{registrationNumber:e},include:{user:{omit:{passwordHash:!0}}}})}async count({filter:{biography:e,degrees:r,formations:t,institutions:i,mainEtps:s,occupations:n,registrationNumber:p,seniority:d,userId:y,userName:v}}){let E={OR:v?[{user:{name:{contains:v,mode:"insensitive"}}}]:void 0};return p&&E.OR?.push({registrationNumber:{contains:p,mode:"insensitive"}}),s&&(E.mainEtps={contains:s,mode:"insensitive"}),t&&(E.formations={contains:t,mode:"insensitive"}),r&&r.length>0&&(E.degrees={hasSome:r}),n&&(E.occupations={contains:n,mode:"insensitive"}),d&&(E.seniority=d),i&&(E.institutions={contains:i,mode:"insensitive"}),e&&(E.biography={contains:e,mode:"insensitive"}),y&&(E.userId={equals:y}),await this.prisma.researcher.count({where:E})}};function fe(){return new kr(C)}function Pi(){return{createResearcherController:new cr(fe())}}function Fi(){return{findResearchersController:new Dr(fe())}}function Mi(){return{findResearcherByIdController:new dr(fe())}}function Ni(){return{findResearcherByUserIdController:new lr(fe())}}function qi(){return{updateResearcherController:new fr(fe())}}function Bi(){return{deleteResearcherController:new pr(fe())}}var ne=na(),{authMiddleware:Lt}=x();ne.post("/",(o,e,r)=>{Lt.authenticated(o,e,r)},async(o,e)=>{let{createResearcherController:r}=Pi();await r.handle(o,e)});ne.get("/",async(o,e)=>{let{findResearchersController:r}=Fi();await r.handle(o,e)});ne.get("/:id",async(o,e)=>{let{findResearcherByIdController:r}=Mi();await r.handle(o,e)});ne.get("/user/:userId",async(o,e)=>{let{findResearcherByUserIdController:r}=Ni();await r.handle(o,e)});ne.put("/:id",(o,e,r)=>{Lt.authenticated(o,e,r)},async(o,e)=>{let{updateResearcherController:r}=qi();await r.handle(o,e)});ne.delete("/:id",(o,e,r)=>{Lt.authenticated(o,e,r)},async(o,e)=>{let{deleteResearcherController:r}=Bi();await r.handle(o,e)});import{Router as ya}from"express";import{extendZodWithOpenApi as aa}from"@asteasolutions/zod-to-openapi";import ye from"zod";aa(ye);var ma=ye.object({teamId:ye.uuid(),member:ye.object({userId:ye.uuid(),role:ye.string(),description:ye.string()})}),_r=class{constructor(e,r){this.teamMemberRepository=e;this.userRepository=r}async handle(e,r){try{let{teamId:t,member:{userId:i,...s}}=ma.parse({...e.body,teamId:e.params.teamId});if(!await this.userRepository.findById(i))throw new b("O usu\xE1rio n\xE3o existe.");let p=await this.teamMemberRepository.create({...s,userId:i,teamId:t});r.status(201).json(p)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as ca}from"@asteasolutions/zod-to-openapi";import{z as Zt}from"zod";ca(Zt);var pa=Zt.object({id:Zt.uuid()}),Wr=class{constructor(e){this.teamMemberRepository=e}async handle(e,r){try{let{id:t}=pa.parse(e.params);await this.teamMemberRepository.delete(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as da}from"@asteasolutions/zod-to-openapi";import{z as Vt}from"zod";da(Vt);var ua=Vt.object({id:Vt.uuid()}),zr=class{constructor(e){this.teamMemberRepository=e}async handle(e,r){try{let{id:t}=ua.parse(e.params),i=await this.teamMemberRepository.findById(t);if(!i)throw new b("Membro n\xE3o encontrado.");r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as la}from"@asteasolutions/zod-to-openapi";import{z as ve}from"zod";la(ve);var fa=ve.object({id:ve.uuid(),role:ve.string(),userId:ve.string(),description:ve.string()}),Hr=class{constructor(e){this.teamMemberRepository=e}async handle(e,r){try{let t=fa.parse(e.body),i=await this.teamMemberRepository.update(t);r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var G=class{constructor(e){this.prisma=e}async findById(e){return await this.prisma.teamMember.findFirst({where:{id:e}})}async findByTeamId(e){return await this.prisma.teamMember.findMany({where:{teamId:e}})}async create({description:e,role:r,teamId:t,userId:i}){return await this.prisma.teamMember.create({data:{role:r,description:e,teamId:t,userId:i}})}async update({id:e,...r}){return await this.prisma.teamMember.update({where:{id:e},data:r})}async updateMany({members:e,teamId:r}){await Promise.all(e.map(async({user:t,role:i})=>{let s=await this.prisma.teamMember.findFirst({where:{teamId:r,userId:t.id},include:{user:!0}});s?await this.prisma.teamMember.update({where:{id:s.id},data:{role:i}}):await this.prisma.teamMember.create({data:{teamId:r,userId:t.id,role:i}})}))}async delete(e){await this.prisma.teamMember.deleteMany({where:{id:e}})}async deleteMany(e){await Promise.all(e.map(async r=>{await this.prisma.teamMember.delete({where:{id:r}})}))}};function Oi(){return{createTeamMemberController:new _r(new G(C),P())}}function Di(){return{findTeamMemberController:new zr(new G(C))}}function ki(){return{updateTeamMemberController:new Hr(new G(C))}}function _i(){return{deleteTeamMemberController:new Wr(new G(C))}}var Ee=ya(),{authMiddleware:Lr}=x();Ee.post("/:teamId/member",(o,e,r)=>{Lr.isAdmin(o,e,r)},async(o,e)=>{let{createTeamMemberController:r}=Oi();await r.handle(o,e)});Ee.get("/member/:id",(o,e,r)=>{Lr.isAdmin(o,e,r)},async(o,e)=>{let{findTeamMemberController:r}=Di();await r.handle(o,e)});Ee.put("/member/:id",(o,e,r)=>{Lr.isAdmin(o,e,r)},async(o,e)=>{let{updateTeamMemberController:r}=ki();await r.handle(o,e)});Ee.delete("/member/:id",(o,e,r)=>{Lr.isAdmin(o,e,r)},async(o,e)=>{let{deleteTeamMemberController:r}=_i();await r.handle(o,e)});import{Router as Ra}from"express";import{extendZodWithOpenApi as ha}from"@asteasolutions/zod-to-openapi";import{z as Kt}from"zod";ha(Kt);var ga=Kt.object({id:Kt.uuid()}),Zr=class{constructor(e){this.teamRepository=e}async handle(e,r){try{let{id:t}=ga.parse(e.params);await this.teamRepository.delete(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Vr=class{constructor(e){this.teamRepository=e}async handle(e,r){try{let t=await this.teamRepository.findAll();return r.status(200).json(t)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Kr=class{constructor(e){this.prisma=e}async create({members:e,name:r,type:t}){return await this.prisma.team.create({data:{name:r,type:t,members:{create:e.map(({role:i,user:s})=>({role:i,user:{connect:{id:s.id}}}))}}})}async findAll(){return await this.prisma.team.findMany({include:{members:{include:{user:!0}}}})}async findById(e){return await this.prisma.team.findUnique({where:{id:e},include:{members:{include:{user:!0}}}})}async findByType({type:e,filter:{name:r}}){let t={type:e};return r&&(t.name={contains:r,mode:"insensitive"}),await this.prisma.team.findMany({where:t,include:{members:{include:{user:!0}}}})}async update({id:e,name:r}){return await this.prisma.team.update({where:{id:e},data:{name:r}})}async delete(e){await this.prisma.team.delete({where:{id:e}})}};function he(){return new Kr(C)}function Wi(){return new G(C)}function zi(){return{findTeamsController:new Vr(he())}}function Hi(){return{findTeamByIdController:new hr(he())}}function Li(){return{findTeamByTypeController:new Rr(he())}}function Zi(){return{createTeamController:new yr(he())}}function Vi(){return{updateTeamController:new Ir(he(),Wi())}}function Ki(){return{deleteTeamController:new Zr(he())}}var ae=Ra(),{authMiddleware:Gt}=x();ae.get("/",async(o,e)=>{let{findTeamsController:r}=zi();await r.handle(o,e)});ae.get("/id/:id",async(o,e)=>{let{findTeamByIdController:r}=Hi();await r.handle(o,e)});ae.get("/type/:type",async(o,e)=>{let{findTeamByTypeController:r}=Li();await r.handle(o,e)});ae.post("/",(o,e,r)=>{Gt.isAdmin(o,e,r)},async(o,e)=>{let{createTeamController:r}=Zi();await r.handle(o,e)});ae.put("/:id",(o,e,r)=>{Gt.isAdmin(o,e,r)},async(o,e)=>{let{updateTeamController:r}=Vi();await r.handle(o,e)});ae.delete("/:id",(o,e,r)=>{Gt.isAdmin(o,e,r)},async(o,e)=>{let{deleteTeamController:r}=Ki();await r.handle(o,e)});import{Router as Ia}from"express";var Gr=class{constructor(e){this.userRepository=e}async handle(e,r){try{let t=await this.userRepository.find();r.status(200).json(t)}catch(t){if(t instanceof Error)throw new m(t.message)}}};function Gi(){return{updateUserController:new Er(P(),A())}}function Yi(){return{deleteUserController:new wr(P())}}function Ji(){return{findUsersController:new Gr(P())}}function $i(){return{findUserController:new br(P())}}var Ce=Ia(),{authMiddleware:Xi}=x();Ce.get("/:id",async(o,e)=>{let{findUserController:r}=$i();await r.handle(o,e)});Ce.put("/",(o,e,r)=>{Xi.authenticated(o,e,r)},M.single("avatarImage"),async(o,e)=>{let{updateUserController:r}=Gi();await r.handle(o,e)});Ce.delete("/:id",(o,e,r)=>{Xi.authenticated(o,e,r)},async(o,e)=>{let{deleteUserController:r}=Yi();await r.handle(o,e)});Ce.get("/",async(o,e)=>{let{findUsersController:r}=Ji();await r.handle(o,e)});var U=Yt(),va={methods:["GET","POST","PUT","DELETE"],origin:["http://localhost:3000","https://rede-ct.vercel.app"],credentials:!0};U.use(ba(va));U.use(Yt.json());U.use(Yt.urlencoded({extended:!1}));U.use("/docs",wa({content:Xo,theme:"kepler"}));U.use("/",Wt);U.use("/auth",K);U.use("/user",Ce);U.use("/news",se);U.use("/team",ae);U.use("/team",Ee);U.use("/certification",de);U.use("/pendency",le);U.use("/researcher",ne);U.use("/in-memoriam",ue);U.use((o,e,r,t)=>{let{errorHandler:i}=Jt();i.handle(o,e,r,t)});var Ca=Ea.createServer(U),Qi=4e3;Ca.listen(Qi,()=>{console.log(`\u{1F680} Aplica\xE7\xE3o rodando na porta ${Qi}.`)});

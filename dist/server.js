import ud from"node:http";import{apiReference as cd}from"@scalar/express-api-reference";import pd from"cors";import Bi from"express";import Ka from"zod";var N=class extends Error{};var O=class extends Error{};var m=class extends Error{};var f=class extends Error{};var _=class extends Error{};import{ZodError as Va}from"zod";var et=class extends Va{};var tt=class{handle(e,r,t,i){return e instanceof et?t.status(400).json({message:"Validation error",error:Ka.treeifyError(e)}):e instanceof N?t.status(400).json({message:e.message}):e instanceof f?t.status(404).json({message:e.message}):e instanceof _?t.status(401).json({message:e.message}):e instanceof O?t.status(409).json({message:e.message}):e instanceof m?t.status(500).json({message:e.message}):t.status(500).json({message:"Internal server error"})}};function Ni(){return{errorHandler:new tt}}import{OpenAPIRegistry as fp,OpenApiGeneratorV3 as yp}from"@asteasolutions/zod-to-openapi";import{$Enums as ki}from"@prisma/client";import p from"zod";import{extendZodWithOpenApi as Ga}from"@asteasolutions/zod-to-openapi";import be from"zod";var Ya=1,$a=6;Ga(be);var Jr=be.object({page:be.coerce.number().min(1).default(Ya),limit:be.coerce.number().min(1).default($a),title:be.string().optional(),description:be.string().optional(),orderBy:be.enum(["asc","desc"]).default("desc")}),rt=class{constructor(e){this.certificationRepository=e}async handle(e,r){try{let{title:t,description:i,limit:s,orderBy:n,page:a}=Jr.parse(e.query),c=a*s-s,l=e.user.id,[T,x]=await Promise.all([this.certificationRepository.findByUserId({userId:l,pagination:{offset:c,limit:s},filter:{title:t,description:i,orderBy:n}}),this.certificationRepository.count({filter:{title:t,description:i,userId:l}})]),q=Math.max(Math.ceil(x/s),1);return r.status(200).json({page:a,totalPages:q,offset:c,limit:s,totalCertifications:x,certifications:T})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Xa}from"@asteasolutions/zod-to-openapi";import we from"zod";var Ja=1,Qa=7;Xa(we);var Qr=we.object({page:we.coerce.number().min(1).default(Ja),limit:we.coerce.number().min(1).default(Qa),title:we.string().optional(),content:we.string().optional(),orderBy:we.enum(["asc","desc"]).default("desc")}),ot=class{constructor(e){this.newsRepository=e}async handle(e,r){try{let{page:t,limit:i,content:s,orderBy:n,title:a}=Qr.parse(e.query),c=i*t-i,l=e.user.id,[T,x]=await Promise.all([this.newsRepository.findByAuthorId({authorId:l,pagination:{offset:c,limit:i},filter:{orderBy:n,title:a,content:s}}),this.newsRepository.count({filter:{authorId:l,content:s,title:a}})]),q=Math.ceil(x/i);r.status(200).json({page:t,totalPages:q,offset:c,limit:i,news:T})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as em}from"@asteasolutions/zod-to-openapi";import{PendencyStatus as tm}from"@prisma/client";import se from"zod";var rm=1,om=6;em(se);var eo=se.object({page:se.coerce.number().min(1).default(rm),limit:se.coerce.number().min(1).default(om),title:se.string().optional(),description:se.string().optional(),status:se.enum(tm).default("PENDING"),orderBy:se.enum(["asc","desc"]).default("desc")}),it=class{constructor(e){this.pendencyRepository=e}async handle(e,r){try{let{limit:t,page:i,...s}=eo.parse(e.query),n=i*t-t,a=e.user.id,[c,l]=await Promise.all([this.pendencyRepository.findByUserId({userId:a,pagination:{offset:n,limit:t},filter:s}),this.pendencyRepository.count({filter:{...s,userId:a}})]),T=Math.max(Math.ceil(l/t),1);return r.status(200).json({page:i,totalPages:T,offset:n,limit:t,pendencies:c})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as im}from"@asteasolutions/zod-to-openapi";import st from"zod";im(st);var to=st.object({password:st.string(),email:st.email()}),nt=class{constructor(e,r,t){this.userRepository=e;this.bcrypt=r;this.jwtService=t}async handle(e,r){try{let{email:t,password:i}=to.parse(e.body),s=await this.userRepository.findByEmail(t);if(!s)return r.status(401).json({message:"Usu\xE1rio n\xE3o existe."});if(!await this.bcrypt.compare({password:i,hashedPassword:s.passwordHash}))throw new _("Senha inv\xE1lida.");let{id:a,role:c}=s,l=this.jwtService.sign({id:a,role:c,email:t});return r.status(200).json({token:l})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as sm}from"@asteasolutions/zod-to-openapi";import Be from"zod";var at=8;sm(Be);var ro=Be.object({name:Be.string("Nome \xE9 obrigat\xF3rio.").min(1,"Nome \xE9 obrigat\xF3rio."),emailAddress:Be.email("E-mail inv\xE1lido.").min(1,"E-mail \xE9 obrigat\xF3rio."),password:Be.string("A senha \xE9 obrigat\xF3ria.").min(at,`A senha deve ter pelo menos ${at} caracteres.`),confirmPassword:Be.string("A senha \xE9 obrigat\xF3ria.").min(at,`A senha deve ter pelo menos ${at} caracteres.`)}).refine(o=>o.password===o.confirmPassword,{message:"As senhas n\xE3o coincidem.",path:["confirmPassword"]}),mt=class{constructor(e,r){this.userRepository=e;this.bcrypt=r}async handle(e,r){try{let{emailAddress:t,name:i,password:s}=ro.parse(e.body);if(await this.userRepository.findByEmail(t))throw new O("Usu\xE1rio j\xE1 existe.");let a=await this.bcrypt.hash(s);return await this.userRepository.create({name:i,emailAddress:t,passwordHash:a}),r.status(201).json()}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Hi={method:"post",path:"/auth/sign-up",tags:["Authentication"],summary:"Create a new user",request:{body:{content:{"application/json":{schema:ro}}}},responses:{201:{description:"User created successfully",summary:"User Registration Successful",content:{"application/json":{schema:p.object({message:p.string()})}}},400:{description:"Invalid input data provided",summary:"Validation Error",content:{"application/json":{schema:p.object({errors:p.record(p.string(),p.string())})}}},409:{description:"User already exists with this email",summary:"User Already Exists",content:{"application/json":{schema:p.object({message:p.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:p.object({message:p.string()})}}}}},Li={method:"post",path:"/auth/sign-in",tags:["Authentication"],summary:"Sign in",request:{body:{content:{"application/json":{schema:to}}}},responses:{200:{description:"Authentication successful, JWT token returned",summary:"Login Successful",content:{"application/json":{schema:p.object({token:p.string()})}}},400:{description:"Invalid credentials or input data",summary:"Validation Error",content:{"application/json":{schema:p.object({errors:p.record(p.string(),p.string())})}}},401:{description:"Invalid email or password",summary:"Authentication Failed",content:{"application/json":{schema:p.object({message:p.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:p.object({message:p.string()})}}}}},_i={method:"get",path:"/auth/user",tags:["Authentication"],summary:"Search for authenticated user",security:[{bearerAuth:[]}],responses:{200:{description:"Authenticated user information retrieved successfully",summary:"User Information Retrieved",content:{"application/json":{schema:p.object({name:p.string(),id:p.string(),avatarUrl:p.string().nullable(),createdAt:p.date(),updatedAt:p.date(),emailAddress:p.string(),orcid:p.string().nullable(),phone:p.string().nullable(),lattesUrl:p.string().nullable(),role:p.enum(ki.UserRole)}).nullable()}}},400:{description:"Invalid request parameters",summary:"Validation Error",content:{"application/json":{schema:p.object({errors:p.record(p.string(),p.string())})}}},404:{description:"User not found or not authenticated",summary:"User Not Found",content:{"application/json":{schema:p.object({message:p.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:p.object({message:p.string()})}}}}},zi={method:"get",path:"/auth/user/news",tags:["Authentication"],summary:"List authenticated user news",security:[{bearerAuth:[]}],request:{query:Qr},responses:{200:{description:"Paginated list of authenticated user news retrieved successfully",summary:"User News Retrieved",content:{"application/json":{schema:p.object({page:p.number(),totalPages:p.number(),offset:p.number(),limit:p.number(),news:p.object({content:p.string(),id:p.string(),title:p.string(),createdAt:p.date(),updatedAt:p.date(),imageUrl:p.string().nullable()})})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:p.object({errors:p.record(p.string(),p.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:p.object({message:p.string()})}}}}},Wi={method:"get",path:"/auth/admin",tags:["Authentication"],summary:"Verify admin access",security:[{bearerAuth:[]}],responses:{200:{description:"Admin access verified successfully",summary:"Admin Access Granted",content:{"application/json":{schema:p.object({success:p.boolean()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:p.object({message:p.string()})}}}}},Zi={method:"get",path:"/auth/certifications",tags:["Authentication"],summary:"List all authenticated user's certifications",security:[{bearerAuth:[]}],request:{query:Jr},responses:{200:{description:"Paginated list of authenticated user certifications retrieved successfully",summary:"User Certifications Retrieved",content:{"application/json":{schema:p.object({page:p.number(),totalPages:p.number(),offset:p.number(),limit:p.number(),certifications:p.object({description:p.string(),id:p.string(),title:p.string(),certificationUrl:p.string(),createdAt:p.date(),updatedAt:p.date(),userId:p.string()})})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:p.object({errors:p.record(p.string(),p.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:p.object({message:p.string()})}}}}},Vi={method:"get",path:"/auth/pendencies",tags:["Authentication"],summary:"List all authenticated user's pendencies",security:[{bearerAuth:[]}],request:{query:eo},responses:{200:{description:"Paginated list of authenticated user pendencies retrieved successfully",summary:"User Pendencies Retrieved",content:{"application/json":{schema:p.object({page:p.number(),totalPages:p.number(),offset:p.number(),limit:p.number(),pendencies:p.object({id:p.string(),title:p.string(),description:p.string(),status:p.enum(ki.PendencyStatus),createdAt:p.date(),updatedAt:p.date(),userId:p.string()})})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:p.object({errors:p.record(p.string(),p.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:p.object({message:p.string()})}}}}};import{$Enums as lm}from"@prisma/client";import y from"zod";import{extendZodWithOpenApi as nm}from"@asteasolutions/zod-to-openapi";import oo from"zod";nm(oo);var io=oo.object({id:oo.string()}),ct=class{constructor(e,r){this.certificationRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t}=io.parse({id:e.params.certification_id}),i=await this.certificationRepository.findById(t);if(!i)throw new f("A certifica\xE7\xE3o n\xE3o existe.");return await Promise.all([this.certificationRepository.deleteById(i.id),this.firebaseStorageService.deleteFile({fileUrl:i.certificationUrl})]),r.sendStatus(204)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as am}from"@asteasolutions/zod-to-openapi";import so from"zod";am(so);var no=so.object({certificationId:so.uuid()}),pt=class{constructor(e){this.certificationRepository=e}async handle(e,r){try{let{certificationId:t}=no.parse({certificationId:e.params.certification_id}),i=await this.certificationRepository.findById(t);if(!i)throw new f("Certificado n\xE3o encontrado.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as mm}from"@asteasolutions/zod-to-openapi";import ne from"zod";var cm=1,pm=6;mm(ne);var ao=ne.object({page:ne.coerce.number().min(1).default(cm),limit:ne.coerce.number().min(1).default(pm),title:ne.string().optional(),description:ne.string().optional(),userId:ne.uuid().optional(),orderBy:ne.enum(["asc","desc"]).default("desc")}),dt=class{constructor(e){this.certificationRepository=e}async handle(e,r){try{let{limit:t,page:i,...s}=ao.parse(e.query),n=i*t-t,[a,c]=await Promise.all([this.certificationRepository.find({pagination:{offset:n,limit:t},filter:s}),this.certificationRepository.count({filter:s})]),l=Math.max(Math.ceil(c/t),1);return r.status(200).json({page:i,totalPages:l,offset:n,limit:t,certifications:a})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as dm}from"@asteasolutions/zod-to-openapi";import Ne from"zod";var A={NEWS:"images/news",USER:"images/user",IN_MEMORIAM:"images/in-memoriam",PARTNER:"images/partners",CERTIFICATION:"documents/certifications",PENDENCY:"documents/pendencies",REGIMENT:"documents/regiments"};dm(Ne);var lt=Ne.object({userId:Ne.uuid(),title:Ne.string().min(1,"T\xEDtulo \xE9 obrigat\xF3rio."),description:Ne.string().min(1,"Descri\xE7\xE3o \xE9 obrigat\xF3ria."),certification:Ne.any().refine(o=>o&&typeof o=="object"&&o.size>0,"Arquivo do certificado \xE9 obrigat\xF3rio")}),ut=class{constructor(e,r,t){this.userRepository=e;this.certificationRepository=r;this.firebaseStorageService=t}async handle(e,r){try{let{userId:t,title:i,description:s,certification:n}=lt.parse({...e.body,userId:e.params.user_id,certification:e.file});if(!await this.userRepository.findById(t))throw new N("O usu\xE1rio n\xE3o existe.");let c=await this.firebaseStorageService.uploadFile({file:n,id:t,folder:A.CERTIFICATION});return await this.certificationRepository.register({userId:t,title:i,description:s,certificationUrl:c}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as um}from"@asteasolutions/zod-to-openapi";import ke from"zod";um(ke);var yt=ke.object({id:ke.uuid(),title:ke.string().min(1,"T\xEDtulo \xE9 obrigat\xF3rio."),description:ke.string().min(1,"Descri\xE7\xE3o \xE9 obrigat\xF3ria."),certification:ke.any().refine(o=>o==null||typeof o=="object"&&typeof o.size=="number"&&(o.size===0||o.size>0),"Arquivo do certificado \xE9 inv\xE1lido").optional()}),ft=class{constructor(e,r){this.certificationRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{certification:t,id:i,...s}=yt.parse({...e.body,id:e.params.certification_id,certification:e.file}),n=await this.certificationRepository.findById(i);if(!n)throw new N("A certifica\xE7\xE3o n\xE3o existe");let a=n.certificationUrl;return t&&t.size>0&&(a=await this.firebaseStorageService.updateFile({file:t,id:n.userId,folder:A.CERTIFICATION,fileUrl:n.certificationUrl})),await this.certificationRepository.update({...s,id:i,certificationUrl:a}),r.sendStatus(204)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Ki={method:"post",path:"/certifications/{user_id}",tags:["Certifications"],summary:"Register certification for user",security:[{bearerAuth:[]}],request:{params:lt.pick({userId:!0}).transform(()=>({user_id:""})),body:{content:{"multipart/form-data":{schema:lt.omit({userId:!0})}}}},responses:{201:{description:"Certification registered successfully for the user",summary:"Certification Registered",content:{"application/json":{schema:y.object({message:y.string()})}}},400:{description:"Invalid input data or file format",summary:"Validation Error",content:{"application/json":{schema:y.object({errors:y.record(y.string(),y.string())})}}},404:{description:"User not found with the provided ID",summary:"User Not Found",content:{"application/json":{schema:y.object({message:y.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:y.object({message:y.string()})}}}}},Gi={method:"get",path:"/certifications",tags:["Certifications"],summary:"List certifications",security:[{bearerAuth:[]}],request:{query:ao},responses:{200:{description:"Paginated list of certifications with user information retrieved successfully",summary:"Certifications Retrieved",content:{"application/json":{schema:y.object({page:y.number(),totalPages:y.number(),offset:y.number(),limit:y.number(),certifications:y.array(y.object({description:y.string(),userId:y.string(),title:y.string(),id:y.string(),createdAt:y.date(),updatedAt:y.date(),certificationUrl:y.url(),user:y.object({id:y.uuid(),name:y.string(),createdAt:y.date(),updatedAt:y.date(),avatarUrl:y.string().nullable(),emailAddress:y.email(),orcid:y.string().nullable(),phone:y.string().nullable(),lattesUrl:y.url().nullable(),role:y.enum(lm.UserRole)})}))})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:y.object({errors:y.record(y.string(),y.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:y.object({message:y.string()})}}}}},Yi={method:"get",path:"/certifications/{certification_id}",tags:["Certifications"],summary:"Find certification by ID",security:[{bearerAuth:[]}],request:{params:no},responses:{200:{description:"Certification details retrieved successfully",summary:"Certification Retrieved",content:{"application/json":{schema:y.object({description:y.string(),userId:y.string(),title:y.string(),id:y.string(),createdAt:y.date(),updatedAt:y.date(),certificationUrl:y.url()}).nullable()}}},400:{description:"Invalid certification ID format",summary:"Validation Error",content:{"application/json":{schema:y.object({errors:y.record(y.string(),y.string())})}}},404:{description:"Certification not found with the provided ID",summary:"Certification Not Found",content:{"application/json":{schema:y.object({message:y.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:y.object({message:y.string()})}}}}},$i={method:"put",path:"/certifications/{certification_id}",tags:["Certifications"],summary:"Update certification",security:[{bearerAuth:[]}],request:{params:yt.pick({id:!0}).transform(()=>({certification_id:""})),body:{content:{"multipart/form-data":{schema:yt.omit({id:!0})}}}},responses:{204:{description:"Certification updated successfully",summary:"Certification Updated"},400:{description:"Invalid input data or file format",summary:"Validation Error",content:{"application/json":{schema:y.object({errors:y.record(y.string(),y.string())})}}},404:{description:"Certification not found with the provided ID",summary:"Certification Not Found",content:{"application/json":{schema:y.object({message:y.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:y.object({message:y.string()})}}}}},Xi={method:"delete",path:"/certifications/{certification_id}",tags:["Certifications"],summary:"Delete certification",security:[{bearerAuth:[]}],request:{params:io},responses:{204:{description:"Certification deleted successfully",summary:"Certification Deleted"},400:{description:"Invalid certification ID format",summary:"Validation Error",content:{"application/json":{schema:y.object({errors:y.record(y.string(),y.string())})}}},404:{description:"Certification not found with the provided ID",summary:"Certification Not Found",content:{"application/json":{schema:y.object({message:y.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:y.object({message:y.string()})}}}}};import{$Enums as fo}from"@prisma/client";import u from"zod";import{extendZodWithOpenApi as fm}from"@asteasolutions/zod-to-openapi";import K from"zod";fm(K);var mo=K.object({code:K.string(),title:K.string(),description:K.string().optional(),notes:K.string().optional(),leaderId:K.uuid(),deputyLeaderId:K.uuid(),secretaryId:K.uuid(),memberIds:K.array(K.uuid())}),gt=class{constructor(e){this.etpRepository=e}async handle(e,r){try{let{code:t,title:i,description:s,notes:n,leaderId:a,deputyLeaderId:c,secretaryId:l,memberIds:T}=mo.parse(e.body);if(await this.etpRepository.findByCode(t))throw new O("J\xE1 existe um ETP cadastrado com este c\xF3digo.");return await this.etpRepository.create({code:t,title:i,description:s,notes:n,leaderId:a,deputyLeaderId:c,secretaryId:l,memberIds:T}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as ym}from"@asteasolutions/zod-to-openapi";import co from"zod";ym(co);var po=co.object({id:co.uuid()}),ht=class{constructor(e){this.etpRepository=e}async handle(e,r){try{let{id:t}=po.parse({id:e.params.id});if(!await this.etpRepository.findById(t))throw new f("O ETP n\xE3o existe.");return await this.etpRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as gm}from"@asteasolutions/zod-to-openapi";import uo from"zod";gm(uo);var It=uo.object({id:uo.uuid()}),Rt=class{constructor(e){this.etpRepository=e}async handle(e,r){try{let{id:t}=It.parse({id:e.params.id}),i=await this.etpRepository.findById(t);if(!i)throw new f("O ETP n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as hm}from"@asteasolutions/zod-to-openapi";import z from"zod";hm(z);var lo=z.object({id:z.uuid(),code:z.string().optional(),title:z.string().optional(),description:z.string().optional(),notes:z.string().optional(),leaderId:z.uuid().optional(),deputyLeaderId:z.uuid().optional(),secretaryId:z.uuid().optional(),memberIds:z.array(z.uuid()).optional()}),bt=class{constructor(e){this.etpRepository=e}async handle(e,r){try{let{id:t,code:i,title:s,description:n,notes:a,leaderId:c,deputyLeaderId:l,secretaryId:T,memberIds:x}=lo.parse({id:e.params.id,...e.body});if(!await this.etpRepository.findById(t))throw new f("O ETP n\xE3o existe.");if(i){let V=await this.etpRepository.findByCode(i);if(V&&V.id!==t)throw new O("J\xE1 existe um ETP com este c\xF3digo.")}return await this.etpRepository.update({id:t,code:i,title:s,description:n,notes:a,leaderId:c,deputyLeaderId:l,secretaryId:T,memberIds:x}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Rm=1,Im=9,wt=u.object({id:u.uuid(),registrationNumber:u.string(),mainEtps:u.string().nullable(),formations:u.string().nullable(),degrees:u.array(u.enum(fo.Degree)),occupations:u.string(),seniority:u.enum(fo.Seniority),institutions:u.string(),biography:u.string().nullable(),createdAt:u.date(),updatedAt:u.date(),user:u.object({id:u.uuid(),name:u.string(),emailAddress:u.string(),avatarUrl:u.string().nullable(),orcid:u.string().nullable(),phone:u.string().nullable(),lattesUrl:u.string().nullable(),role:u.enum(fo.UserRole)})}),Ji=u.object({id:u.uuid(),code:u.string(),title:u.string(),description:u.string().nullable(),notes:u.string().nullable(),createdAt:u.date(),updatedAt:u.date(),leader:u.object({id:u.uuid(),researcher:wt}).nullable(),deputyLeader:u.object({id:u.uuid(),researcher:wt}).nullable(),secretary:u.object({id:u.uuid(),researcher:wt}).nullable(),members:u.array(wt)}),Qi={method:"post",path:"/etp",tags:["ETPs"],summary:"Create a new ETP with single leader, deputy leader, secretary and multiple members",security:[{bearerAuth:[]}],request:{body:{content:{"application/json":{schema:mo}}}},responses:{201:{description:"ETP created successfully",summary:"ETP Created"},400:{description:"Invalid input data or missing required fields",summary:"Validation Error",content:{"application/json":{schema:u.object({errors:u.record(u.string(),u.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:u.object({message:u.string()})}}},409:{description:"ETP with this code already exists",summary:"Conflict",content:{"application/json":{schema:u.object({message:u.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:u.object({message:u.string()})}}}}},es={method:"get",path:"/etp",tags:["ETPs"],summary:"List all ETPs with pagination and filters",request:{query:u.object({page:u.coerce.number().min(1).default(Rm).optional(),limit:u.coerce.number().min(1).default(Im).optional(),code:u.string().optional(),title:u.string().optional(),description:u.string().optional(),notes:u.string().optional(),orderBy:u.enum(["asc","desc"]).optional()})},responses:{200:{description:"List of ETPs retrieved successfully with pagination",summary:"ETPs Retrieved",content:{"application/json":{schema:u.object({page:u.number(),totalPages:u.number(),offset:u.number(),limit:u.number(),etps:u.array(Ji)})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:u.object({message:u.string()})}}}}},ts={method:"get",path:"/etp/{id}",tags:["ETPs"],summary:"Find ETP by ID",request:{params:It},responses:{200:{description:"ETP details retrieved successfully",summary:"ETP Retrieved",content:{"application/json":{schema:Ji}}},400:{description:"Invalid ETP ID format",summary:"Validation Error",content:{"application/json":{schema:u.object({errors:u.record(u.string(),u.string())})}}},404:{description:"ETP not found with the provided ID",summary:"ETP Not Found",content:{"application/json":{schema:u.object({message:u.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:u.object({message:u.string()})}}}}},rs={method:"put",path:"/etp/{id}",tags:["ETPs"],summary:"Update ETP and manage user relationships (single leader, deputy leader, secretary, multiple members)",security:[{bearerAuth:[]}],request:{params:It,body:{content:{"application/json":{schema:lo.omit({id:!0})}}}},responses:{200:{description:"ETP updated successfully",summary:"ETP Updated"},400:{description:"Invalid input data or ETP ID format",summary:"Validation Error",content:{"application/json":{schema:u.object({errors:u.record(u.string(),u.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:u.object({message:u.string()})}}},404:{description:"ETP not found with the provided ID",summary:"ETP Not Found",content:{"application/json":{schema:u.object({message:u.string()})}}},409:{description:"ETP with this code already exists",summary:"Conflict",content:{"application/json":{schema:u.object({message:u.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:u.object({message:u.string()})}}}}},os={method:"delete",path:"/etp/{id}",tags:["ETPs"],summary:"Delete ETP",security:[{bearerAuth:[]}],request:{params:po},responses:{200:{description:"ETP deleted successfully",summary:"ETP Deleted"},400:{description:"Invalid ETP ID format",summary:"Validation Error",content:{"application/json":{schema:u.object({errors:u.record(u.string(),u.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:u.object({message:u.string()})}}},404:{description:"ETP not found with the provided ID",summary:"ETP Not Found",content:{"application/json":{schema:u.object({message:u.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:u.object({message:u.string()})}}}}};import{InMemoriamRole as Om}from"@prisma/client";import R from"zod";import{extendZodWithOpenApi as bm}from"@asteasolutions/zod-to-openapi";import{InMemoriamRole as wm}from"@prisma/client";import ae from"zod";var ss=2,is=1024,Cm=is*is,Sm=ss*Cm;bm(ae);var yo=ae.object({name:ae.string().min(1,"Nome \xE9 obrigat\xF3rio"),birthDate:ae.coerce.date(),deathDate:ae.coerce.date(),biography:ae.string().optional(),photo:ae.any().refine(o=>o==null?!0:typeof o!="object"||typeof o.size!="number"?!1:o.size<=Sm,`A imagem deve ter no m\xE1ximo ${ss}MB.`).optional(),role:ae.enum(wm)}).refine(o=>o.deathDate>o.birthDate,{message:"Data de falecimento deve ser posterior \xE0 data de nascimento",path:["deathDate"]}),Ct=class{constructor(e,r){this.inMemoriamRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{name:t,birthDate:i,deathDate:s,biography:n,role:a,photo:c}=yo.parse({...e.body,photo:e.file}),l=await this.inMemoriamRepository.create({name:t,birthDate:i,deathDate:s,biography:n??void 0,role:a}),T;return c&&(T=await this.firebaseStorageService.uploadFile({file:c,id:l.id,folder:A.IN_MEMORIAM}),await this.inMemoriamRepository.update({id:l.id,photoUrl:T})),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Em}from"@asteasolutions/zod-to-openapi";import go from"zod";Em(go);var ho=go.object({id:go.uuid()}),St=class{constructor(e,r){this.inMemoriamRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t}=ho.parse({id:e.params.id}),i=await this.inMemoriamRepository.findById(t);if(!i)throw new f("O in memoriam n\xE3o existe.");return i.photoUrl&&this.firebaseStorageService.deleteFile({fileUrl:i.photoUrl}),await this.inMemoriamRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as vm}from"@asteasolutions/zod-to-openapi";import Ro from"zod";vm(Ro);var vt=Ro.object({id:Ro.uuid()}),Et=class{constructor(e){this.inMemoriamRepository=e}async handle(e,r){try{let{id:t}=vt.parse({id:e.params.id}),i=await this.inMemoriamRepository.findById(t);if(!i)throw new f("O in memoriam n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as jm}from"@asteasolutions/zod-to-openapi";import{InMemoriamRole as Tm}from"@prisma/client";import Io from"zod";jm(Io);var bo=Io.object({role:Io.enum(Tm)}),jt=class{constructor(e){this.inMemoriamRepository=e}async handle(e,r){try{let{role:t}=bo.parse({role:e.params.role}),i=await this.inMemoriamRepository.findByRole(t);return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as xm}from"@asteasolutions/zod-to-openapi";import{InMemoriamRole as Mm}from"@prisma/client";import me from"zod";var Pm=1,Am=9;xm(me);var wo=me.object({page:me.coerce.number().min(1).default(Pm),limit:me.coerce.number().min(1).default(Am),name:me.string().optional(),biography:me.string().optional(),role:me.enum(Mm).optional(),orderBy:me.enum(["asc","desc"]).optional()}),Tt=class{constructor(e){this.inMemoriamRepository=e}async handle(e,r){try{let{page:t,limit:i,...s}=wo.parse(e.query),n=i*t-i,[a,c]=await Promise.all([this.inMemoriamRepository.find({pagination:{offset:n,limit:i},filter:s}),this.inMemoriamRepository.count({filter:s})]),l=Math.max(Math.ceil(c/i),1);r.status(200).json({page:t,totalPages:l,offset:n,limit:i,inMemoriam:a})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Um}from"@asteasolutions/zod-to-openapi";import{InMemoriamRole as Dm}from"@prisma/client";import J from"zod";var as=2,ns=1024,Fm=ns*ns,qm=as*Fm;Um(J);var Co=J.object({id:J.uuid(),name:J.string().min(1,"Nome \xE9 obrigat\xF3rio").optional(),birthDate:J.coerce.date().optional(),deathDate:J.coerce.date().optional(),biography:J.string().optional(),photo:J.any().refine(o=>o==null?!0:typeof o!="object"||typeof o.size!="number"?!1:o.size<=qm,`A imagem deve ter no m\xE1ximo ${as}MB.`).optional(),role:J.enum(Dm).optional()}).refine(o=>o.birthDate&&o.deathDate?o.deathDate>o.birthDate:!0,{message:"Data de falecimento deve ser posterior \xE0 data de nascimento",path:["deathDate"]}),xt=class{constructor(e,r){this.inMemoriamRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t,name:i,birthDate:s,deathDate:n,biography:a,photo:c,role:l}=Co.parse({id:e.params.id,...e.body,photo:e.file}),T=await this.inMemoriamRepository.findById(t);if(!T)throw new f("O registro in memoriam n\xE3o existe.");let x=T.photoUrl;return c&&(x=await this.firebaseStorageService.uploadFile({file:c,id:t,folder:A.IN_MEMORIAM})),await this.inMemoriamRepository.update({id:t,name:i,birthDate:s,deathDate:n,biography:a,photoUrl:x??void 0,role:l}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var So=R.object({id:R.uuid(),name:R.string(),birthDate:R.date(),deathDate:R.date(),biography:R.string().nullable(),photoUrl:R.string().nullable(),role:R.enum(Om),createdAt:R.date(),updatedAt:R.date()}),ms={method:"post",path:"/in-memoriam",tags:["In Memoriam"],summary:"Create a new in memoriam record with optional photo upload",security:[{bearerAuth:[]}],request:{body:{content:{"multipart/form-data":{schema:yo}}}},responses:{201:{description:"In memoriam record created successfully",summary:"In Memoriam Created"},400:{description:"Invalid input data, missing required fields, or invalid photo format/size",summary:"Validation Error",content:{"application/json":{schema:R.object({errors:R.record(R.string(),R.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:R.object({message:R.string()})}}},409:{description:"In memoriam record with this name already exists",summary:"Conflict",content:{"application/json":{schema:R.object({message:R.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:R.object({message:R.string()})}}}}},cs={method:"get",path:"/in-memoriam",tags:["In Memoriam"],summary:"List all in memoriam records with pagination and filters",request:{query:wo},responses:{200:{description:"List of in memoriam records retrieved successfully with pagination",summary:"In Memoriam Records Retrieved",content:{"application/json":{schema:R.object({page:R.number(),totalPages:R.number(),offset:R.number(),limit:R.number(),inMemoriam:R.array(So)})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:R.object({errors:R.record(R.string(),R.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:R.object({message:R.string()})}}}}},ps={method:"get",path:"/in-memoriam/{id}",tags:["In Memoriam"],summary:"Find in memoriam record by ID",request:{params:vt},responses:{200:{description:"In memoriam record details retrieved successfully",summary:"In Memoriam Record Retrieved",content:{"application/json":{schema:So}}},400:{description:"Invalid in memoriam record ID format",summary:"Validation Error",content:{"application/json":{schema:R.object({errors:R.record(R.string(),R.string())})}}},404:{description:"In memoriam record not found with the provided ID",summary:"In Memoriam Record Not Found",content:{"application/json":{schema:R.object({message:R.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:R.object({message:R.string()})}}}}},ds={method:"put",path:"/in-memoriam/{id}",tags:["In Memoriam"],summary:"Update in memoriam record with optional photo upload",security:[{bearerAuth:[]}],request:{params:vt,body:{content:{"multipart/form-data":{schema:Co.omit({id:!0})}}}},responses:{200:{description:"In memoriam record updated successfully",summary:"In Memoriam Record Updated"},400:{description:"Invalid input data, in memoriam record ID format, or invalid photo format/size",summary:"Validation Error",content:{"application/json":{schema:R.object({errors:R.record(R.string(),R.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:R.object({message:R.string()})}}},404:{description:"In memoriam record not found with the provided ID",summary:"In Memoriam Record Not Found",content:{"application/json":{schema:R.object({message:R.string()})}}},409:{description:"In memoriam record with this name already exists",summary:"Conflict",content:{"application/json":{schema:R.object({message:R.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:R.object({message:R.string()})}}}}},us={method:"delete",path:"/in-memoriam/{id}",tags:["In Memoriam"],summary:"Delete in memoriam record",security:[{bearerAuth:[]}],request:{params:ho},responses:{200:{description:"In memoriam record deleted successfully",summary:"In Memoriam Record Deleted"},400:{description:"Invalid in memoriam record ID format",summary:"Validation Error",content:{"application/json":{schema:R.object({errors:R.record(R.string(),R.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:R.object({message:R.string()})}}},404:{description:"In memoriam record not found with the provided ID",summary:"In Memoriam Record Not Found",content:{"application/json":{schema:R.object({message:R.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:R.object({message:R.string()})}}}}},Tf={method:"get",path:"/in-memoriam/role/{role}",tags:["In Memoriam"],summary:"Find in memoriam records by role",request:{params:bo},responses:{200:{description:"In memoriam records retrieved successfully by role",summary:"In Memoriam Records Retrieved by Role",content:{"application/json":{schema:R.array(So)}}},400:{description:"Invalid role parameter provided",summary:"Validation Error",content:{"application/json":{schema:R.object({errors:R.record(R.string(),R.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:R.object({message:R.string()})}}}}};import{$Enums as Lm}from"@prisma/client";import E from"zod";import{extendZodWithOpenApi as Bm}from"@asteasolutions/zod-to-openapi";import He from"zod";Bm(He);var Eo=He.object({role:He.string().min(1),description:He.string().optional(),userId:He.uuid(),order:He.number().optional()}),Mt=class{constructor(e){this.legitimatorCommitteeMemberRepository=e}async handle(e,r){try{let{role:t,description:i,userId:s,order:n}=Eo.parse(e.body);return await this.legitimatorCommitteeMemberRepository.create({role:t,description:i,userId:s,order:n??0}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Nm}from"@asteasolutions/zod-to-openapi";import vo from"zod";Nm(vo);var jo=vo.object({id:vo.uuid()}),Pt=class{constructor(e){this.legitimatorCommitteeMemberRepository=e}async handle(e,r){try{let{id:t}=jo.parse({id:e.params.id});if(!await this.legitimatorCommitteeMemberRepository.findById(t))throw new f("O membro do comit\xEA legitimador n\xE3o existe.");return await this.legitimatorCommitteeMemberRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as km}from"@asteasolutions/zod-to-openapi";import To from"zod";km(To);var Ut=To.object({id:To.uuid()}),At=class{constructor(e){this.legitimatorCommitteeMemberRepository=e}async handle(e,r){try{let{id:t}=Ut.parse({id:e.params.id}),i=await this.legitimatorCommitteeMemberRepository.findById(t);if(!i)throw new f("O membro do comit\xEA legitimador n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Hm}from"@asteasolutions/zod-to-openapi";import Ce from"zod";Hm(Ce);var xo=Ce.object({id:Ce.uuid(),role:Ce.string().min(1).optional(),description:Ce.string().optional(),userId:Ce.uuid().optional(),order:Ce.number().optional()}),Dt=class{constructor(e){this.legitimatorCommitteeMemberRepository=e}async handle(e,r){try{let{id:t,role:i,description:s,userId:n,order:a}=xo.parse({id:e.params.id,...e.body});if(!await this.legitimatorCommitteeMemberRepository.findById(t))throw new f("O membro do comit\xEA legitimador n\xE3o existe.");return await this.legitimatorCommitteeMemberRepository.update({id:t,role:i,description:s,userId:n,order:a}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var _m=E.object({id:E.uuid(),name:E.string(),emailAddress:E.string(),avatarUrl:E.string().nullable(),orcid:E.string().nullable(),phone:E.string().nullable(),lattesUrl:E.string().nullable(),role:E.enum(Lm.UserRole)}),ls=E.object({id:E.uuid(),role:E.string(),description:E.string().nullable(),order:E.number(),createdAt:E.date(),updatedAt:E.date(),userId:E.uuid(),user:_m}),fs={method:"post",path:"/legitimator-committee-member",tags:["Legitimator Committee Members"],summary:"Create a new Legitimator Committee Member",security:[{bearerAuth:[]}],request:{body:{content:{"application/json":{schema:Eo}}}},responses:{201:{description:"Legitimator Committee Member created successfully",summary:"Legitimator Committee Member Created"},400:{description:"Invalid input data or missing required fields",summary:"Validation Error",content:{"application/json":{schema:E.object({errors:E.record(E.string(),E.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:E.object({message:E.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:E.object({message:E.string()})}}}}},ys={method:"get",path:"/legitimator-committee-member",tags:["Legitimator Committee Members"],summary:"List all Legitimator Committee Members with filters",request:{query:E.object({role:E.string().optional(),orderBy:E.enum(["asc","desc"]).optional()})},responses:{200:{description:"List of Legitimator Committee Members retrieved successfully",summary:"Legitimator Committee Members Retrieved",content:{"application/json":{schema:E.object({members:E.array(ls)})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:E.object({message:E.string()})}}}}},gs={method:"get",path:"/legitimator-committee-member/{id}",tags:["Legitimator Committee Members"],summary:"Find Legitimator Committee Member by ID",request:{params:Ut},responses:{200:{description:"Legitimator Committee Member details retrieved successfully",summary:"Legitimator Committee Member Retrieved",content:{"application/json":{schema:ls}}},400:{description:"Invalid Legitimator Committee Member ID format",summary:"Validation Error",content:{"application/json":{schema:E.object({errors:E.record(E.string(),E.string())})}}},404:{description:"Legitimator Committee Member not found with the provided ID",summary:"Legitimator Committee Member Not Found",content:{"application/json":{schema:E.object({message:E.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:E.object({message:E.string()})}}}}},hs={method:"put",path:"/legitimator-committee-member/{id}",tags:["Legitimator Committee Members"],summary:"Update Legitimator Committee Member",security:[{bearerAuth:[]}],request:{params:Ut,body:{content:{"application/json":{schema:xo.omit({id:!0})}}}},responses:{200:{description:"Legitimator Committee Member updated successfully",summary:"Legitimator Committee Member Updated"},400:{description:"Invalid input data or Legitimator Committee Member ID format",summary:"Validation Error",content:{"application/json":{schema:E.object({errors:E.record(E.string(),E.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:E.object({message:E.string()})}}},404:{description:"Legitimator Committee Member not found with the provided ID",summary:"Legitimator Committee Member Not Found",content:{"application/json":{schema:E.object({message:E.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:E.object({message:E.string()})}}}}},Rs={method:"delete",path:"/legitimator-committee-member/{id}",tags:["Legitimator Committee Members"],summary:"Delete Legitimator Committee Member",security:[{bearerAuth:[]}],request:{params:jo},responses:{200:{description:"Legitimator Committee Member deleted successfully",summary:"Legitimator Committee Member Deleted"},400:{description:"Invalid Legitimator Committee Member ID format",summary:"Validation Error",content:{"application/json":{schema:E.object({errors:E.record(E.string(),E.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:E.object({message:E.string()})}}},404:{description:"Legitimator Committee Member not found with the provided ID",summary:"Legitimator Committee Member Not Found",content:{"application/json":{schema:E.object({message:E.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:E.object({message:E.string()})}}}}};import{$Enums as Km}from"@prisma/client";import g from"zod";import{extendZodWithOpenApi as zm}from"@asteasolutions/zod-to-openapi";import Q from"zod";zm(Q);var Mo=Q.object({name:Q.string().min(1),description:Q.string().optional(),members:Q.array(Q.object({userId:Q.uuid(),role:Q.string().min(1),order:Q.number().optional()}))}),Ft=class{constructor(e){this.managementTeamRepository=e}async handle(e,r){try{let{name:t,description:i,members:s}=Mo.parse(e.body);if(await this.managementTeamRepository.findByName(t))throw new O("J\xE1 existe um time de gest\xE3o cadastrado com este nome.");return await this.managementTeamRepository.create({name:t,description:i,members:s.map(a=>({userId:a.userId,role:a.role,order:a.order??0}))}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Wm}from"@asteasolutions/zod-to-openapi";import Po from"zod";Wm(Po);var Ao=Po.object({id:Po.uuid()}),qt=class{constructor(e){this.managementTeamRepository=e}async handle(e,r){try{let{id:t}=Ao.parse({id:e.params.id});if(!await this.managementTeamRepository.findById(t))throw new f("O time de gest\xE3o n\xE3o existe.");return await this.managementTeamRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Zm}from"@asteasolutions/zod-to-openapi";import Uo from"zod";Zm(Uo);var Bt=Uo.object({id:Uo.uuid()}),Ot=class{constructor(e){this.managementTeamRepository=e}async handle(e,r){try{let{id:t}=Bt.parse({id:e.params.id}),i=await this.managementTeamRepository.findById(t);if(!i)throw new f("O time de gest\xE3o n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Vm}from"@asteasolutions/zod-to-openapi";import $ from"zod";Vm($);var Do=$.object({id:$.uuid(),name:$.string().min(1).optional(),description:$.string().optional(),members:$.array($.object({userId:$.uuid(),role:$.string().min(1),order:$.number().optional()})).optional()}),Nt=class{constructor(e){this.managementTeamRepository=e}async handle(e,r){try{let{id:t,name:i,description:s,members:n}=Do.parse({id:e.params.id,...e.body}),a=await this.managementTeamRepository.findById(t);if(!a)throw new f("O time de gest\xE3o n\xE3o existe.");if(i&&i!==a.name){let c=await this.managementTeamRepository.findByName(i);if(c&&c.id!==t)throw new O("J\xE1 existe um time de gest\xE3o com este nome.")}return await this.managementTeamRepository.update({id:t,name:i,description:s,members:n?n.map(c=>({userId:c.userId,role:c.role,order:c.order??0})):void 0}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Gm=g.object({id:g.uuid(),name:g.string(),emailAddress:g.string(),avatarUrl:g.string().nullable(),orcid:g.string().nullable(),phone:g.string().nullable(),lattesUrl:g.string().nullable(),role:g.enum(Km.UserRole)}),Ym=g.object({id:g.uuid(),role:g.string(),description:g.string().nullable(),order:g.number(),teamId:g.uuid(),userId:g.uuid(),createdAt:g.date(),updatedAt:g.date(),user:Gm}),Is=g.object({id:g.uuid(),name:g.string(),description:g.string().nullable(),createdAt:g.date(),updatedAt:g.date(),members:g.array(Ym)}),bs={method:"post",path:"/management-team",tags:["Management Teams"],summary:"Create a new Management Team with multiple members",security:[{bearerAuth:[]}],request:{body:{content:{"application/json":{schema:Mo}}}},responses:{201:{description:"Management Team created successfully",summary:"Management Team Created"},400:{description:"Invalid input data or missing required fields",summary:"Validation Error",content:{"application/json":{schema:g.object({errors:g.record(g.string(),g.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:g.object({message:g.string()})}}},409:{description:"Management Team with this name already exists",summary:"Conflict",content:{"application/json":{schema:g.object({message:g.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:g.object({message:g.string()})}}}}},ws={method:"get",path:"/management-team",tags:["Management Teams"],summary:"List all Management Teams with filters",request:{query:g.object({name:g.string().optional(),description:g.string().optional(),orderBy:g.enum(["asc","desc"]).optional()})},responses:{200:{description:"List of Management Teams retrieved successfully",summary:"Management Teams Retrieved",content:{"application/json":{schema:g.object({teams:g.array(Is)})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:g.object({message:g.string()})}}}}},Cs={method:"get",path:"/management-team/{id}",tags:["Management Teams"],summary:"Find Management Team by ID",request:{params:Bt},responses:{200:{description:"Management Team details retrieved successfully",summary:"Management Team Retrieved",content:{"application/json":{schema:Is}}},400:{description:"Invalid Management Team ID format",summary:"Validation Error",content:{"application/json":{schema:g.object({errors:g.record(g.string(),g.string())})}}},404:{description:"Management Team not found with the provided ID",summary:"Management Team Not Found",content:{"application/json":{schema:g.object({message:g.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:g.object({message:g.string()})}}}}},Ss={method:"put",path:"/management-team/{id}",tags:["Management Teams"],summary:"Update Management Team and manage member relationships",security:[{bearerAuth:[]}],request:{params:Bt,body:{content:{"application/json":{schema:Do.omit({id:!0})}}}},responses:{200:{description:"Management Team updated successfully",summary:"Management Team Updated"},400:{description:"Invalid input data or Management Team ID format",summary:"Validation Error",content:{"application/json":{schema:g.object({errors:g.record(g.string(),g.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:g.object({message:g.string()})}}},404:{description:"Management Team not found with the provided ID",summary:"Management Team Not Found",content:{"application/json":{schema:g.object({message:g.string()})}}},409:{description:"Management Team with this name already exists",summary:"Conflict",content:{"application/json":{schema:g.object({message:g.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:g.object({message:g.string()})}}}}},Es={method:"delete",path:"/management-team/{id}",tags:["Management Teams"],summary:"Delete Management Team",security:[{bearerAuth:[]}],request:{params:Ao},responses:{200:{description:"Management Team deleted successfully",summary:"Management Team Deleted"},400:{description:"Invalid Management Team ID format",summary:"Validation Error",content:{"application/json":{schema:g.object({errors:g.record(g.string(),g.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:g.object({message:g.string()})}}},404:{description:"Management Team not found with the provided ID",summary:"Management Team Not Found",content:{"application/json":{schema:g.object({message:g.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:g.object({message:g.string()})}}}}};import b from"zod";import{extendZodWithOpenApi as $m}from"@asteasolutions/zod-to-openapi";import Ye from"zod";var Xm=5,vs=1024,Jm=vs*vs,Qm=Xm*Jm;$m(Ye);var Fo=Ye.object({title:Ye.string().min(1),content:Ye.string().min(1),image:Ye.any().refine(o=>!o||typeof o=="object"&&typeof o.mimetype=="string"&&o.mimetype.startsWith("image/")&&typeof o.size=="number"&&o.size<=Qm,{message:"A imagem deve ser uma imagem v\xE1lida de no m\xE1ximo 5MB."})}),kt=class{constructor(e,r){this.newsRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{title:t,content:i,image:s}=Fo.parse({...e.body,image:e.file}),n=e.user.id,a=await this.firebaseStorageService.uploadFile({file:s,folder:A.NEWS,id:n});await this.newsRepository.create({title:t,content:i,authorId:n,imageUrl:a}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as ec}from"@asteasolutions/zod-to-openapi";import ce from"zod";var tc=1,rc=7;ec(ce);var Lt=ce.object({page:ce.coerce.number().min(1).default(tc),limit:ce.coerce.number().min(1).default(rc),authorId:ce.string(),title:ce.string().optional(),content:ce.string().optional(),orderBy:ce.enum(["asc","desc"]).default("desc")}),Ht=class{constructor(e){this.newsRepository=e}async handle(e,r){try{let{page:t,limit:i,authorId:s,...n}=Lt.parse(e.query),a=i*t-i,[c,l]=await Promise.all([this.newsRepository.findByAuthorId({authorId:s,pagination:{offset:a,limit:i},filter:n}),this.newsRepository.count({filter:{authorId:s,...n}})]),T=Math.max(Math.ceil(l/i),1);r.status(200).json({page:t,totalPages:T,offset:a,limit:i,news:c})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as oc}from"@asteasolutions/zod-to-openapi";import qo from"zod";oc(qo);var Oo=qo.object({id:qo.string()}),_t=class{constructor(e){this.newsRepository=e}async handle(e,r){try{let{id:t}=Oo.parse(e.params),i=await this.newsRepository.findById(t);if(!i)throw new f("Not\xEDcia n\xE3o encontrada.");r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as ic}from"@asteasolutions/zod-to-openapi";import pe from"zod";var sc=1,nc=9;ic(pe);var Bo=pe.object({page:pe.coerce.number().min(1).default(sc),limit:pe.coerce.number().min(1).default(nc),title:pe.string().optional(),content:pe.string().optional(),authorId:pe.string().optional(),orderBy:pe.enum(["asc","desc"]).default("desc")}),zt=class{constructor(e){this.newsRepository=e}async handle(e,r){try{let{page:t,limit:i,authorId:s,content:n,orderBy:a,title:c}=Bo.parse(e.query),l=i*t-i,[T,x]=await Promise.all([this.newsRepository.find({pagination:{offset:l,limit:i},filter:{authorId:s,content:n,title:c,orderBy:a}}),this.newsRepository.count({filter:{title:c,content:n,authorId:s}})]),q=Math.max(Math.ceil(x/i),1);r.status(200).json({page:t,totalPages:q,offset:l,limit:i,news:T})}catch(t){if(t instanceof Error)throw new m(t.message)}}};var js={method:"post",path:"/news",tags:["News"],summary:"Create news",security:[{bearerAuth:[]}],request:{body:{content:{"multipart/form-data":{schema:Fo}}}},responses:{201:{description:"News article created successfully",summary:"News Created",content:{"application/json":{schema:b.object({message:b.string()})}}},400:{description:"Invalid input data or file format",summary:"Validation Error",content:{"application/json":{schema:b.object({errors:b.record(b.string(),b.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:b.object({message:b.string()})}}}}},Ts={method:"get",path:"/news",tags:["News"],summary:"List news",request:{query:Bo},responses:{200:{description:"Paginated list of news articles retrieved successfully",summary:"News Retrieved",content:{"application/json":{schema:b.object({page:b.number(),totalPages:b.number(),offset:b.number(),limit:b.number(),news:b.array(b.object({title:b.string(),content:b.string(),id:b.string(),createdAt:b.date(),updatedAt:b.date(),imageUrl:b.string().nullable()}))})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:b.object({errors:b.record(b.string(),b.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:b.object({message:b.string()})}}}}},xs={method:"get",path:"/news/{id}",tags:["News"],summary:"Find news by ID",request:{params:Oo},responses:{200:{description:"News article details retrieved successfully",summary:"News Retrieved",content:{"application/json":{schema:b.object({page:b.number(),totalPages:b.number(),offset:b.number(),limit:b.number(),news:b.object({title:b.string(),content:b.string(),id:b.string(),createdAt:b.date(),updatedAt:b.date(),imageUrl:b.string().nullable()})})}}},400:{description:"Invalid news ID format",summary:"Validation Error",content:{"application/json":{schema:b.object({errors:b.record(b.string(),b.string())})}}},404:{description:"News article not found with the provided ID",summary:"News Not Found",content:{"application/json":{schema:b.object({message:b.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:b.object({message:b.string()})}}}}},Ms={method:"get",path:"/news/author/{author_id}",tags:["News"],summary:"List news by author",request:{params:Lt.pick({authorId:!0}).transform(()=>({author_id:""})),query:Lt.omit({authorId:!0})},responses:{200:{description:"Paginated list of news articles by author retrieved successfully",summary:"Author News Retrieved",content:{"application/json":{schema:b.object({page:b.number(),totalPages:b.number(),offset:b.number(),limit:b.number(),news:b.array(b.object({title:b.string(),content:b.string(),id:b.string(),createdAt:b.date(),updatedAt:b.date(),imageUrl:b.string().nullable()}))})}}},400:{description:"Invalid author ID or query parameters",summary:"Validation Error",content:{"application/json":{schema:b.object({errors:b.record(b.string(),b.string())})}}},404:{description:"Author not found with the provided ID",summary:"Author Not Found",content:{"application/json":{schema:b.object({message:b.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:b.object({message:b.string()})}}}}};import C from"zod";import{extendZodWithOpenApi as ac}from"@asteasolutions/zod-to-openapi";import X from"zod";var As=2,Ps=1024,mc=Ps*Ps,cc=As*mc;ac(X);var No=X.object({name:X.string().min(1,"Nome \xE9 obrigat\xF3rio"),logo:X.any().refine(o=>o==null||typeof o!="object"||typeof o.size!="number"?!1:o.size<=cc,`A imagem deve ter no m\xE1ximo ${As}MB.`),websiteUrl:X.url("URL do site deve ser v\xE1lida").optional(),description:X.string().optional(),category:X.string().optional(),since:X.coerce.date(),isActive:X.preprocess(o=>o==="true",X.boolean().optional())}),Wt=class{constructor(e,r){this.partnerRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{name:t,logo:i,websiteUrl:s,description:n,category:a,since:c,isActive:l}=No.parse({...e.body,logo:e.file}),T=await this.partnerRepository.create({name:t,websiteUrl:s,description:n,category:a,since:c,isActive:l}),x=await this.firebaseStorageService.uploadFile({file:i,id:T.id,folder:A.PARTNER});return await this.partnerRepository.update({id:T.id,logoUrl:x}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as pc}from"@asteasolutions/zod-to-openapi";import ko from"zod";pc(ko);var Ho=ko.object({id:ko.uuid()}),Zt=class{constructor(e,r){this.partnerRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t}=Ho.parse({id:e.params.id}),i=await this.partnerRepository.findById(t);if(!i)throw new f("O parceiro n\xE3o existe.");return i.logoUrl&&this.firebaseStorageService.deleteFile({fileUrl:i.logoUrl}),await this.partnerRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as dc}from"@asteasolutions/zod-to-openapi";import Lo from"zod";dc(Lo);var Kt=Lo.object({id:Lo.uuid()}),Vt=class{constructor(e){this.partnerRepository=e}async handle(e,r){try{let{id:t}=Kt.parse({id:e.params.id}),i=await this.partnerRepository.findById(t);if(!i)throw new f("O parceiro n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as uc}from"@asteasolutions/zod-to-openapi";import ee from"zod";var lc=1,fc=9;uc(ee);var _o=ee.object({page:ee.coerce.number().min(1).default(lc),limit:ee.coerce.number().min(1).default(fc),name:ee.string().optional(),description:ee.string().optional(),category:ee.string().optional(),isActive:ee.coerce.boolean().optional(),orderBy:ee.enum(["asc","desc"]).optional()}),Gt=class{constructor(e){this.partnerRepository=e}async handle(e,r){try{let{page:t,limit:i,...s}=_o.parse(e.query),n=i*t-i,[a,c]=await Promise.all([this.partnerRepository.find({pagination:{offset:n,limit:i},filter:s}),this.partnerRepository.count({filter:s})]),l=Math.max(Math.ceil(c/i),1);r.status(200).json({page:t,totalPages:l,offset:n,limit:i,partners:a})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as yc}from"@asteasolutions/zod-to-openapi";import G from"zod";var Ds=2,Us=1024,gc=Us*Us,hc=Ds*gc;yc(G);var zo=G.object({id:G.uuid(),name:G.string().min(1,"Nome \xE9 obrigat\xF3rio").optional(),logo:G.any().refine(o=>o==null?!0:typeof o!="object"||typeof o.size!="number"?!1:o.size<=hc,`A imagem deve ter no m\xE1ximo ${Ds}MB.`).optional(),websiteUrl:G.url("URL do site deve ser v\xE1lida").optional(),description:G.string().optional(),category:G.string().optional(),since:G.coerce.date().optional(),isActive:G.preprocess(o=>o==="true",G.boolean().optional())}),Yt=class{constructor(e,r){this.partnerRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t,name:i,logo:s,websiteUrl:n,description:a,category:c,since:l,isActive:T}=zo.parse({id:e.params.id,...e.body,logo:e.file}),x=await this.partnerRepository.findById(t);if(!x)throw new f("O parceiro n\xE3o existe.");let q=x.logoUrl;if(s&&(q=await this.firebaseStorageService.uploadFile({file:s,id:t,folder:"images/partners"})),!q)throw new m("Logo URL \xE9 obrigat\xF3rio");return await this.partnerRepository.update({id:t,name:i,logoUrl:q,websiteUrl:n,description:a,category:c,since:l,isActive:T}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Fs=C.object({id:C.uuid(),name:C.string(),logoUrl:C.string(),websiteUrl:C.string().nullable(),description:C.string().nullable(),category:C.string().nullable(),since:C.date(),isActive:C.boolean(),createdAt:C.date(),updatedAt:C.date()}),qs={method:"post",path:"/partner",tags:["Partners"],summary:"Create a new partner with logo upload",security:[{bearerAuth:[]}],request:{body:{content:{"multipart/form-data":{schema:No}}}},responses:{201:{description:"Partner created successfully",summary:"Partner Created"},400:{description:"Invalid input data, missing required fields, or invalid logo format/size",summary:"Validation Error",content:{"application/json":{schema:C.object({errors:C.record(C.string(),C.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:C.object({message:C.string()})}}},409:{description:"Partner with this name already exists",summary:"Conflict",content:{"application/json":{schema:C.object({message:C.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:C.object({message:C.string()})}}}}},Os={method:"get",path:"/partner",tags:["Partners"],summary:"List all partners with pagination and filters",request:{query:_o},responses:{200:{description:"List of partners retrieved successfully with pagination",summary:"Partners Retrieved",content:{"application/json":{schema:C.object({page:C.number(),totalPages:C.number(),offset:C.number(),limit:C.number(),partners:C.array(Fs)})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:C.object({errors:C.record(C.string(),C.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:C.object({message:C.string()})}}}}},Bs={method:"get",path:"/partner/{id}",tags:["Partners"],summary:"Find partner by ID",request:{params:Kt},responses:{200:{description:"Partner details retrieved successfully",summary:"Partner Retrieved",content:{"application/json":{schema:Fs}}},400:{description:"Invalid partner ID format",summary:"Validation Error",content:{"application/json":{schema:C.object({errors:C.record(C.string(),C.string())})}}},404:{description:"Partner not found with the provided ID",summary:"Partner Not Found",content:{"application/json":{schema:C.object({message:C.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:C.object({message:C.string()})}}}}},Ns={method:"put",path:"/partner/{id}",tags:["Partners"],summary:"Update partner with optional logo upload",security:[{bearerAuth:[]}],request:{params:Kt,body:{content:{"multipart/form-data":{schema:zo.omit({id:!0})}}}},responses:{200:{description:"Partner updated successfully",summary:"Partner Updated"},400:{description:"Invalid input data, partner ID format, or invalid logo format/size",summary:"Validation Error",content:{"application/json":{schema:C.object({errors:C.record(C.string(),C.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:C.object({message:C.string()})}}},404:{description:"Partner not found with the provided ID",summary:"Partner Not Found",content:{"application/json":{schema:C.object({message:C.string()})}}},409:{description:"Partner with this name already exists",summary:"Conflict",content:{"application/json":{schema:C.object({message:C.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:C.object({message:C.string()})}}}}},ks={method:"delete",path:"/partner/{id}",tags:["Partners"],summary:"Delete partner",security:[{bearerAuth:[]}],request:{params:Ho},responses:{200:{description:"Partner deleted successfully",summary:"Partner Deleted"},400:{description:"Invalid partner ID format",summary:"Validation Error",content:{"application/json":{schema:C.object({errors:C.record(C.string(),C.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:C.object({message:C.string()})}}},404:{description:"Partner not found with the provided ID",summary:"Partner Not Found",content:{"application/json":{schema:C.object({message:C.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:C.object({message:C.string()})}}}}};import{$Enums as Hs}from"@prisma/client";import S from"zod";import{extendZodWithOpenApi as Rc}from"@asteasolutions/zod-to-openapi";import{PendencyStatus as Ic}from"@prisma/client";import de from"zod";Rc(de);var Xt=de.object({userId:de.uuid(),title:de.string().min(1),description:de.string().optional(),status:de.enum(Ic).default("PENDING"),dueDate:de.coerce.date().optional(),document:de.any().refine(o=>o&&typeof o=="object"&&o.size>0,"Arquivo do documento \xE9 obrigat\xF3rio")}),$t=class{constructor(e,r,t){this.userRepository=e;this.pendencyRepository=r;this.firebaseStorageService=t}async handle(e,r){try{let{userId:t,title:i,description:s,status:n,dueDate:a,document:c}=Xt.parse({...e.body,userId:e.params.user_id,document:e.file});if(!await this.userRepository.findById(t))throw new N("O usu\xE1rio n\xE3o existe.");let T=await this.firebaseStorageService.uploadFile({file:c,id:t,folder:A.PENDENCY});return await this.pendencyRepository.create({userId:t,title:i,description:s,status:n,dueDate:a,documentUrl:T}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as bc}from"@asteasolutions/zod-to-openapi";import Wo from"zod";bc(Wo);var Zo=Wo.object({id:Wo.uuid()}),Jt=class{constructor(e,r){this.pendencyRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t}=Zo.parse({id:e.params.pendency_id}),i=await this.pendencyRepository.findById(t);if(!i)throw new f("A pend\xEAncia n\xE3o existe.");return await Promise.all([this.pendencyRepository.deleteById(i.id),this.firebaseStorageService.deleteFile({fileUrl:i.documentUrl})]),r.sendStatus(204)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as wc}from"@asteasolutions/zod-to-openapi";import{PendencyStatus as Cc}from"@prisma/client";import te from"zod";var Sc=1,Ec=6;wc(te);var Vo=te.object({page:te.coerce.number().min(1).default(Sc),limit:te.coerce.number().min(1).default(Ec),title:te.string().optional(),description:te.string().optional(),status:te.enum(Cc).default("PENDING"),userId:te.uuid().optional(),orderBy:te.enum(["asc","desc"]).default("desc")}),Qt=class{constructor(e){this.pendencyRepository=e}async handle(e,r){try{let{description:t,limit:i,orderBy:s,page:n,title:a,status:c,userId:l}=Vo.parse(e.query),T=n*i-i,[x,q]=await Promise.all([this.pendencyRepository.find({pagination:{offset:T,limit:i},filter:{title:a,description:t,status:c,orderBy:s,userId:l}}),this.pendencyRepository.count({filter:{title:a,description:t,status:c,userId:l}})]),V=Math.max(Math.ceil(q/i),1);return r.status(200).json({page:n,totalPages:V,offset:T,limit:i,pendencies:x})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as vc}from"@asteasolutions/zod-to-openapi";import Ko from"zod";vc(Ko);var Go=Ko.object({pendencyId:Ko.uuid()}),er=class{constructor(e){this.pendencyRepository=e}async handle(e,r){try{let{pendencyId:t}=Go.parse({pendencyId:e.params.pendency_id}),i=await this.pendencyRepository.findById(t);if(!i)throw new f("Pend\xEAncia n\xE3o encontrada.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as jc}from"@asteasolutions/zod-to-openapi";import{PendencyStatus as Tc}from"@prisma/client";import ue from"zod";jc(ue);var rr=ue.object({id:ue.uuid(),title:ue.string().min(1),description:ue.string().optional(),status:ue.enum(Tc),dueDate:ue.coerce.date().optional(),document:ue.any().refine(o=>o==null||typeof o=="object"&&typeof o.size=="number"&&(o.size===0||o.size>0),"Arquivo do documento \xE9 inv\xE1lido").optional()}),tr=class{constructor(e,r){this.pendencyRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{document:t,id:i,...s}=rr.parse({...e.body,id:e.params.pendency_id,document:e.file}),n=await this.pendencyRepository.findById(i);if(!n)throw new N("A pend\xEAncia n\xE3o existe");let a=n.documentUrl;return t&&t.size>0&&(a=await this.firebaseStorageService.updateFile({file:t,id:n.userId,folder:A.PENDENCY,fileUrl:n.documentUrl})),await this.pendencyRepository.update({...s,id:i,documentUrl:a}),r.sendStatus(204)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Ls={method:"post",path:"/pendency/{user_id}",tags:["Pendencies"],summary:"Create pendency for user",security:[{bearerAuth:[]}],request:{params:Xt.pick({userId:!0}).transform(()=>({user_id:""})),body:{content:{"multipart/form-data":{schema:Xt.omit({userId:!0})}}}},responses:{201:{description:"Pendency created successfully for the user",summary:"Pendency Created",content:{"application/json":{schema:S.object({})}}},400:{description:"Invalid input data or file format",summary:"Validation Error",content:{"application/json":{schema:S.object({errors:S.record(S.string(),S.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:S.object({message:S.string()})}}}}},_s={method:"get",path:"/pendency",tags:["Pendencies"],summary:"List pendencies",security:[{bearerAuth:[]}],request:{query:Vo},responses:{200:{description:"Paginated list of pendencies retrieved successfully",summary:"Pendencies Retrieved",content:{"application/json":{schema:S.object({page:S.number(),totalPages:S.number(),offset:S.number(),limit:S.number(),pendencies:S.array(S.object({id:S.string(),title:S.string(),description:S.string().nullable(),status:S.enum(Hs.PendencyStatus),dueDate:S.date().nullable(),documentUrl:S.string(),userId:S.string(),createdAt:S.date(),updatedAt:S.date()}))})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:S.object({errors:S.record(S.string(),S.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:S.object({message:S.string()})}}}}},zs={method:"get",path:"/pendency/{pendency_id}",tags:["Pendencies"],summary:"Find pendency by ID",security:[{bearerAuth:[]}],request:{params:Go},responses:{200:{description:"Pendency details retrieved successfully",summary:"Pendency Retrieved",content:{"application/json":{schema:S.object({id:S.string(),title:S.string(),description:S.string().nullable(),status:S.enum(Hs.PendencyStatus),dueDate:S.date().nullable(),documentUrl:S.string(),userId:S.string(),createdAt:S.date(),updatedAt:S.date()}).nullable()}}},400:{description:"Invalid pendency ID format",summary:"Validation Error",content:{"application/json":{schema:S.object({errors:S.record(S.string(),S.string())})}}},404:{description:"Pendency not found with the provided ID",summary:"Pendency Not Found",content:{"application/json":{schema:S.object({message:S.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:S.object({message:S.string()})}}}}},Ws={method:"put",path:"/pendency/{pendency_id}",tags:["Pendencies"],summary:"Update pendency",security:[{bearerAuth:[]}],request:{params:rr.pick({id:!0}).transform(()=>({pendency_id:""})),body:{content:{"multipart/form-data":{schema:rr.omit({id:!0})}}}},responses:{204:{description:"Pendency updated successfully",summary:"Pendency Updated"},400:{description:"Invalid input data or pendency does not exist",summary:"Validation Error",content:{"application/json":{schema:S.object({errors:S.record(S.string(),S.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:S.object({message:S.string()})}}}}},Zs={method:"delete",path:"/pendency/{pendency_id}",tags:["Pendencies"],summary:"Delete pendency",security:[{bearerAuth:[]}],request:{params:Zo},responses:{204:{description:"Pendency deleted successfully",summary:"Pendency Deleted"},400:{description:"Invalid pendency ID format",summary:"Validation Error",content:{"application/json":{schema:S.object({errors:S.record(S.string(),S.string())})}}},404:{description:"Pendency not found with the provided ID",summary:"Pendency Not Found",content:{"application/json":{schema:S.object({message:S.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:S.object({message:S.string()})}}}}};import{RegimentStatus as zc}from"@prisma/client";import w from"zod";import{extendZodWithOpenApi as xc}from"@asteasolutions/zod-to-openapi";import{RegimentStatus as Ks}from"@prisma/client";import Se from"zod";var Gs=10,Vs=1024,Mc=Vs*Vs,Pc=Gs*Mc;xc(Se);var Yo=Se.object({title:Se.string().min(1,"T\xEDtulo \xE9 obrigat\xF3rio"),version:Se.string().min(1,"Vers\xE3o \xE9 obrigat\xF3ria"),publishedAt:Se.coerce.date(),document:Se.any().refine(o=>o==null||typeof o!="object"||typeof o.size!="number"?!1:o.size<=Pc,`O documento deve ter no m\xE1ximo ${Gs}MB.`),status:Se.enum(Ks).optional()}),or=class{constructor(e,r){this.regimentRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{title:t,version:i,publishedAt:s,document:n,status:a}=Yo.parse({...e.body,document:e.file}),c=await this.regimentRepository.create({title:t,version:i,publishedAt:s,documentUrl:"",status:a??Ks.IN_FORCE}),l=await this.firebaseStorageService.uploadFile({file:n,id:c.id,folder:A.REGIMENT});return await this.regimentRepository.update({id:c.id,documentUrl:l}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Ac}from"@asteasolutions/zod-to-openapi";import $o from"zod";Ac($o);var Xo=$o.object({id:$o.uuid()}),ir=class{constructor(e,r){this.regimentRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t}=Xo.parse({id:e.params.id}),i=await this.regimentRepository.findById(t);if(!i)throw new f("O regimento n\xE3o existe.");return i.documentUrl&&await this.firebaseStorageService.deleteFile({fileUrl:i.documentUrl}),await this.regimentRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Uc}from"@asteasolutions/zod-to-openapi";import Jo from"zod";Uc(Jo);var nr=Jo.object({id:Jo.uuid()}),sr=class{constructor(e){this.regimentRepository=e}async handle(e,r){try{let{id:t}=nr.parse({id:e.params.id}),i=await this.regimentRepository.findById(t);if(!i)throw new f("O regimento n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Dc}from"@asteasolutions/zod-to-openapi";import{RegimentStatus as Fc}from"@prisma/client";import Qo from"zod";Dc(Qo);var ei=Qo.object({status:Qo.enum(Fc)}),ar=class{constructor(e){this.regimentRepository=e}async handle(e,r){try{let{status:t}=ei.parse({status:e.params.status}),i=await this.regimentRepository.findByStatus(t);return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as qc}from"@asteasolutions/zod-to-openapi";import{RegimentStatus as Oc}from"@prisma/client";import Ee from"zod";var Bc=1,Nc=10;qc(Ee);var ti=Ee.object({page:Ee.coerce.number().min(1).default(Bc),limit:Ee.coerce.number().min(1).default(Nc),title:Ee.string().optional(),status:Ee.enum(Oc).optional(),orderBy:Ee.enum(["asc","desc"]).optional()}),mr=class{constructor(e){this.regimentRepository=e}async handle(e,r){try{let{page:t,limit:i,...s}=ti.parse(e.query),n=i*t-i,[a,c]=await Promise.all([this.regimentRepository.find({pagination:{offset:n,limit:i},filter:s}),this.regimentRepository.count({filter:s})]),l=Math.max(Math.ceil(c/i),1);r.status(200).json({page:t,totalPages:l,offset:n,limit:i,regiments:a})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as kc}from"@asteasolutions/zod-to-openapi";import{RegimentStatus as Hc}from"@prisma/client";import le from"zod";var $s=10,Ys=1024,Lc=Ys*Ys,_c=$s*Lc;kc(le);var ri=le.object({id:le.uuid(),title:le.string().min(1,"T\xEDtulo \xE9 obrigat\xF3rio").optional(),version:le.string().min(1,"Vers\xE3o \xE9 obrigat\xF3ria").optional(),publishedAt:le.coerce.date().optional(),document:le.any().refine(o=>o==null?!0:typeof o!="object"||typeof o.size!="number"?!1:o.size<=_c,`O documento deve ter no m\xE1ximo ${$s}MB.`).optional(),status:le.enum(Hc).optional()}),cr=class{constructor(e,r){this.regimentRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t,title:i,version:s,publishedAt:n,document:a,status:c}=ri.parse({id:e.params.id,...e.body,document:e.file}),l=await this.regimentRepository.findById(t);if(!l)throw new f("O regimento n\xE3o existe.");let T=l.documentUrl;return a&&(l.documentUrl&&await this.firebaseStorageService.deleteFile({fileUrl:l.documentUrl}),T=await this.firebaseStorageService.uploadFile({file:a,id:t,folder:A.REGIMENT})),await this.regimentRepository.update({id:t,title:i,version:s,publishedAt:n,documentUrl:T??void 0,status:c}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var oi=w.object({id:w.uuid(),title:w.string(),version:w.string(),publishedAt:w.date(),documentUrl:w.string(),status:w.enum(zc),createdAt:w.date(),updatedAt:w.date()}),Xs={method:"post",path:"/regiment",tags:["Regiments"],summary:"Create a new regiment with document upload",security:[{bearerAuth:[]}],request:{body:{content:{"multipart/form-data":{schema:Yo}}}},responses:{201:{description:"Regiment created successfully",summary:"Regiment Created"},400:{description:"Invalid input data, missing required fields, or invalid document format/size",summary:"Validation Error",content:{"application/json":{schema:w.object({errors:w.record(w.string(),w.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:w.object({message:w.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:w.object({message:w.string()})}}}}},Js={method:"get",path:"/regiment",tags:["Regiments"],summary:"List all regiments with pagination and filters",request:{query:ti},responses:{200:{description:"List of regiments retrieved successfully with pagination",summary:"Regiments Retrieved",content:{"application/json":{schema:w.object({page:w.number(),totalPages:w.number(),offset:w.number(),limit:w.number(),regiments:w.array(oi)})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:w.object({errors:w.record(w.string(),w.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:w.object({message:w.string()})}}}}},Qs={method:"get",path:"/regiment/{id}",tags:["Regiments"],summary:"Find regiment by ID",request:{params:nr},responses:{200:{description:"Regiment details retrieved successfully",summary:"Regiment Retrieved",content:{"application/json":{schema:oi}}},400:{description:"Invalid regiment ID format",summary:"Validation Error",content:{"application/json":{schema:w.object({errors:w.record(w.string(),w.string())})}}},404:{description:"Regiment not found with the provided ID",summary:"Regiment Not Found",content:{"application/json":{schema:w.object({message:w.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:w.object({message:w.string()})}}}}},en={method:"get",path:"/regiment/status/{status}",tags:["Regiments"],summary:"Find regiments by status",request:{params:ei},responses:{200:{description:"Regiments retrieved successfully by status",summary:"Regiments Retrieved by Status",content:{"application/json":{schema:w.array(oi)}}},400:{description:"Invalid status parameter provided",summary:"Validation Error",content:{"application/json":{schema:w.object({errors:w.record(w.string(),w.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:w.object({message:w.string()})}}}}},tn={method:"put",path:"/regiment/{id}",tags:["Regiments"],summary:"Update regiment with optional document upload",security:[{bearerAuth:[]}],request:{params:nr,body:{content:{"multipart/form-data":{schema:ri.omit({id:!0})}}}},responses:{200:{description:"Regiment updated successfully",summary:"Regiment Updated"},400:{description:"Invalid input data, regiment ID format, or invalid document format/size",summary:"Validation Error",content:{"application/json":{schema:w.object({errors:w.record(w.string(),w.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:w.object({message:w.string()})}}},404:{description:"Regiment not found with the provided ID",summary:"Regiment Not Found",content:{"application/json":{schema:w.object({message:w.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:w.object({message:w.string()})}}}}},rn={method:"delete",path:"/regiment/{id}",tags:["Regiments"],summary:"Delete regiment",security:[{bearerAuth:[]}],request:{params:Xo},responses:{200:{description:"Regiment deleted successfully",summary:"Regiment Deleted"},400:{description:"Invalid regiment ID format",summary:"Validation Error",content:{"application/json":{schema:w.object({errors:w.record(w.string(),w.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:w.object({message:w.string()})}}},404:{description:"Regiment not found with the provided ID",summary:"Regiment Not Found",content:{"application/json":{schema:w.object({message:w.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:w.object({message:w.string()})}}}}};import{$Enums as di}from"@prisma/client";import d from"zod";import{extendZodWithOpenApi as Wc}from"@asteasolutions/zod-to-openapi";import{Degree as Zc,Seniority as Vc}from"@prisma/client";import W from"zod";Wc(W);var ii=W.object({registrationNumber:W.string(),mainEtps:W.string().optional(),formations:W.string().optional(),degrees:W.array(W.enum(Zc)),occupations:W.string(),seniority:W.enum(Vc),institutions:W.string(),biography:W.string().optional(),userId:W.string()}),pr=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{registrationNumber:t,mainEtps:i,formations:s,degrees:n,occupations:a,seniority:c,institutions:l,biography:T,userId:x}=ii.parse(e.body);if(await this.researcherRepository.findByRegistrationNumber(t))throw new O("J\xE1 existe um pesquisador cadastrado com este n\xFAmero de registro.");if(await this.researcherRepository.findByUserId(x))throw new O("Usu\xE1rio j\xE1 possui um perfil de pesquisador.");return await this.researcherRepository.create({registrationNumber:t,mainEtps:i,formations:s,degrees:n,occupations:a,seniority:c,institutions:l,biography:T,userId:x}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Kc}from"@asteasolutions/zod-to-openapi";import si from"zod";Kc(si);var ni=si.object({id:si.uuid()}),dr=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{id:t}=ni.parse({id:e.params.id});if(!await this.researcherRepository.findById(t))throw new f("O pesquisador n\xE3o existe.");return await this.researcherRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Gc}from"@asteasolutions/zod-to-openapi";import ai from"zod";Gc(ai);var lr=ai.object({id:ai.uuid()}),ur=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{id:t}=lr.parse({id:e.params.id}),i=await this.researcherRepository.findById(t);if(!i)throw new f("O pesquisador n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Yc}from"@asteasolutions/zod-to-openapi";import mi from"zod";Yc(mi);var ci=mi.object({userId:mi.uuid()}),fr=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{userId:t}=ci.parse({userId:e.params.userId}),i=await this.researcherRepository.findByUserId(t);if(!i)throw new f("O pesquisador n\xE3o existe para este usu\xE1rio.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as $c}from"@asteasolutions/zod-to-openapi";import{Degree as Xc,Seniority as Jc}from"@prisma/client";import Z from"zod";$c(Z);var pi=Z.object({id:Z.uuid(),registrationNumber:Z.string().optional(),mainEtps:Z.string().optional(),formations:Z.string().optional(),degrees:Z.array(Z.enum(Xc)).optional(),occupations:Z.string().optional(),seniority:Z.enum(Jc).optional(),institutions:Z.string().optional(),biography:Z.string().optional()}),yr=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{id:t,registrationNumber:i,mainEtps:s,formations:n,degrees:a,occupations:c,seniority:l,institutions:T,biography:x}=pi.parse({id:e.params.id,...e.body}),q=await this.researcherRepository.findById(t);if(!q)throw new f("O pesquisador n\xE3o existe.");if(i&&i!==q.registrationNumber){let V=await this.researcherRepository.findByRegistrationNumber(i);if(V&&V.id!==t)throw new O("J\xE1 existe um pesquisador com este n\xFAmero de registro.")}return await this.researcherRepository.update({id:t,registrationNumber:i,mainEtps:s,formations:n,degrees:a,occupations:c,seniority:l,institutions:T,biography:x}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Qc=1,ep=9,ui=d.object({id:d.uuid(),registrationNumber:d.string(),mainEtps:d.string().nullable(),formations:d.string().nullable(),degrees:d.array(d.enum(di.Degree)),occupations:d.string(),seniority:d.enum(di.Seniority),institutions:d.string(),biography:d.string().nullable(),createdAt:d.date(),updatedAt:d.date(),userId:d.uuid(),user:d.object({id:d.uuid(),name:d.string(),emailAddress:d.string(),avatarUrl:d.string().nullable(),orcid:d.string().nullable(),phone:d.string().nullable(),lattesUrl:d.string().nullable(),role:d.enum(di.UserRole)})}),on={method:"post",path:"/researcher",tags:["Researchers"],summary:"Create a new researcher profile",security:[{bearerAuth:[]}],request:{body:{content:{"application/json":{schema:ii}}}},responses:{201:{description:"Researcher profile created successfully",summary:"Researcher Created",content:{"application/json":{schema:d.object({message:d.string()})}}},400:{description:"Invalid input data or missing required fields",summary:"Validation Error",content:{"application/json":{schema:d.object({errors:d.record(d.string(),d.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:d.object({message:d.string()})}}},409:{description:"Researcher with this registration number already exists or user already has a researcher profile",summary:"Conflict",content:{"application/json":{schema:d.object({message:d.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:d.object({message:d.string()})}}}}},sn={method:"get",path:"/researcher",tags:["Researchers"],summary:"List all researchers with pagination and filters",request:{query:d.object({page:d.coerce.number().min(1).default(Qc).optional(),limit:d.coerce.number().min(1).default(ep).optional(),userId:d.string().optional(),registrationNumber:d.string().optional(),name:d.string().optional(),emailAddress:d.string().optional(),mainEtps:d.string().optional(),formations:d.string().optional(),occupations:d.string().optional(),institutions:d.string().optional(),biography:d.string().optional(),orderBy:d.enum(["asc","desc"]).optional()})},responses:{200:{description:"List of researchers retrieved successfully with pagination",summary:"Researchers Retrieved",content:{"application/json":{schema:d.object({page:d.number(),totalPages:d.number(),offset:d.number(),limit:d.number(),researchers:d.array(ui)})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:d.object({message:d.string()})}}}}},nn={method:"get",path:"/researcher/{id}",tags:["Researchers"],summary:"Find researcher by ID",request:{params:lr},responses:{200:{description:"Researcher details retrieved successfully",summary:"Researcher Retrieved",content:{"application/json":{schema:ui}}},400:{description:"Invalid researcher ID format",summary:"Validation Error",content:{"application/json":{schema:d.object({errors:d.record(d.string(),d.string())})}}},404:{description:"Researcher not found with the provided ID",summary:"Researcher Not Found",content:{"application/json":{schema:d.object({message:d.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:d.object({message:d.string()})}}}}},an={method:"get",path:"/researcher/user/{userId}",tags:["Researchers"],summary:"Find researcher by user ID",request:{params:ci},responses:{200:{description:"Researcher details retrieved successfully",summary:"Researcher Retrieved",content:{"application/json":{schema:ui}}},400:{description:"Invalid user ID format",summary:"Validation Error",content:{"application/json":{schema:d.object({errors:d.record(d.string(),d.string())})}}},404:{description:"Researcher not found for this user",summary:"Researcher Not Found",content:{"application/json":{schema:d.object({message:d.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:d.object({message:d.string()})}}}}},mn={method:"put",path:"/researcher/{id}",tags:["Researchers"],summary:"Update researcher profile",security:[{bearerAuth:[]}],request:{params:lr,body:{content:{"application/json":{schema:pi.omit({id:!0})}}}},responses:{200:{description:"Researcher profile updated successfully",summary:"Researcher Updated",content:{"application/json":{schema:d.object({message:d.string()})}}},400:{description:"Invalid input data or researcher ID format",summary:"Validation Error",content:{"application/json":{schema:d.object({errors:d.record(d.string(),d.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:d.object({message:d.string()})}}},404:{description:"Researcher not found with the provided ID",summary:"Researcher Not Found",content:{"application/json":{schema:d.object({message:d.string()})}}},409:{description:"Researcher with this registration number already exists",summary:"Conflict",content:{"application/json":{schema:d.object({message:d.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:d.object({message:d.string()})}}}}},cn={method:"delete",path:"/researcher/{id}",tags:["Researchers"],summary:"Delete researcher profile",security:[{bearerAuth:[]}],request:{params:ni},responses:{200:{description:"Researcher profile deleted successfully",summary:"Researcher Deleted"},400:{description:"Invalid researcher ID format",summary:"Validation Error",content:{"application/json":{schema:d.object({errors:d.record(d.string(),d.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:d.object({message:d.string()})}}},404:{description:"Researcher not found with the provided ID",summary:"Researcher Not Found",content:{"application/json":{schema:d.object({message:d.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:d.object({message:d.string()})}}}}};import{$Enums as sp}from"@prisma/client";import v from"zod";import{extendZodWithOpenApi as tp}from"@asteasolutions/zod-to-openapi";import Le from"zod";tp(Le);var li=Le.object({role:Le.string().min(1),description:Le.string().optional(),userId:Le.uuid(),order:Le.number().optional()}),gr=class{constructor(e){this.sdhcTeamMemberRepository=e}async handle(e,r){try{let{role:t,description:i,userId:s,order:n}=li.parse(e.body);return await this.sdhcTeamMemberRepository.create({role:t,description:i,userId:s,order:n??0}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as rp}from"@asteasolutions/zod-to-openapi";import fi from"zod";rp(fi);var yi=fi.object({id:fi.uuid()}),hr=class{constructor(e){this.sdhcTeamMemberRepository=e}async handle(e,r){try{let{id:t}=yi.parse({id:e.params.id});if(!await this.sdhcTeamMemberRepository.findById(t))throw new f("O membro da equipe SDHC n\xE3o existe.");return await this.sdhcTeamMemberRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as op}from"@asteasolutions/zod-to-openapi";import gi from"zod";op(gi);var Ir=gi.object({id:gi.uuid()}),Rr=class{constructor(e){this.sdhcTeamMemberRepository=e}async handle(e,r){try{let{id:t}=Ir.parse({id:e.params.id}),i=await this.sdhcTeamMemberRepository.findById(t);if(!i)throw new f("O membro da equipe SDHC n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as ip}from"@asteasolutions/zod-to-openapi";import ve from"zod";ip(ve);var hi=ve.object({id:ve.uuid(),role:ve.string().min(1).optional(),description:ve.string().optional(),userId:ve.uuid().optional(),order:ve.number().optional()}),br=class{constructor(e){this.sdhcTeamMemberRepository=e}async handle(e,r){try{let{id:t,role:i,description:s,userId:n,order:a}=hi.parse({id:e.params.id,...e.body});if(!await this.sdhcTeamMemberRepository.findById(t))throw new f("O membro da equipe SDHC n\xE3o existe.");return await this.sdhcTeamMemberRepository.update({id:t,role:i,description:s,userId:n,order:a}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var np=v.object({id:v.uuid(),name:v.string(),emailAddress:v.string(),avatarUrl:v.string().nullable(),orcid:v.string().nullable(),phone:v.string().nullable(),lattesUrl:v.string().nullable(),role:v.enum(sp.UserRole)}),pn=v.object({id:v.uuid(),role:v.string(),description:v.string().nullable(),order:v.number(),createdAt:v.date(),updatedAt:v.date(),userId:v.uuid(),user:np}),dn={method:"post",path:"/sdhc-team-member",tags:["SDHC Team Members"],summary:"Create a new SDHC Team Member",security:[{bearerAuth:[]}],request:{body:{content:{"application/json":{schema:li}}}},responses:{201:{description:"SDHC Team Member created successfully",summary:"SDHC Team Member Created"},400:{description:"Invalid input data or missing required fields",summary:"Validation Error",content:{"application/json":{schema:v.object({errors:v.record(v.string(),v.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:v.object({message:v.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:v.object({message:v.string()})}}}}},un={method:"get",path:"/sdhc-team-member",tags:["SDHC Team Members"],summary:"List all SDHC Team Members with filters",request:{query:v.object({role:v.string().optional(),orderBy:v.enum(["asc","desc"]).optional()})},responses:{200:{description:"List of SDHC Team Members retrieved successfully",summary:"SDHC Team Members Retrieved",content:{"application/json":{schema:v.object({members:v.array(pn)})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:v.object({message:v.string()})}}}}},ln={method:"get",path:"/sdhc-team-member/{id}",tags:["SDHC Team Members"],summary:"Find SDHC Team Member by ID",request:{params:Ir},responses:{200:{description:"SDHC Team Member details retrieved successfully",summary:"SDHC Team Member Retrieved",content:{"application/json":{schema:pn}}},400:{description:"Invalid SDHC Team Member ID format",summary:"Validation Error",content:{"application/json":{schema:v.object({errors:v.record(v.string(),v.string())})}}},404:{description:"SDHC Team Member not found with the provided ID",summary:"SDHC Team Member Not Found",content:{"application/json":{schema:v.object({message:v.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:v.object({message:v.string()})}}}}},fn={method:"put",path:"/sdhc-team-member/{id}",tags:["SDHC Team Members"],summary:"Update SDHC Team Member",security:[{bearerAuth:[]}],request:{params:Ir,body:{content:{"application/json":{schema:hi.omit({id:!0})}}}},responses:{200:{description:"SDHC Team Member updated successfully",summary:"SDHC Team Member Updated"},400:{description:"Invalid input data or SDHC Team Member ID format",summary:"Validation Error",content:{"application/json":{schema:v.object({errors:v.record(v.string(),v.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:v.object({message:v.string()})}}},404:{description:"SDHC Team Member not found with the provided ID",summary:"SDHC Team Member Not Found",content:{"application/json":{schema:v.object({message:v.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:v.object({message:v.string()})}}}}},yn={method:"delete",path:"/sdhc-team-member/{id}",tags:["SDHC Team Members"],summary:"Delete SDHC Team Member",security:[{bearerAuth:[]}],request:{params:yi},responses:{200:{description:"SDHC Team Member deleted successfully",summary:"SDHC Team Member Deleted"},400:{description:"Invalid SDHC Team Member ID format",summary:"Validation Error",content:{"application/json":{schema:v.object({errors:v.record(v.string(),v.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:v.object({message:v.string()})}}},404:{description:"SDHC Team Member not found with the provided ID",summary:"SDHC Team Member Not Found",content:{"application/json":{schema:v.object({message:v.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:v.object({message:v.string()})}}}}};import{$Enums as Rn}from"@prisma/client";import j from"zod";import{extendZodWithOpenApi as ap}from"@asteasolutions/zod-to-openapi";import Ri from"zod";ap(Ri);var Ii=Ri.object({id:Ri.string()}),wr=class{constructor(e){this.userRepository=e}async handle(e,r){try{let{id:t}=Ii.parse({id:e.params.id}),i=await this.userRepository.findById(t);if(!i)throw new f("O usu\xE1rio n\xE3o existe.");let s=e.user.id;if(i.id!==s)throw new _("Voc\xEA n\xE3o tem permiss\xE3o para deletar o usu\xE1rio");return await this.userRepository.deleteById(i.id),r.sendStatus(204)}catch(t){if(console.log(t),t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as mp}from"@asteasolutions/zod-to-openapi";import{z as bi}from"zod";mp(bi);var wi=bi.object({id:bi.string().min(1,"id do usu\xE1rio n\xE3o fornecido.")}),Cr=class{constructor(e){this.userRepository=e}async handle(e,r){try{let{id:t}=wi.parse(e.params),i=await this.userRepository.findById(t);if(!i)throw new f("Usu\xE1rio n\xE3o encontrado");r.status(200).json(i)}catch(t){if(console.log(t),t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as cp}from"@asteasolutions/zod-to-openapi";import je from"zod";var hn=2,gn=1024,pp=gn*gn,dp=hn*pp,up=/^\d{4}-\d{4}-\d{4}-\d{4}$/,lp=/^\(?\d{2}\)?[\s-]?\d{4,5}-?\d{4}$/;cp(je);var Ci=je.object({name:je.string().optional(),lattesUrl:je.string().optional(),orcid:je.string().optional().transform(o=>o===void 0?void 0:o.trim()).refine(o=>o===void 0||o===""||up.test(o),{message:"ORCID inv\xE1lido. Deve estar no formato 0000-0000-0000-0000"}),phone:je.string().optional().refine(o=>o===void 0||o===""||lp.test(o),{message:"Telefone inv\xE1lido. Deve estar no formato (99) 99999-9999"}),avatarImage:je.any().refine(o=>o==null?!0:typeof o!="object"||typeof o.size!="number"?!1:o.size<=dp,`A imagem deve ter no m\xE1ximo ${hn}MB.`).optional()}),Sr=class{constructor(e,r){this.userRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{avatarImage:t,...i}=Ci.parse({...e.body,avatarImage:e.file}),s=e.user.id,n=await this.userRepository.findById(s);if(!n)throw new N("O usu\xE1rio n\xE3o existe");let a=n.avatarUrl;return t&&(n.avatarUrl?a=await this.firebaseStorageService.updateFile({file:t,id:s,folder:A.USER,fileUrl:n.avatarUrl}):a=await this.firebaseStorageService.uploadFile({file:t,id:s,folder:A.USER})),await this.userRepository.update({...i,id:s,avatarUrl:a||void 0}),r.sendStatus(204)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var In={method:"get",path:"/users/{id}",tags:["Users"],summary:"Find user by ID",request:{params:wi},responses:{200:{description:"User details retrieved successfully",summary:"User Retrieved",content:{"application/json":{schema:j.object({id:j.string(),name:j.string(),createdAt:j.date(),updatedAt:j.date(),role:j.enum(Rn.UserRole),lattesUrl:j.string().nullable(),orcid:j.string().nullable(),phone:j.string().nullable(),avatarUrl:j.url().nullable(),emailAddress:j.email()})}}},400:{description:"Invalid user ID format",summary:"Validation Error",content:{"application/json":{schema:j.object({errors:j.record(j.string(),j.string())})}}},404:{description:"User not found with the provided ID",summary:"User Not Found",content:{"application/json":{schema:j.object({message:j.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:j.object({message:j.string()})}}}}},bn={method:"put",path:"/users",tags:["Users"],summary:"Update authenticated user",security:[{bearerAuth:[]}],request:{body:{content:{"multipart/form-data":{schema:Ci}}}},responses:{200:{description:"User profile updated successfully",summary:"User Updated",content:{"application/json":{schema:j.object({message:j.string()})}}},400:{description:"Invalid input data or file format",summary:"Validation Error",content:{"application/json":{schema:j.object({errors:j.record(j.string(),j.string())})}}},401:{description:"User not authenticated or unauthorized",summary:"Authentication Required",content:{"application/json":{schema:j.object({message:j.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:j.object({message:j.string()})}}}}},wn={method:"delete",path:"/users",tags:["Users"],summary:"Delete authenticated user",security:[{bearerAuth:[]}],request:{params:Ii},responses:{200:{description:"User account deleted successfully",summary:"User Deleted",content:{"application/json":{schema:j.object({message:j.string()})}}},400:{description:"Invalid request parameters",summary:"Validation Error",content:{"application/json":{schema:j.object({errors:j.record(j.string(),j.string())})}}},401:{description:"User not authenticated or unauthorized",summary:"Authentication Required",content:{"application/json":{schema:j.object({message:j.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:j.object({message:j.string()})}}}}},Cn={method:"get",path:"/users",tags:["Users"],summary:"List users",responses:{200:{description:"Complete list of users retrieved successfully",summary:"Users Retrieved",content:{"application/json":{schema:j.array(j.object({id:j.string(),name:j.string(),createdAt:j.date(),updatedAt:j.date(),role:j.enum(Rn.UserRole),lattesUrl:j.url().nullable(),orcid:j.string().nullable(),phone:j.string().nullable(),avatarUrl:j.string().nullable(),emailAddress:j.email()}))}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:j.object({message:j.string()})}}}}};var I=new fp;I.registerComponent("securitySchemes","bearerAuth",{type:"http",scheme:"bearer",bearerFormat:"JWT"});I.registerPath(Hi);I.registerPath(Li);I.registerPath(_i);I.registerPath(zi);I.registerPath(Zi);I.registerPath(Vi);I.registerPath(Wi);I.registerPath(In);I.registerPath(bn);I.registerPath(wn);I.registerPath(Cn);I.registerPath(js);I.registerPath(Ts);I.registerPath(xs);I.registerPath(Ms);I.registerPath(Ki);I.registerPath(Gi);I.registerPath(Yi);I.registerPath($i);I.registerPath(Xi);I.registerPath(Ls);I.registerPath(_s);I.registerPath(zs);I.registerPath(Ws);I.registerPath(Zs);I.registerPath(ms);I.registerPath(cs);I.registerPath(ps);I.registerPath(ds);I.registerPath(us);I.registerPath(on);I.registerPath(sn);I.registerPath(nn);I.registerPath(an);I.registerPath(mn);I.registerPath(cn);I.registerPath(Qi);I.registerPath(es);I.registerPath(ts);I.registerPath(rs);I.registerPath(os);I.registerPath(qs);I.registerPath(Os);I.registerPath(Bs);I.registerPath(Ns);I.registerPath(ks);I.registerPath(bs);I.registerPath(ws);I.registerPath(Cs);I.registerPath(Ss);I.registerPath(Es);I.registerPath(dn);I.registerPath(un);I.registerPath(ln);I.registerPath(fn);I.registerPath(yn);I.registerPath(fs);I.registerPath(ys);I.registerPath(gs);I.registerPath(hs);I.registerPath(Rs);I.registerPath(Xs);I.registerPath(Js);I.registerPath(Qs);I.registerPath(en);I.registerPath(tn);I.registerPath(rn);var gp=new yp(I.definitions),Sn=gp.generateDocument({openapi:"3.0.0",info:{title:"API da Rede CT",version:"1.0.0",description:"API com valida\xE7\xE3o Zod"}});import{Router as Sp}from"express";import{extendZodWithOpenApi as hp}from"@asteasolutions/zod-to-openapi";import Si from"zod";hp(Si);var Rp=Si.object({authenticatedUserId:Si.uuid()}),Er=class{constructor(e){this.userRepository=e}async handle(e,r){try{let{authenticatedUserId:t}=Rp.parse({authenticatedUserId:e.user.id}),i=await this.userRepository.findById(t);if(!i)throw new f("Usu\xE1rio n\xE3o encontrado.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{PrismaClient as Ip}from"@prisma/client";var U=new Ip({log:["warn","error"]});var vr=class{constructor(e){this.prisma=e}async register({userId:e,title:r,description:t,certificationUrl:i}){await this.prisma.certification.create({data:{title:r,description:t,certificationUrl:i,user:{connect:{id:e}}}})}async find({pagination:{offset:e,limit:r},filter:{description:t,orderBy:i,title:s,userId:n}}){let a={};return n&&(a.userId=n),s&&(a.title={contains:s,mode:"insensitive"}),t&&(a.description={contains:t,mode:"insensitive"}),await this.prisma.certification.findMany({where:a,include:{user:{omit:{passwordHash:!0}}},orderBy:i?{updatedAt:i}:{updatedAt:"desc"},skip:e,take:r})}async findById(e){return await this.prisma.certification.findFirst({where:{id:e}})}async findByUserId({pagination:{limit:e,offset:r},filter:{description:t,orderBy:i,title:s},userId:n}){let a={userId:n};return s&&(a.title={contains:s,mode:"insensitive"}),t&&(a.description={contains:t,mode:"insensitive"}),await this.prisma.certification.findMany({where:a,include:{user:{omit:{passwordHash:!0}}},skip:r,take:e,orderBy:i?{updatedAt:i}:{updatedAt:"desc"}})}async update({id:e,...r}){await this.prisma.certification.update({where:{id:e},data:r})}async deleteById(e){await this.prisma.certification.delete({where:{id:e}})}async count({filter:{description:e,title:r,userId:t}}){let i={};r&&(i.title={contains:r,mode:"insensitive"});let s=[];return e&&s.push({description:{contains:e,mode:"insensitive"}}),t&&s.push({userId:t}),s.length>0&&(i.OR=s),await this.prisma.certification.count({where:i})}};function fe(){return new vr(U)}var jr=class{constructor(e){this.prisma=e}async create({authorId:e,...r}){return await this.prisma.news.create({data:{...r,author:{connect:{id:e}}}})}async find({pagination:{offset:e,limit:r},filter:{authorId:t,content:i,title:s,orderBy:n}}){let a={};t&&(a.authorId={contains:t,mode:"insensitive"});let c=[];return s&&c.push({title:{contains:s,mode:"insensitive"}}),i&&c.push({content:{contains:i,mode:"insensitive"}}),c.length>0&&(a.OR=c),await this.prisma.news.findMany({where:a,omit:{authorId:!0},include:{author:!0},orderBy:{updatedAt:n},skip:e,take:r})}async findById(e){return await this.prisma.news.findUnique({where:{id:e},omit:{authorId:!0},include:{author:!0}})}async findByAuthorId({authorId:e,pagination:{offset:r,limit:t},filter:{orderBy:i="desc",content:s,title:n}}){let a={authorId:e},c=[];return n&&c.push({title:{contains:n,mode:"insensitive"}}),s&&c.push({content:{contains:s,mode:"insensitive"}}),c.length>0&&(a.OR=c),await this.prisma.news.findMany({omit:{authorId:!0},where:a,orderBy:{updatedAt:i},skip:r,take:t})}async update(e){return await this.prisma.news.update({where:{id:e.id},data:{title:e.title,content:e.content,imageUrl:e.imageUrl}})}async delete(e){await this.prisma.news.delete({where:{id:e}})}async count({filter:{authorId:e,content:r,title:t}}){let i={};e&&(i.authorId={contains:e,mode:"insensitive"});let s=[];return t&&s.push({title:{contains:t,mode:"insensitive"}}),r&&s.push({content:{contains:r,mode:"insensitive"}}),s.length>0&&(i.OR=s),await this.prisma.news.count({where:i})}};function re(){return new jr(U)}var Tr=class{constructor(e){this.prisma=e}async create(e){await this.prisma.pendency.create({data:e})}async find({filter:{description:e,orderBy:r,title:t,status:i,userId:s},pagination:{limit:n,offset:a}}){let c={userId:s,AND:{status:{equals:i}}};e&&(c.description={contains:e,mode:"insensitive"});let l=[];return t&&l.push({title:{contains:t,mode:"insensitive"}}),l.length>0&&(c.OR=l),await this.prisma.pendency.findMany({where:c,orderBy:{updatedAt:r},include:{user:{omit:{passwordHash:!0}}},skip:a,take:n})}async findById(e){return await this.prisma.pendency.findFirst({where:{id:e},include:{user:{omit:{passwordHash:!0}}}})}async findByUserId({filter:{description:e,orderBy:r,title:t,status:i},pagination:{limit:s,offset:n},userId:a}){let c={userId:a,AND:{status:{equals:i}}},l=[];return e&&l.push({description:{contains:e,mode:"insensitive"}}),t&&l.push({title:{contains:t,mode:"insensitive"}}),l.length>0&&(c.OR=l),await this.prisma.pendency.findMany({where:c,orderBy:{updatedAt:r},include:{user:{omit:{passwordHash:!0}}},skip:n,take:s})}async update({id:e,...r}){await this.prisma.pendency.update({where:{id:e},data:r})}async deleteById(e){await this.prisma.pendency.delete({where:{id:e}})}async count({filter:{description:e,title:r,status:t,userId:i}}){let s={userId:i},n=[];return e&&n.push({description:{contains:e,mode:"insensitive"}}),r&&n.push({title:{contains:r,mode:"insensitive"}}),t&&n.push({status:{equals:t}}),n.length>0&&(s.OR=n),await this.prisma.pendency.count({where:s})}};function ye(){return new Tr(U)}var xr=class{constructor(e){this.prisma=e}async create(e){await this.prisma.user.create({data:e})}async update(e){await this.prisma.user.update({where:{id:e.id},data:{lattesUrl:e.lattesUrl??null,orcid:e.orcid??null,phone:e.phone??null,avatarUrl:e.avatarUrl??null}})}async deleteById(e){await this.prisma.user.delete({where:{id:e}})}async find(){return await this.prisma.user.findMany({omit:{passwordHash:!0}})}async findByEmail(e){return await this.prisma.user.findFirst({where:{emailAddress:e}})}async findById(e){return await this.prisma.user.findFirst({where:{id:e},omit:{passwordHash:!0}})}};function H(){return new xr(U)}import{compare as bp,hash as wp}from"bcryptjs";var Mr=class{constructor(e,r){this.hashFn=e;this.compareFn=r}async hash(e){return await this.hashFn(e,6)}async compare({password:e,hashedPassword:r}){return await this.compareFn(e,r)}};function Ei(){return new Mr(wp,bp)}import En from"jsonwebtoken";import L from"zod";var Cp=L.object({JWT_SECRET:L.string(),FIREBASE_BUCKET:L.string(),FIREBASE_CLIENT_EMAIL:L.string(),FIREBASE_PRIVATE_KEY:L.string(),FIREBASE_PROJECT_ID:L.string(),FIREBASE_TYPE:L.string(),FIREBASE_PRIVATE_KEY_ID:L.string(),FIREBASE_CLIENT_ID:L.string(),FIREBASE_AUTH_URI:L.string(),FIREBASE_TOKEN_URI:L.string(),FIREBASE_AUTH_PROVIDER_X509_CERT_URL:L.string(),FIREBASE_CLIENT_X509_CERT_URL:L.string()}),B=Cp.parse(process.env);var Pr=class{constructor(e,r){this.signFn=e;this.verifyFn=r}sign(e){try{return this.signFn(e,B.JWT_SECRET,{expiresIn:"3d",subject:e.id})}catch{return null}}verify(e){try{return this.verifyFn(e,B.JWT_SECRET)}catch{return null}}};function Ar(){return new Pr(En.sign,En.verify)}function vn(){return{signUpController:new mt(H(),Ei())}}function jn(){return{signInController:new nt(H(),Ei(),Ar())}}function Tn(){return{findAuthenticatedUserController:new Er(H())}}function xn(){return{findAuthenticatedUserController:new ot(re())}}function Mn(){return{findAuthenticatedUserCertificationsController:new rt(fe())}}function Pn(){return{findAuthenticatedUserPendenciesController:new it(ye())}}var Ur=class{constructor(e){this.jwtService=e}authenticated(e,r,t){let i=e.headers.authorization;if(!i?.startsWith("Bearer "))return r.status(401).json({message:"Token inv\xE1lido.",invalid:!0});let s=i.split(" ")[1];if(!s)return r.status(401).json({message:"Token n\xE3o fornecido."});try{let n=this.jwtService.verify(s);if(!n)return r.status(401).json({message:"Token inv\xE1lido.",invalid:!0});e.user=n,t()}catch(n){if(console.log(n),n instanceof Error)return r.status(401).json({message:n.message})}}isAdmin(e,r,t){let i=e.headers.authorization;if(!i?.startsWith("Bearer "))return r.status(401).json({message:"Token inv\xE1lido.",invalid:!0});let s=i.split(" ")[1];if(!s)return r.status(401).json({message:"Token n\xE3o fornecido."});try{let n=this.jwtService.verify(s);if(!n)return r.status(401).json({message:"Token inv\xE1lido.",invalid:!0});if(n.role!=="ADMIN")return r.status(401).json({message:"\xC9 necess\xE1rio ter permiss\xF5es de administrador."});t()}catch(n){if(console.log(n),n instanceof Error)return r.status(401).json({message:n.message})}}};function M(){return{authMiddleware:new Ur(Ar())}}var oe=Sp(),{authMiddleware:$e}=M();oe.post("/sign-up",async(o,e)=>{let{signUpController:r}=vn();await r.handle(o,e)});oe.post("/sign-in",async(o,e)=>{let{signInController:r}=jn();await r.handle(o,e)});oe.get("/user",(o,e,r)=>{$e.authenticated(o,e,r)},async(o,e)=>{let{findAuthenticatedUserController:r}=Tn();await r.handle(o,e)});oe.get("/user/news",(o,e,r)=>{$e.authenticated(o,e,r)},async(o,e)=>{let{findAuthenticatedUserController:r}=xn();await r.handle(o,e)});oe.get("/admin",(o,e,r)=>{$e.isAdmin(o,e,r)},(o,e)=>{try{e.status(200).json({success:!0})}catch(r){r instanceof Error&&e.status(500).json({message:r.message})}});oe.get("/certifications",(o,e,r)=>{$e.authenticated(o,e,r)},async(o,e)=>{let{findAuthenticatedUserCertificationsController:r}=Mn();await r.handle(o,e)});oe.get("/pendencies",(o,e,r)=>{$e.authenticated(o,e,r)},async(o,e)=>{let{findAuthenticatedUserPendenciesController:r}=Pn();await r.handle(o,e)});import{Router as Mp}from"express";import{getStorage as vp}from"firebase-admin/storage";import{config as Ep}from"dotenv";import An from"firebase-admin";Ep();var vi=An.initializeApp({credential:An.credential.cert({clientEmail:B.FIREBASE_CLIENT_EMAIL,privateKey:B.FIREBASE_PRIVATE_KEY,projectId:B.FIREBASE_PROJECT_ID,type:B.FIREBASE_TYPE,privateKeyId:B.FIREBASE_PRIVATE_KEY_ID,clientId:B.FIREBASE_CLIENT_ID,authUri:B.FIREBASE_AUTH_URI,tokenUri:B.FIREBASE_TOKEN_URI,authProviderX509CertUrl:B.FIREBASE_AUTH_PROVIDER_X509_CERT_URL,clientX509CertUrl:B.FIREBASE_CLIENT_X509_CERT_URL}),storageBucket:B.FIREBASE_BUCKET});vi.name?console.log("\u{1F525} Firebase conectado com sucesso!"):console.error("\u274C Erro ao se conectar ao Firebase.");var jp=vp(vi),Un=jp.bucket(B.FIREBASE_BUCKET);import{randomUUID as Tp}from"node:crypto";var xp=/https:\/\/storage\.googleapis\.com\/[^/]+\/(.+)$/,Dr=class{constructor(e){this.bucket=e}async uploadFile({file:e,folder:r,id:t}){let i=`${Tp()}-${e?.originalname}`,s=this.bucket.file(`${r}/${t}/${i}`);return await new Promise((n,a)=>{let c=s.createWriteStream({metadata:{contentType:e?.mimetype}});c.on("error",l=>{a(l)}),c.on("finish",async()=>{try{await s.makePublic();let l=`https://storage.googleapis.com/${this.bucket.name}/${s.name}`;n(l)}catch(l){a(l)}}),c.end(e.buffer)})}async updateFile({file:e,id:r,fileUrl:t,folder:i}){try{let s=this.getPath(t);if(!s)throw new Error("Arquivo n\xE3o encontrado.");let[n,a]=await Promise.all([this.bucket.file(s).delete(),this.uploadFile({file:e,id:r,folder:i})]);return a}catch{throw new Error("Erro ao atualizar o arquivo.")}}async deleteFile({fileUrl:e}){let r=this.getPath(e);if(!r)throw new Error("Arquivo n\xE3o encontrado.");try{await this.bucket.file(r).delete()}catch{throw new Error("Erro ao deletar o arquivo.")}}getPath(e){let r=e.match(xp);return r?r[1]:null}};function P(){return new Dr(Un)}function Dn(){return{registerCertificationController:new ut(H(),fe(),P())}}function Fn(){return{findCertificationsController:new dt(fe())}}function qn(){return{findCertificationByIdController:new pt(fe())}}function On(){return{updateCertificationController:new ft(fe(),P())}}function Bn(){return{deleteCertificationController:new ct(fe(),P())}}import Nn from"multer";var F=Nn({storage:Nn.memoryStorage()});var Te=Mp(),{authMiddleware:Xe}=M();Te.post("/:user_id",(o,e,r)=>{Xe.isAdmin(o,e,r)},F.single("certification"),async(o,e)=>{let{registerCertificationController:r}=Dn();await r.handle(o,e)});Te.get("/",(o,e,r)=>{Xe.isAdmin(o,e,r)},async(o,e)=>{let{findCertificationsController:r}=Fn();await r.handle(o,e)});Te.get("/:certification_id",(o,e,r)=>{Xe.isAdmin(o,e,r)},async(o,e)=>{let{findCertificationByIdController:r}=qn();await r.handle(o,e)});Te.put("/:certification_id",(o,e,r)=>{Xe.isAdmin(o,e,r)},F.single("certification"),async(o,e)=>{let{updateCertificationController:r}=On();await r.handle(o,e)});Te.delete("/:certification_id",(o,e,r)=>{Xe.isAdmin(o,e,r)},async(o,e)=>{let{deleteCertificationController:r}=Bn();await r.handle(o,e)});import{Router as Fp}from"express";import{extendZodWithOpenApi as Pp}from"@asteasolutions/zod-to-openapi";import ie from"zod";var Ap=1,Up=9;Pp(ie);var Dp=ie.object({page:ie.coerce.number().min(1).default(Ap),limit:ie.coerce.number().min(1).default(Up),code:ie.string().optional(),title:ie.string().optional(),description:ie.string().optional(),notes:ie.string().optional(),orderBy:ie.enum(["asc","desc"]).optional()}),Fr=class{constructor(e){this.etpRepository=e}async handle(e,r){try{let{page:t,limit:i,...s}=Dp.parse(e.query),n=i*t-i,[a,c]=await Promise.all([this.etpRepository.find({pagination:{offset:n,limit:i},filter:s}),this.etpRepository.count({filter:s})]),l=Math.max(Math.ceil(c/i),1);r.status(200).json({page:t,totalPages:l,offset:n,limit:i,etps:a})}catch(t){if(t instanceof Error)throw new m(t.message)}}};var qr=class{constructor(e){this.prisma=e}async create(e){let{leaderId:r,deputyLeaderId:t,secretaryId:i,memberIds:s,...n}=e;return await this.prisma.$transaction(async a=>{let c=await a.eTP.create({data:n});return await a.eTPLeader.create({data:{etpId:c.id,researcherId:r}}),await a.eTPDeputy.create({data:{etpId:c.id,researcherId:t}}),await a.eTPSecretary.create({data:{etpId:c.id,researcherId:i}}),await a.eTP.update({where:{id:c.id},data:{members:{connect:s.map(l=>({id:l}))}}}),c})}async update(e){let{leaderId:r,deputyLeaderId:t,secretaryId:i,memberIds:s,...n}=e;return await this.prisma.$transaction(async a=>{let c=await a.eTP.update({where:{id:e.id},data:n});return await this.updateLeader(a,e.id,r),await this.updateDeputyLeader(a,e.id,t),await this.updateSecretary(a,e.id,i),await this.updateMembers(a,e.id,s),c})}async updateLeader(e,r,t){t!==void 0&&(await e.eTPLeader.deleteMany({where:{etpId:r}}),t&&await e.eTPLeader.create({data:{etpId:r,researcherId:t}}))}async updateDeputyLeader(e,r,t){t!==void 0&&(await e.eTPDeputy.deleteMany({where:{etpId:r}}),t&&await e.eTPDeputy.create({data:{etpId:r,researcherId:t}}))}async updateSecretary(e,r,t){t!==void 0&&(await e.eTPSecretary.deleteMany({where:{etpId:r}}),t&&await e.eTPSecretary.create({data:{etpId:r,researcherId:t}}))}async updateMembers(e,r,t){t!==void 0&&await e.eTP.update({where:{id:r},data:{members:{set:t.map(i=>({id:i}))}}})}async deleteById(e){await this.prisma.eTP.delete({where:{id:e}})}async find({pagination:{offset:e,limit:r},filter:{code:t,title:i,description:s,notes:n,orderBy:a}}){let c={};return t&&(c.code={contains:t,mode:"insensitive"}),i&&(c.title={contains:i,mode:"insensitive"}),s&&(c.description={contains:s,mode:"insensitive"}),n&&(c.notes={contains:n,mode:"insensitive"}),await this.prisma.eTP.findMany({where:c,include:{leader:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},deputyLeader:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},secretary:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},members:{include:{user:{omit:{passwordHash:!0}}}}},orderBy:a?{updatedAt:a}:{updatedAt:"desc"},skip:e,take:r})}async findById(e){return await this.prisma.eTP.findFirst({where:{id:e},include:{leader:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},deputyLeader:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},secretary:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},members:{include:{user:{omit:{passwordHash:!0}}}}}})}async findByCode(e){return await this.prisma.eTP.findFirst({where:{code:e},include:{leader:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},deputyLeader:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},secretary:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},members:{include:{user:{omit:{passwordHash:!0}}}}}})}async count({filter:{code:e,title:r,description:t,notes:i}}){let s={};return e&&(s.code={contains:e,mode:"insensitive"}),r&&(s.title={contains:r,mode:"insensitive"}),t&&(s.description={contains:t,mode:"insensitive"}),i&&(s.notes={contains:i,mode:"insensitive"}),await this.prisma.eTP.count({where:s})}};function _e(){return new qr(U)}function kn(){return{createETPController:new gt(_e())}}function Hn(){return{findETPsController:new Fr(_e())}}function Ln(){return{findETPByIdController:new Rt(_e())}}function _n(){return{updateETPController:new bt(_e())}}function zn(){return{deleteETPController:new ht(_e())}}var xe=Fp(),{authMiddleware:ji}=M();xe.post("/",(o,e,r)=>{ji.authenticated(o,e,r)},async(o,e)=>{let{createETPController:r}=kn();await r.handle(o,e)});xe.get("/",async(o,e)=>{let{findETPsController:r}=Hn();await r.handle(o,e)});xe.get("/:id",async(o,e)=>{let{findETPByIdController:r}=Ln();await r.handle(o,e)});xe.put("/:id",(o,e,r)=>{ji.authenticated(o,e,r)},async(o,e)=>{let{updateETPController:r}=_n();await r.handle(o,e)});xe.delete("/:id",(o,e,r)=>{ji.authenticated(o,e,r)},async(o,e)=>{let{deleteETPController:r}=zn();await r.handle(o,e)});import{Router as qp}from"express";var Or=class{constructor(e){this.prisma=e}async create(e){return await this.prisma.inMemoriam.create({data:e})}async update(e){await this.prisma.inMemoriam.update({where:{id:e.id},data:e})}async deleteById(e){await this.prisma.inMemoriam.delete({where:{id:e}})}async find({pagination:{offset:e,limit:r},filter:{name:t,biography:i,role:s,orderBy:n}}){let a={};return t&&(a.name={contains:t,mode:"insensitive"}),i&&(a.biography={contains:i,mode:"insensitive"}),s&&(a.role=s),await this.prisma.inMemoriam.findMany({where:a,orderBy:n?{updatedAt:n}:{updatedAt:"desc"},skip:e,take:r})}async findById(e){return await this.prisma.inMemoriam.findFirst({where:{id:e}})}async findByRole(e){return await this.prisma.inMemoriam.findMany({where:{role:e}})}async count({filter:{name:e,biography:r,role:t}}){let i={};return e&&(i.name={contains:e,mode:"insensitive"}),r&&(i.biography={contains:r,mode:"insensitive"}),t&&(i.role=t),await this.prisma.inMemoriam.count({where:i})}};function Me(){return new Or(U)}function Wn(){return{createInMemoriamController:new Ct(Me(),P())}}function Zn(){return{findInMemoriamsController:new Tt(Me())}}function Vn(){return{findInMemoriamByIdController:new Et(Me())}}function Kn(){return{findInMemoriamByRoleController:new jt(Me())}}function Gn(){return{updateInMemoriamController:new xt(Me(),P())}}function Yn(){return{deleteInMemoriamController:new St(Me(),P())}}var ge=qp(),{authMiddleware:Ti}=M();ge.post("/",(o,e,r)=>{Ti.authenticated(o,e,r)},F.single("photo"),async(o,e)=>{let{createInMemoriamController:r}=Wn();await r.handle(o,e)});ge.get("/",async(o,e)=>{let{findInMemoriamsController:r}=Zn();await r.handle(o,e)});ge.get("/:id",async(o,e)=>{let{findInMemoriamByIdController:r}=Vn();await r.handle(o,e)});ge.get("/role/:role",async(o,e)=>{let{findInMemoriamByRoleController:r}=Kn();await r.handle(o,e)});ge.put("/:id",(o,e,r)=>{Ti.authenticated(o,e,r)},F.single("photo"),async(o,e)=>{let{updateInMemoriamController:r}=Gn();await r.handle(o,e)});ge.delete("/:id",(o,e,r)=>{Ti.authenticated(o,e,r)},async(o,e)=>{let{deleteInMemoriamController:r}=Yn();await r.handle(o,e)});import{Router as Op}from"express";var xi=Op();xi.get("/",(o,e)=>{e.status(200).json({message:"Rede CT"})});import{Router as kp}from"express";import{extendZodWithOpenApi as Bp}from"@asteasolutions/zod-to-openapi";import Br from"zod";Bp(Br);var Np=Br.object({role:Br.string().optional(),orderBy:Br.enum(["asc","desc"]).optional()}),Nr=class{constructor(e){this.legitimatorCommitteeMemberRepository=e}async handle(e,r){try{let t=Np.parse(e.query),i=await this.legitimatorCommitteeMemberRepository.find({filter:t});r.status(200).json({members:i})}catch(t){if(t instanceof Error)throw new m(t.message)}}};var kr=class{constructor(e){this.prisma=e}async create(e){await this.prisma.legitimatorCommitteeMember.create({data:{...e,order:e.order??0}})}async update(e){let{id:r,...t}=e;await this.prisma.legitimatorCommitteeMember.update({where:{id:r},data:t})}async deleteById(e){await this.prisma.legitimatorCommitteeMember.delete({where:{id:e}})}async find({filter:{role:e,orderBy:r}}){let t={};return e&&(t.role={contains:e,mode:"insensitive"}),await this.prisma.legitimatorCommitteeMember.findMany({where:t,include:{user:{omit:{passwordHash:!0}}},orderBy:r?[{order:"asc"},{updatedAt:r}]:[{order:"asc"},{updatedAt:"desc"}]})}async findById(e){return await this.prisma.legitimatorCommitteeMember.findFirst({where:{id:e},include:{user:{omit:{passwordHash:!0}}}})}async count({filter:{role:e}}){let r={};return e&&(r.role={contains:e,mode:"insensitive"}),await this.prisma.legitimatorCommitteeMember.count({where:r})}};function ze(){return new kr(U)}function $n(){return{createLegitimatorCommitteeMemberController:new Mt(ze())}}function Xn(){return{findLegitimatorCommitteeMembersController:new Nr(ze())}}function Jn(){return{findLegitimatorCommitteeMemberByIdController:new At(ze())}}function Qn(){return{updateLegitimatorCommitteeMemberController:new Dt(ze())}}function ea(){return{deleteLegitimatorCommitteeMemberController:new Pt(ze())}}var Pe=kp(),{authMiddleware:Mi}=M();Pe.post("/",(o,e,r)=>{Mi.authenticated(o,e,r)},async(o,e)=>{let{createLegitimatorCommitteeMemberController:r}=$n();await r.handle(o,e)});Pe.get("/",async(o,e)=>{let{findLegitimatorCommitteeMembersController:r}=Xn();await r.handle(o,e)});Pe.get("/:id",async(o,e)=>{let{findLegitimatorCommitteeMemberByIdController:r}=Jn();await r.handle(o,e)});Pe.put("/:id",(o,e,r)=>{Mi.authenticated(o,e,r)},async(o,e)=>{let{updateLegitimatorCommitteeMemberController:r}=Qn();await r.handle(o,e)});Pe.delete("/:id",(o,e,r)=>{Mi.authenticated(o,e,r)},async(o,e)=>{let{deleteLegitimatorCommitteeMemberController:r}=ea();await r.handle(o,e)});import{Router as _p}from"express";import{extendZodWithOpenApi as Hp}from"@asteasolutions/zod-to-openapi";import Je from"zod";Hp(Je);var Lp=Je.object({name:Je.string().optional(),description:Je.string().optional(),orderBy:Je.enum(["asc","desc"]).optional()}),Hr=class{constructor(e){this.managementTeamRepository=e}async handle(e,r){try{let t=Lp.parse(e.query),i=await this.managementTeamRepository.find({filter:t});r.status(200).json({teams:i})}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Lr=class{constructor(e){this.prisma=e}async create(e){let{members:r,...t}=e;await this.prisma.$transaction(async i=>{let s=await i.managementTeam.create({data:t});return await i.managementTeamMember.createMany({data:r.map(({userId:n,role:a,order:c})=>({teamId:s.id,userId:n,role:a,order:c??0}))}),s})}async update(e){let{members:r,...t}=e;await this.prisma.$transaction(async i=>{let s=await i.managementTeam.update({where:{id:e.id},data:t});return r!==void 0&&(await i.managementTeamMember.deleteMany({where:{teamId:e.id}}),r.length>0&&await i.managementTeamMember.createMany({data:r.map(({userId:n,role:a,order:c})=>({teamId:e.id,userId:n,role:a,order:c??0}))})),s})}async deleteById(e){await this.prisma.managementTeam.delete({where:{id:e}})}async find({filter:{name:e,description:r,orderBy:t}}){let i={};return e&&(i.name={contains:e,mode:"insensitive"}),r&&(i.description={contains:r,mode:"insensitive"}),await this.prisma.managementTeam.findMany({where:i,include:{members:{include:{user:{omit:{passwordHash:!0}}},orderBy:{order:"asc"}}},orderBy:t?{updatedAt:t}:{updatedAt:"desc"}})}async findById(e){return await this.prisma.managementTeam.findFirst({where:{id:e},include:{members:{include:{user:{omit:{passwordHash:!0}}},orderBy:{order:"asc"}}}})}async findByName(e){return await this.prisma.managementTeam.findFirst({where:{name:e},include:{members:{include:{user:{omit:{passwordHash:!0}}},orderBy:{order:"asc"}}}})}async count({filter:{name:e,description:r}}){let t={};return e&&(t.name={contains:e,mode:"insensitive"}),r&&(t.description={contains:r,mode:"insensitive"}),await this.prisma.managementTeam.count({where:t})}};function We(){return new Lr(U)}function ta(){return{createManagementTeamController:new Ft(We())}}function ra(){return{findManagementTeamsController:new Hr(We())}}function oa(){return{findManagementTeamByIdController:new Ot(We())}}function ia(){return{updateManagementTeamController:new Nt(We())}}function sa(){return{deleteManagementTeamController:new qt(We())}}var Ae=_p(),{authMiddleware:Pi}=M();Ae.post("/",(o,e,r)=>{Pi.authenticated(o,e,r)},async(o,e)=>{let{createManagementTeamController:r}=ta();await r.handle(o,e)});Ae.get("/",async(o,e)=>{let{findManagementTeamsController:r}=ra();await r.handle(o,e)});Ae.get("/:id",async(o,e)=>{let{findManagementTeamByIdController:r}=oa();await r.handle(o,e)});Ae.put("/:id",(o,e,r)=>{Pi.authenticated(o,e,r)},async(o,e)=>{let{updateManagementTeamController:r}=ia();await r.handle(o,e)});Ae.delete("/:id",(o,e,r)=>{Pi.authenticated(o,e,r)},async(o,e)=>{let{deleteManagementTeamController:r}=sa();await r.handle(o,e)});import{Router as $p}from"express";import{extendZodWithOpenApi as zp}from"@asteasolutions/zod-to-openapi";import Ai from"zod";zp(Ai);var Wp=Ai.object({id:Ai.string()}),_r=class{constructor(e,r){this.newsRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t}=Wp.parse(e.params),i=e.user.id,s=await this.newsRepository.findById(t);if(!s)throw new f("Not\xEDcia n\xE3o encontrada.");if(s.author.id!==i)throw new _("Sem permiss\xE3o.");await Promise.all([this.newsRepository.delete(t),this.firebaseStorageService.deleteFile({fileUrl:s.imageUrl})]),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Zp}from"@asteasolutions/zod-to-openapi";import Ze from"zod";var Vp=5,na=1024,Kp=na*na,Gp=Vp*Kp;Zp(Ze);var Yp=Ze.object({id:Ze.string(),title:Ze.string().min(1),content:Ze.string().min(1),image:Ze.any().optional().refine(o=>!o||typeof o=="object"&&typeof o.mimetype=="string"&&o.mimetype.startsWith("image/")&&typeof o.size=="number"&&o.size<=Gp,"A imagem deve ser uma imagem v\xE1lida de no m\xE1ximo 5MB.")}),zr=class{constructor(e,r){this.newsRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t,title:i,content:s,image:n}=Yp.parse({id:e.params.id,image:e.file,...e.body}),a=await this.newsRepository.findById(t);if(!a)throw new f("Not\xEDcia n\xE3o encontrada.");let c=e.user.id;if(a.author.id!==c)throw new _("Sem permiss\xE3o.");let l=a.imageUrl||"";n&&a.imageUrl&&(l=await this.firebaseStorageService.updateFile({file:n,folder:A.NEWS,id:t,fileUrl:a.imageUrl}));let T=await this.newsRepository.update({id:t,title:i,content:s,imageUrl:l});r.status(200).json(T)}catch(t){if(t instanceof Error)throw new m(t.message)}}};function aa(){return{createNewsController:new kt(re(),P())}}function ma(){return{findAllNewsController:new zt(re())}}function ca(){return{findNewsByIdController:new _t(re())}}function pa(){return{findNewsByAuthorIdController:new Ht(re())}}function da(){return{updateNewsController:new zr(re(),P())}}function ua(){return{deleteNewsController:new _r(re(),P())}}var he=$p(),{authMiddleware:Ui}=M();he.post("/",(o,e,r)=>{Ui.authenticated(o,e,r)},F.single("image"),async(o,e)=>{let{createNewsController:r}=aa();await r.handle(o,e)});he.get("/",async(o,e)=>{let{findAllNewsController:r}=ma();await r.handle(o,e)});he.get("/:id",async(o,e)=>{let{findNewsByIdController:r}=ca();await r.handle(o,e)});he.get("/author/:authorId",async(o,e)=>{let{findNewsByAuthorIdController:r}=pa();await r.handle(o,e)});he.put("/:id",(o,e,r)=>{Ui.authenticated(o,e,r)},F.single("image"),async(o,e)=>{let{updateNewsController:r}=da();await r.handle(o,e)});he.delete("/:id",(o,e,r)=>{Ui.authenticated(o,e,r)},async(o,e)=>{let{deleteNewsController:r}=ua();await r.handle(o,e)});import{Router as Xp}from"express";var Wr=class{constructor(e){this.prisma=e}async create(e){return await this.prisma.partner.create({data:e})}async update(e){await this.prisma.partner.update({where:{id:e.id},data:e})}async deleteById(e){await this.prisma.partner.delete({where:{id:e}})}async find({pagination:{offset:e,limit:r},filter:{name:t,description:i,category:s,isActive:n,orderBy:a}}){let c={};return t&&(c.name={contains:t,mode:"insensitive"}),i&&(c.description={contains:i,mode:"insensitive"}),s&&(c.category={contains:s,mode:"insensitive"}),n!==void 0&&(c.isActive=n),await this.prisma.partner.findMany({where:c,orderBy:a?{updatedAt:a}:{updatedAt:"desc"},skip:e,take:r})}async findById(e){return await this.prisma.partner.findFirst({where:{id:e}})}async count({filter:{name:e,description:r,category:t,isActive:i}}){let s={};return e&&(s.name={contains:e,mode:"insensitive"}),r&&(s.description={contains:r,mode:"insensitive"}),t&&(s.category={contains:t,mode:"insensitive"}),i!==void 0&&(s.isActive=i),await this.prisma.partner.count({where:s})}};function Ve(){return new Wr(U)}function la(){return{createPartnerController:new Wt(Ve(),P())}}function fa(){return{findPartnersController:new Gt(Ve())}}function ya(){return{findPartnerByIdController:new Vt(Ve())}}function ga(){return{updatePartnerController:new Yt(Ve(),P())}}function ha(){return{deletePartnerController:new Zt(Ve(),P())}}var Ue=Xp(),{authMiddleware:Di}=M();Ue.post("/",(o,e,r)=>{Di.authenticated(o,e,r)},F.single("logo"),async(o,e)=>{let{createPartnerController:r}=la();await r.handle(o,e)});Ue.get("/",async(o,e)=>{let{findPartnersController:r}=fa();await r.handle(o,e)});Ue.get("/:id",async(o,e)=>{let{findPartnerByIdController:r}=ya();await r.handle(o,e)});Ue.put("/:id",(o,e,r)=>{Di.authenticated(o,e,r)},F.single("logo"),async(o,e)=>{let{updatePartnerController:r}=ga();await r.handle(o,e)});Ue.delete("/:id",(o,e,r)=>{Di.authenticated(o,e,r)},async(o,e)=>{let{deletePartnerController:r}=ha();await r.handle(o,e)});import{Router as Jp}from"express";function Ra(){return{createPendencyController:new $t(H(),ye(),P())}}function Ia(){return{findPendenciesController:new Qt(ye())}}function ba(){return{findPendencyByIdController:new er(ye())}}function wa(){return{updatePendencyController:new tr(ye(),P())}}function Ca(){return{deletePendencyController:new Jt(ye(),P())}}var De=Jp(),{authMiddleware:Qe}=M();De.post("/:user_id",(o,e,r)=>{Qe.isAdmin(o,e,r)},F.single("document"),async(o,e)=>{let{createPendencyController:r}=Ra();await r.handle(o,e)});De.get("/",(o,e,r)=>{Qe.isAdmin(o,e,r)},async(o,e)=>{let{findPendenciesController:r}=Ia();await r.handle(o,e)});De.get("/:pendency_id",(o,e,r)=>{Qe.isAdmin(o,e,r)},async(o,e)=>{let{findPendencyByIdController:r}=ba();await r.handle(o,e)});De.put("/:pendency_id",(o,e,r)=>{Qe.isAdmin(o,e,r)},F.single("document"),async(o,e)=>{let{updatePendencyController:r}=wa();await r.handle(o,e)});De.delete("/:pendency_id",(o,e,r)=>{Qe.isAdmin(o,e,r)},async(o,e)=>{let{deletePendencyController:r}=Ca();await r.handle(o,e)});import{Router as Qp}from"express";var Zr=class{constructor(e){this.prisma=e}async create(e){return await this.prisma.regiment.create({data:e})}async update(e){await this.prisma.regiment.update({where:{id:e.id},data:e})}async deleteById(e){await this.prisma.regiment.delete({where:{id:e}})}async find({pagination:{offset:e,limit:r},filter:{title:t,status:i,orderBy:s}}){let n={};return t&&(n.title={contains:t,mode:"insensitive"}),i&&(n.status=i),await this.prisma.regiment.findMany({where:n,orderBy:s?{updatedAt:s}:{updatedAt:"desc"},skip:e,take:r})}async findById(e){return await this.prisma.regiment.findFirst({where:{id:e}})}async findByStatus(e){return await this.prisma.regiment.findMany({where:{status:e}})}async count({filter:{title:e,status:r}}){let t={};return e&&(t.title={contains:e,mode:"insensitive"}),r&&(t.status=r),await this.prisma.regiment.count({where:t})}};function Fe(){return new Zr(U)}function Sa(){return{createRegimentController:new or(Fe(),P())}}function Ea(){return{findRegimentsController:new mr(Fe())}}function va(){return{findRegimentByIdController:new sr(Fe())}}function ja(){return{findRegimentByStatusController:new ar(Fe())}}function Ta(){return{updateRegimentController:new cr(Fe(),P())}}function xa(){return{deleteRegimentController:new ir(Fe(),P())}}var Re=Qp(),{authMiddleware:Fi}=M();Re.post("/",(o,e,r)=>{Fi.authenticated(o,e,r)},F.single("document"),async(o,e)=>{let{createRegimentController:r}=Sa();await r.handle(o,e)});Re.get("/",async(o,e)=>{let{findRegimentsController:r}=Ea();await r.handle(o,e)});Re.get("/:id",async(o,e)=>{let{findRegimentByIdController:r}=va();await r.handle(o,e)});Re.get("/status/:status",async(o,e)=>{let{findRegimentByStatusController:r}=ja();await r.handle(o,e)});Re.put("/:id",(o,e,r)=>{Fi.authenticated(o,e,r)},F.single("document"),async(o,e)=>{let{updateRegimentController:r}=Ta();await r.handle(o,e)});Re.delete("/:id",(o,e,r)=>{Fi.authenticated(o,e,r)},async(o,e)=>{let{deleteRegimentController:r}=xa();await r.handle(o,e)});import{Router as id}from"express";import{extendZodWithOpenApi as ed}from"@asteasolutions/zod-to-openapi";import k from"zod";var td=1,rd=9;ed(k);var od=k.object({page:k.coerce.number().min(1).default(td),limit:k.coerce.number().min(1).default(rd),userId:k.string().optional(),registrationNumber:k.string().optional(),name:k.string().optional(),emailAddress:k.string().optional(),mainEtps:k.string().optional(),formations:k.string().optional(),occupations:k.string().optional(),institutions:k.string().optional(),biography:k.string().optional(),orderBy:k.enum(["asc","desc"]).optional()}),Vr=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{page:t,limit:i,...s}=od.parse(e.query),n=i*t-i,[a,c]=await Promise.all([this.researcherRepository.find({pagination:{offset:n,limit:i},filter:{userName:s.name,...s}}),this.researcherRepository.count({filter:{userName:s.name,...s}})]),l=Math.max(Math.ceil(c/i),1);r.status(200).json({page:t,totalPages:l,offset:n,limit:i,researchers:a})}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Kr=class{constructor(e){this.prisma=e}async create(e){await this.prisma.researcher.create({data:e})}async update(e){await this.prisma.researcher.update({where:{id:e.id},data:e})}async deleteById(e){await this.prisma.researcher.delete({where:{id:e}})}async find({pagination:{offset:e,limit:r},filter:{biography:t,degrees:i,formations:s,institutions:n,mainEtps:a,occupations:c,orderBy:l,registrationNumber:T,seniority:x,userId:q,userName:V}}){let Y={OR:V?[{user:{name:{contains:V,mode:"insensitive"}}}]:void 0};return T&&Y.OR?.push({registrationNumber:{contains:T,mode:"insensitive"}}),a&&(Y.mainEtps={contains:a,mode:"insensitive"}),s&&(Y.formations={contains:s,mode:"insensitive"}),i&&i.length>0&&(Y.degrees={hasSome:i}),c&&(Y.occupations={contains:c,mode:"insensitive"}),x&&(Y.seniority=x),n&&(Y.institutions={contains:n,mode:"insensitive"}),t&&(Y.biography={contains:t,mode:"insensitive"}),q&&(Y.userId={equals:q}),await this.prisma.researcher.findMany({where:Y,omit:{userId:!0},include:{user:{omit:{passwordHash:!0}}},orderBy:l?{updatedAt:l}:{updatedAt:"desc"},skip:e,take:r})}async findById(e){return await this.prisma.researcher.findFirst({where:{id:e},include:{user:{omit:{passwordHash:!0}}}})}async findByUserId(e){return await this.prisma.researcher.findFirst({where:{userId:e},include:{user:{omit:{passwordHash:!0}}}})}async findByRegistrationNumber(e){return await this.prisma.researcher.findFirst({where:{registrationNumber:e},include:{user:{omit:{passwordHash:!0}}}})}async count({filter:{biography:e,degrees:r,formations:t,institutions:i,mainEtps:s,occupations:n,registrationNumber:a,seniority:c,userId:l,userName:T}}){let x={OR:T?[{user:{name:{contains:T,mode:"insensitive"}}}]:void 0};return a&&x.OR?.push({registrationNumber:{contains:a,mode:"insensitive"}}),s&&(x.mainEtps={contains:s,mode:"insensitive"}),t&&(x.formations={contains:t,mode:"insensitive"}),r&&r.length>0&&(x.degrees={hasSome:r}),n&&(x.occupations={contains:n,mode:"insensitive"}),c&&(x.seniority=c),i&&(x.institutions={contains:i,mode:"insensitive"}),e&&(x.biography={contains:e,mode:"insensitive"}),l&&(x.userId={equals:l}),await this.prisma.researcher.count({where:x})}};function qe(){return new Kr(U)}function Ma(){return{createResearcherController:new pr(qe())}}function Pa(){return{findResearchersController:new Vr(qe())}}function Aa(){return{findResearcherByIdController:new ur(qe())}}function Ua(){return{findResearcherByUserIdController:new fr(qe())}}function Da(){return{updateResearcherController:new yr(qe())}}function Fa(){return{deleteResearcherController:new dr(qe())}}var Ie=id(),{authMiddleware:qi}=M();Ie.post("/",(o,e,r)=>{qi.authenticated(o,e,r)},async(o,e)=>{let{createResearcherController:r}=Ma();await r.handle(o,e)});Ie.get("/",async(o,e)=>{let{findResearchersController:r}=Pa();await r.handle(o,e)});Ie.get("/:id",async(o,e)=>{let{findResearcherByIdController:r}=Aa();await r.handle(o,e)});Ie.get("/user/:userId",async(o,e)=>{let{findResearcherByUserIdController:r}=Ua();await r.handle(o,e)});Ie.put("/:id",(o,e,r)=>{qi.authenticated(o,e,r)},async(o,e)=>{let{updateResearcherController:r}=Da();await r.handle(o,e)});Ie.delete("/:id",(o,e,r)=>{qi.authenticated(o,e,r)},async(o,e)=>{let{deleteResearcherController:r}=Fa();await r.handle(o,e)});import{Router as ad}from"express";import{extendZodWithOpenApi as sd}from"@asteasolutions/zod-to-openapi";import Gr from"zod";sd(Gr);var nd=Gr.object({role:Gr.string().optional(),orderBy:Gr.enum(["asc","desc"]).optional()}),Yr=class{constructor(e){this.sdhcTeamMemberRepository=e}async handle(e,r){try{let t=nd.parse(e.query),i=await this.sdhcTeamMemberRepository.find({filter:t});r.status(200).json({members:i})}catch(t){if(t instanceof Error)throw new m(t.message)}}};var $r=class{constructor(e){this.prisma=e}async create(e){await this.prisma.sDHCTeamMember.create({data:{...e,order:e.order??0}})}async update(e){let{id:r,...t}=e;await this.prisma.sDHCTeamMember.update({where:{id:r},data:t})}async deleteById(e){await this.prisma.sDHCTeamMember.delete({where:{id:e}})}async find({filter:{role:e,orderBy:r}}){let t={};return e&&(t.role={contains:e,mode:"insensitive"}),await this.prisma.sDHCTeamMember.findMany({where:t,include:{user:{omit:{passwordHash:!0}}},orderBy:r?[{order:"asc"},{updatedAt:r}]:[{order:"asc"},{updatedAt:"desc"}]})}async findById(e){return await this.prisma.sDHCTeamMember.findFirst({where:{id:e},include:{user:{omit:{passwordHash:!0}}}})}async count({filter:{role:e}}){let r={};return e&&(r.role={contains:e,mode:"insensitive"}),await this.prisma.sDHCTeamMember.count({where:r})}};function Ke(){return new $r(U)}function qa(){return{createSDHCTeamMemberController:new gr(Ke())}}function Oa(){return{findSDHCTeamMembersController:new Yr(Ke())}}function Ba(){return{findSDHCTeamMemberByIdController:new Rr(Ke())}}function Na(){return{updateSDHCTeamMemberController:new br(Ke())}}function ka(){return{deleteSDHCTeamMemberController:new hr(Ke())}}var Oe=ad(),{authMiddleware:Oi}=M();Oe.post("/",(o,e,r)=>{Oi.authenticated(o,e,r)},async(o,e)=>{let{createSDHCTeamMemberController:r}=qa();await r.handle(o,e)});Oe.get("/",async(o,e)=>{let{findSDHCTeamMembersController:r}=Oa();await r.handle(o,e)});Oe.get("/:id",async(o,e)=>{let{findSDHCTeamMemberByIdController:r}=Ba();await r.handle(o,e)});Oe.put("/:id",(o,e,r)=>{Oi.authenticated(o,e,r)},async(o,e)=>{let{updateSDHCTeamMemberController:r}=Na();await r.handle(o,e)});Oe.delete("/:id",(o,e,r)=>{Oi.authenticated(o,e,r)},async(o,e)=>{let{deleteSDHCTeamMemberController:r}=ka();await r.handle(o,e)});import{Router as md}from"express";var Xr=class{constructor(e){this.userRepository=e}async handle(e,r){try{let t=await this.userRepository.find();r.status(200).json(t)}catch(t){if(t instanceof Error)throw new m(t.message)}}};function Ha(){return{updateUserController:new Sr(H(),P())}}function La(){return{deleteUserController:new wr(H())}}function _a(){return{findUsersController:new Xr(H())}}function za(){return{findUserController:new Cr(H())}}var Ge=md(),{authMiddleware:Wa}=M();Ge.get("/:id",async(o,e)=>{let{findUserController:r}=za();await r.handle(o,e)});Ge.put("/",(o,e,r)=>{Wa.authenticated(o,e,r)},F.single("avatarImage"),async(o,e)=>{let{updateUserController:r}=Ha();await r.handle(o,e)});Ge.delete("/:id",(o,e,r)=>{Wa.authenticated(o,e,r)},async(o,e)=>{let{deleteUserController:r}=La();await r.handle(o,e)});Ge.get("/",async(o,e)=>{let{findUsersController:r}=_a();await r.handle(o,e)});var D=Bi(),dd={methods:["GET","POST","PUT","DELETE"],origin:["http://localhost:3000","https://rede-ct.vercel.app"],credentials:!0};D.use(pd(dd));D.use(Bi.json());D.use(Bi.urlencoded({extended:!1}));D.use("/docs",cd({content:Sn,theme:"kepler"}));D.use("/",xi);D.use("/auth",oe);D.use("/user",Ge);D.use("/news",he);D.use("/certification",Te);D.use("/pendency",De);D.use("/researcher",Ie);D.use("/in-memoriam",ge);D.use("/etp",xe);D.use("/partner",Ue);D.use("/management-team",Ae);D.use("/sdhc-team-member",Oe);D.use("/legitimator-committee-member",Pe);D.use("/regiment",Re);D.use((o,e,r,t)=>{let{errorHandler:i}=Ni();i.handle(o,e,r,t)});var ld=ud.createServer(D),Za=4e3;ld.listen(Za,()=>{console.log(`\u{1F680} Aplica\xE7\xE3o rodando na porta ${Za}.`)});

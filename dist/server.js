import bp from"node:http";import{apiReference as gp}from"@scalar/express-api-reference";import Rp from"cors";import li from"express";import na from"zod";var O=class extends Error{};var F=class extends Error{};var m=class extends Error{};var g=class extends Error{};var H=class extends Error{};import{ZodError as sa}from"zod";var Ye=class extends sa{};var Je=class{handle(e,r,t,i){return e instanceof Ye?t.status(400).json({message:"Validation error",error:na.treeifyError(e)}):e instanceof O?t.status(400).json({message:e.message}):e instanceof g?t.status(404).json({message:e.message}):e instanceof H?t.status(401).json({message:e.message}):e instanceof F?t.status(409).json({message:e.message}):e instanceof m?t.status(500).json({message:e.message}):t.status(500).json({message:"Internal server error"})}};function fi(){return{errorHandler:new Je}}import{OpenAPIRegistry as gc,OpenApiGeneratorV3 as Rc}from"@asteasolutions/zod-to-openapi";import{$Enums as yi}from"@prisma/client";import p from"zod";import{extendZodWithOpenApi as aa}from"@asteasolutions/zod-to-openapi";import ge from"zod";var ma=1,ca=6;aa(ge);var Br=ge.object({page:ge.coerce.number().min(1).default(ma),limit:ge.coerce.number().min(1).default(ca),title:ge.string().optional(),description:ge.string().optional(),orderBy:ge.enum(["asc","desc"]).default("desc")}),Xe=class{constructor(e){this.certificationRepository=e}async handle(e,r){try{let{title:t,description:i,limit:s,orderBy:n,page:a}=Br.parse(e.query),c=a*s-s,f=e.user.id,[T,j]=await Promise.all([this.certificationRepository.findByUserId({userId:f,pagination:{offset:c,limit:s},filter:{title:t,description:i,orderBy:n}}),this.certificationRepository.count({filter:{title:t,description:i,userId:f}})]),D=Math.max(Math.ceil(j/s),1);return r.status(200).json({page:a,totalPages:D,offset:c,limit:s,totalCertifications:j,certifications:T})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as pa}from"@asteasolutions/zod-to-openapi";import Re from"zod";var da=1,ua=7;pa(Re);var kr=Re.object({page:Re.coerce.number().min(1).default(da),limit:Re.coerce.number().min(1).default(ua),title:Re.string().optional(),content:Re.string().optional(),orderBy:Re.enum(["asc","desc"]).default("desc")}),Qe=class{constructor(e){this.newsRepository=e}async handle(e,r){try{let{page:t,limit:i,content:s,orderBy:n,title:a}=kr.parse(e.query),c=i*t-i,f=e.user.id,[T,j]=await Promise.all([this.newsRepository.findByAuthorId({authorId:f,pagination:{offset:c,limit:i},filter:{orderBy:n,title:a,content:s}}),this.newsRepository.count({filter:{authorId:f,content:s,title:a}})]),D=Math.ceil(j/i);r.status(200).json({page:t,totalPages:D,offset:c,limit:i,news:T})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as la}from"@asteasolutions/zod-to-openapi";import{PendencyStatus as fa}from"@prisma/client";import oe from"zod";var ya=1,ha=6;la(oe);var Lr=oe.object({page:oe.coerce.number().min(1).default(ya),limit:oe.coerce.number().min(1).default(ha),title:oe.string().optional(),description:oe.string().optional(),status:oe.enum(fa).default("PENDING"),orderBy:oe.enum(["asc","desc"]).default("desc")}),et=class{constructor(e){this.pendencyRepository=e}async handle(e,r){try{let{limit:t,page:i,...s}=Lr.parse(e.query),n=i*t-t,a=e.user.id,[c,f]=await Promise.all([this.pendencyRepository.findByUserId({userId:a,pagination:{offset:n,limit:t},filter:s}),this.pendencyRepository.count({filter:{...s,userId:a}})]),T=Math.max(Math.ceil(f/t),1);return r.status(200).json({page:i,totalPages:T,offset:n,limit:t,pendencies:c})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as ga}from"@asteasolutions/zod-to-openapi";import tt from"zod";ga(tt);var Hr=tt.object({password:tt.string(),email:tt.email()}),rt=class{constructor(e,r,t){this.userRepository=e;this.bcrypt=r;this.jwtService=t}async handle(e,r){try{let{email:t,password:i}=Hr.parse(e.body),s=await this.userRepository.findByEmail(t);if(!s)return r.status(401).json({message:"Usu\xE1rio n\xE3o existe."});if(!await this.bcrypt.compare({password:i,hashedPassword:s.passwordHash}))throw new H("Senha inv\xE1lida.");let{id:a,role:c}=s,f=this.jwtService.sign({id:a,role:c,email:t});return r.status(200).json({token:f})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Ra}from"@asteasolutions/zod-to-openapi";import Pe from"zod";var ot=8;Ra(Pe);var _r=Pe.object({name:Pe.string("Nome \xE9 obrigat\xF3rio.").min(1,"Nome \xE9 obrigat\xF3rio."),emailAddress:Pe.email("E-mail inv\xE1lido.").min(1,"E-mail \xE9 obrigat\xF3rio."),password:Pe.string("A senha \xE9 obrigat\xF3ria.").min(ot,`A senha deve ter pelo menos ${ot} caracteres.`),confirmPassword:Pe.string("A senha \xE9 obrigat\xF3ria.").min(ot,`A senha deve ter pelo menos ${ot} caracteres.`)}).refine(o=>o.password===o.confirmPassword,{message:"As senhas n\xE3o coincidem.",path:["confirmPassword"]}),it=class{constructor(e,r){this.userRepository=e;this.bcrypt=r}async handle(e,r){try{let{emailAddress:t,name:i,password:s}=_r.parse(e.body);if(await this.userRepository.findByEmail(t))throw new F("Usu\xE1rio j\xE1 existe.");let a=await this.bcrypt.hash(s);return await this.userRepository.create({name:i,emailAddress:t,passwordHash:a}),r.status(201).json()}catch(t){if(t instanceof Error)throw new m(t.message)}}};var hi={method:"post",path:"/auth/sign-up",tags:["Authentication"],summary:"Create a new user",request:{body:{content:{"application/json":{schema:_r}}}},responses:{201:{description:"User created successfully",summary:"User Registration Successful",content:{"application/json":{schema:p.object({message:p.string()})}}},400:{description:"Invalid input data provided",summary:"Validation Error",content:{"application/json":{schema:p.object({errors:p.record(p.string(),p.string())})}}},409:{description:"User already exists with this email",summary:"User Already Exists",content:{"application/json":{schema:p.object({message:p.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:p.object({message:p.string()})}}}}},gi={method:"post",path:"/auth/sign-in",tags:["Authentication"],summary:"Sign in",request:{body:{content:{"application/json":{schema:Hr}}}},responses:{200:{description:"Authentication successful, JWT token returned",summary:"Login Successful",content:{"application/json":{schema:p.object({token:p.string()})}}},400:{description:"Invalid credentials or input data",summary:"Validation Error",content:{"application/json":{schema:p.object({errors:p.record(p.string(),p.string())})}}},401:{description:"Invalid email or password",summary:"Authentication Failed",content:{"application/json":{schema:p.object({message:p.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:p.object({message:p.string()})}}}}},Ri={method:"get",path:"/auth/user",tags:["Authentication"],summary:"Search for authenticated user",security:[{bearerAuth:[]}],responses:{200:{description:"Authenticated user information retrieved successfully",summary:"User Information Retrieved",content:{"application/json":{schema:p.object({name:p.string(),id:p.string(),avatarUrl:p.string().nullable(),createdAt:p.date(),updatedAt:p.date(),emailAddress:p.string(),orcid:p.string().nullable(),phone:p.string().nullable(),lattesUrl:p.string().nullable(),role:p.enum(yi.UserRole)}).nullable()}}},400:{description:"Invalid request parameters",summary:"Validation Error",content:{"application/json":{schema:p.object({errors:p.record(p.string(),p.string())})}}},404:{description:"User not found or not authenticated",summary:"User Not Found",content:{"application/json":{schema:p.object({message:p.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:p.object({message:p.string()})}}}}},Ii={method:"get",path:"/auth/user/news",tags:["Authentication"],summary:"List authenticated user news",security:[{bearerAuth:[]}],request:{query:kr},responses:{200:{description:"Paginated list of authenticated user news retrieved successfully",summary:"User News Retrieved",content:{"application/json":{schema:p.object({page:p.number(),totalPages:p.number(),offset:p.number(),limit:p.number(),news:p.object({content:p.string(),id:p.string(),title:p.string(),createdAt:p.date(),updatedAt:p.date(),imageUrl:p.string().nullable()})})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:p.object({errors:p.record(p.string(),p.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:p.object({message:p.string()})}}}}},bi={method:"get",path:"/auth/admin",tags:["Authentication"],summary:"Verify admin access",security:[{bearerAuth:[]}],responses:{200:{description:"Admin access verified successfully",summary:"Admin Access Granted",content:{"application/json":{schema:p.object({success:p.boolean()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:p.object({message:p.string()})}}}}},wi={method:"get",path:"/auth/certifications",tags:["Authentication"],summary:"List all authenticated user's certifications",security:[{bearerAuth:[]}],request:{query:Br},responses:{200:{description:"Paginated list of authenticated user certifications retrieved successfully",summary:"User Certifications Retrieved",content:{"application/json":{schema:p.object({page:p.number(),totalPages:p.number(),offset:p.number(),limit:p.number(),certifications:p.object({description:p.string(),id:p.string(),title:p.string(),certificationUrl:p.string(),createdAt:p.date(),updatedAt:p.date(),userId:p.string()})})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:p.object({errors:p.record(p.string(),p.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:p.object({message:p.string()})}}}}},Ci={method:"get",path:"/auth/pendencies",tags:["Authentication"],summary:"List all authenticated user's pendencies",security:[{bearerAuth:[]}],request:{query:Lr},responses:{200:{description:"Paginated list of authenticated user pendencies retrieved successfully",summary:"User Pendencies Retrieved",content:{"application/json":{schema:p.object({page:p.number(),totalPages:p.number(),offset:p.number(),limit:p.number(),pendencies:p.object({id:p.string(),title:p.string(),description:p.string(),status:p.enum(yi.PendencyStatus),createdAt:p.date(),updatedAt:p.date(),userId:p.string()})})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:p.object({errors:p.record(p.string(),p.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:p.object({message:p.string()})}}}}};import{$Enums as Ta}from"@prisma/client";import y from"zod";import{extendZodWithOpenApi as Ia}from"@asteasolutions/zod-to-openapi";import zr from"zod";Ia(zr);var Wr=zr.object({id:zr.string()}),st=class{constructor(e,r){this.certificationRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t}=Wr.parse({id:e.params.certification_id}),i=await this.certificationRepository.findById(t);if(!i)throw new g("A certifica\xE7\xE3o n\xE3o existe.");return await Promise.all([this.certificationRepository.deleteById(i.id),this.firebaseStorageService.deleteFile({fileUrl:i.certificationUrl})]),r.sendStatus(204)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as ba}from"@asteasolutions/zod-to-openapi";import Zr from"zod";ba(Zr);var Vr=Zr.object({certificationId:Zr.uuid()}),nt=class{constructor(e){this.certificationRepository=e}async handle(e,r){try{let{certificationId:t}=Vr.parse({certificationId:e.params.certification_id}),i=await this.certificationRepository.findById(t);if(!i)throw new g("Certificado n\xE3o encontrado.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as wa}from"@asteasolutions/zod-to-openapi";import ie from"zod";var Ca=1,Ea=6;wa(ie);var Kr=ie.object({page:ie.coerce.number().min(1).default(Ca),limit:ie.coerce.number().min(1).default(Ea),title:ie.string().optional(),description:ie.string().optional(),userId:ie.uuid().optional(),orderBy:ie.enum(["asc","desc"]).default("desc")}),at=class{constructor(e){this.certificationRepository=e}async handle(e,r){try{let{limit:t,page:i,...s}=Kr.parse(e.query),n=i*t-t,[a,c]=await Promise.all([this.certificationRepository.find({pagination:{offset:n,limit:t},filter:s}),this.certificationRepository.count({filter:s})]),f=Math.max(Math.ceil(c/t),1);return r.status(200).json({page:i,totalPages:f,offset:n,limit:t,certifications:a})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Sa}from"@asteasolutions/zod-to-openapi";import Ae from"zod";var A={NEWS:"images/news",USER:"images/user",IN_MEMORIAM:"images/in-memoriam",PARTNER:"images/partners",CERTIFICATION:"documents/certifications",PENDENCY:"documents/pendencies"};Sa(Ae);var ct=Ae.object({userId:Ae.uuid(),title:Ae.string().min(1,"T\xEDtulo \xE9 obrigat\xF3rio."),description:Ae.string().min(1,"Descri\xE7\xE3o \xE9 obrigat\xF3ria."),certification:Ae.any().refine(o=>o&&typeof o=="object"&&o.size>0,"Arquivo do certificado \xE9 obrigat\xF3rio")}),mt=class{constructor(e,r,t){this.userRepository=e;this.certificationRepository=r;this.firebaseStorageService=t}async handle(e,r){try{let{userId:t,title:i,description:s,certification:n}=ct.parse({...e.body,userId:e.params.user_id,certification:e.file});if(!await this.userRepository.findById(t))throw new O("O usu\xE1rio n\xE3o existe.");let c=await this.firebaseStorageService.uploadFile({file:n,id:t,folder:A.CERTIFICATION});return await this.certificationRepository.register({userId:t,title:i,description:s,certificationUrl:c}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as va}from"@asteasolutions/zod-to-openapi";import Ue from"zod";va(Ue);var dt=Ue.object({id:Ue.uuid(),title:Ue.string().min(1,"T\xEDtulo \xE9 obrigat\xF3rio."),description:Ue.string().min(1,"Descri\xE7\xE3o \xE9 obrigat\xF3ria."),certification:Ue.any().refine(o=>o==null||typeof o=="object"&&typeof o.size=="number"&&(o.size===0||o.size>0),"Arquivo do certificado \xE9 inv\xE1lido").optional()}),pt=class{constructor(e,r){this.certificationRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{certification:t,id:i,...s}=dt.parse({...e.body,id:e.params.certification_id,certification:e.file}),n=await this.certificationRepository.findById(i);if(!n)throw new O("A certifica\xE7\xE3o n\xE3o existe");let a=n.certificationUrl;return t&&t.size>0&&(a=await this.firebaseStorageService.updateFile({file:t,id:n.userId,folder:A.CERTIFICATION,fileUrl:n.certificationUrl})),await this.certificationRepository.update({...s,id:i,certificationUrl:a}),r.sendStatus(204)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Ei={method:"post",path:"/certifications/{user_id}",tags:["Certifications"],summary:"Register certification for user",security:[{bearerAuth:[]}],request:{params:ct.pick({userId:!0}).transform(()=>({user_id:""})),body:{content:{"multipart/form-data":{schema:ct.omit({userId:!0})}}}},responses:{201:{description:"Certification registered successfully for the user",summary:"Certification Registered",content:{"application/json":{schema:y.object({message:y.string()})}}},400:{description:"Invalid input data or file format",summary:"Validation Error",content:{"application/json":{schema:y.object({errors:y.record(y.string(),y.string())})}}},404:{description:"User not found with the provided ID",summary:"User Not Found",content:{"application/json":{schema:y.object({message:y.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:y.object({message:y.string()})}}}}},Si={method:"get",path:"/certifications",tags:["Certifications"],summary:"List certifications",security:[{bearerAuth:[]}],request:{query:Kr},responses:{200:{description:"Paginated list of certifications with user information retrieved successfully",summary:"Certifications Retrieved",content:{"application/json":{schema:y.object({page:y.number(),totalPages:y.number(),offset:y.number(),limit:y.number(),certifications:y.array(y.object({description:y.string(),userId:y.string(),title:y.string(),id:y.string(),createdAt:y.date(),updatedAt:y.date(),certificationUrl:y.url(),user:y.object({id:y.uuid(),name:y.string(),createdAt:y.date(),updatedAt:y.date(),avatarUrl:y.string().nullable(),emailAddress:y.email(),orcid:y.string().nullable(),phone:y.string().nullable(),lattesUrl:y.url().nullable(),role:y.enum(Ta.UserRole)})}))})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:y.object({errors:y.record(y.string(),y.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:y.object({message:y.string()})}}}}},vi={method:"get",path:"/certifications/{certification_id}",tags:["Certifications"],summary:"Find certification by ID",security:[{bearerAuth:[]}],request:{params:Vr},responses:{200:{description:"Certification details retrieved successfully",summary:"Certification Retrieved",content:{"application/json":{schema:y.object({description:y.string(),userId:y.string(),title:y.string(),id:y.string(),createdAt:y.date(),updatedAt:y.date(),certificationUrl:y.url()}).nullable()}}},400:{description:"Invalid certification ID format",summary:"Validation Error",content:{"application/json":{schema:y.object({errors:y.record(y.string(),y.string())})}}},404:{description:"Certification not found with the provided ID",summary:"Certification Not Found",content:{"application/json":{schema:y.object({message:y.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:y.object({message:y.string()})}}}}},Ti={method:"put",path:"/certifications/{certification_id}",tags:["Certifications"],summary:"Update certification",security:[{bearerAuth:[]}],request:{params:dt.pick({id:!0}).transform(()=>({certification_id:""})),body:{content:{"multipart/form-data":{schema:dt.omit({id:!0})}}}},responses:{204:{description:"Certification updated successfully",summary:"Certification Updated"},400:{description:"Invalid input data or file format",summary:"Validation Error",content:{"application/json":{schema:y.object({errors:y.record(y.string(),y.string())})}}},404:{description:"Certification not found with the provided ID",summary:"Certification Not Found",content:{"application/json":{schema:y.object({message:y.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:y.object({message:y.string()})}}}}},ji={method:"delete",path:"/certifications/{certification_id}",tags:["Certifications"],summary:"Delete certification",security:[{bearerAuth:[]}],request:{params:Wr},responses:{204:{description:"Certification deleted successfully",summary:"Certification Deleted"},400:{description:"Invalid certification ID format",summary:"Validation Error",content:{"application/json":{schema:y.object({errors:y.record(y.string(),y.string())})}}},404:{description:"Certification not found with the provided ID",summary:"Certification Not Found",content:{"application/json":{schema:y.object({message:y.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:y.object({message:y.string()})}}}}};import{$Enums as Qr}from"@prisma/client";import u from"zod";import{extendZodWithOpenApi as ja}from"@asteasolutions/zod-to-openapi";import V from"zod";ja(V);var Gr=V.object({code:V.string(),title:V.string(),description:V.string().optional(),notes:V.string().optional(),leaderId:V.uuid(),deputyLeaderId:V.uuid(),secretaryId:V.uuid(),memberIds:V.array(V.uuid())}),ut=class{constructor(e){this.etpRepository=e}async handle(e,r){try{let{code:t,title:i,description:s,notes:n,leaderId:a,deputyLeaderId:c,secretaryId:f,memberIds:T}=Gr.parse(e.body);if(await this.etpRepository.findByCode(t))throw new F("J\xE1 existe um ETP cadastrado com este c\xF3digo.");return await this.etpRepository.create({code:t,title:i,description:s,notes:n,leaderId:a,deputyLeaderId:c,secretaryId:f,memberIds:T}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Ma}from"@asteasolutions/zod-to-openapi";import $r from"zod";Ma($r);var Yr=$r.object({id:$r.uuid()}),lt=class{constructor(e){this.etpRepository=e}async handle(e,r){try{let{id:t}=Yr.parse({id:e.params.id});if(!await this.etpRepository.findById(t))throw new g("O ETP n\xE3o existe.");return await this.etpRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as xa}from"@asteasolutions/zod-to-openapi";import Jr from"zod";xa(Jr);var yt=Jr.object({id:Jr.uuid()}),ft=class{constructor(e){this.etpRepository=e}async handle(e,r){try{let{id:t}=yt.parse({id:e.params.id}),i=await this.etpRepository.findById(t);if(!i)throw new g("O ETP n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Pa}from"@asteasolutions/zod-to-openapi";import _ from"zod";Pa(_);var Xr=_.object({id:_.uuid(),code:_.string().optional(),title:_.string().optional(),description:_.string().optional(),notes:_.string().optional(),leaderId:_.uuid().optional(),deputyLeaderId:_.uuid().optional(),secretaryId:_.uuid().optional(),memberIds:_.array(_.uuid()).optional()}),ht=class{constructor(e){this.etpRepository=e}async handle(e,r){try{let{id:t,code:i,title:s,description:n,notes:a,leaderId:c,deputyLeaderId:f,secretaryId:T,memberIds:j}=Xr.parse({id:e.params.id,...e.body});if(!await this.etpRepository.findById(t))throw new g("O ETP n\xE3o existe.");if(i){let Z=await this.etpRepository.findByCode(i);if(Z&&Z.id!==t)throw new F("J\xE1 existe um ETP com este c\xF3digo.")}return await this.etpRepository.update({id:t,code:i,title:s,description:n,notes:a,leaderId:c,deputyLeaderId:f,secretaryId:T,memberIds:j}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Aa=1,Ua=9,gt=u.object({id:u.uuid(),registrationNumber:u.string(),mainEtps:u.string().nullable(),formations:u.string().nullable(),degrees:u.array(u.enum(Qr.Degree)),occupations:u.string(),seniority:u.enum(Qr.Seniority),institutions:u.string(),biography:u.string().nullable(),createdAt:u.date(),updatedAt:u.date(),user:u.object({id:u.uuid(),name:u.string(),emailAddress:u.string(),avatarUrl:u.string().nullable(),orcid:u.string().nullable(),phone:u.string().nullable(),lattesUrl:u.string().nullable(),role:u.enum(Qr.UserRole)})}),Mi=u.object({id:u.uuid(),code:u.string(),title:u.string(),description:u.string().nullable(),notes:u.string().nullable(),createdAt:u.date(),updatedAt:u.date(),leader:u.object({id:u.uuid(),researcher:gt}).nullable(),deputyLeader:u.object({id:u.uuid(),researcher:gt}).nullable(),secretary:u.object({id:u.uuid(),researcher:gt}).nullable(),members:u.array(gt)}),xi={method:"post",path:"/etp",tags:["ETPs"],summary:"Create a new ETP with single leader, deputy leader, secretary and multiple members",security:[{bearerAuth:[]}],request:{body:{content:{"application/json":{schema:Gr}}}},responses:{201:{description:"ETP created successfully",summary:"ETP Created"},400:{description:"Invalid input data or missing required fields",summary:"Validation Error",content:{"application/json":{schema:u.object({errors:u.record(u.string(),u.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:u.object({message:u.string()})}}},409:{description:"ETP with this code already exists",summary:"Conflict",content:{"application/json":{schema:u.object({message:u.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:u.object({message:u.string()})}}}}},Pi={method:"get",path:"/etp",tags:["ETPs"],summary:"List all ETPs with pagination and filters",request:{query:u.object({page:u.coerce.number().min(1).default(Aa).optional(),limit:u.coerce.number().min(1).default(Ua).optional(),code:u.string().optional(),title:u.string().optional(),description:u.string().optional(),notes:u.string().optional(),orderBy:u.enum(["asc","desc"]).optional()})},responses:{200:{description:"List of ETPs retrieved successfully with pagination",summary:"ETPs Retrieved",content:{"application/json":{schema:u.object({page:u.number(),totalPages:u.number(),offset:u.number(),limit:u.number(),etps:u.array(Mi)})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:u.object({message:u.string()})}}}}},Ai={method:"get",path:"/etp/{id}",tags:["ETPs"],summary:"Find ETP by ID",request:{params:yt},responses:{200:{description:"ETP details retrieved successfully",summary:"ETP Retrieved",content:{"application/json":{schema:Mi}}},400:{description:"Invalid ETP ID format",summary:"Validation Error",content:{"application/json":{schema:u.object({errors:u.record(u.string(),u.string())})}}},404:{description:"ETP not found with the provided ID",summary:"ETP Not Found",content:{"application/json":{schema:u.object({message:u.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:u.object({message:u.string()})}}}}},Ui={method:"put",path:"/etp/{id}",tags:["ETPs"],summary:"Update ETP and manage user relationships (single leader, deputy leader, secretary, multiple members)",security:[{bearerAuth:[]}],request:{params:yt,body:{content:{"application/json":{schema:Xr.omit({id:!0})}}}},responses:{200:{description:"ETP updated successfully",summary:"ETP Updated"},400:{description:"Invalid input data or ETP ID format",summary:"Validation Error",content:{"application/json":{schema:u.object({errors:u.record(u.string(),u.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:u.object({message:u.string()})}}},404:{description:"ETP not found with the provided ID",summary:"ETP Not Found",content:{"application/json":{schema:u.object({message:u.string()})}}},409:{description:"ETP with this code already exists",summary:"Conflict",content:{"application/json":{schema:u.object({message:u.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:u.object({message:u.string()})}}}}},Di={method:"delete",path:"/etp/{id}",tags:["ETPs"],summary:"Delete ETP",security:[{bearerAuth:[]}],request:{params:Yr},responses:{200:{description:"ETP deleted successfully",summary:"ETP Deleted"},400:{description:"Invalid ETP ID format",summary:"Validation Error",content:{"application/json":{schema:u.object({errors:u.record(u.string(),u.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:u.object({message:u.string()})}}},404:{description:"ETP not found with the provided ID",summary:"ETP Not Found",content:{"application/json":{schema:u.object({message:u.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:u.object({message:u.string()})}}}}};import{InMemoriamRole as $a}from"@prisma/client";import h from"zod";import{extendZodWithOpenApi as Da}from"@asteasolutions/zod-to-openapi";import{InMemoriamRole as Fa}from"@prisma/client";import se from"zod";var qi=2,Fi=1024,qa=Fi*Fi,Na=qi*qa;Da(se);var eo=se.object({name:se.string().min(1,"Nome \xE9 obrigat\xF3rio"),birthDate:se.coerce.date(),deathDate:se.coerce.date(),biography:se.string().optional(),photo:se.any().refine(o=>o==null?!0:typeof o!="object"||typeof o.size!="number"?!1:o.size<=Na,`A imagem deve ter no m\xE1ximo ${qi}MB.`).optional(),role:se.enum(Fa)}).refine(o=>o.deathDate>o.birthDate,{message:"Data de falecimento deve ser posterior \xE0 data de nascimento",path:["deathDate"]}),Rt=class{constructor(e,r){this.inMemoriamRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{name:t,birthDate:i,deathDate:s,biography:n,role:a,photo:c}=eo.parse({...e.body,photo:e.file}),f=await this.inMemoriamRepository.create({name:t,birthDate:i,deathDate:s,biography:n??void 0,role:a}),T;return c&&(T=await this.firebaseStorageService.uploadFile({file:c,id:f.id,folder:A.IN_MEMORIAM}),await this.inMemoriamRepository.update({id:f.id,photoUrl:T})),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Oa}from"@asteasolutions/zod-to-openapi";import to from"zod";Oa(to);var ro=to.object({id:to.uuid()}),It=class{constructor(e,r){this.inMemoriamRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t}=ro.parse({id:e.params.id}),i=await this.inMemoriamRepository.findById(t);if(!i)throw new g("O in memoriam n\xE3o existe.");return i.photoUrl&&this.firebaseStorageService.deleteFile({fileUrl:i.photoUrl}),await this.inMemoriamRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Ba}from"@asteasolutions/zod-to-openapi";import oo from"zod";Ba(oo);var wt=oo.object({id:oo.uuid()}),bt=class{constructor(e){this.inMemoriamRepository=e}async handle(e,r){try{let{id:t}=wt.parse({id:e.params.id}),i=await this.inMemoriamRepository.findById(t);if(!i)throw new g("O in memoriam n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as ka}from"@asteasolutions/zod-to-openapi";import{InMemoriamRole as La}from"@prisma/client";import io from"zod";ka(io);var so=io.object({role:io.enum(La)}),Ct=class{constructor(e){this.inMemoriamRepository=e}async handle(e,r){try{let{role:t}=so.parse({role:e.params.role}),i=await this.inMemoriamRepository.findByRole(t);return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Ha}from"@asteasolutions/zod-to-openapi";import{InMemoriamRole as _a}from"@prisma/client";import ne from"zod";var za=1,Wa=9;Ha(ne);var no=ne.object({page:ne.coerce.number().min(1).default(za),limit:ne.coerce.number().min(1).default(Wa),name:ne.string().optional(),biography:ne.string().optional(),role:ne.enum(_a).optional(),orderBy:ne.enum(["asc","desc"]).optional()}),Et=class{constructor(e){this.inMemoriamRepository=e}async handle(e,r){try{let{page:t,limit:i,...s}=no.parse(e.query),n=i*t-i,[a,c]=await Promise.all([this.inMemoriamRepository.find({pagination:{offset:n,limit:i},filter:s}),this.inMemoriamRepository.count({filter:s})]),f=Math.max(Math.ceil(c/i),1);r.status(200).json({page:t,totalPages:f,offset:n,limit:i,inMemoriam:a})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Za}from"@asteasolutions/zod-to-openapi";import{InMemoriamRole as Va}from"@prisma/client";import Y from"zod";var Oi=2,Ni=1024,Ka=Ni*Ni,Ga=Oi*Ka;Za(Y);var ao=Y.object({id:Y.uuid(),name:Y.string().min(1,"Nome \xE9 obrigat\xF3rio").optional(),birthDate:Y.coerce.date().optional(),deathDate:Y.coerce.date().optional(),biography:Y.string().optional(),photo:Y.any().refine(o=>o==null?!0:typeof o!="object"||typeof o.size!="number"?!1:o.size<=Ga,`A imagem deve ter no m\xE1ximo ${Oi}MB.`).optional(),role:Y.enum(Va).optional()}).refine(o=>o.birthDate&&o.deathDate?o.deathDate>o.birthDate:!0,{message:"Data de falecimento deve ser posterior \xE0 data de nascimento",path:["deathDate"]}),St=class{constructor(e,r){this.inMemoriamRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t,name:i,birthDate:s,deathDate:n,biography:a,photo:c,role:f}=ao.parse({id:e.params.id,...e.body,photo:e.file}),T=await this.inMemoriamRepository.findById(t);if(!T)throw new g("O registro in memoriam n\xE3o existe.");let j=T.photoUrl;return c&&(j=await this.firebaseStorageService.uploadFile({file:c,id:t,folder:A.IN_MEMORIAM})),await this.inMemoriamRepository.update({id:t,name:i,birthDate:s,deathDate:n,biography:a,photoUrl:j??void 0,role:f}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var mo=h.object({id:h.uuid(),name:h.string(),birthDate:h.date(),deathDate:h.date(),biography:h.string().nullable(),photoUrl:h.string().nullable(),role:h.enum($a),createdAt:h.date(),updatedAt:h.date()}),Bi={method:"post",path:"/in-memoriam",tags:["In Memoriam"],summary:"Create a new in memoriam record with optional photo upload",security:[{bearerAuth:[]}],request:{body:{content:{"multipart/form-data":{schema:eo}}}},responses:{201:{description:"In memoriam record created successfully",summary:"In Memoriam Created"},400:{description:"Invalid input data, missing required fields, or invalid photo format/size",summary:"Validation Error",content:{"application/json":{schema:h.object({errors:h.record(h.string(),h.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:h.object({message:h.string()})}}},409:{description:"In memoriam record with this name already exists",summary:"Conflict",content:{"application/json":{schema:h.object({message:h.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:h.object({message:h.string()})}}}}},ki={method:"get",path:"/in-memoriam",tags:["In Memoriam"],summary:"List all in memoriam records with pagination and filters",request:{query:no},responses:{200:{description:"List of in memoriam records retrieved successfully with pagination",summary:"In Memoriam Records Retrieved",content:{"application/json":{schema:h.object({page:h.number(),totalPages:h.number(),offset:h.number(),limit:h.number(),inMemoriam:h.array(mo)})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:h.object({errors:h.record(h.string(),h.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:h.object({message:h.string()})}}}}},Li={method:"get",path:"/in-memoriam/{id}",tags:["In Memoriam"],summary:"Find in memoriam record by ID",request:{params:wt},responses:{200:{description:"In memoriam record details retrieved successfully",summary:"In Memoriam Record Retrieved",content:{"application/json":{schema:mo}}},400:{description:"Invalid in memoriam record ID format",summary:"Validation Error",content:{"application/json":{schema:h.object({errors:h.record(h.string(),h.string())})}}},404:{description:"In memoriam record not found with the provided ID",summary:"In Memoriam Record Not Found",content:{"application/json":{schema:h.object({message:h.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:h.object({message:h.string()})}}}}},Hi={method:"put",path:"/in-memoriam/{id}",tags:["In Memoriam"],summary:"Update in memoriam record with optional photo upload",security:[{bearerAuth:[]}],request:{params:wt,body:{content:{"multipart/form-data":{schema:ao.omit({id:!0})}}}},responses:{200:{description:"In memoriam record updated successfully",summary:"In Memoriam Record Updated"},400:{description:"Invalid input data, in memoriam record ID format, or invalid photo format/size",summary:"Validation Error",content:{"application/json":{schema:h.object({errors:h.record(h.string(),h.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:h.object({message:h.string()})}}},404:{description:"In memoriam record not found with the provided ID",summary:"In Memoriam Record Not Found",content:{"application/json":{schema:h.object({message:h.string()})}}},409:{description:"In memoriam record with this name already exists",summary:"Conflict",content:{"application/json":{schema:h.object({message:h.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:h.object({message:h.string()})}}}}},_i={method:"delete",path:"/in-memoriam/{id}",tags:["In Memoriam"],summary:"Delete in memoriam record",security:[{bearerAuth:[]}],request:{params:ro},responses:{200:{description:"In memoriam record deleted successfully",summary:"In Memoriam Record Deleted"},400:{description:"Invalid in memoriam record ID format",summary:"Validation Error",content:{"application/json":{schema:h.object({errors:h.record(h.string(),h.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:h.object({message:h.string()})}}},404:{description:"In memoriam record not found with the provided ID",summary:"In Memoriam Record Not Found",content:{"application/json":{schema:h.object({message:h.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:h.object({message:h.string()})}}}}},Fl={method:"get",path:"/in-memoriam/role/{role}",tags:["In Memoriam"],summary:"Find in memoriam records by role",request:{params:so},responses:{200:{description:"In memoriam records retrieved successfully by role",summary:"In Memoriam Records Retrieved by Role",content:{"application/json":{schema:h.array(mo)}}},400:{description:"Invalid role parameter provided",summary:"Validation Error",content:{"application/json":{schema:h.object({errors:h.record(h.string(),h.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:h.object({message:h.string()})}}}}};import{$Enums as em}from"@prisma/client";import b from"zod";import{extendZodWithOpenApi as Ya}from"@asteasolutions/zod-to-openapi";import We from"zod";Ya(We);var co=We.object({role:We.string().min(1),description:We.string().optional(),userId:We.uuid()}),vt=class{constructor(e){this.legitimatorCommitteeMemberRepository=e}async handle(e,r){try{let{role:t,description:i,userId:s}=co.parse(e.body);return await this.legitimatorCommitteeMemberRepository.create({role:t,description:i,userId:s}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Ja}from"@asteasolutions/zod-to-openapi";import po from"zod";Ja(po);var uo=po.object({id:po.uuid()}),Tt=class{constructor(e){this.legitimatorCommitteeMemberRepository=e}async handle(e,r){try{let{id:t}=uo.parse({id:e.params.id});if(!await this.legitimatorCommitteeMemberRepository.findById(t))throw new g("O membro do comit\xEA legitimador n\xE3o existe.");return await this.legitimatorCommitteeMemberRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Xa}from"@asteasolutions/zod-to-openapi";import lo from"zod";Xa(lo);var Mt=lo.object({id:lo.uuid()}),jt=class{constructor(e){this.legitimatorCommitteeMemberRepository=e}async handle(e,r){try{let{id:t}=Mt.parse({id:e.params.id}),i=await this.legitimatorCommitteeMemberRepository.findById(t);if(!i)throw new g("O membro do comit\xEA legitimador n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Qa}from"@asteasolutions/zod-to-openapi";import De from"zod";Qa(De);var fo=De.object({id:De.uuid(),role:De.string().min(1).optional(),description:De.string().optional(),userId:De.uuid().optional()}),xt=class{constructor(e){this.legitimatorCommitteeMemberRepository=e}async handle(e,r){try{let{id:t,role:i,description:s,userId:n}=fo.parse({id:e.params.id,...e.body});if(!await this.legitimatorCommitteeMemberRepository.findById(t))throw new g("O membro do comit\xEA legitimador n\xE3o existe.");return await this.legitimatorCommitteeMemberRepository.update({id:t,role:i,description:s,userId:n}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var tm=1,rm=9,om=b.object({id:b.uuid(),name:b.string(),emailAddress:b.string(),avatarUrl:b.string().nullable(),orcid:b.string().nullable(),phone:b.string().nullable(),lattesUrl:b.string().nullable(),role:b.enum(em.UserRole)}),zi=b.object({id:b.uuid(),role:b.string(),description:b.string().nullable(),createdAt:b.date(),updatedAt:b.date(),userId:b.uuid(),user:om}),Wi={method:"post",path:"/legitimator-committee-member",tags:["Legitimator Committee Members"],summary:"Create a new Legitimator Committee Member",security:[{bearerAuth:[]}],request:{body:{content:{"application/json":{schema:co}}}},responses:{201:{description:"Legitimator Committee Member created successfully",summary:"Legitimator Committee Member Created"},400:{description:"Invalid input data or missing required fields",summary:"Validation Error",content:{"application/json":{schema:b.object({errors:b.record(b.string(),b.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:b.object({message:b.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:b.object({message:b.string()})}}}}},Zi={method:"get",path:"/legitimator-committee-member",tags:["Legitimator Committee Members"],summary:"List all Legitimator Committee Members with pagination and filters",request:{query:b.object({page:b.coerce.number().min(1).default(tm).optional(),limit:b.coerce.number().min(1).default(rm).optional(),role:b.string().optional(),orderBy:b.enum(["asc","desc"]).optional()})},responses:{200:{description:"List of Legitimator Committee Members retrieved successfully with pagination",summary:"Legitimator Committee Members Retrieved",content:{"application/json":{schema:b.object({page:b.number(),totalPages:b.number(),offset:b.number(),limit:b.number(),members:b.array(zi)})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:b.object({message:b.string()})}}}}},Vi={method:"get",path:"/legitimator-committee-member/{id}",tags:["Legitimator Committee Members"],summary:"Find Legitimator Committee Member by ID",request:{params:Mt},responses:{200:{description:"Legitimator Committee Member details retrieved successfully",summary:"Legitimator Committee Member Retrieved",content:{"application/json":{schema:zi}}},400:{description:"Invalid Legitimator Committee Member ID format",summary:"Validation Error",content:{"application/json":{schema:b.object({errors:b.record(b.string(),b.string())})}}},404:{description:"Legitimator Committee Member not found with the provided ID",summary:"Legitimator Committee Member Not Found",content:{"application/json":{schema:b.object({message:b.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:b.object({message:b.string()})}}}}},Ki={method:"put",path:"/legitimator-committee-member/{id}",tags:["Legitimator Committee Members"],summary:"Update Legitimator Committee Member",security:[{bearerAuth:[]}],request:{params:Mt,body:{content:{"application/json":{schema:fo.omit({id:!0})}}}},responses:{200:{description:"Legitimator Committee Member updated successfully",summary:"Legitimator Committee Member Updated"},400:{description:"Invalid input data or Legitimator Committee Member ID format",summary:"Validation Error",content:{"application/json":{schema:b.object({errors:b.record(b.string(),b.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:b.object({message:b.string()})}}},404:{description:"Legitimator Committee Member not found with the provided ID",summary:"Legitimator Committee Member Not Found",content:{"application/json":{schema:b.object({message:b.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:b.object({message:b.string()})}}}}},Gi={method:"delete",path:"/legitimator-committee-member/{id}",tags:["Legitimator Committee Members"],summary:"Delete Legitimator Committee Member",security:[{bearerAuth:[]}],request:{params:uo},responses:{200:{description:"Legitimator Committee Member deleted successfully",summary:"Legitimator Committee Member Deleted"},400:{description:"Invalid Legitimator Committee Member ID format",summary:"Validation Error",content:{"application/json":{schema:b.object({errors:b.record(b.string(),b.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:b.object({message:b.string()})}}},404:{description:"Legitimator Committee Member not found with the provided ID",summary:"Legitimator Committee Member Not Found",content:{"application/json":{schema:b.object({message:b.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:b.object({message:b.string()})}}}}};import{$Enums as mm}from"@prisma/client";import l from"zod";import{extendZodWithOpenApi as im}from"@asteasolutions/zod-to-openapi";import ae from"zod";im(ae);var yo=ae.object({name:ae.string().min(1),description:ae.string().optional(),members:ae.array(ae.object({userId:ae.uuid(),role:ae.string().min(1)}))}),Pt=class{constructor(e){this.managementTeamRepository=e}async handle(e,r){try{let{name:t,description:i,members:s}=yo.parse(e.body);if(await this.managementTeamRepository.findByName(t))throw new F("J\xE1 existe um time de gest\xE3o cadastrado com este nome.");return await this.managementTeamRepository.create({name:t,description:i,members:s}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as sm}from"@asteasolutions/zod-to-openapi";import ho from"zod";sm(ho);var go=ho.object({id:ho.uuid()}),At=class{constructor(e){this.managementTeamRepository=e}async handle(e,r){try{let{id:t}=go.parse({id:e.params.id});if(!await this.managementTeamRepository.findById(t))throw new g("O time de gest\xE3o n\xE3o existe.");return await this.managementTeamRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as nm}from"@asteasolutions/zod-to-openapi";import Ro from"zod";nm(Ro);var Dt=Ro.object({id:Ro.uuid()}),Ut=class{constructor(e){this.managementTeamRepository=e}async handle(e,r){try{let{id:t}=Dt.parse({id:e.params.id}),i=await this.managementTeamRepository.findById(t);if(!i)throw new g("O time de gest\xE3o n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as am}from"@asteasolutions/zod-to-openapi";import J from"zod";am(J);var Io=J.object({id:J.uuid(),name:J.string().min(1).optional(),description:J.string().optional(),members:J.array(J.object({userId:J.uuid(),role:J.string().min(1)})).optional()}),Ft=class{constructor(e){this.managementTeamRepository=e}async handle(e,r){try{let{id:t,name:i,description:s,members:n}=Io.parse({id:e.params.id,...e.body}),a=await this.managementTeamRepository.findById(t);if(!a)throw new g("O time de gest\xE3o n\xE3o existe.");if(i&&i!==a.name){let c=await this.managementTeamRepository.findByName(i);if(c&&c.id!==t)throw new F("J\xE1 existe um time de gest\xE3o com este nome.")}return await this.managementTeamRepository.update({id:t,name:i,description:s,members:n}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var cm=1,pm=9,dm=l.object({id:l.uuid(),name:l.string(),emailAddress:l.string(),avatarUrl:l.string().nullable(),orcid:l.string().nullable(),phone:l.string().nullable(),lattesUrl:l.string().nullable(),role:l.enum(mm.UserRole)}),um=l.object({id:l.uuid(),role:l.string(),description:l.string().nullable(),teamId:l.uuid(),userId:l.uuid(),createdAt:l.date(),updatedAt:l.date(),user:dm}),$i=l.object({id:l.uuid(),name:l.string(),description:l.string().nullable(),createdAt:l.date(),updatedAt:l.date(),members:l.array(um)}),Yi={method:"post",path:"/management-team",tags:["Management Teams"],summary:"Create a new Management Team with multiple members",security:[{bearerAuth:[]}],request:{body:{content:{"application/json":{schema:yo}}}},responses:{201:{description:"Management Team created successfully",summary:"Management Team Created"},400:{description:"Invalid input data or missing required fields",summary:"Validation Error",content:{"application/json":{schema:l.object({errors:l.record(l.string(),l.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:l.object({message:l.string()})}}},409:{description:"Management Team with this name already exists",summary:"Conflict",content:{"application/json":{schema:l.object({message:l.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:l.object({message:l.string()})}}}}},Ji={method:"get",path:"/management-team",tags:["Management Teams"],summary:"List all Management Teams with pagination and filters",request:{query:l.object({page:l.coerce.number().min(1).default(cm).optional(),limit:l.coerce.number().min(1).default(pm).optional(),name:l.string().optional(),description:l.string().optional(),orderBy:l.enum(["asc","desc"]).optional()})},responses:{200:{description:"List of Management Teams retrieved successfully with pagination",summary:"Management Teams Retrieved",content:{"application/json":{schema:l.object({page:l.number(),totalPages:l.number(),offset:l.number(),limit:l.number(),teams:l.array($i)})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:l.object({message:l.string()})}}}}},Xi={method:"get",path:"/management-team/{id}",tags:["Management Teams"],summary:"Find Management Team by ID",request:{params:Dt},responses:{200:{description:"Management Team details retrieved successfully",summary:"Management Team Retrieved",content:{"application/json":{schema:$i}}},400:{description:"Invalid Management Team ID format",summary:"Validation Error",content:{"application/json":{schema:l.object({errors:l.record(l.string(),l.string())})}}},404:{description:"Management Team not found with the provided ID",summary:"Management Team Not Found",content:{"application/json":{schema:l.object({message:l.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:l.object({message:l.string()})}}}}},Qi={method:"put",path:"/management-team/{id}",tags:["Management Teams"],summary:"Update Management Team and manage member relationships",security:[{bearerAuth:[]}],request:{params:Dt,body:{content:{"application/json":{schema:Io.omit({id:!0})}}}},responses:{200:{description:"Management Team updated successfully",summary:"Management Team Updated"},400:{description:"Invalid input data or Management Team ID format",summary:"Validation Error",content:{"application/json":{schema:l.object({errors:l.record(l.string(),l.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:l.object({message:l.string()})}}},404:{description:"Management Team not found with the provided ID",summary:"Management Team Not Found",content:{"application/json":{schema:l.object({message:l.string()})}}},409:{description:"Management Team with this name already exists",summary:"Conflict",content:{"application/json":{schema:l.object({message:l.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:l.object({message:l.string()})}}}}},es={method:"delete",path:"/management-team/{id}",tags:["Management Teams"],summary:"Delete Management Team",security:[{bearerAuth:[]}],request:{params:go},responses:{200:{description:"Management Team deleted successfully",summary:"Management Team Deleted"},400:{description:"Invalid Management Team ID format",summary:"Validation Error",content:{"application/json":{schema:l.object({errors:l.record(l.string(),l.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:l.object({message:l.string()})}}},404:{description:"Management Team not found with the provided ID",summary:"Management Team Not Found",content:{"application/json":{schema:l.object({message:l.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:l.object({message:l.string()})}}}}};import{$Enums as gm}from"@prisma/client";import w from"zod";import{extendZodWithOpenApi as lm}from"@asteasolutions/zod-to-openapi";import Ze from"zod";lm(Ze);var bo=Ze.object({role:Ze.string().min(1),description:Ze.string().optional(),userId:Ze.uuid()}),qt=class{constructor(e){this.sdhcTeamMemberRepository=e}async handle(e,r){try{let{role:t,description:i,userId:s}=bo.parse(e.body);return await this.sdhcTeamMemberRepository.create({role:t,description:i,userId:s}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as fm}from"@asteasolutions/zod-to-openapi";import wo from"zod";fm(wo);var Co=wo.object({id:wo.uuid()}),Nt=class{constructor(e){this.sdhcTeamMemberRepository=e}async handle(e,r){try{let{id:t}=Co.parse({id:e.params.id});if(!await this.sdhcTeamMemberRepository.findById(t))throw new g("O membro da equipe SDHC n\xE3o existe.");return await this.sdhcTeamMemberRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as ym}from"@asteasolutions/zod-to-openapi";import Eo from"zod";ym(Eo);var Bt=Eo.object({id:Eo.uuid()}),Ot=class{constructor(e){this.sdhcTeamMemberRepository=e}async handle(e,r){try{let{id:t}=Bt.parse({id:e.params.id}),i=await this.sdhcTeamMemberRepository.findById(t);if(!i)throw new g("O membro da equipe SDHC n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as hm}from"@asteasolutions/zod-to-openapi";import Fe from"zod";hm(Fe);var So=Fe.object({id:Fe.uuid(),role:Fe.string().min(1).optional(),description:Fe.string().optional(),userId:Fe.uuid().optional()}),kt=class{constructor(e){this.sdhcTeamMemberRepository=e}async handle(e,r){try{let{id:t,role:i,description:s,userId:n}=So.parse({id:e.params.id,...e.body});if(!await this.sdhcTeamMemberRepository.findById(t))throw new g("O membro da equipe SDHC n\xE3o existe.");return await this.sdhcTeamMemberRepository.update({id:t,role:i,description:s,userId:n}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Rm=1,Im=9,bm=w.object({id:w.uuid(),name:w.string(),emailAddress:w.string(),avatarUrl:w.string().nullable(),orcid:w.string().nullable(),phone:w.string().nullable(),lattesUrl:w.string().nullable(),role:w.enum(gm.UserRole)}),ts=w.object({id:w.uuid(),role:w.string(),description:w.string().nullable(),createdAt:w.date(),updatedAt:w.date(),userId:w.uuid(),user:bm}),rs={method:"post",path:"/sdhc-team-member",tags:["SDHC Team Members"],summary:"Create a new SDHC Team Member",security:[{bearerAuth:[]}],request:{body:{content:{"application/json":{schema:bo}}}},responses:{201:{description:"SDHC Team Member created successfully",summary:"SDHC Team Member Created"},400:{description:"Invalid input data or missing required fields",summary:"Validation Error",content:{"application/json":{schema:w.object({errors:w.record(w.string(),w.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:w.object({message:w.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:w.object({message:w.string()})}}}}},os={method:"get",path:"/sdhc-team-member",tags:["SDHC Team Members"],summary:"List all SDHC Team Members with pagination and filters",request:{query:w.object({page:w.coerce.number().min(1).default(Rm).optional(),limit:w.coerce.number().min(1).default(Im).optional(),role:w.string().optional(),orderBy:w.enum(["asc","desc"]).optional()})},responses:{200:{description:"List of SDHC Team Members retrieved successfully with pagination",summary:"SDHC Team Members Retrieved",content:{"application/json":{schema:w.object({page:w.number(),totalPages:w.number(),offset:w.number(),limit:w.number(),members:w.array(ts)})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:w.object({message:w.string()})}}}}},is={method:"get",path:"/sdhc-team-member/{id}",tags:["SDHC Team Members"],summary:"Find SDHC Team Member by ID",request:{params:Bt},responses:{200:{description:"SDHC Team Member details retrieved successfully",summary:"SDHC Team Member Retrieved",content:{"application/json":{schema:ts}}},400:{description:"Invalid SDHC Team Member ID format",summary:"Validation Error",content:{"application/json":{schema:w.object({errors:w.record(w.string(),w.string())})}}},404:{description:"SDHC Team Member not found with the provided ID",summary:"SDHC Team Member Not Found",content:{"application/json":{schema:w.object({message:w.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:w.object({message:w.string()})}}}}},ss={method:"put",path:"/sdhc-team-member/{id}",tags:["SDHC Team Members"],summary:"Update SDHC Team Member",security:[{bearerAuth:[]}],request:{params:Bt,body:{content:{"application/json":{schema:So.omit({id:!0})}}}},responses:{200:{description:"SDHC Team Member updated successfully",summary:"SDHC Team Member Updated"},400:{description:"Invalid input data or SDHC Team Member ID format",summary:"Validation Error",content:{"application/json":{schema:w.object({errors:w.record(w.string(),w.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:w.object({message:w.string()})}}},404:{description:"SDHC Team Member not found with the provided ID",summary:"SDHC Team Member Not Found",content:{"application/json":{schema:w.object({message:w.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:w.object({message:w.string()})}}}}},ns={method:"delete",path:"/sdhc-team-member/{id}",tags:["SDHC Team Members"],summary:"Delete SDHC Team Member",security:[{bearerAuth:[]}],request:{params:Co},responses:{200:{description:"SDHC Team Member deleted successfully",summary:"SDHC Team Member Deleted"},400:{description:"Invalid SDHC Team Member ID format",summary:"Validation Error",content:{"application/json":{schema:w.object({errors:w.record(w.string(),w.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:w.object({message:w.string()})}}},404:{description:"SDHC Team Member not found with the provided ID",summary:"SDHC Team Member Not Found",content:{"application/json":{schema:w.object({message:w.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:w.object({message:w.string()})}}}}};import R from"zod";import{extendZodWithOpenApi as wm}from"@asteasolutions/zod-to-openapi";import Ve from"zod";var Cm=5,as=1024,Em=as*as,Sm=Cm*Em;wm(Ve);var vo=Ve.object({title:Ve.string().min(1),content:Ve.string().min(1),image:Ve.any().refine(o=>!o||typeof o=="object"&&typeof o.mimetype=="string"&&o.mimetype.startsWith("image/")&&typeof o.size=="number"&&o.size<=Sm,{message:"A imagem deve ser uma imagem v\xE1lida de no m\xE1ximo 5MB."})}),Lt=class{constructor(e,r){this.newsRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{title:t,content:i,image:s}=vo.parse({...e.body,image:e.file}),n=e.user.id,a=await this.firebaseStorageService.uploadFile({file:s,folder:A.NEWS,id:n});await this.newsRepository.create({title:t,content:i,authorId:n,imageUrl:a}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as vm}from"@asteasolutions/zod-to-openapi";import me from"zod";var Tm=1,jm=7;vm(me);var _t=me.object({page:me.coerce.number().min(1).default(Tm),limit:me.coerce.number().min(1).default(jm),authorId:me.string(),title:me.string().optional(),content:me.string().optional(),orderBy:me.enum(["asc","desc"]).default("desc")}),Ht=class{constructor(e){this.newsRepository=e}async handle(e,r){try{let{page:t,limit:i,authorId:s,...n}=_t.parse(e.query),a=i*t-i,[c,f]=await Promise.all([this.newsRepository.findByAuthorId({authorId:s,pagination:{offset:a,limit:i},filter:n}),this.newsRepository.count({filter:{authorId:s,...n}})]),T=Math.max(Math.ceil(f/i),1);r.status(200).json({page:t,totalPages:T,offset:a,limit:i,news:c})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Mm}from"@asteasolutions/zod-to-openapi";import To from"zod";Mm(To);var jo=To.object({id:To.string()}),zt=class{constructor(e){this.newsRepository=e}async handle(e,r){try{let{id:t}=jo.parse(e.params),i=await this.newsRepository.findById(t);if(!i)throw new g("Not\xEDcia n\xE3o encontrada.");r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as xm}from"@asteasolutions/zod-to-openapi";import ce from"zod";var Pm=1,Am=9;xm(ce);var Mo=ce.object({page:ce.coerce.number().min(1).default(Pm),limit:ce.coerce.number().min(1).default(Am),title:ce.string().optional(),content:ce.string().optional(),authorId:ce.string().optional(),orderBy:ce.enum(["asc","desc"]).default("desc")}),Wt=class{constructor(e){this.newsRepository=e}async handle(e,r){try{let{page:t,limit:i,authorId:s,content:n,orderBy:a,title:c}=Mo.parse(e.query),f=i*t-i,[T,j]=await Promise.all([this.newsRepository.find({pagination:{offset:f,limit:i},filter:{authorId:s,content:n,title:c,orderBy:a}}),this.newsRepository.count({filter:{title:c,content:n,authorId:s}})]),D=Math.max(Math.ceil(j/i),1);r.status(200).json({page:t,totalPages:D,offset:f,limit:i,news:T})}catch(t){if(t instanceof Error)throw new m(t.message)}}};var ms={method:"post",path:"/news",tags:["News"],summary:"Create news",security:[{bearerAuth:[]}],request:{body:{content:{"multipart/form-data":{schema:vo}}}},responses:{201:{description:"News article created successfully",summary:"News Created",content:{"application/json":{schema:R.object({message:R.string()})}}},400:{description:"Invalid input data or file format",summary:"Validation Error",content:{"application/json":{schema:R.object({errors:R.record(R.string(),R.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:R.object({message:R.string()})}}}}},cs={method:"get",path:"/news",tags:["News"],summary:"List news",request:{query:Mo},responses:{200:{description:"Paginated list of news articles retrieved successfully",summary:"News Retrieved",content:{"application/json":{schema:R.object({page:R.number(),totalPages:R.number(),offset:R.number(),limit:R.number(),news:R.array(R.object({title:R.string(),content:R.string(),id:R.string(),createdAt:R.date(),updatedAt:R.date(),imageUrl:R.string().nullable()}))})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:R.object({errors:R.record(R.string(),R.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:R.object({message:R.string()})}}}}},ps={method:"get",path:"/news/{id}",tags:["News"],summary:"Find news by ID",request:{params:jo},responses:{200:{description:"News article details retrieved successfully",summary:"News Retrieved",content:{"application/json":{schema:R.object({page:R.number(),totalPages:R.number(),offset:R.number(),limit:R.number(),news:R.object({title:R.string(),content:R.string(),id:R.string(),createdAt:R.date(),updatedAt:R.date(),imageUrl:R.string().nullable()})})}}},400:{description:"Invalid news ID format",summary:"Validation Error",content:{"application/json":{schema:R.object({errors:R.record(R.string(),R.string())})}}},404:{description:"News article not found with the provided ID",summary:"News Not Found",content:{"application/json":{schema:R.object({message:R.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:R.object({message:R.string()})}}}}},ds={method:"get",path:"/news/author/{author_id}",tags:["News"],summary:"List news by author",request:{params:_t.pick({authorId:!0}).transform(()=>({author_id:""})),query:_t.omit({authorId:!0})},responses:{200:{description:"Paginated list of news articles by author retrieved successfully",summary:"Author News Retrieved",content:{"application/json":{schema:R.object({page:R.number(),totalPages:R.number(),offset:R.number(),limit:R.number(),news:R.array(R.object({title:R.string(),content:R.string(),id:R.string(),createdAt:R.date(),updatedAt:R.date(),imageUrl:R.string().nullable()}))})}}},400:{description:"Invalid author ID or query parameters",summary:"Validation Error",content:{"application/json":{schema:R.object({errors:R.record(R.string(),R.string())})}}},404:{description:"Author not found with the provided ID",summary:"Author Not Found",content:{"application/json":{schema:R.object({message:R.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:R.object({message:R.string()})}}}}};import C from"zod";import{extendZodWithOpenApi as Um}from"@asteasolutions/zod-to-openapi";import $ from"zod";var ls=2,us=1024,Dm=us*us,Fm=ls*Dm;Um($);var xo=$.object({name:$.string().min(1,"Nome \xE9 obrigat\xF3rio"),logo:$.any().refine(o=>o==null||typeof o!="object"||typeof o.size!="number"?!1:o.size<=Fm,`A imagem deve ter no m\xE1ximo ${ls}MB.`),websiteUrl:$.url("URL do site deve ser v\xE1lida").optional(),description:$.string().optional(),category:$.string().optional(),since:$.coerce.date(),isActive:$.preprocess(o=>o==="true",$.boolean().optional())}),Zt=class{constructor(e,r){this.partnerRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{name:t,logo:i,websiteUrl:s,description:n,category:a,since:c,isActive:f}=xo.parse({...e.body,logo:e.file}),T=await this.partnerRepository.create({name:t,websiteUrl:s,description:n,category:a,since:c,isActive:f}),j=await this.firebaseStorageService.uploadFile({file:i,id:T.id,folder:A.PARTNER});return await this.partnerRepository.update({id:T.id,logoUrl:j}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as qm}from"@asteasolutions/zod-to-openapi";import Po from"zod";qm(Po);var Ao=Po.object({id:Po.uuid()}),Vt=class{constructor(e,r){this.partnerRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t}=Ao.parse({id:e.params.id}),i=await this.partnerRepository.findById(t);if(!i)throw new g("O parceiro n\xE3o existe.");return i.logoUrl&&this.firebaseStorageService.deleteFile({fileUrl:i.logoUrl}),await this.partnerRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Nm}from"@asteasolutions/zod-to-openapi";import Uo from"zod";Nm(Uo);var Gt=Uo.object({id:Uo.uuid()}),Kt=class{constructor(e){this.partnerRepository=e}async handle(e,r){try{let{id:t}=Gt.parse({id:e.params.id}),i=await this.partnerRepository.findById(t);if(!i)throw new g("O parceiro n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Om}from"@asteasolutions/zod-to-openapi";import X from"zod";var Bm=1,km=9;Om(X);var Do=X.object({page:X.coerce.number().min(1).default(Bm),limit:X.coerce.number().min(1).default(km),name:X.string().optional(),description:X.string().optional(),category:X.string().optional(),isActive:X.coerce.boolean().optional(),orderBy:X.enum(["asc","desc"]).optional()}),$t=class{constructor(e){this.partnerRepository=e}async handle(e,r){try{let{page:t,limit:i,...s}=Do.parse(e.query),n=i*t-i,[a,c]=await Promise.all([this.partnerRepository.find({pagination:{offset:n,limit:i},filter:s}),this.partnerRepository.count({filter:s})]),f=Math.max(Math.ceil(c/i),1);r.status(200).json({page:t,totalPages:f,offset:n,limit:i,partners:a})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Lm}from"@asteasolutions/zod-to-openapi";import K from"zod";var ys=2,fs=1024,Hm=fs*fs,_m=ys*Hm;Lm(K);var Fo=K.object({id:K.uuid(),name:K.string().min(1,"Nome \xE9 obrigat\xF3rio").optional(),logo:K.any().refine(o=>o==null?!0:typeof o!="object"||typeof o.size!="number"?!1:o.size<=_m,`A imagem deve ter no m\xE1ximo ${ys}MB.`).optional(),websiteUrl:K.url("URL do site deve ser v\xE1lida").optional(),description:K.string().optional(),category:K.string().optional(),since:K.coerce.date().optional(),isActive:K.preprocess(o=>o==="true",K.boolean().optional())}),Yt=class{constructor(e,r){this.partnerRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t,name:i,logo:s,websiteUrl:n,description:a,category:c,since:f,isActive:T}=Fo.parse({id:e.params.id,...e.body,logo:e.file}),j=await this.partnerRepository.findById(t);if(!j)throw new g("O parceiro n\xE3o existe.");let D=j.logoUrl;if(s&&(D=await this.firebaseStorageService.uploadFile({file:s,id:t,folder:"images/partners"})),!D)throw new m("Logo URL \xE9 obrigat\xF3rio");return await this.partnerRepository.update({id:t,name:i,logoUrl:D,websiteUrl:n,description:a,category:c,since:f,isActive:T}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var hs=C.object({id:C.uuid(),name:C.string(),logoUrl:C.string(),websiteUrl:C.string().nullable(),description:C.string().nullable(),category:C.string().nullable(),since:C.date(),isActive:C.boolean(),createdAt:C.date(),updatedAt:C.date()}),gs={method:"post",path:"/partner",tags:["Partners"],summary:"Create a new partner with logo upload",security:[{bearerAuth:[]}],request:{body:{content:{"multipart/form-data":{schema:xo}}}},responses:{201:{description:"Partner created successfully",summary:"Partner Created"},400:{description:"Invalid input data, missing required fields, or invalid logo format/size",summary:"Validation Error",content:{"application/json":{schema:C.object({errors:C.record(C.string(),C.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:C.object({message:C.string()})}}},409:{description:"Partner with this name already exists",summary:"Conflict",content:{"application/json":{schema:C.object({message:C.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:C.object({message:C.string()})}}}}},Rs={method:"get",path:"/partner",tags:["Partners"],summary:"List all partners with pagination and filters",request:{query:Do},responses:{200:{description:"List of partners retrieved successfully with pagination",summary:"Partners Retrieved",content:{"application/json":{schema:C.object({page:C.number(),totalPages:C.number(),offset:C.number(),limit:C.number(),partners:C.array(hs)})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:C.object({errors:C.record(C.string(),C.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:C.object({message:C.string()})}}}}},Is={method:"get",path:"/partner/{id}",tags:["Partners"],summary:"Find partner by ID",request:{params:Gt},responses:{200:{description:"Partner details retrieved successfully",summary:"Partner Retrieved",content:{"application/json":{schema:hs}}},400:{description:"Invalid partner ID format",summary:"Validation Error",content:{"application/json":{schema:C.object({errors:C.record(C.string(),C.string())})}}},404:{description:"Partner not found with the provided ID",summary:"Partner Not Found",content:{"application/json":{schema:C.object({message:C.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:C.object({message:C.string()})}}}}},bs={method:"put",path:"/partner/{id}",tags:["Partners"],summary:"Update partner with optional logo upload",security:[{bearerAuth:[]}],request:{params:Gt,body:{content:{"multipart/form-data":{schema:Fo.omit({id:!0})}}}},responses:{200:{description:"Partner updated successfully",summary:"Partner Updated"},400:{description:"Invalid input data, partner ID format, or invalid logo format/size",summary:"Validation Error",content:{"application/json":{schema:C.object({errors:C.record(C.string(),C.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:C.object({message:C.string()})}}},404:{description:"Partner not found with the provided ID",summary:"Partner Not Found",content:{"application/json":{schema:C.object({message:C.string()})}}},409:{description:"Partner with this name already exists",summary:"Conflict",content:{"application/json":{schema:C.object({message:C.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:C.object({message:C.string()})}}}}},ws={method:"delete",path:"/partner/{id}",tags:["Partners"],summary:"Delete partner",security:[{bearerAuth:[]}],request:{params:Ao},responses:{200:{description:"Partner deleted successfully",summary:"Partner Deleted"},400:{description:"Invalid partner ID format",summary:"Validation Error",content:{"application/json":{schema:C.object({errors:C.record(C.string(),C.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:C.object({message:C.string()})}}},404:{description:"Partner not found with the provided ID",summary:"Partner Not Found",content:{"application/json":{schema:C.object({message:C.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:C.object({message:C.string()})}}}}};import{$Enums as Cs}from"@prisma/client";import S from"zod";import{extendZodWithOpenApi as zm}from"@asteasolutions/zod-to-openapi";import{PendencyStatus as Wm}from"@prisma/client";import pe from"zod";zm(pe);var Xt=pe.object({userId:pe.uuid(),title:pe.string().min(1),description:pe.string().optional(),status:pe.enum(Wm).default("PENDING"),dueDate:pe.coerce.date().optional(),document:pe.any().refine(o=>o&&typeof o=="object"&&o.size>0,"Arquivo do documento \xE9 obrigat\xF3rio")}),Jt=class{constructor(e,r,t){this.userRepository=e;this.pendencyRepository=r;this.firebaseStorageService=t}async handle(e,r){try{let{userId:t,title:i,description:s,status:n,dueDate:a,document:c}=Xt.parse({...e.body,userId:e.params.user_id,document:e.file});if(!await this.userRepository.findById(t))throw new O("O usu\xE1rio n\xE3o existe.");let T=await this.firebaseStorageService.uploadFile({file:c,id:t,folder:A.PENDENCY});return await this.pendencyRepository.create({userId:t,title:i,description:s,status:n,dueDate:a,documentUrl:T}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Zm}from"@asteasolutions/zod-to-openapi";import qo from"zod";Zm(qo);var No=qo.object({id:qo.uuid()}),Qt=class{constructor(e,r){this.pendencyRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t}=No.parse({id:e.params.pendency_id}),i=await this.pendencyRepository.findById(t);if(!i)throw new g("A pend\xEAncia n\xE3o existe.");return await Promise.all([this.pendencyRepository.deleteById(i.id),this.firebaseStorageService.deleteFile({fileUrl:i.documentUrl})]),r.sendStatus(204)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Vm}from"@asteasolutions/zod-to-openapi";import{PendencyStatus as Km}from"@prisma/client";import Q from"zod";var Gm=1,$m=6;Vm(Q);var Oo=Q.object({page:Q.coerce.number().min(1).default(Gm),limit:Q.coerce.number().min(1).default($m),title:Q.string().optional(),description:Q.string().optional(),status:Q.enum(Km).default("PENDING"),userId:Q.uuid().optional(),orderBy:Q.enum(["asc","desc"]).default("desc")}),er=class{constructor(e){this.pendencyRepository=e}async handle(e,r){try{let{description:t,limit:i,orderBy:s,page:n,title:a,status:c,userId:f}=Oo.parse(e.query),T=n*i-i,[j,D]=await Promise.all([this.pendencyRepository.find({pagination:{offset:T,limit:i},filter:{title:a,description:t,status:c,orderBy:s,userId:f}}),this.pendencyRepository.count({filter:{title:a,description:t,status:c,userId:f}})]),Z=Math.max(Math.ceil(D/i),1);return r.status(200).json({page:n,totalPages:Z,offset:T,limit:i,pendencies:j})}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Ym}from"@asteasolutions/zod-to-openapi";import Bo from"zod";Ym(Bo);var ko=Bo.object({pendencyId:Bo.uuid()}),tr=class{constructor(e){this.pendencyRepository=e}async handle(e,r){try{let{pendencyId:t}=ko.parse({pendencyId:e.params.pendency_id}),i=await this.pendencyRepository.findById(t);if(!i)throw new g("Pend\xEAncia n\xE3o encontrada.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Jm}from"@asteasolutions/zod-to-openapi";import{PendencyStatus as Xm}from"@prisma/client";import de from"zod";Jm(de);var or=de.object({id:de.uuid(),title:de.string().min(1),description:de.string().optional(),status:de.enum(Xm),dueDate:de.coerce.date().optional(),document:de.any().refine(o=>o==null||typeof o=="object"&&typeof o.size=="number"&&(o.size===0||o.size>0),"Arquivo do documento \xE9 inv\xE1lido").optional()}),rr=class{constructor(e,r){this.pendencyRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{document:t,id:i,...s}=or.parse({...e.body,id:e.params.pendency_id,document:e.file}),n=await this.pendencyRepository.findById(i);if(!n)throw new O("A pend\xEAncia n\xE3o existe");let a=n.documentUrl;return t&&t.size>0&&(a=await this.firebaseStorageService.updateFile({file:t,id:n.userId,folder:A.PENDENCY,fileUrl:n.documentUrl})),await this.pendencyRepository.update({...s,id:i,documentUrl:a}),r.sendStatus(204)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Es={method:"post",path:"/pendency/{user_id}",tags:["Pendencies"],summary:"Create pendency for user",security:[{bearerAuth:[]}],request:{params:Xt.pick({userId:!0}).transform(()=>({user_id:""})),body:{content:{"multipart/form-data":{schema:Xt.omit({userId:!0})}}}},responses:{201:{description:"Pendency created successfully for the user",summary:"Pendency Created",content:{"application/json":{schema:S.object({})}}},400:{description:"Invalid input data or file format",summary:"Validation Error",content:{"application/json":{schema:S.object({errors:S.record(S.string(),S.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:S.object({message:S.string()})}}}}},Ss={method:"get",path:"/pendency",tags:["Pendencies"],summary:"List pendencies",security:[{bearerAuth:[]}],request:{query:Oo},responses:{200:{description:"Paginated list of pendencies retrieved successfully",summary:"Pendencies Retrieved",content:{"application/json":{schema:S.object({page:S.number(),totalPages:S.number(),offset:S.number(),limit:S.number(),pendencies:S.array(S.object({id:S.string(),title:S.string(),description:S.string().nullable(),status:S.enum(Cs.PendencyStatus),dueDate:S.date().nullable(),documentUrl:S.string(),userId:S.string(),createdAt:S.date(),updatedAt:S.date()}))})}}},400:{description:"Invalid query parameters provided",summary:"Validation Error",content:{"application/json":{schema:S.object({errors:S.record(S.string(),S.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:S.object({message:S.string()})}}}}},vs={method:"get",path:"/pendency/{pendency_id}",tags:["Pendencies"],summary:"Find pendency by ID",security:[{bearerAuth:[]}],request:{params:ko},responses:{200:{description:"Pendency details retrieved successfully",summary:"Pendency Retrieved",content:{"application/json":{schema:S.object({id:S.string(),title:S.string(),description:S.string().nullable(),status:S.enum(Cs.PendencyStatus),dueDate:S.date().nullable(),documentUrl:S.string(),userId:S.string(),createdAt:S.date(),updatedAt:S.date()}).nullable()}}},400:{description:"Invalid pendency ID format",summary:"Validation Error",content:{"application/json":{schema:S.object({errors:S.record(S.string(),S.string())})}}},404:{description:"Pendency not found with the provided ID",summary:"Pendency Not Found",content:{"application/json":{schema:S.object({message:S.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:S.object({message:S.string()})}}}}},Ts={method:"put",path:"/pendency/{pendency_id}",tags:["Pendencies"],summary:"Update pendency",security:[{bearerAuth:[]}],request:{params:or.pick({id:!0}).transform(()=>({pendency_id:""})),body:{content:{"multipart/form-data":{schema:or.omit({id:!0})}}}},responses:{204:{description:"Pendency updated successfully",summary:"Pendency Updated"},400:{description:"Invalid input data or pendency does not exist",summary:"Validation Error",content:{"application/json":{schema:S.object({errors:S.record(S.string(),S.string())})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:S.object({message:S.string()})}}}}},js={method:"delete",path:"/pendency/{pendency_id}",tags:["Pendencies"],summary:"Delete pendency",security:[{bearerAuth:[]}],request:{params:No},responses:{204:{description:"Pendency deleted successfully",summary:"Pendency Deleted"},400:{description:"Invalid pendency ID format",summary:"Validation Error",content:{"application/json":{schema:S.object({errors:S.record(S.string(),S.string())})}}},404:{description:"Pendency not found with the provided ID",summary:"Pendency Not Found",content:{"application/json":{schema:S.object({message:S.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:S.object({message:S.string()})}}}}};import{$Enums as Ko}from"@prisma/client";import d from"zod";import{extendZodWithOpenApi as Qm}from"@asteasolutions/zod-to-openapi";import{Degree as ec,Seniority as tc}from"@prisma/client";import z from"zod";Qm(z);var Lo=z.object({registrationNumber:z.string(),mainEtps:z.string().optional(),formations:z.string().optional(),degrees:z.array(z.enum(ec)),occupations:z.string(),seniority:z.enum(tc),institutions:z.string(),biography:z.string().optional(),userId:z.string()}),ir=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{registrationNumber:t,mainEtps:i,formations:s,degrees:n,occupations:a,seniority:c,institutions:f,biography:T,userId:j}=Lo.parse(e.body);if(await this.researcherRepository.findByRegistrationNumber(t))throw new F("J\xE1 existe um pesquisador cadastrado com este n\xFAmero de registro.");if(await this.researcherRepository.findByUserId(j))throw new F("Usu\xE1rio j\xE1 possui um perfil de pesquisador.");return await this.researcherRepository.create({registrationNumber:t,mainEtps:i,formations:s,degrees:n,occupations:a,seniority:c,institutions:f,biography:T,userId:j}),r.sendStatus(201)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as rc}from"@asteasolutions/zod-to-openapi";import Ho from"zod";rc(Ho);var _o=Ho.object({id:Ho.uuid()}),sr=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{id:t}=_o.parse({id:e.params.id});if(!await this.researcherRepository.findById(t))throw new g("O pesquisador n\xE3o existe.");return await this.researcherRepository.deleteById(t),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as oc}from"@asteasolutions/zod-to-openapi";import zo from"zod";oc(zo);var ar=zo.object({id:zo.uuid()}),nr=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{id:t}=ar.parse({id:e.params.id}),i=await this.researcherRepository.findById(t);if(!i)throw new g("O pesquisador n\xE3o existe.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as ic}from"@asteasolutions/zod-to-openapi";import Wo from"zod";ic(Wo);var Zo=Wo.object({userId:Wo.uuid()}),mr=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{userId:t}=Zo.parse({userId:e.params.userId}),i=await this.researcherRepository.findByUserId(t);if(!i)throw new g("O pesquisador n\xE3o existe para este usu\xE1rio.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as sc}from"@asteasolutions/zod-to-openapi";import{Degree as nc,Seniority as ac}from"@prisma/client";import W from"zod";sc(W);var Vo=W.object({id:W.uuid(),registrationNumber:W.string().optional(),mainEtps:W.string().optional(),formations:W.string().optional(),degrees:W.array(W.enum(nc)).optional(),occupations:W.string().optional(),seniority:W.enum(ac).optional(),institutions:W.string().optional(),biography:W.string().optional()}),cr=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{id:t,registrationNumber:i,mainEtps:s,formations:n,degrees:a,occupations:c,seniority:f,institutions:T,biography:j}=Vo.parse({id:e.params.id,...e.body}),D=await this.researcherRepository.findById(t);if(!D)throw new g("O pesquisador n\xE3o existe.");if(i&&i!==D.registrationNumber){let Z=await this.researcherRepository.findByRegistrationNumber(i);if(Z&&Z.id!==t)throw new F("J\xE1 existe um pesquisador com este n\xFAmero de registro.")}return await this.researcherRepository.update({id:t,registrationNumber:i,mainEtps:s,formations:n,degrees:a,occupations:c,seniority:f,institutions:T,biography:j}),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var mc=1,cc=9,Go=d.object({id:d.uuid(),registrationNumber:d.string(),mainEtps:d.string().nullable(),formations:d.string().nullable(),degrees:d.array(d.enum(Ko.Degree)),occupations:d.string(),seniority:d.enum(Ko.Seniority),institutions:d.string(),biography:d.string().nullable(),createdAt:d.date(),updatedAt:d.date(),userId:d.uuid(),user:d.object({id:d.uuid(),name:d.string(),emailAddress:d.string(),avatarUrl:d.string().nullable(),orcid:d.string().nullable(),phone:d.string().nullable(),lattesUrl:d.string().nullable(),role:d.enum(Ko.UserRole)})}),Ms={method:"post",path:"/researcher",tags:["Researchers"],summary:"Create a new researcher profile",security:[{bearerAuth:[]}],request:{body:{content:{"application/json":{schema:Lo}}}},responses:{201:{description:"Researcher profile created successfully",summary:"Researcher Created",content:{"application/json":{schema:d.object({message:d.string()})}}},400:{description:"Invalid input data or missing required fields",summary:"Validation Error",content:{"application/json":{schema:d.object({errors:d.record(d.string(),d.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:d.object({message:d.string()})}}},409:{description:"Researcher with this registration number already exists or user already has a researcher profile",summary:"Conflict",content:{"application/json":{schema:d.object({message:d.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:d.object({message:d.string()})}}}}},xs={method:"get",path:"/researcher",tags:["Researchers"],summary:"List all researchers with pagination and filters",request:{query:d.object({page:d.coerce.number().min(1).default(mc).optional(),limit:d.coerce.number().min(1).default(cc).optional(),userId:d.string().optional(),registrationNumber:d.string().optional(),name:d.string().optional(),emailAddress:d.string().optional(),mainEtps:d.string().optional(),formations:d.string().optional(),occupations:d.string().optional(),institutions:d.string().optional(),biography:d.string().optional(),orderBy:d.enum(["asc","desc"]).optional()})},responses:{200:{description:"List of researchers retrieved successfully with pagination",summary:"Researchers Retrieved",content:{"application/json":{schema:d.object({page:d.number(),totalPages:d.number(),offset:d.number(),limit:d.number(),researchers:d.array(Go)})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:d.object({message:d.string()})}}}}},Ps={method:"get",path:"/researcher/{id}",tags:["Researchers"],summary:"Find researcher by ID",request:{params:ar},responses:{200:{description:"Researcher details retrieved successfully",summary:"Researcher Retrieved",content:{"application/json":{schema:Go}}},400:{description:"Invalid researcher ID format",summary:"Validation Error",content:{"application/json":{schema:d.object({errors:d.record(d.string(),d.string())})}}},404:{description:"Researcher not found with the provided ID",summary:"Researcher Not Found",content:{"application/json":{schema:d.object({message:d.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:d.object({message:d.string()})}}}}},As={method:"get",path:"/researcher/user/{userId}",tags:["Researchers"],summary:"Find researcher by user ID",request:{params:Zo},responses:{200:{description:"Researcher details retrieved successfully",summary:"Researcher Retrieved",content:{"application/json":{schema:Go}}},400:{description:"Invalid user ID format",summary:"Validation Error",content:{"application/json":{schema:d.object({errors:d.record(d.string(),d.string())})}}},404:{description:"Researcher not found for this user",summary:"Researcher Not Found",content:{"application/json":{schema:d.object({message:d.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:d.object({message:d.string()})}}}}},Us={method:"put",path:"/researcher/{id}",tags:["Researchers"],summary:"Update researcher profile",security:[{bearerAuth:[]}],request:{params:ar,body:{content:{"application/json":{schema:Vo.omit({id:!0})}}}},responses:{200:{description:"Researcher profile updated successfully",summary:"Researcher Updated",content:{"application/json":{schema:d.object({message:d.string()})}}},400:{description:"Invalid input data or researcher ID format",summary:"Validation Error",content:{"application/json":{schema:d.object({errors:d.record(d.string(),d.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:d.object({message:d.string()})}}},404:{description:"Researcher not found with the provided ID",summary:"Researcher Not Found",content:{"application/json":{schema:d.object({message:d.string()})}}},409:{description:"Researcher with this registration number already exists",summary:"Conflict",content:{"application/json":{schema:d.object({message:d.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:d.object({message:d.string()})}}}}},Ds={method:"delete",path:"/researcher/{id}",tags:["Researchers"],summary:"Delete researcher profile",security:[{bearerAuth:[]}],request:{params:_o},responses:{200:{description:"Researcher profile deleted successfully",summary:"Researcher Deleted"},400:{description:"Invalid researcher ID format",summary:"Validation Error",content:{"application/json":{schema:d.object({errors:d.record(d.string(),d.string())})}}},401:{description:"User not authenticated",summary:"Authentication Required",content:{"application/json":{schema:d.object({message:d.string()})}}},404:{description:"Researcher not found with the provided ID",summary:"Researcher Not Found",content:{"application/json":{schema:d.object({message:d.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:d.object({message:d.string()})}}}}};import{$Enums as Ns}from"@prisma/client";import v from"zod";import{extendZodWithOpenApi as pc}from"@asteasolutions/zod-to-openapi";import $o from"zod";pc($o);var Yo=$o.object({id:$o.string()}),pr=class{constructor(e){this.userRepository=e}async handle(e,r){try{let{id:t}=Yo.parse({id:e.params.id}),i=await this.userRepository.findById(t);if(!i)throw new g("O usu\xE1rio n\xE3o existe.");let s=e.user.id;if(i.id!==s)throw new H("Voc\xEA n\xE3o tem permiss\xE3o para deletar o usu\xE1rio");return await this.userRepository.deleteById(i.id),r.sendStatus(204)}catch(t){if(console.log(t),t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as dc}from"@asteasolutions/zod-to-openapi";import{z as Jo}from"zod";dc(Jo);var Xo=Jo.object({id:Jo.string().min(1,"id do usu\xE1rio n\xE3o fornecido.")}),dr=class{constructor(e){this.userRepository=e}async handle(e,r){try{let{id:t}=Xo.parse(e.params),i=await this.userRepository.findById(t);if(!i)throw new g("Usu\xE1rio n\xE3o encontrado");r.status(200).json(i)}catch(t){if(console.log(t),t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as uc}from"@asteasolutions/zod-to-openapi";import Ie from"zod";var qs=2,Fs=1024,lc=Fs*Fs,fc=qs*lc,yc=/^\d{4}-\d{4}-\d{4}-\d{4}$/,hc=/^\(?\d{2}\)?[\s-]?\d{4,5}-?\d{4}$/;uc(Ie);var Qo=Ie.object({name:Ie.string().optional(),lattesUrl:Ie.string().optional(),orcid:Ie.string().optional().transform(o=>o===void 0?void 0:o.trim()).refine(o=>o===void 0||o===""||yc.test(o),{message:"ORCID inv\xE1lido. Deve estar no formato 0000-0000-0000-0000"}),phone:Ie.string().optional().refine(o=>o===void 0||o===""||hc.test(o),{message:"Telefone inv\xE1lido. Deve estar no formato (99) 99999-9999"}),avatarImage:Ie.any().refine(o=>o==null?!0:typeof o!="object"||typeof o.size!="number"?!1:o.size<=fc,`A imagem deve ter no m\xE1ximo ${qs}MB.`).optional()}),ur=class{constructor(e,r){this.userRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{avatarImage:t,...i}=Qo.parse({...e.body,avatarImage:e.file}),s=e.user.id,n=await this.userRepository.findById(s);if(!n)throw new O("O usu\xE1rio n\xE3o existe");let a=n.avatarUrl;return t&&(n.avatarUrl?a=await this.firebaseStorageService.updateFile({file:t,id:s,folder:A.USER,fileUrl:n.avatarUrl}):a=await this.firebaseStorageService.uploadFile({file:t,id:s,folder:A.USER})),await this.userRepository.update({...i,id:s,avatarUrl:a||void 0}),r.sendStatus(204)}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Os={method:"get",path:"/users/{id}",tags:["Users"],summary:"Find user by ID",request:{params:Xo},responses:{200:{description:"User details retrieved successfully",summary:"User Retrieved",content:{"application/json":{schema:v.object({id:v.string(),name:v.string(),createdAt:v.date(),updatedAt:v.date(),role:v.enum(Ns.UserRole),lattesUrl:v.string().nullable(),orcid:v.string().nullable(),phone:v.string().nullable(),avatarUrl:v.url().nullable(),emailAddress:v.email()})}}},400:{description:"Invalid user ID format",summary:"Validation Error",content:{"application/json":{schema:v.object({errors:v.record(v.string(),v.string())})}}},404:{description:"User not found with the provided ID",summary:"User Not Found",content:{"application/json":{schema:v.object({message:v.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:v.object({message:v.string()})}}}}},Bs={method:"put",path:"/users",tags:["Users"],summary:"Update authenticated user",security:[{bearerAuth:[]}],request:{body:{content:{"multipart/form-data":{schema:Qo}}}},responses:{200:{description:"User profile updated successfully",summary:"User Updated",content:{"application/json":{schema:v.object({message:v.string()})}}},400:{description:"Invalid input data or file format",summary:"Validation Error",content:{"application/json":{schema:v.object({errors:v.record(v.string(),v.string())})}}},401:{description:"User not authenticated or unauthorized",summary:"Authentication Required",content:{"application/json":{schema:v.object({message:v.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:v.object({message:v.string()})}}}}},ks={method:"delete",path:"/users",tags:["Users"],summary:"Delete authenticated user",security:[{bearerAuth:[]}],request:{params:Yo},responses:{200:{description:"User account deleted successfully",summary:"User Deleted",content:{"application/json":{schema:v.object({message:v.string()})}}},400:{description:"Invalid request parameters",summary:"Validation Error",content:{"application/json":{schema:v.object({errors:v.record(v.string(),v.string())})}}},401:{description:"User not authenticated or unauthorized",summary:"Authentication Required",content:{"application/json":{schema:v.object({message:v.string()})}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:v.object({message:v.string()})}}}}},Ls={method:"get",path:"/users",tags:["Users"],summary:"List users",responses:{200:{description:"Complete list of users retrieved successfully",summary:"Users Retrieved",content:{"application/json":{schema:v.array(v.object({id:v.string(),name:v.string(),createdAt:v.date(),updatedAt:v.date(),role:v.enum(Ns.UserRole),lattesUrl:v.url().nullable(),orcid:v.string().nullable(),phone:v.string().nullable(),avatarUrl:v.string().nullable(),emailAddress:v.email()}))}}},500:{description:"Internal server error occurred",summary:"Server Error",content:{"application/json":{schema:v.object({message:v.string()})}}}}};var E=new gc;E.registerComponent("securitySchemes","bearerAuth",{type:"http",scheme:"bearer",bearerFormat:"JWT"});E.registerPath(hi);E.registerPath(gi);E.registerPath(Ri);E.registerPath(Ii);E.registerPath(wi);E.registerPath(Ci);E.registerPath(bi);E.registerPath(Os);E.registerPath(Bs);E.registerPath(ks);E.registerPath(Ls);E.registerPath(ms);E.registerPath(cs);E.registerPath(ps);E.registerPath(ds);E.registerPath(Ei);E.registerPath(Si);E.registerPath(vi);E.registerPath(Ti);E.registerPath(ji);E.registerPath(Es);E.registerPath(Ss);E.registerPath(vs);E.registerPath(Ts);E.registerPath(js);E.registerPath(Bi);E.registerPath(ki);E.registerPath(Li);E.registerPath(Hi);E.registerPath(_i);E.registerPath(Ms);E.registerPath(xs);E.registerPath(Ps);E.registerPath(As);E.registerPath(Us);E.registerPath(Ds);E.registerPath(xi);E.registerPath(Pi);E.registerPath(Ai);E.registerPath(Ui);E.registerPath(Di);E.registerPath(gs);E.registerPath(Rs);E.registerPath(Is);E.registerPath(bs);E.registerPath(ws);E.registerPath(Yi);E.registerPath(Ji);E.registerPath(Xi);E.registerPath(Qi);E.registerPath(es);E.registerPath(rs);E.registerPath(os);E.registerPath(is);E.registerPath(ss);E.registerPath(ns);E.registerPath(Wi);E.registerPath(Zi);E.registerPath(Vi);E.registerPath(Ki);E.registerPath(Gi);var Ic=new Rc(E.definitions),Hs=Ic.generateDocument({openapi:"3.0.0",info:{title:"API da Rede CT",version:"1.0.0",description:"API com valida\xE7\xE3o Zod"}});import{Router as Tc}from"express";import{extendZodWithOpenApi as bc}from"@asteasolutions/zod-to-openapi";import ei from"zod";bc(ei);var wc=ei.object({authenticatedUserId:ei.uuid()}),lr=class{constructor(e){this.userRepository=e}async handle(e,r){try{let{authenticatedUserId:t}=wc.parse({authenticatedUserId:e.user.id}),i=await this.userRepository.findById(t);if(!i)throw new g("Usu\xE1rio n\xE3o encontrado.");return r.status(200).json(i)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{PrismaClient as Cc}from"@prisma/client";var x=new Cc({log:["warn","error"]});var fr=class{constructor(e){this.prisma=e}async register({userId:e,title:r,description:t,certificationUrl:i}){await this.prisma.certification.create({data:{title:r,description:t,certificationUrl:i,user:{connect:{id:e}}}})}async find({pagination:{offset:e,limit:r},filter:{description:t,orderBy:i,title:s,userId:n}}){let a={};return n&&(a.userId=n),s&&(a.title={contains:s,mode:"insensitive"}),t&&(a.description={contains:t,mode:"insensitive"}),await this.prisma.certification.findMany({where:a,include:{user:{omit:{passwordHash:!0}}},orderBy:i?{updatedAt:i}:{updatedAt:"desc"},skip:e,take:r})}async findById(e){return await this.prisma.certification.findFirst({where:{id:e}})}async findByUserId({pagination:{limit:e,offset:r},filter:{description:t,orderBy:i,title:s},userId:n}){let a={userId:n};return s&&(a.title={contains:s,mode:"insensitive"}),t&&(a.description={contains:t,mode:"insensitive"}),await this.prisma.certification.findMany({where:a,include:{user:{omit:{passwordHash:!0}}},skip:r,take:e,orderBy:i?{updatedAt:i}:{updatedAt:"desc"}})}async update({id:e,...r}){await this.prisma.certification.update({where:{id:e},data:r})}async deleteById(e){await this.prisma.certification.delete({where:{id:e}})}async count({filter:{description:e,title:r,userId:t}}){let i={};r&&(i.title={contains:r,mode:"insensitive"});let s=[];return e&&s.push({description:{contains:e,mode:"insensitive"}}),t&&s.push({userId:t}),s.length>0&&(i.OR=s),await this.prisma.certification.count({where:i})}};function ue(){return new fr(x)}var yr=class{constructor(e){this.prisma=e}async create({authorId:e,...r}){return await this.prisma.news.create({data:{...r,author:{connect:{id:e}}}})}async find({pagination:{offset:e,limit:r},filter:{authorId:t,content:i,title:s,orderBy:n}}){let a={};t&&(a.authorId={contains:t,mode:"insensitive"});let c=[];return s&&c.push({title:{contains:s,mode:"insensitive"}}),i&&c.push({content:{contains:i,mode:"insensitive"}}),c.length>0&&(a.OR=c),await this.prisma.news.findMany({where:a,omit:{authorId:!0},include:{author:!0},orderBy:{updatedAt:n},skip:e,take:r})}async findById(e){return await this.prisma.news.findUnique({where:{id:e},omit:{authorId:!0},include:{author:!0}})}async findByAuthorId({authorId:e,pagination:{offset:r,limit:t},filter:{orderBy:i="desc",content:s,title:n}}){let a={authorId:e},c=[];return n&&c.push({title:{contains:n,mode:"insensitive"}}),s&&c.push({content:{contains:s,mode:"insensitive"}}),c.length>0&&(a.OR=c),await this.prisma.news.findMany({omit:{authorId:!0},where:a,orderBy:{updatedAt:i},skip:r,take:t})}async update(e){return await this.prisma.news.update({where:{id:e.id},data:{title:e.title,content:e.content,imageUrl:e.imageUrl}})}async delete(e){await this.prisma.news.delete({where:{id:e}})}async count({filter:{authorId:e,content:r,title:t}}){let i={};e&&(i.authorId={contains:e,mode:"insensitive"});let s=[];return t&&s.push({title:{contains:t,mode:"insensitive"}}),r&&s.push({content:{contains:r,mode:"insensitive"}}),s.length>0&&(i.OR=s),await this.prisma.news.count({where:i})}};function ee(){return new yr(x)}var hr=class{constructor(e){this.prisma=e}async create(e){await this.prisma.pendency.create({data:e})}async find({filter:{description:e,orderBy:r,title:t,status:i,userId:s},pagination:{limit:n,offset:a}}){let c={userId:s,AND:{status:{equals:i}}};e&&(c.description={contains:e,mode:"insensitive"});let f=[];return t&&f.push({title:{contains:t,mode:"insensitive"}}),f.length>0&&(c.OR=f),await this.prisma.pendency.findMany({where:c,orderBy:{updatedAt:r},include:{user:{omit:{passwordHash:!0}}},skip:a,take:n})}async findById(e){return await this.prisma.pendency.findFirst({where:{id:e},include:{user:{omit:{passwordHash:!0}}}})}async findByUserId({filter:{description:e,orderBy:r,title:t,status:i},pagination:{limit:s,offset:n},userId:a}){let c={userId:a,AND:{status:{equals:i}}},f=[];return e&&f.push({description:{contains:e,mode:"insensitive"}}),t&&f.push({title:{contains:t,mode:"insensitive"}}),f.length>0&&(c.OR=f),await this.prisma.pendency.findMany({where:c,orderBy:{updatedAt:r},include:{user:{omit:{passwordHash:!0}}},skip:n,take:s})}async update({id:e,...r}){await this.prisma.pendency.update({where:{id:e},data:r})}async deleteById(e){await this.prisma.pendency.delete({where:{id:e}})}async count({filter:{description:e,title:r,status:t,userId:i}}){let s={userId:i},n=[];return e&&n.push({description:{contains:e,mode:"insensitive"}}),r&&n.push({title:{contains:r,mode:"insensitive"}}),t&&n.push({status:{equals:t}}),n.length>0&&(s.OR=n),await this.prisma.pendency.count({where:s})}};function le(){return new hr(x)}var gr=class{constructor(e){this.prisma=e}async create(e){await this.prisma.user.create({data:e})}async update(e){await this.prisma.user.update({where:{id:e.id},data:{lattesUrl:e.lattesUrl??null,orcid:e.orcid??null,phone:e.phone??null,avatarUrl:e.avatarUrl??null}})}async deleteById(e){await this.prisma.user.delete({where:{id:e}})}async find(){return await this.prisma.user.findMany({omit:{passwordHash:!0}})}async findByEmail(e){return await this.prisma.user.findFirst({where:{emailAddress:e}})}async findById(e){return await this.prisma.user.findFirst({where:{id:e},omit:{passwordHash:!0}})}};function k(){return new gr(x)}import{compare as Ec,hash as Sc}from"bcryptjs";var Rr=class{constructor(e,r){this.hashFn=e;this.compareFn=r}async hash(e){return await this.hashFn(e,6)}async compare({password:e,hashedPassword:r}){return await this.compareFn(e,r)}};function ti(){return new Rr(Sc,Ec)}import _s from"jsonwebtoken";import L from"zod";var vc=L.object({JWT_SECRET:L.string(),FIREBASE_BUCKET:L.string(),FIREBASE_CLIENT_EMAIL:L.string(),FIREBASE_PRIVATE_KEY:L.string(),FIREBASE_PROJECT_ID:L.string(),FIREBASE_TYPE:L.string(),FIREBASE_PRIVATE_KEY_ID:L.string(),FIREBASE_CLIENT_ID:L.string(),FIREBASE_AUTH_URI:L.string(),FIREBASE_TOKEN_URI:L.string(),FIREBASE_AUTH_PROVIDER_X509_CERT_URL:L.string(),FIREBASE_CLIENT_X509_CERT_URL:L.string()}),q=vc.parse(process.env);var Ir=class{constructor(e,r){this.signFn=e;this.verifyFn=r}sign(e){try{return this.signFn(e,q.JWT_SECRET,{expiresIn:"3d",subject:e.id})}catch{return null}}verify(e){try{return this.verifyFn(e,q.JWT_SECRET)}catch{return null}}};function br(){return new Ir(_s.sign,_s.verify)}function zs(){return{signUpController:new it(k(),ti())}}function Ws(){return{signInController:new rt(k(),ti(),br())}}function Zs(){return{findAuthenticatedUserController:new lr(k())}}function Vs(){return{findAuthenticatedUserController:new Qe(ee())}}function Ks(){return{findAuthenticatedUserCertificationsController:new Xe(ue())}}function Gs(){return{findAuthenticatedUserPendenciesController:new et(le())}}var wr=class{constructor(e){this.jwtService=e}authenticated(e,r,t){let i=e.headers.authorization;if(!i?.startsWith("Bearer "))return r.status(401).json({message:"Token inv\xE1lido.",invalid:!0});let s=i.split(" ")[1];if(!s)return r.status(401).json({message:"Token n\xE3o fornecido."});try{let n=this.jwtService.verify(s);if(!n)return r.status(401).json({message:"Token inv\xE1lido.",invalid:!0});e.user=n,t()}catch(n){if(console.log(n),n instanceof Error)return r.status(401).json({message:n.message})}}isAdmin(e,r,t){let i=e.headers.authorization;if(!i?.startsWith("Bearer "))return r.status(401).json({message:"Token inv\xE1lido.",invalid:!0});let s=i.split(" ")[1];if(!s)return r.status(401).json({message:"Token n\xE3o fornecido."});try{let n=this.jwtService.verify(s);if(!n)return r.status(401).json({message:"Token inv\xE1lido.",invalid:!0});if(n.role!=="ADMIN")return r.status(401).json({message:"\xC9 necess\xE1rio ter permiss\xF5es de administrador."});t()}catch(n){if(console.log(n),n instanceof Error)return r.status(401).json({message:n.message})}}};function M(){return{authMiddleware:new wr(br())}}var te=Tc(),{authMiddleware:Ke}=M();te.post("/sign-up",async(o,e)=>{let{signUpController:r}=zs();await r.handle(o,e)});te.post("/sign-in",async(o,e)=>{let{signInController:r}=Ws();await r.handle(o,e)});te.get("/user",(o,e,r)=>{Ke.authenticated(o,e,r)},async(o,e)=>{let{findAuthenticatedUserController:r}=Zs();await r.handle(o,e)});te.get("/user/news",(o,e,r)=>{Ke.authenticated(o,e,r)},async(o,e)=>{let{findAuthenticatedUserController:r}=Vs();await r.handle(o,e)});te.get("/admin",(o,e,r)=>{Ke.isAdmin(o,e,r)},(o,e)=>{try{e.status(200).json({success:!0})}catch(r){r instanceof Error&&e.status(500).json({message:r.message})}});te.get("/certifications",(o,e,r)=>{Ke.authenticated(o,e,r)},async(o,e)=>{let{findAuthenticatedUserCertificationsController:r}=Ks();await r.handle(o,e)});te.get("/pendencies",(o,e,r)=>{Ke.authenticated(o,e,r)},async(o,e)=>{let{findAuthenticatedUserPendenciesController:r}=Gs();await r.handle(o,e)});import{Router as Uc}from"express";import{getStorage as Mc}from"firebase-admin/storage";import{config as jc}from"dotenv";import $s from"firebase-admin";jc();var ri=$s.initializeApp({credential:$s.credential.cert({clientEmail:q.FIREBASE_CLIENT_EMAIL,privateKey:q.FIREBASE_PRIVATE_KEY,projectId:q.FIREBASE_PROJECT_ID,type:q.FIREBASE_TYPE,privateKeyId:q.FIREBASE_PRIVATE_KEY_ID,clientId:q.FIREBASE_CLIENT_ID,authUri:q.FIREBASE_AUTH_URI,tokenUri:q.FIREBASE_TOKEN_URI,authProviderX509CertUrl:q.FIREBASE_AUTH_PROVIDER_X509_CERT_URL,clientX509CertUrl:q.FIREBASE_CLIENT_X509_CERT_URL}),storageBucket:q.FIREBASE_BUCKET});ri.name?console.log("\u{1F525} Firebase conectado com sucesso!"):console.error("\u274C Erro ao se conectar ao Firebase.");var xc=Mc(ri),Ys=xc.bucket(q.FIREBASE_BUCKET);import{randomUUID as Pc}from"node:crypto";var Ac=/https:\/\/storage\.googleapis\.com\/[^/]+\/(.+)$/,Cr=class{constructor(e){this.bucket=e}async uploadFile({file:e,folder:r,id:t}){let i=`${Pc()}-${e?.originalname}`,s=this.bucket.file(`${r}/${t}/${i}`);return await new Promise((n,a)=>{let c=s.createWriteStream({metadata:{contentType:e?.mimetype}});c.on("error",f=>{a(f)}),c.on("finish",async()=>{try{await s.makePublic();let f=`https://storage.googleapis.com/${this.bucket.name}/${s.name}`;n(f)}catch(f){a(f)}}),c.end(e.buffer)})}async updateFile({file:e,id:r,fileUrl:t,folder:i}){try{let s=this.getPath(t);if(!s)throw new Error("Arquivo n\xE3o encontrado.");let[n,a]=await Promise.all([this.bucket.file(s).delete(),this.uploadFile({file:e,id:r,folder:i})]);return a}catch{throw new Error("Erro ao atualizar o arquivo.")}}async deleteFile({fileUrl:e}){let r=this.getPath(e);if(!r)throw new Error("Arquivo n\xE3o encontrado.");try{await this.bucket.file(r).delete()}catch{throw new Error("Erro ao deletar o arquivo.")}}getPath(e){let r=e.match(Ac);return r?r[1]:null}};function P(){return new Cr(Ys)}function Js(){return{registerCertificationController:new mt(k(),ue(),P())}}function Xs(){return{findCertificationsController:new at(ue())}}function Qs(){return{findCertificationByIdController:new nt(ue())}}function en(){return{updateCertificationController:new pt(ue(),P())}}function tn(){return{deleteCertificationController:new st(ue(),P())}}import rn from"multer";var N=rn({storage:rn.memoryStorage()});var be=Uc(),{authMiddleware:Ge}=M();be.post("/:user_id",(o,e,r)=>{Ge.isAdmin(o,e,r)},N.single("certification"),async(o,e)=>{let{registerCertificationController:r}=Js();await r.handle(o,e)});be.get("/",(o,e,r)=>{Ge.isAdmin(o,e,r)},async(o,e)=>{let{findCertificationsController:r}=Xs();await r.handle(o,e)});be.get("/:certification_id",(o,e,r)=>{Ge.isAdmin(o,e,r)},async(o,e)=>{let{findCertificationByIdController:r}=Qs();await r.handle(o,e)});be.put("/:certification_id",(o,e,r)=>{Ge.isAdmin(o,e,r)},N.single("certification"),async(o,e)=>{let{updateCertificationController:r}=en();await r.handle(o,e)});be.delete("/:certification_id",(o,e,r)=>{Ge.isAdmin(o,e,r)},async(o,e)=>{let{deleteCertificationController:r}=tn();await r.handle(o,e)});import{Router as Oc}from"express";import{extendZodWithOpenApi as Dc}from"@asteasolutions/zod-to-openapi";import re from"zod";var Fc=1,qc=9;Dc(re);var Nc=re.object({page:re.coerce.number().min(1).default(Fc),limit:re.coerce.number().min(1).default(qc),code:re.string().optional(),title:re.string().optional(),description:re.string().optional(),notes:re.string().optional(),orderBy:re.enum(["asc","desc"]).optional()}),Er=class{constructor(e){this.etpRepository=e}async handle(e,r){try{let{page:t,limit:i,...s}=Nc.parse(e.query),n=i*t-i,[a,c]=await Promise.all([this.etpRepository.find({pagination:{offset:n,limit:i},filter:s}),this.etpRepository.count({filter:s})]),f=Math.max(Math.ceil(c/i),1);r.status(200).json({page:t,totalPages:f,offset:n,limit:i,etps:a})}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Sr=class{constructor(e){this.prisma=e}async create(e){let{leaderId:r,deputyLeaderId:t,secretaryId:i,memberIds:s,...n}=e;return await this.prisma.$transaction(async a=>{let c=await a.eTP.create({data:n});return await a.eTPLeader.create({data:{etpId:c.id,researcherId:r}}),await a.eTPDeputy.create({data:{etpId:c.id,researcherId:t}}),await a.eTPSecretary.create({data:{etpId:c.id,researcherId:i}}),await a.eTP.update({where:{id:c.id},data:{members:{connect:s.map(f=>({id:f}))}}}),c})}async update(e){let{leaderId:r,deputyLeaderId:t,secretaryId:i,memberIds:s,...n}=e;return await this.prisma.$transaction(async a=>{let c=await a.eTP.update({where:{id:e.id},data:n});return await this.updateLeader(a,e.id,r),await this.updateDeputyLeader(a,e.id,t),await this.updateSecretary(a,e.id,i),await this.updateMembers(a,e.id,s),c})}async updateLeader(e,r,t){t!==void 0&&(await e.eTPLeader.deleteMany({where:{etpId:r}}),t&&await e.eTPLeader.create({data:{etpId:r,researcherId:t}}))}async updateDeputyLeader(e,r,t){t!==void 0&&(await e.eTPDeputy.deleteMany({where:{etpId:r}}),t&&await e.eTPDeputy.create({data:{etpId:r,researcherId:t}}))}async updateSecretary(e,r,t){t!==void 0&&(await e.eTPSecretary.deleteMany({where:{etpId:r}}),t&&await e.eTPSecretary.create({data:{etpId:r,researcherId:t}}))}async updateMembers(e,r,t){t!==void 0&&await e.eTP.update({where:{id:r},data:{members:{set:t.map(i=>({id:i}))}}})}async deleteById(e){await this.prisma.eTP.delete({where:{id:e}})}async find({pagination:{offset:e,limit:r},filter:{code:t,title:i,description:s,notes:n,orderBy:a}}){let c={};return t&&(c.code={contains:t,mode:"insensitive"}),i&&(c.title={contains:i,mode:"insensitive"}),s&&(c.description={contains:s,mode:"insensitive"}),n&&(c.notes={contains:n,mode:"insensitive"}),await this.prisma.eTP.findMany({where:c,include:{leader:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},deputyLeader:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},secretary:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},members:{include:{user:{omit:{passwordHash:!0}}}}},orderBy:a?{updatedAt:a}:{updatedAt:"desc"},skip:e,take:r})}async findById(e){return await this.prisma.eTP.findFirst({where:{id:e},include:{leader:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},deputyLeader:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},secretary:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},members:{include:{user:{omit:{passwordHash:!0}}}}}})}async findByCode(e){return await this.prisma.eTP.findFirst({where:{code:e},include:{leader:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},deputyLeader:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},secretary:{include:{researcher:{include:{user:{omit:{passwordHash:!0}}}}}},members:{include:{user:{omit:{passwordHash:!0}}}}}})}async count({filter:{code:e,title:r,description:t,notes:i}}){let s={};return e&&(s.code={contains:e,mode:"insensitive"}),r&&(s.title={contains:r,mode:"insensitive"}),t&&(s.description={contains:t,mode:"insensitive"}),i&&(s.notes={contains:i,mode:"insensitive"}),await this.prisma.eTP.count({where:s})}};function qe(){return new Sr(x)}function on(){return{createETPController:new ut(qe())}}function sn(){return{findETPsController:new Er(qe())}}function nn(){return{findETPByIdController:new ft(qe())}}function an(){return{updateETPController:new ht(qe())}}function mn(){return{deleteETPController:new lt(qe())}}var we=Oc(),{authMiddleware:oi}=M();we.post("/",(o,e,r)=>{oi.authenticated(o,e,r)},async(o,e)=>{let{createETPController:r}=on();await r.handle(o,e)});we.get("/",async(o,e)=>{let{findETPsController:r}=sn();await r.handle(o,e)});we.get("/:id",async(o,e)=>{let{findETPByIdController:r}=nn();await r.handle(o,e)});we.put("/:id",(o,e,r)=>{oi.authenticated(o,e,r)},async(o,e)=>{let{updateETPController:r}=an();await r.handle(o,e)});we.delete("/:id",(o,e,r)=>{oi.authenticated(o,e,r)},async(o,e)=>{let{deleteETPController:r}=mn();await r.handle(o,e)});import{Router as Bc}from"express";var vr=class{constructor(e){this.prisma=e}async create(e){await this.prisma.inMemoriam.create({data:e})}async update(e){await this.prisma.inMemoriam.update({where:{id:e.id},data:e})}async deleteById(e){await this.prisma.inMemoriam.delete({where:{id:e}})}async find({pagination:{offset:e,limit:r},filter:{name:t,biography:i,role:s,orderBy:n}}){let a={};return t&&(a.name={contains:t,mode:"insensitive"}),i&&(a.biography={contains:i,mode:"insensitive"}),s&&(a.role=s),await this.prisma.inMemoriam.findMany({where:a,orderBy:n?{updatedAt:n}:{updatedAt:"desc"},skip:e,take:r})}async findById(e){return await this.prisma.inMemoriam.findFirst({where:{id:e}})}async findByRole(e){return await this.prisma.inMemoriam.findMany({where:{role:e}})}async count({filter:{name:e,biography:r,role:t}}){let i={};return e&&(i.name={contains:e,mode:"insensitive"}),r&&(i.biography={contains:r,mode:"insensitive"}),t&&(i.role=t),await this.prisma.inMemoriam.count({where:i})}};function Ce(){return new vr(x)}function cn(){return{createInMemoriamController:new Rt(Ce(),P())}}function pn(){return{findInMemoriamsController:new Et(Ce())}}function dn(){return{findInMemoriamByIdController:new bt(Ce())}}function un(){return{findInMemoriamByRoleController:new Ct(Ce())}}function ln(){return{updateInMemoriamController:new St(Ce(),P())}}function fn(){return{deleteInMemoriamController:new It(Ce(),P())}}var fe=Bc(),{authMiddleware:ii}=M();fe.post("/",(o,e,r)=>{ii.authenticated(o,e,r)},N.single("photo"),async(o,e)=>{let{createInMemoriamController:r}=cn();await r.handle(o,e)});fe.get("/",async(o,e)=>{let{findInMemoriamsController:r}=pn();await r.handle(o,e)});fe.get("/:id",async(o,e)=>{let{findInMemoriamByIdController:r}=dn();await r.handle(o,e)});fe.get("/role/:role",async(o,e)=>{let{findInMemoriamByRoleController:r}=un();await r.handle(o,e)});fe.put("/:id",(o,e,r)=>{ii.authenticated(o,e,r)},N.single("photo"),async(o,e)=>{let{updateInMemoriamController:r}=ln();await r.handle(o,e)});fe.delete("/:id",(o,e,r)=>{ii.authenticated(o,e,r)},async(o,e)=>{let{deleteInMemoriamController:r}=fn();await r.handle(o,e)});import{Router as kc}from"express";var si=kc();si.get("/",(o,e)=>{e.status(200).json({message:"Rede CT"})});import{Router as Wc}from"express";import{extendZodWithOpenApi as Lc}from"@asteasolutions/zod-to-openapi";import Ne from"zod";var Hc=1,_c=9;Lc(Ne);var zc=Ne.object({page:Ne.coerce.number().min(1).default(Hc),limit:Ne.coerce.number().min(1).default(_c),role:Ne.string().optional(),orderBy:Ne.enum(["asc","desc"]).optional()}),Tr=class{constructor(e){this.legitimatorCommitteeMemberRepository=e}async handle(e,r){try{let{page:t,limit:i,...s}=zc.parse(e.query),n=i*t-i,[a,c]=await Promise.all([this.legitimatorCommitteeMemberRepository.find({pagination:{offset:n,limit:i},filter:s}),this.legitimatorCommitteeMemberRepository.count({filter:s})]),f=Math.max(Math.ceil(c/i),1);r.status(200).json({page:t,totalPages:f,offset:n,limit:i,members:a})}catch(t){if(t instanceof Error)throw new m(t.message)}}};var jr=class{constructor(e){this.prisma=e}async create(e){await this.prisma.legitimatorCommitteeMember.create({data:e})}async update(e){let{id:r,...t}=e;await this.prisma.legitimatorCommitteeMember.update({where:{id:r},data:t})}async deleteById(e){await this.prisma.legitimatorCommitteeMember.delete({where:{id:e}})}async find({pagination:{offset:e,limit:r},filter:{role:t,orderBy:i}}){let s={};return t&&(s.role={contains:t,mode:"insensitive"}),await this.prisma.legitimatorCommitteeMember.findMany({where:s,include:{user:{omit:{passwordHash:!0}}},orderBy:i?{updatedAt:i}:{updatedAt:"desc"},skip:e,take:r})}async findById(e){return await this.prisma.legitimatorCommitteeMember.findFirst({where:{id:e},include:{user:{omit:{passwordHash:!0}}}})}async count({filter:{role:e}}){let r={};return e&&(r.role={contains:e,mode:"insensitive"}),await this.prisma.legitimatorCommitteeMember.count({where:r})}};function Oe(){return new jr(x)}function yn(){return{createLegitimatorCommitteeMemberController:new vt(Oe())}}function hn(){return{findLegitimatorCommitteeMembersController:new Tr(Oe())}}function gn(){return{findLegitimatorCommitteeMemberByIdController:new jt(Oe())}}function Rn(){return{updateLegitimatorCommitteeMemberController:new xt(Oe())}}function In(){return{deleteLegitimatorCommitteeMemberController:new Tt(Oe())}}var Ee=Wc(),{authMiddleware:ni}=M();Ee.post("/",(o,e,r)=>{ni.authenticated(o,e,r)},async(o,e)=>{let{createLegitimatorCommitteeMemberController:r}=yn();await r.handle(o,e)});Ee.get("/",async(o,e)=>{let{findLegitimatorCommitteeMembersController:r}=hn();await r.handle(o,e)});Ee.get("/:id",async(o,e)=>{let{findLegitimatorCommitteeMemberByIdController:r}=gn();await r.handle(o,e)});Ee.put("/:id",(o,e,r)=>{ni.authenticated(o,e,r)},async(o,e)=>{let{updateLegitimatorCommitteeMemberController:r}=Rn();await r.handle(o,e)});Ee.delete("/:id",(o,e,r)=>{ni.authenticated(o,e,r)},async(o,e)=>{let{deleteLegitimatorCommitteeMemberController:r}=In();await r.handle(o,e)});import{Router as $c}from"express";import{extendZodWithOpenApi as Zc}from"@asteasolutions/zod-to-openapi";import Se from"zod";var Vc=1,Kc=9;Zc(Se);var Gc=Se.object({page:Se.coerce.number().min(1).default(Vc),limit:Se.coerce.number().min(1).default(Kc),name:Se.string().optional(),description:Se.string().optional(),orderBy:Se.enum(["asc","desc"]).optional()}),Mr=class{constructor(e){this.managementTeamRepository=e}async handle(e,r){try{let{page:t,limit:i,...s}=Gc.parse(e.query),n=i*t-i,[a,c]=await Promise.all([this.managementTeamRepository.find({pagination:{offset:n,limit:i},filter:s}),this.managementTeamRepository.count({filter:s})]),f=Math.max(Math.ceil(c/i),1);r.status(200).json({page:t,totalPages:f,offset:n,limit:i,teams:a})}catch(t){if(t instanceof Error)throw new m(t.message)}}};var xr=class{constructor(e){this.prisma=e}async create(e){let{members:r,...t}=e;await this.prisma.$transaction(async i=>{let s=await i.managementTeam.create({data:t});return await i.managementTeamMember.createMany({data:r.map(({userId:n,role:a})=>({teamId:s.id,userId:n,role:a}))}),s})}async update(e){let{members:r,...t}=e;await this.prisma.$transaction(async i=>{let s=await i.managementTeam.update({where:{id:e.id},data:t});return r!==void 0&&(await i.managementTeamMember.deleteMany({where:{teamId:e.id}}),r.length>0&&await i.managementTeamMember.createMany({data:r.map(({userId:n,role:a})=>({teamId:e.id,userId:n,role:a}))})),s})}async deleteById(e){await this.prisma.managementTeam.delete({where:{id:e}})}async find({pagination:{offset:e,limit:r},filter:{name:t,description:i,orderBy:s}}){let n={};return t&&(n.name={contains:t,mode:"insensitive"}),i&&(n.description={contains:i,mode:"insensitive"}),await this.prisma.managementTeam.findMany({where:n,include:{members:{include:{user:{omit:{passwordHash:!0}}}}},orderBy:s?{updatedAt:s}:{updatedAt:"desc"},skip:e,take:r})}async findById(e){return await this.prisma.managementTeam.findFirst({where:{id:e},include:{members:{include:{user:{omit:{passwordHash:!0}}}}}})}async findByName(e){return await this.prisma.managementTeam.findFirst({where:{name:e},include:{members:{include:{user:{omit:{passwordHash:!0}}}}}})}async count({filter:{name:e,description:r}}){let t={};return e&&(t.name={contains:e,mode:"insensitive"}),r&&(t.description={contains:r,mode:"insensitive"}),await this.prisma.managementTeam.count({where:t})}};function Be(){return new xr(x)}function bn(){return{createManagementTeamController:new Pt(Be())}}function wn(){return{findManagementTeamsController:new Mr(Be())}}function Cn(){return{findManagementTeamByIdController:new Ut(Be())}}function En(){return{updateManagementTeamController:new Ft(Be())}}function Sn(){return{deleteManagementTeamController:new At(Be())}}var ve=$c(),{authMiddleware:ai}=M();ve.post("/",(o,e,r)=>{ai.authenticated(o,e,r)},async(o,e)=>{let{createManagementTeamController:r}=bn();await r.handle(o,e)});ve.get("/",async(o,e)=>{let{findManagementTeamsController:r}=wn();await r.handle(o,e)});ve.get("/:id",async(o,e)=>{let{findManagementTeamByIdController:r}=Cn();await r.handle(o,e)});ve.put("/:id",(o,e,r)=>{ai.authenticated(o,e,r)},async(o,e)=>{let{updateManagementTeamController:r}=En();await r.handle(o,e)});ve.delete("/:id",(o,e,r)=>{ai.authenticated(o,e,r)},async(o,e)=>{let{deleteManagementTeamController:r}=Sn();await r.handle(o,e)});import{Router as op}from"express";import{extendZodWithOpenApi as Yc}from"@asteasolutions/zod-to-openapi";import mi from"zod";Yc(mi);var Jc=mi.object({id:mi.string()}),Pr=class{constructor(e,r){this.newsRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t}=Jc.parse(e.params),i=e.user.id,s=await this.newsRepository.findById(t);if(!s)throw new g("Not\xEDcia n\xE3o encontrada.");if(s.author.id!==i)throw new H("Sem permiss\xE3o.");await Promise.all([this.newsRepository.delete(t),this.firebaseStorageService.deleteFile({fileUrl:s.imageUrl})]),r.sendStatus(200)}catch(t){if(t instanceof Error)throw new m(t.message)}}};import{extendZodWithOpenApi as Xc}from"@asteasolutions/zod-to-openapi";import ke from"zod";var Qc=5,vn=1024,ep=vn*vn,tp=Qc*ep;Xc(ke);var rp=ke.object({id:ke.string(),title:ke.string().min(1),content:ke.string().min(1),image:ke.any().optional().refine(o=>!o||typeof o=="object"&&typeof o.mimetype=="string"&&o.mimetype.startsWith("image/")&&typeof o.size=="number"&&o.size<=tp,"A imagem deve ser uma imagem v\xE1lida de no m\xE1ximo 5MB.")}),Ar=class{constructor(e,r){this.newsRepository=e;this.firebaseStorageService=r}async handle(e,r){try{let{id:t,title:i,content:s,image:n}=rp.parse({id:e.params.id,image:e.file,...e.body}),a=await this.newsRepository.findById(t);if(!a)throw new g("Not\xEDcia n\xE3o encontrada.");let c=e.user.id;if(a.author.id!==c)throw new H("Sem permiss\xE3o.");let f=a.imageUrl||"";n&&a.imageUrl&&(f=await this.firebaseStorageService.updateFile({file:n,folder:A.NEWS,id:t,fileUrl:a.imageUrl}));let T=await this.newsRepository.update({id:t,title:i,content:s,imageUrl:f});r.status(200).json(T)}catch(t){if(t instanceof Error)throw new m(t.message)}}};function Tn(){return{createNewsController:new Lt(ee(),P())}}function jn(){return{findAllNewsController:new Wt(ee())}}function Mn(){return{findNewsByIdController:new zt(ee())}}function xn(){return{findNewsByAuthorIdController:new Ht(ee())}}function Pn(){return{updateNewsController:new Ar(ee(),P())}}function An(){return{deleteNewsController:new Pr(ee(),P())}}var ye=op(),{authMiddleware:ci}=M();ye.post("/",(o,e,r)=>{ci.authenticated(o,e,r)},N.single("image"),async(o,e)=>{let{createNewsController:r}=Tn();await r.handle(o,e)});ye.get("/",async(o,e)=>{let{findAllNewsController:r}=jn();await r.handle(o,e)});ye.get("/:id",async(o,e)=>{let{findNewsByIdController:r}=Mn();await r.handle(o,e)});ye.get("/author/:authorId",async(o,e)=>{let{findNewsByAuthorIdController:r}=xn();await r.handle(o,e)});ye.put("/:id",(o,e,r)=>{ci.authenticated(o,e,r)},N.single("image"),async(o,e)=>{let{updateNewsController:r}=Pn();await r.handle(o,e)});ye.delete("/:id",(o,e,r)=>{ci.authenticated(o,e,r)},async(o,e)=>{let{deleteNewsController:r}=An();await r.handle(o,e)});import{Router as ip}from"express";var Ur=class{constructor(e){this.prisma=e}async create(e){await this.prisma.partner.create({data:e})}async update(e){await this.prisma.partner.update({where:{id:e.id},data:e})}async deleteById(e){await this.prisma.partner.delete({where:{id:e}})}async find({pagination:{offset:e,limit:r},filter:{name:t,description:i,category:s,isActive:n,orderBy:a}}){let c={};return t&&(c.name={contains:t,mode:"insensitive"}),i&&(c.description={contains:i,mode:"insensitive"}),s&&(c.category={contains:s,mode:"insensitive"}),n!==void 0&&(c.isActive=n),await this.prisma.partner.findMany({where:c,orderBy:a?{updatedAt:a}:{updatedAt:"desc"},skip:e,take:r})}async findById(e){return await this.prisma.partner.findFirst({where:{id:e}})}async count({filter:{name:e,description:r,category:t,isActive:i}}){let s={};return e&&(s.name={contains:e,mode:"insensitive"}),r&&(s.description={contains:r,mode:"insensitive"}),t&&(s.category={contains:t,mode:"insensitive"}),i!==void 0&&(s.isActive=i),await this.prisma.partner.count({where:s})}};function Le(){return new Ur(x)}function Un(){return{createPartnerController:new Zt(Le(),P())}}function Dn(){return{findPartnersController:new $t(Le())}}function Fn(){return{findPartnerByIdController:new Kt(Le())}}function qn(){return{updatePartnerController:new Yt(Le(),P())}}function Nn(){return{deletePartnerController:new Vt(Le(),P())}}var Te=ip(),{authMiddleware:pi}=M();Te.post("/",(o,e,r)=>{pi.authenticated(o,e,r)},N.single("logo"),async(o,e)=>{let{createPartnerController:r}=Un();await r.handle(o,e)});Te.get("/",async(o,e)=>{let{findPartnersController:r}=Dn();await r.handle(o,e)});Te.get("/:id",async(o,e)=>{let{findPartnerByIdController:r}=Fn();await r.handle(o,e)});Te.put("/:id",(o,e,r)=>{pi.authenticated(o,e,r)},N.single("logo"),async(o,e)=>{let{updatePartnerController:r}=qn();await r.handle(o,e)});Te.delete("/:id",(o,e,r)=>{pi.authenticated(o,e,r)},async(o,e)=>{let{deletePartnerController:r}=Nn();await r.handle(o,e)});import{Router as sp}from"express";function On(){return{createPendencyController:new Jt(k(),le(),P())}}function Bn(){return{findPendenciesController:new er(le())}}function kn(){return{findPendencyByIdController:new tr(le())}}function Ln(){return{updatePendencyController:new rr(le(),P())}}function Hn(){return{deletePendencyController:new Qt(le(),P())}}var je=sp(),{authMiddleware:$e}=M();je.post("/:user_id",(o,e,r)=>{$e.isAdmin(o,e,r)},N.single("document"),async(o,e)=>{let{createPendencyController:r}=On();await r.handle(o,e)});je.get("/",(o,e,r)=>{$e.isAdmin(o,e,r)},async(o,e)=>{let{findPendenciesController:r}=Bn();await r.handle(o,e)});je.get("/:pendency_id",(o,e,r)=>{$e.isAdmin(o,e,r)},async(o,e)=>{let{findPendencyByIdController:r}=kn();await r.handle(o,e)});je.put("/:pendency_id",(o,e,r)=>{$e.isAdmin(o,e,r)},N.single("document"),async(o,e)=>{let{updatePendencyController:r}=Ln();await r.handle(o,e)});je.delete("/:pendency_id",(o,e,r)=>{$e.isAdmin(o,e,r)},async(o,e)=>{let{deletePendencyController:r}=Hn();await r.handle(o,e)});import{Router as pp}from"express";import{extendZodWithOpenApi as np}from"@asteasolutions/zod-to-openapi";import B from"zod";var ap=1,mp=9;np(B);var cp=B.object({page:B.coerce.number().min(1).default(ap),limit:B.coerce.number().min(1).default(mp),userId:B.string().optional(),registrationNumber:B.string().optional(),name:B.string().optional(),emailAddress:B.string().optional(),mainEtps:B.string().optional(),formations:B.string().optional(),occupations:B.string().optional(),institutions:B.string().optional(),biography:B.string().optional(),orderBy:B.enum(["asc","desc"]).optional()}),Dr=class{constructor(e){this.researcherRepository=e}async handle(e,r){try{let{page:t,limit:i,...s}=cp.parse(e.query),n=i*t-i,[a,c]=await Promise.all([this.researcherRepository.find({pagination:{offset:n,limit:i},filter:{userName:s.name,...s}}),this.researcherRepository.count({filter:{userName:s.name,...s}})]),f=Math.max(Math.ceil(c/i),1);r.status(200).json({page:t,totalPages:f,offset:n,limit:i,researchers:a})}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Fr=class{constructor(e){this.prisma=e}async create(e){await this.prisma.researcher.create({data:e})}async update(e){await this.prisma.researcher.update({where:{id:e.id},data:e})}async deleteById(e){await this.prisma.researcher.delete({where:{id:e}})}async find({pagination:{offset:e,limit:r},filter:{biography:t,degrees:i,formations:s,institutions:n,mainEtps:a,occupations:c,orderBy:f,registrationNumber:T,seniority:j,userId:D,userName:Z}}){let G={OR:Z?[{user:{name:{contains:Z,mode:"insensitive"}}}]:void 0};return T&&G.OR?.push({registrationNumber:{contains:T,mode:"insensitive"}}),a&&(G.mainEtps={contains:a,mode:"insensitive"}),s&&(G.formations={contains:s,mode:"insensitive"}),i&&i.length>0&&(G.degrees={hasSome:i}),c&&(G.occupations={contains:c,mode:"insensitive"}),j&&(G.seniority=j),n&&(G.institutions={contains:n,mode:"insensitive"}),t&&(G.biography={contains:t,mode:"insensitive"}),D&&(G.userId={equals:D}),await this.prisma.researcher.findMany({where:G,omit:{userId:!0},include:{user:{omit:{passwordHash:!0}}},orderBy:f?{updatedAt:f}:{updatedAt:"desc"},skip:e,take:r})}async findById(e){return await this.prisma.researcher.findFirst({where:{id:e},include:{user:{omit:{passwordHash:!0}}}})}async findByUserId(e){return await this.prisma.researcher.findFirst({where:{userId:e},include:{user:{omit:{passwordHash:!0}}}})}async findByRegistrationNumber(e){return await this.prisma.researcher.findFirst({where:{registrationNumber:e},include:{user:{omit:{passwordHash:!0}}}})}async count({filter:{biography:e,degrees:r,formations:t,institutions:i,mainEtps:s,occupations:n,registrationNumber:a,seniority:c,userId:f,userName:T}}){let j={OR:T?[{user:{name:{contains:T,mode:"insensitive"}}}]:void 0};return a&&j.OR?.push({registrationNumber:{contains:a,mode:"insensitive"}}),s&&(j.mainEtps={contains:s,mode:"insensitive"}),t&&(j.formations={contains:t,mode:"insensitive"}),r&&r.length>0&&(j.degrees={hasSome:r}),n&&(j.occupations={contains:n,mode:"insensitive"}),c&&(j.seniority=c),i&&(j.institutions={contains:i,mode:"insensitive"}),e&&(j.biography={contains:e,mode:"insensitive"}),f&&(j.userId={equals:f}),await this.prisma.researcher.count({where:j})}};function Me(){return new Fr(x)}function _n(){return{createResearcherController:new ir(Me())}}function zn(){return{findResearchersController:new Dr(Me())}}function Wn(){return{findResearcherByIdController:new nr(Me())}}function Zn(){return{findResearcherByUserIdController:new mr(Me())}}function Vn(){return{updateResearcherController:new cr(Me())}}function Kn(){return{deleteResearcherController:new sr(Me())}}var he=pp(),{authMiddleware:di}=M();he.post("/",(o,e,r)=>{di.authenticated(o,e,r)},async(o,e)=>{let{createResearcherController:r}=_n();await r.handle(o,e)});he.get("/",async(o,e)=>{let{findResearchersController:r}=zn();await r.handle(o,e)});he.get("/:id",async(o,e)=>{let{findResearcherByIdController:r}=Wn();await r.handle(o,e)});he.get("/user/:userId",async(o,e)=>{let{findResearcherByUserIdController:r}=Zn();await r.handle(o,e)});he.put("/:id",(o,e,r)=>{di.authenticated(o,e,r)},async(o,e)=>{let{updateResearcherController:r}=Vn();await r.handle(o,e)});he.delete("/:id",(o,e,r)=>{di.authenticated(o,e,r)},async(o,e)=>{let{deleteResearcherController:r}=Kn();await r.handle(o,e)});import{Router as yp}from"express";import{extendZodWithOpenApi as dp}from"@asteasolutions/zod-to-openapi";import He from"zod";var up=1,lp=9;dp(He);var fp=He.object({page:He.coerce.number().min(1).default(up),limit:He.coerce.number().min(1).default(lp),role:He.string().optional(),orderBy:He.enum(["asc","desc"]).optional()}),qr=class{constructor(e){this.sdhcTeamMemberRepository=e}async handle(e,r){try{let{page:t,limit:i,...s}=fp.parse(e.query),n=i*t-i,[a,c]=await Promise.all([this.sdhcTeamMemberRepository.find({pagination:{offset:n,limit:i},filter:s}),this.sdhcTeamMemberRepository.count({filter:s})]),f=Math.max(Math.ceil(c/i),1);r.status(200).json({page:t,totalPages:f,offset:n,limit:i,members:a})}catch(t){if(t instanceof Error)throw new m(t.message)}}};var Nr=class{constructor(e){this.prisma=e}async create(e){await this.prisma.sDHCTeamMember.create({data:e})}async update(e){let{id:r,...t}=e;await this.prisma.sDHCTeamMember.update({where:{id:r},data:t})}async deleteById(e){await this.prisma.sDHCTeamMember.delete({where:{id:e}})}async find({pagination:{offset:e,limit:r},filter:{role:t,orderBy:i}}){let s={};return t&&(s.role={contains:t,mode:"insensitive"}),await this.prisma.sDHCTeamMember.findMany({where:s,include:{user:{omit:{passwordHash:!0}}},orderBy:i?{updatedAt:i}:{updatedAt:"desc"},skip:e,take:r})}async findById(e){return await this.prisma.sDHCTeamMember.findFirst({where:{id:e},include:{user:{omit:{passwordHash:!0}}}})}async count({filter:{role:e}}){let r={};return e&&(r.role={contains:e,mode:"insensitive"}),await this.prisma.sDHCTeamMember.count({where:r})}};function _e(){return new Nr(x)}function Gn(){return{createSDHCTeamMemberController:new qt(_e())}}function $n(){return{findSDHCTeamMembersController:new qr(_e())}}function Yn(){return{findSDHCTeamMemberByIdController:new Ot(_e())}}function Jn(){return{updateSDHCTeamMemberController:new kt(_e())}}function Xn(){return{deleteSDHCTeamMemberController:new Nt(_e())}}var xe=yp(),{authMiddleware:ui}=M();xe.post("/",(o,e,r)=>{ui.authenticated(o,e,r)},async(o,e)=>{let{createSDHCTeamMemberController:r}=Gn();await r.handle(o,e)});xe.get("/",async(o,e)=>{let{findSDHCTeamMembersController:r}=$n();await r.handle(o,e)});xe.get("/:id",async(o,e)=>{let{findSDHCTeamMemberByIdController:r}=Yn();await r.handle(o,e)});xe.put("/:id",(o,e,r)=>{ui.authenticated(o,e,r)},async(o,e)=>{let{updateSDHCTeamMemberController:r}=Jn();await r.handle(o,e)});xe.delete("/:id",(o,e,r)=>{ui.authenticated(o,e,r)},async(o,e)=>{let{deleteSDHCTeamMemberController:r}=Xn();await r.handle(o,e)});import{Router as hp}from"express";var Or=class{constructor(e){this.userRepository=e}async handle(e,r){try{let t=await this.userRepository.find();r.status(200).json(t)}catch(t){if(t instanceof Error)throw new m(t.message)}}};function Qn(){return{updateUserController:new ur(k(),P())}}function ea(){return{deleteUserController:new pr(k())}}function ta(){return{findUsersController:new Or(k())}}function ra(){return{findUserController:new dr(k())}}var ze=hp(),{authMiddleware:oa}=M();ze.get("/:id",async(o,e)=>{let{findUserController:r}=ra();await r.handle(o,e)});ze.put("/",(o,e,r)=>{oa.authenticated(o,e,r)},N.single("avatarImage"),async(o,e)=>{let{updateUserController:r}=Qn();await r.handle(o,e)});ze.delete("/:id",(o,e,r)=>{oa.authenticated(o,e,r)},async(o,e)=>{let{deleteUserController:r}=ea();await r.handle(o,e)});ze.get("/",async(o,e)=>{let{findUsersController:r}=ta();await r.handle(o,e)});var U=li(),Ip={methods:["GET","POST","PUT","DELETE"],origin:["http://localhost:3000","https://rede-ct.vercel.app"],credentials:!0};U.use(Rp(Ip));U.use(li.json());U.use(li.urlencoded({extended:!1}));U.use("/docs",gp({content:Hs,theme:"kepler"}));U.use("/",si);U.use("/auth",te);U.use("/user",ze);U.use("/news",ye);U.use("/certification",be);U.use("/pendency",je);U.use("/researcher",he);U.use("/in-memoriam",fe);U.use("/etp",we);U.use("/partner",Te);U.use("/management-team",ve);U.use("/sdhc-team-member",xe);U.use("/legitimator-committee-member",Ee);U.use((o,e,r,t)=>{let{errorHandler:i}=fi();i.handle(o,e,r,t)});var wp=bp.createServer(U),ia=4e3;wp.listen(ia,()=>{console.log(`\u{1F680} Aplica\xE7\xE3o rodando na porta ${ia}.`)});
